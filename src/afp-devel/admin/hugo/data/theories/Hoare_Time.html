<div id="AExp">
<div class="head">
<h1>Theory AExp</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Arithmetic and Boolean Expressions"</span></span>

<span class="keyword1"><span class="command">theory</span></span> AExp <span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Arithmetic Expressions"</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> vname <span class="main">=</span> <span class="quoted">string</span>
<span class="keyword1"><span class="command">type_synonym</span></span> val <span class="main">=</span> <span class="quoted">int</span>
<span class="keyword1"><span class="command">type_synonym</span></span> state <span class="main">=</span> <span class="quoted"><span class="quoted">"vname <span class="main">⇒</span> val"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> aexp <span class="main">=</span> N <span class="quoted">int</span> <span class="main">|</span> V <span class="quoted">vname</span> <span class="main">|</span> Plus <span class="quoted">aexp</span> <span class="quoted">aexp</span> <span class="main">|</span> Times <span class="quoted">aexp</span> <span class="quoted">aexp</span> <span class="main">|</span> Div <span class="quoted">aexp</span> <span class="quoted">aexp</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">aval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"aexp <span class="main">⇒</span> state <span class="main">⇒</span> val"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">aval</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">aval</span> <span class="main">(</span>V <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">aval</span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">aval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free">aval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">aval</span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">aval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">*</span> <span class="free">aval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span><span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">aval</span> <span class="main">(</span>Div <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">aval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">div</span> <span class="free">aval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>


<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"aval <span class="main">(</span>Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="numeral">5</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span> <span class="main">=</span> <span class="inner_quoted">''x''</span> <span class="keyword1">then</span> <span class="numeral">7</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The same state more concisely:›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"aval <span class="main">(</span>Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="numeral">5</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">(</span><span class="inner_quoted">''x''</span><span class="main">:=</span> <span class="numeral">7</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A little syntax magic to write larger states compactly:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">null_state</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">&lt;&gt;</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">null_state</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">x</span><span class="main">.</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command">syntax</span></span> 
  <span class="quoted">"_State"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"updbinds <span class="main">=&gt;</span> <span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">&lt;</span>_<span class="keyword1">&gt;</span>"</span><span class="main">)</span>
<span class="keyword1"><span class="command">translations</span></span>
  <span class="quoted">"_State <span class="free">ms</span>"</span> <span class="main">==</span> <span class="quoted">"_Update <span class="main">&lt;&gt;</span> <span class="free">ms</span>"</span>
  <span class="quoted">"_State <span class="main">(</span>_updbinds <span class="free">b</span> <span class="free">bs</span><span class="main">)</span>"</span> <span class="main">&lt;=</span> <span class="quoted">"_Update <span class="main">(</span>_State <span class="free">b</span><span class="main">)</span> <span class="free">bs</span>"</span>
 
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="BExp">
<div class="head">
<h1>Theory BExp</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> BExp <span class="keyword2"><span class="keyword">imports</span></span> <a href="AExp.html">AExp</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Boolean Expressions"</span></span>

<span class="keyword1"><span class="command">datatype</span></span> bexp <span class="main">=</span> Bc <span class="quoted">bool</span> <span class="main">|</span> Not <span class="quoted">bexp</span> <span class="main">|</span> And <span class="quoted">bexp</span> <span class="quoted">bexp</span> <span class="main">|</span> Less <span class="quoted">aexp</span> <span class="quoted">aexp</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">bval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bexp <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">bval</span> <span class="main">(</span>Bc <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">bval</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">bval</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">bval</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">bval</span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="free">bval</span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">bval</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span>aval <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">&lt;</span> aval <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"bval <span class="main">(</span>Less <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>Plus <span class="main">(</span>N <span class="numeral">3</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
            <span class="main">&lt;</span><span class="inner_quoted">''x''</span> <span class="main">:=</span> <span class="numeral">3</span><span class="main">,</span> <span class="inner_quoted">''y''</span> <span class="main">:=</span> <span class="main">1</span><span class="main">&gt;</span>"</span></span>
 
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Com">
<div class="head">
<h1>Theory Com</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"IMP --- A Simple Imperative Language"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Com <span class="keyword2"><span class="keyword">imports</span></span> <a href="BExp.html">BExp</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span>
  com <span class="main">=</span> SKIP 
      <span class="main">|</span> Assign <span class="quoted">vname</span> <span class="quoted">aexp</span>       <span class="main">(</span><span class="quoted">"_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">::=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _"</span> <span class="main">[</span>1000<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span>
      <span class="main">|</span> Seq    <span class="quoted">com</span>  <span class="quoted">com</span>         <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span>  <span class="main">[</span>60<span class="main">,</span> 61<span class="main">]</span> 60<span class="main">)</span>
      <span class="main">|</span> If     <span class="quoted">bexp</span> <span class="quoted">com</span> <span class="quoted">com</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">IF</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">THEN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">ELSE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span>
      <span class="main">|</span> While  <span class="quoted">bexp</span> <span class="quoted">com</span>         <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">WHILE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">DO</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Big_Step">
<div class="head">
<h1>Theory Big_Step</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Gerwin Klein, Tobias Nipkow *)</span>

<span class="keyword1"><span class="command">theory</span></span> Big_Step <span class="keyword2"><span class="keyword">imports</span></span> <a href="Com.html">Com</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Big-Step Semantics of Commands"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
The big-step semantics is a straight-forward inductive definition
with concrete syntax. Note that the first parameter is a tuple,
so the syntax becomes <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>(c,s) ⇒ s'›</span></span></span></span>.
›</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">big_step</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">×</span> state <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">⇒</span>"</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
Skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP<span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
Assign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>3</sub></span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>3</sub></span></span></span>"</span></span> <span class="main">|</span>
IfTrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> <span class="main">|</span>
IfFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span>bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> <span class="main">|</span>
WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
WhileTrue<span class="main">:</span>
<span class="quoted"><span class="quoted">"<span class="main">⟦</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">;</span>  <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>3</sub></span></span></span> <span class="main">⟧</span> 
<span class="main">⟹</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">s<span class="hidden">⇩</span><sub>3</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We want to execute the big-step rules:›</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">big_step</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For inductive definitions we need command
       \texttt{values} instead of \texttt{value}.›</span></span>

<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>SKIP<span class="main">,</span> <span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">t</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We need to translate the result state into a list
to display it.›</span></span>

<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>map <span class="bound">t</span> <span class="main">[</span><span class="inner_quoted">''x''</span><span class="main">]</span> <span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>SKIP<span class="main">,</span> <span class="main">&lt;</span><span class="inner_quoted">''x''</span> <span class="main">:=</span> <span class="numeral">42</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">t</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>map <span class="bound">t</span> <span class="main">[</span><span class="inner_quoted">''x''</span><span class="main">]</span> <span class="main">|</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> N <span class="numeral">2</span><span class="main">,</span> <span class="main">&lt;</span><span class="inner_quoted">''x''</span> <span class="main">:=</span> <span class="numeral">42</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">t</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>map <span class="bound">t</span> <span class="main">[</span><span class="inner_quoted">''x''</span><span class="main">,</span><span class="inner_quoted">''y''</span><span class="main">]</span> <span class="main">|</span><span class="bound">t</span><span class="main">.</span>
  <span class="main">(</span><span class="keyword1">WHILE</span> Less <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="numeral">5</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
   <span class="main">&lt;</span><span class="inner_quoted">''x''</span> <span class="main">:=</span> <span class="main">0</span><span class="main">,</span> <span class="inner_quoted">''y''</span> <span class="main">:=</span> <span class="numeral">13</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">t</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Proof automation:›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The introduction rules are good for automatically
construction small program executions. The recursive cases
may require backtracking, so we declare the set as unsafe
intro rules.›</span></span>
<span class="keyword1"><span class="command">declare</span></span> big_step.intros <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The standard induction rule 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] big_step.induct <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">thm</span></span> big_step.induct

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
This induction schema is almost perfect for our purposes, but
our trick for reusing the tuple syntax means that the induction
schema has two parameters instead of the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span>, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span>,
and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s'›</span></span></span></span> that we are likely to encounter. Splitting
the tuple parameter fixes this:
›</span></span>
<span class="keyword1"><span class="command">lemmas</span></span> big_step_induct <span class="main">=</span> big_step.induct<span class="main">[</span><span class="operator">split_format</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">complete</span><span class="main"><span class="main">)</span></span><span class="main">]</span>
<span class="keyword1"><span class="command">thm</span></span> big_step_induct
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> [display] big_step_induct <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Rule inversion"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹What can we deduce from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>SKIP<span class="main"><span class="main">,</span></span><span class="free"><span class="free">s</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">⇒</span></span> <span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> ?
That <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">s</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This is how we can automatically prove it:›</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> SkipE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP<span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> SkipE

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is an \emph{elimination rule}. The [elim] attribute tells auto,
blast and friends (but not simp!) to use it automatically; [elim!] means that
it is applied eagerly.

Similarly for the other commands:›</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> AssignE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">a</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> AssignE
<span class="keyword1"><span class="command">inductive_cases</span></span> SeqE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">,</span><span class="free">s1</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s3</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> SeqE
<span class="keyword1"><span class="command">inductive_cases</span></span> IfE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> IfE

<span class="keyword1"><span class="command">inductive_cases</span></span> WhileE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> WhileE
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Only [elim]: [elim!] would not terminate.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An automatic example:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> SKIP <span class="keyword1">ELSE</span> SKIP<span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Rule inversion by hand via the ``cases'' method:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> SKIP <span class="keyword1">ELSE</span> SKIP<span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>  <span class="comment1">― ‹inverting assms›</span>
    <span class="keyword3"><span class="command">case</span></span> IfTrue <span class="keyword1"><span class="command">thm</span></span> IfTrue
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> IfFalse <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Using rule inversion to prove simplification rules: *)</span>
<span class="keyword1" id="Big_Step-assign_simp"><span class="command">lemma</span></span> assign_simp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">a</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">s'</span> <span class="main">=</span> <span class="free">s</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">a</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹An example combining rule inversion and derivations›</span></span>
<span class="keyword1" id="Big_Step-Seq_assoc"><span class="command">lemma</span></span> Seq_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="main">(</span><span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">)</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">s1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c3</span><span class="main">,</span> <span class="skolem">s2</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> c2 c3
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> c1
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="main">(</span><span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">)</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">― ‹The other direction is analogous›</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="main">(</span><span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">)</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span>"</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Command Equivalence"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  We call two statements <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c'›</span></span></span></span> equivalent wrt.\ the
  big-step semantics when \emph{<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c›</span></span></span></span> started in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span> terminates
  in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s'›</span></span></span></span> iff <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>c'›</span></span></span></span> started in the same <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s›</span></span></span></span> also terminates
  in the same <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>s'›</span></span></span></span>}. Formally:
›</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">equiv_c</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> com <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infix</span></span> <span class="quoted">"<span class="keyword1">∼</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">∼</span></span> <span class="free"><span class="bound"><span class="entity">c'</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">t</span>  <span class="main">=</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c'</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">t</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
Warning: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∼›</span></span></span></span> is the symbol written \verb!\ &lt; s i m &gt;! (without spaces).

  As an example, we show that loop unfolding is an equivalence
  transformation on programs:
›</span></span>
<span class="keyword1" id="Big_Step-unfold_while"><span class="command">lemma</span></span> unfold_while<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="main">∼</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c</span><span class="main">;;</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="keyword1">ELSE</span> SKIP<span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?w</span> <span class="main">∼</span> <span class="var">?iw</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹to show the equivalence, we look at the derivation tree for›</span>
  <span class="comment1">― ‹each side and from that construct a derivation tree for the other side›</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?w</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span>
    <span class="comment1">― ‹as a first thing we note that, if <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">b</span><span class="antiquote">}</span></span> is <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">False</span><span class="antiquote">}</span></span> in state <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">s</span><span class="antiquote">}</span></span>,›</span>
    <span class="comment1">― ‹then both statements do nothing:›</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>bval <span class="free">b</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?w</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?iw</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>bval <span class="free">b</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="comment1">― ‹on the other hand, if <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">b</span><span class="antiquote">}</span></span> is <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">True</span><span class="antiquote">}</span></span> in state <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">s</span><span class="antiquote">}</span></span>,›</span>
    <span class="comment1">― ‹then only the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">WhileTrue</span><span class="antiquote">}</span></span> rule can have been used to derive <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"(?w, s) ⇒ t"</span><span class="antiquote">}</span></span>›</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?w</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?w</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">― ‹now we can build a derivation tree for the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">IF</span><span class="antiquote">}</span></span>›</span>
      <span class="comment1">― ‹first, the body of the True-branch:›</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">;;</span> <span class="var">?w</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span>
      <span class="comment1">― ‹then the whole <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">IF</span><span class="antiquote">}</span></span>›</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹bval <span class="free">b</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?iw</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> IfTrue<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="comment1">― ‹both cases together give us what we want:›</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?iw</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">moreover</span></span>
  <span class="comment1">― ‹now the other direction:›</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?iw</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span>
    <span class="comment1">― ‹again, if <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">b</span><span class="antiquote">}</span></span> is <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">False</span><span class="antiquote">}</span></span> in state <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">s</span><span class="antiquote">}</span></span>, then the False-branch›</span>
    <span class="comment1">― ‹of the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">IF</span><span class="antiquote">}</span></span> is executed, and both statements do nothing:›</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>bval <span class="free">b</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?iw</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?w</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span>bval <span class="free">b</span> <span class="skolem">s</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="comment1">― ‹on the other hand, if <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">b</span><span class="antiquote">}</span></span> is <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">True</span><span class="antiquote">}</span></span> in state <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">s</span><span class="antiquote">}</span></span>,›</span>
    <span class="comment1">― ‹then this time only the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">IfTrue</span><span class="antiquote">}</span></span> rule can have be used›</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="var">?iw</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">;;</span> <span class="var">?w</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">― ‹and for this, only the Seq-rule is applicable:›</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?w</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="comment1">― ‹with this information, we can build a derivation tree for the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">WHILE</span><span class="antiquote">}</span></span>›</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹bval <span class="free">b</span> <span class="skolem">s</span>›</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?w</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> WhileTrue<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>
    <span class="comment1">― ‹both cases together again give us what we want:›</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?w</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Luckily, such lengthy proofs are seldom necessary.  Isabelle can
prove many such facts automatically.›</span></span>

<span class="keyword1" id="Big_Step-while_unfold"><span class="command">lemma</span></span> while_unfold<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="main">∼</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c</span><span class="main">;;</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="keyword1">ELSE</span> SKIP<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Big_Step-triv_if"><span class="command">lemma</span></span> triv_if<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c</span> <span class="keyword1">ELSE</span> <span class="free">c</span><span class="main">)</span> <span class="main">∼</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Big_Step-commute_if"><span class="command">lemma</span></span> commute_if<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b1</span> <span class="keyword1">THEN</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b2</span> <span class="keyword1">THEN</span> <span class="free">c11</span> <span class="keyword1">ELSE</span> <span class="free">c12</span><span class="main">)</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">)</span> 
   <span class="main">∼</span> 
   <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b2</span> <span class="keyword1">THEN</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b1</span> <span class="keyword1">THEN</span> <span class="free">c11</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">)</span> <span class="keyword1">ELSE</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b1</span> <span class="keyword1">THEN</span> <span class="free">c12</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Big_Step-sim_while_cong_aux"><span class="command">lemma</span></span> sim_while_cong_aux<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span>  <span class="main">⟹</span> <span class="free">c</span> <span class="main">∼</span> <span class="free">c'</span> <span class="main">⟹</span>  <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c'</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">t</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_induct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Big_Step-sim_while_cong"><span class="command">lemma</span></span> sim_while_cong<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∼</span> <span class="free">c'</span> <span class="main">⟹</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">∼</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> sim_while_cong_aux<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Command equivalence is an equivalence relation, i.e.\ it is
reflexive, symmetric, and transitive. Because we used an abbreviation
above, Isabelle derives this automatically.›</span></span>

<span class="keyword1" id="Big_Step-sim_refl"><span class="command">lemma</span></span> sim_refl<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∼</span> <span class="free">c</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1" id="Big_Step-sim_sym"><span class="command">lemma</span></span> sim_sym<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span> <span class="main">∼</span> <span class="free">c'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">c'</span> <span class="main">∼</span> <span class="free">c</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="Big_Step-sim_trans"><span class="command">lemma</span></span> sim_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">c</span> <span class="main">∼</span> <span class="free">c'</span> <span class="main">⟹</span> <span class="free">c'</span> <span class="main">∼</span> <span class="free">c''</span> <span class="main">⟹</span> <span class="free">c</span> <span class="main">∼</span> <span class="free">c''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Execution is deterministic"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This proof is automatic.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> big_step_determ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span><span class="main">;</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">u</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step.induct<span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
  This is the proof as you might present it in a lecture. The remaining
  cases are simple enough to be proved automatically:
›</span></span>

<span class="keyword1"><span class="command">theorem</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span>  <span class="main">⟹</span>  <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t'</span>  <span class="main">⟹</span>  <span class="free">t'</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">t'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step.induct<span class="main">)</span>
  <span class="comment1">― ‹the only interesting case, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">WhileTrue</span><span class="antiquote">}</span></span>:›</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">s</span> <span class="skolem">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">t</span> <span class="skolem">t'</span>
  <span class="comment1">― ‹The assumptions of the rule:›</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">s<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span><span class="skolem">s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span>"</span></span>
  <span class="comment1">― ‹Ind.Hyp; note the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span><span class="raw_text">"⋀"</span><span class="antiquote">}</span></span> because of arbitrary:›</span>
  <span class="keyword3"><span class="command">assume</span></span> IHc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">t'</span> <span class="main">⟹</span> <span class="bound">t'</span> <span class="main">=</span> <span class="skolem">s<span class="hidden">⇩</span><sub>1</sub></span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> IHw<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t'</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span><span class="skolem">s<span class="hidden">⇩</span><sub>1</sub></span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">t'</span> <span class="main">⟹</span> <span class="bound">t'</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>
  <span class="comment1">― ‹Premise of implication:›</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t'</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹bval <span class="skolem">b</span> <span class="skolem">s</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s<span class="hidden">⇩</span><sub>1</sub>'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">s<span class="hidden">⇩</span><sub>1</sub>'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span><span class="skolem">s<span class="hidden">⇩</span><sub>1</sub>'</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t'</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> c IHc <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s<span class="hidden">⇩</span><sub>1</sub>'</span> <span class="main">=</span> <span class="skolem">s<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> w IHw <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> <span class="comment1">― ‹prove the rest automatically›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Big_StepT">
<div class="head">
<h1>Theory Big_StepT</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Big Step Semantics with Time"</span></span>
<span class="keyword1"><span class="command">theory</span></span> Big_StepT <span class="keyword2"><span class="keyword">imports</span></span> <a href="Big_Step.html">Big_Step</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Big-Step with Time Semantics of Commands"</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">big_step_t</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">×</span> state <span class="main">⇒</span> nat <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⇒</span> _ <span class="keyword1">⇓</span> _"</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
Skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP<span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> Suc <span class="main">0</span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
Assign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> Suc <span class="main">0</span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s3</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s3</span></span></span>"</span></span> <span class="main">|</span>
IfTrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> <span class="main">|</span>
IfFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span>bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">t</span></span></span>"</span></span> <span class="main">|</span>
WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span>bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> Suc <span class="main">0</span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
WhileTrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s3</span></span></span><span class="main">;</span> <span class="main">1</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">z</span></span></span>  <span class="main">⟧</span> 
    <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main"><span class="free">⇒</span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s3</span></span></span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We want to execute the big-step rules:›</span></span>

<span class="keyword1"><span class="command">code_pred</span></span> <span class="quoted"><span class="quoted">big_step_t</span></span> <span class="keyword1"><span class="command">.</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For inductive definitions we need command
       \texttt{values} instead of \texttt{value}.›</span></span>

<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="bound">x</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>SKIP<span class="main">,</span> <span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We need to translate the result state into a list
to display it.›</span></span>

<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>map <span class="bound">t</span> <span class="main">[</span><span class="inner_quoted">''x''</span><span class="main">]</span> <span class="main">|</span><span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span>SKIP<span class="main">,</span> <span class="main">&lt;</span><span class="inner_quoted">''x''</span> <span class="main">:=</span> <span class="numeral">42</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>map <span class="bound">t</span> <span class="main">[</span><span class="inner_quoted">''x''</span><span class="main">]</span> <span class="main">|</span><span class="bound">t</span> <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> N <span class="numeral">2</span><span class="main">,</span> <span class="main">&lt;</span><span class="inner_quoted">''x''</span> <span class="main">:=</span> <span class="numeral">42</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">values</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span>map <span class="bound">t</span> <span class="main">[</span><span class="inner_quoted">''x''</span><span class="main">,</span><span class="inner_quoted">''y''</span><span class="main">]</span> <span class="main">|</span><span class="bound">t</span> <span class="bound">x</span><span class="main">.</span>
  <span class="main">(</span><span class="keyword1">WHILE</span> Less <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="main">(</span><span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="numeral">5</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
   <span class="main">&lt;</span><span class="inner_quoted">''x''</span> <span class="main">:=</span> <span class="main">0</span><span class="main">,</span> <span class="inner_quoted">''y''</span> <span class="main">:=</span> <span class="numeral">13</span><span class="main">&gt;</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">x</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">}</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Proof automation:›</span></span>
 
<span class="keyword1"><span class="command">declare</span></span> big_step_t.intros <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>
  
<span class="keyword1"><span class="command">lemmas</span></span> big_step_t_induct <span class="main">=</span> big_step_t.induct<span class="main">[</span><span class="operator">split_format</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">complete</span><span class="main"><span class="main">)</span></span><span class="main">]</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Rule inversion"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹What can we deduce from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>SKIP<span class="main"><span class="main">,</span></span><span class="free"><span class="free">s</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">⇒</span></span> <span class="free"><span class="free">x</span></span> <span class="main"><span class="main">⇓</span></span> <span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> ?
That <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">s</span></span> <span class="main"><span class="main">=</span></span> <span class="free"><span class="free">t</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This is how we can automatically prove it:›</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> Skip_tE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP<span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">x</span> <span class="main">⇓</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> Skip_tE

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is an \emph{elimination rule}. The [elim] attribute tells auto,
blast and friends (but not simp!) to use it automatically; [elim!] means that
it is applied eagerly.

Similarly for the other commands:›</span></span>

<span class="keyword1"><span class="command">inductive_cases</span></span> Assign_tE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">a</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> Assign_tE
<span class="keyword1"><span class="command">inductive_cases</span></span> Seq_tE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">,</span><span class="free">s1</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">s3</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> Seq_tE
<span class="keyword1"><span class="command">inductive_cases</span></span> If_tE<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">x</span> <span class="main">⇓</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> If_tE

<span class="keyword1"><span class="command">inductive_cases</span></span> While_tE<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">x</span> <span class="main">⇓</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> While_tE
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Only [elim]: [elim!] would not terminate.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An automatic example:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> SKIP <span class="keyword1">ELSE</span> SKIP<span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">x</span> <span class="main">⇓</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">t</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Rule inversion by hand via the ``cases'' method:›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> SKIP <span class="keyword1">ELSE</span> SKIP<span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">x</span> <span class="main">⇓</span> <span class="free">t</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">t</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">cases</span>  <span class="comment1">― ‹inverting assms›</span>
    <span class="keyword3"><span class="command">case</span></span> IfTrue
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> IfFalse <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(* Using rule inversion to prove simplification rules: *)</span>
<span class="keyword1" id="Big_StepT-assign_t_simp"><span class="command">lemma</span></span> assign_t_simp<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">a</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> Suc <span class="main">0</span> <span class="main">⇓</span>  <span class="free">s'</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">s'</span> <span class="main">=</span> <span class="free">s</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">a</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹An example combining rule inversion and derivations›</span></span>
<span class="keyword1" id="Big_StepT-Seq_t_assoc"><span class="command">lemma</span></span> Seq_t_assoc<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span>  <span class="free">s'</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="main">(</span><span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">)</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">p3</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">⇓</span> <span class="skolem">s1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c3</span><span class="main">,</span> <span class="skolem">s2</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p3</span> <span class="main">⇓</span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="skolem">p1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">p2</span> <span class="main">+</span> <span class="skolem">p3</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> c2 c3
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">+</span> <span class="skolem">p3</span> <span class="main">⇓</span>  <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">with</span></span> c1
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="main">(</span><span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">)</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="comment1">― ‹The other direction is analogous›</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="main">(</span><span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">)</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s1</span></span> <span class="skolem"><span class="skolem">s2</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">p3</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">⇓</span> <span class="skolem">s1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="skolem">s1</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">s2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    c3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c3</span><span class="main">,</span> <span class="skolem">s2</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p3</span> <span class="main">⇓</span> <span class="free">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">p</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">p3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> c1 c2
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span> <span class="main">⇓</span>  <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this c3
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="free">c2</span><span class="main">;;</span> <span class="free">c3</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> p <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Relation to Big-Step Semantics"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span>  <span class="free">s'</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="free">s'</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_t_induct<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Big_Step.Assign<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">s'</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span>  <span class="free">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">c</span></span> <span class="quoted"><span class="free">s</span></span> <span class="quoted"><span class="free">s'</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_induct<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command">qed</span></span>

 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Execution is deterministic"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This proof is automatic.›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> big_step_t_determ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span><span class="main">;</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">q</span> <span class="main">⇓</span> <span class="free">u</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">u</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_t.induct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 

<span class="keyword1"><span class="command">theorem</span></span> big_step_t_determ2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span><span class="main">;</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">q</span> <span class="main">⇓</span> <span class="free">u</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">u</span> <span class="main">=</span> <span class="free">t</span> <span class="main">∧</span> <span class="free">p</span><span class="main">=</span><span class="free">q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span>  <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">u</span></span> <span class="quoted"><span class="free">q</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_t_induct<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> Skip_tE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> Assign_tE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> If_tE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> If_tE<span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> While_tE<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>7<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> While_tE<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
          <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> While_tE<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
          <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
         
       
<span class="keyword1" id="Big_StepT-bigstep_det"><span class="command">lemma</span></span> bigstep_det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p1</span> <span class="main">⇓</span> <span class="free">t1</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">p1</span><span class="main">=</span><span class="free">p</span> <span class="main">∧</span> <span class="free">t1</span><span class="main">=</span><span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> big_step_t_determ2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1" id="Big_StepT-bigstep_progress"><span class="command">lemma</span></span> bigstep_progress<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_t.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">terminates</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">↓</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">terminates</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span> <span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">thestate</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">thestate</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">thetime</span> <span class="main">(</span><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">thetime</span> <span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">cs</span></span></span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span>  
            
  
<span class="keyword1" id="Big_StepT-bigstepT_the_cost"><span class="command">lemma</span></span> bigstepT_the_cost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span> <span class="main">⇓</span> <span class="free">s'</span> <span class="main">⟹</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span><span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bigstep_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1" id="Big_StepT-bigstepT_the_state"><span class="command">lemma</span></span> bigstepT_the_state<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">t</span> <span class="main">⇓</span> <span class="free">s'</span> <span class="main">⟹</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span><span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bigstep_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 


<span class="keyword1" id="Big_StepT-SKIPnot"><span class="command">lemma</span></span> SKIPnot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span>SKIP<span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">≠</span><span class="free">t</span> <span class="main">∨</span> <span class="free">p</span><span class="main">≠</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

 
<span class="keyword1" id="Big_StepT-SKIPp"><span class="command">lemma</span></span> SKIPp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span><span class="main">(</span>SKIP<span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1" id="Big_StepT-SKIPt"><span class="command">lemma</span></span> SKIPt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span><span class="main">(</span>SKIP<span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 


<span class="keyword1" id="Big_StepT-ASSp"><span class="command">lemma</span></span> ASSp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> Ex <span class="main">(</span>big_step_t <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">e</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1" id="Big_StepT-ASSt"><span class="command">lemma</span></span> ASSt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">e</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">e</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1" id="Big_StepT-ASSnot"><span class="command">lemma</span></span> ASSnot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">e</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">≠</span>Suc <span class="main">0</span> <span class="main">∨</span> <span class="free">t</span><span class="main">≠</span><span class="free">s</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">e</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
       
    
    
<span class="keyword1" id="Big_StepT-If_THE_True"><span class="command">lemma</span></span> If_THE_True<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">if</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1_t<span class="main">:</span> <span class="quoted"><span class="quoted">"terminates <span class="main">(</span><span class="free">c1</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">s</span> <span class="free">l</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> c1_t <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> T <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span><span class="main">+</span><span class="main">1</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> IfTrue <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> a bigstepT_the_cost <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">moreover</span></span>    
  <span class="keyword1"><span class="command">from</span></span> b bigstepT_the_cost <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Big_StepT-If_THE_False"><span class="command">lemma</span></span> If_THE_False<span class="main">:</span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
     <span class="keyword2"><span class="keyword">if</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span>bval <span class="free">b</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2_t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">↓</span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="free">s</span> <span class="free">l</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> c2_t <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> T <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span><span class="main">+</span><span class="main">1</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> IfFalse <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> a bigstepT_the_cost <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">moreover</span></span>    
  <span class="keyword1"><span class="command">from</span></span> b bigstepT_the_cost <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">ultimately</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
    
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Nielson_Hoare">
<div class="head">
<h1>Theory Nielson_Hoare</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Nielson_Hoare
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Big_StepT.html">Big_StepT</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Nielson Style Hoare Logic with logical variables"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">eq</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">==</span> <span class="main">(</span>And <span class="main">(</span>Not <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Not <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   
<span class="keyword1"><span class="command">type_synonym</span></span> lvname <span class="main">=</span> <span class="quoted">string</span>
<span class="keyword1"><span class="command">type_synonym</span></span> assn2 <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>lvname <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> state <span class="main">⇒</span> bool"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> tbd <span class="main">=</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> nat"</span></span> <span class="comment1">(* time bound *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹The support of an assn2›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">support</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn2 <span class="main">⇒</span> string set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">support</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">l1</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">l2</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l1</span> <span class="bound">s</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l2</span> <span class="bound">s</span><span class="main">}</span>"</span></span>


<span class="keyword1" id="Nielson_Hoare-support_and"><span class="command">lemma</span></span> support_and<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> support <span class="free">P</span> <span class="main">∪</span> support <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword1" id="Nielson_Hoare-support_impl"><span class="command">lemma</span></span> support_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> support <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
<span class="keyword1" id="Nielson_Hoare-support_exist"><span class="command">lemma</span></span> support_exist<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">z</span><span class="main">::</span>nat<span class="main">.</span> <span class="free">Q</span> <span class="bound">z</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="keyword1">UN</span> <span class="bound">n</span><span class="main">.</span> support <span class="main">(</span><span class="free">Q</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>   

    
<span class="keyword1" id="Nielson_Hoare-support_all"><span class="command">lemma</span></span> support_all<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">z</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="keyword1">UN</span> <span class="bound">n</span><span class="main">.</span> support <span class="main">(</span><span class="free">Q</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>  
    
    
<span class="keyword1" id="Nielson_Hoare-support_single"><span class="command">lemma</span></span> support_single<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">l</span> <span class="free">a</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="free">a</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
<span class="keyword1" id="Nielson_Hoare-support_inv"><span class="command">lemma</span></span> support_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1" id="Nielson_Hoare-assn2_lupd"><span class="command">lemma</span></span> assn2_lupd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> support <span class="free">Q</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="free">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span> <span class="free">l</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> support_def fun_upd_other fun_eq_iff<span class="main">)</span>
  <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fun_upd_def<span class="main">)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Validity"</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">state_subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> aexp <span class="main">⇒</span> vname <span class="main">⇒</span> state"</span></span>
  <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">'/</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>1000<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hoare1_valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn2 <span class="main">⇒</span> com <span class="main">⇒</span> tbd <span class="main">⇒</span> assn2 <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span> _ <span class="keyword1">⇓</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">⟷</span>  <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>  <span class="bound">p</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Hoare rules"</span></span>
  
<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hoare1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn2 <span class="main">⇒</span> com <span class="main">⇒</span> tbd <span class="main">⇒</span> assn2 <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span> _ <span class="keyword1">⇓</span> <span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>

Skip<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> SKIP <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

Assign<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l</span> <span class="main">(</span><span class="bound">s</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span>  <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>
       <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="bound">s</span> <span class="main">+</span> Suc <span class="main">0</span> <span class="main">)</span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e2'</span></span></span> <span class="bound">s</span> <span class="main">)</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span>  <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">)</span><span class="main"><span class="free">}</span></span><span class="main">;</span>
         <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> support <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">∉</span> support <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">;</span>
         <span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">e2'</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span><span class="main">⟧</span>
          <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

While<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span>  <span class="free"><span class="bound"><span class="entity">e''</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">l</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>
       <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>  <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span> <span class="main">≥</span> <span class="main">1</span>  <span class="main">+</span>  <span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">e''</span></span></span> <span class="bound">s</span>  <span class="main">;</span> 
     <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">~</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">1</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span><span class="main">;</span>
     <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">∉</span> support <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

conseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span><span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l'</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">;</span>
           <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>   <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  
  
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Derived Rules:›</span></span>

<span class="keyword1" id="Nielson_Hoare-conseq_old"><span class="command">lemma</span></span> conseq_old<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span> <span class="free">e'</span> <span class="bound">s</span> <span class="main">≤</span>  <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">e'</span> <span class="main">⇓</span>  <span class="free">Q</span><span class="main">}</span><span class="main">;</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q'</span> <span class="bound">l</span> <span class="bound">s</span>  <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">e</span> <span class="main">⇓</span> <span class="free">Q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conseq <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Nielson_Hoare-If2"><span class="command">lemma</span></span> If2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="free">b</span> <span class="bound">s</span><span class="main">}</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> <span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span><span class="main">;</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span> bval <span class="free">b</span> <span class="bound">s</span><span class="main">}</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span> <span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span><span class="main">;</span>
        <span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">e</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="free">e'</span> <span class="bound">s</span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">ELSE</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span> <span class="free">e'</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ If<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> P'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Nielson_Hoare-strengthen_pre"><span class="command">lemma</span></span> strengthen_pre<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">;</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">e</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Nielson_Hoare-weaken_post"><span class="command">lemma</span></span> weaken_post<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span><span class="main">;</span>  <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">e</span> <span class="main">⇓</span> <span class="free">Q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span>   e'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">e</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Nielson_Hoare-ub_cost"><span class="command">lemma</span></span> ub_cost<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">e'</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="main">(</span><span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">e'</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">e'</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 

<span class="keyword1" id="Nielson_Hoare-Assign'"><span class="command">lemma</span></span> Assign'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">l</span> <span class="main">(</span><span class="bound">s</span><span class="main">[</span><span class="free">a</span><span class="main">/</span><span class="free">x</span><span class="main">]</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">x</span> <span class="main">::=</span> <span class="free">a</span> <span class="main">{</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> strengthen_pre<span class="main">[</span><span class="operator">OF</span> _ Assign<span class="main">]</span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span>

 
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Soundness"</span></span>
  
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The soundness theorem:›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hoare1_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="main">⊨<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> hoare1_valid_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span>  <span class="operator">induction</span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoare1.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Skip <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">P</span> <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">P1</span> <span class="skolem">x</span> <span class="skolem">e2'</span> <span class="skolem">c1</span> <span class="skolem">e1</span> <span class="skolem">P2</span> <span class="skolem">e2</span> <span class="skolem">c2</span> <span class="skolem">P3</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  S6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P1</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">l</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">e2'</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">P2</span> <span class="bound">l</span> <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="bound">t</span> <span class="main">≤</span> <span class="bound">l</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>7<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  S7<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P2</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k'</span> <span class="main">*</span> <span class="skolem">e2</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">P3</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> k k' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> max <span class="skolem">k</span> <span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"max <span class="skolem"><span class="skolem">k</span></span> <span class="skolem"><span class="skolem">k'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span> 
    <span class="keyword1"><span class="command">have</span></span> x_supp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> support <span class="skolem">P1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> x_supp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> support <span class="skolem">P2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>

    <span class="keyword1"><span class="command">from</span></span> S6 <span class="keyword1"><span class="command">have</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">e2'</span> <span class="skolem">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span>  <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="skolem">P2</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span> "</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     
    <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span>

    <span class="keyword1"><span class="command">with</span></span> Seq<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">e1</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">e2'</span> <span class="skolem">s</span> <span class="main">≤</span>   <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">with</span></span> a S assn2_lupd<span class="main">[</span><span class="operator">OF</span> x_supp<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="skolem">P2</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cost1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 31<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> P2' assn2_lupd<span class="main">[</span><span class="operator">OF</span> x_supp2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> P2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="skolem">l</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 31 <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">e2'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">from</span></span> S7 P2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">t'</span> <span class="bound">p'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p'</span> <span class="main">⇓</span> <span class="bound">t'</span><span class="main">)</span> <span class="main">∧</span>   <span class="bound">p'</span> <span class="main">≤</span> <span class="skolem">k'</span> <span class="main">*</span> <span class="skolem">e2</span> <span class="skolem">t</span> <span class="main">∧</span> <span class="skolem">P3</span> <span class="skolem">l</span> <span class="bound">t'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">p'</span></span>  <span class="keyword2"><span class="keyword">where</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p'</span> <span class="main">⇓</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cost2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">p'</span> <span class="main">≤</span> <span class="skolem">k'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e2</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P3</span> <span class="skolem">l</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> c1 c2 <span class="keyword1"><span class="command">have</span></span> weg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p'</span> <span class="main">⇓</span> <span class="skolem">t'</span>"</span></span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Big_StepT.Seq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> cost1 cost2 3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="skolem">p'</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e1</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">k'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> add_mono mult_le_mono2 order_subst1<span class="main">)</span>  
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e1</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mono<span class="main">)</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e1</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib2<span class="main">)</span>      
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">finally</span></span>
    <span class="keyword1"><span class="command">have</span></span> cost<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      
    <span class="keyword1"><span class="command">from</span></span> weg cost P3
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span><span class="main">+</span><span class="skolem">p'</span> <span class="main">⇓</span> <span class="skolem">t'</span> <span class="main">∧</span>   <span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="skolem">p'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">P3</span> <span class="skolem">l</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span>  <span class="bound">p</span> <span class="main">≤</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="skolem">k'</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">P3</span> <span class="skolem">l</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">c1</span> <span class="skolem">e</span> <span class="skolem">Q</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="keyword2"><span class="keyword">where</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> If1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span>  k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> If2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"max <span class="main">(</span><span class="skolem">k1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">k2</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?k'</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?k'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> P1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c1</span> <span class="keyword1">ELSE</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span>  <span class="bound">p</span> <span class="main">≤</span> <span class="var">?k'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span> <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="bound">t</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> If1 P1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c1</span> <span class="keyword1">ELSE</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span><span class="main">+</span><span class="main">1</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span>  <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span>  <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?k'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span>  <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_mult_max_left<span class="main">)</span> 
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">+</span><span class="main">1</span>   <span class="main">≤</span> <span class="var">?k'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span>  <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c1</span> <span class="keyword1">ELSE</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="var">?k'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span> <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> If2 P1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> False <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c1</span> <span class="keyword1">ELSE</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span><span class="main">+</span><span class="main">1</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">k2</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="skolem">e</span> <span class="skolem">s</span>  <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k2</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span>  <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?k'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span>  <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_mult_max_left<span class="main">)</span>  
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">+</span><span class="main">1</span>   <span class="main">≤</span> <span class="var">?k'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span>  <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c1</span> <span class="keyword1">ELSE</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span>  <span class="bound">p</span> <span class="main">≤</span> <span class="var">?k'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="skolem">s</span> <span class="main">+</span> Suc <span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>conseq <span class="skolem">P'</span> <span class="skolem">e</span> <span class="skolem">e'</span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">Q'</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> conseq<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="keyword2"><span class="keyword">where</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">e</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">Q</span> <span class="bound">l'</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="skolem">Q'</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">e</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">Q</span> <span class="bound">l'</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="skolem">Q'</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> conseq<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> c2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span>  <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span><span class="main">*</span><span class="skolem">k1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k1 k2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">k2</span></span><span class="main"><span class="main">*</span></span><span class="skolem"><span class="skolem">k1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> c1' <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l'</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">Q</span> <span class="bound">l'</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="skolem">Q'</span> <span class="skolem">l</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">fl</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="skolem">fl</span> <span class="bound">t</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">Q</span> <span class="main">(</span><span class="skolem">fl</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="skolem">Q'</span> <span class="skolem">l</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">with</span></span> c2' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ft</span></span> <span class="skolem"><span class="skolem">fp</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="skolem">fp</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⇓</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">t</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="skolem">fp</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">t</span><span class="main">.</span> <span class="skolem">Q</span> <span class="main">(</span><span class="skolem">fl</span> <span class="bound">t</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ft</span> <span class="bound">t</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">from</span></span> i <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> tt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">ft</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">fp</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> big_step_t_determ2
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
    <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>   
    <span class="keyword1"><span class="command">from</span></span> tt ii iii <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="skolem">Q</span> <span class="main">(</span><span class="skolem">fl</span> <span class="bound">x</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p A
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_trans mult.assoc mult_le_mono2<span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> B Q <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="skolem">l</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    
    <span class="keyword1"><span class="command">from</span></span> c p q
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span>  <span class="skolem">k2</span> <span class="main">*</span><span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="skolem">Q'</span> <span class="skolem">l</span> <span class="bound">t</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">INV</span> <span class="skolem">b</span> <span class="skolem">e'</span> <span class="skolem">y</span> <span class="skolem">c</span> <span class="skolem">e''</span> <span class="skolem">e</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">from</span></span> While<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> W6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">INV</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">e'</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="skolem">y</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e''</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">INV</span> <span class="bound">l</span> <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="bound">t</span> <span class="main">≤</span> <span class="bound">l</span> <span class="skolem">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">+</span><span class="main">1</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span> <span class="skolem">l</span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="skolem">e</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">n</span><span class="main">;</span> <span class="skolem">INV</span> <span class="skolem">l</span> <span class="skolem">s</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="var">?k'</span> <span class="main">*</span> <span class="skolem">e</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="skolem">INV</span> <span class="skolem">l</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">t</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
        
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> While<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>  b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span>  WhileFalse<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> less <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            
      <span class="keyword1"><span class="command">next</span></span> 
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> While<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> bT<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cost1<span class="main">:</span> <span class="quoted"><span class="quoted">"  <span class="main">1</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">e''</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">(</span><span class="skolem">y</span> <span class="main">:=</span> <span class="skolem">e'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> y_supp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">∉</span> support <span class="skolem">INV</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
 
      <span class="keyword1"><span class="command">from</span></span> cost1 <span class="keyword1"><span class="command">have</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> W6
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="var">?l'</span> <span class="skolem">s</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="main">=</span> <span class="var">?l'</span> <span class="skolem">y</span>
            <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span>   <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e''</span> <span class="skolem">s</span>  <span class="main">∧</span> <span class="skolem">INV</span> <span class="var">?l'</span> <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="bound">t</span> <span class="main">≤</span> <span class="var">?l'</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>3<span class="main">)</span> bT
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span>   <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e''</span> <span class="skolem">s</span>  <span class="main">∧</span> <span class="skolem">INV</span> <span class="var">?l'</span> <span class="bound">t</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="bound">t</span> <span class="main">≤</span> <span class="skolem">e'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span>   assn2_lupd<span class="main">[</span><span class="operator">OF</span> y_supp<span class="main">]</span> 
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>  
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span>   <span class="keyword2"><span class="keyword">where</span></span> ceff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cost2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">p</span> <span class="main">≤</span>  <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e''</span> <span class="skolem">s</span>"</span></span> 
                    <span class="keyword2"><span class="keyword">and</span></span> INVz'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="var">?l'</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cost3<span class="main">:</span> <span class="quoted"><span class="quoted">"  <span class="skolem">e</span> <span class="skolem">t</span> <span class="main">≤</span>   <span class="skolem">e'</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

      <span class="keyword1"><span class="command">from</span></span> INVz' <span class="keyword1"><span class="command">have</span></span> INVz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">l</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> y_supp<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Z cost3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ _ INVz<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="skolem">t</span>"</span></span><span class="main">]</span>  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">p'</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> weff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p'</span> <span class="main">⇓</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> cost4<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">p'</span> <span class="main">≤</span> <span class="var">?k'</span> <span class="main">*</span>  <span class="skolem">e</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> INV0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">l</span> <span class="skolem">t'</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> nb<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bval <span class="skolem">b</span> <span class="skolem">t'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>      

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p'</span>  <span class="main">⇓</span> <span class="skolem">t'</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> WhileTrue<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> ceff<span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> weff<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">note</span></span> INV0 nb
      <span class="keyword1"><span class="command">moreover</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e''</span> <span class="skolem">s</span> <span class="main">+</span> <span class="var">?k'</span> <span class="main">*</span> <span class="skolem">e</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cost2 cost4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span>  <span class="main">1</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e''</span> <span class="skolem">s</span> <span class="main">+</span> <span class="var">?k'</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cost3
          <span class="keyword1"><span class="command">using</span></span> add_left_mono mult_le_mono2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?k'</span><span class="main">*</span><span class="main">1</span> <span class="main">+</span> <span class="var">?k'</span><span class="main">*</span> <span class="skolem">e''</span> <span class="skolem">s</span> <span class="main">+</span> <span class="var">?k'</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="skolem">s</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="var">?k'</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span><span class="main">+</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">e''</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?k'</span> <span class="main">*</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> cost1
          <span class="keyword1"><span class="command">using</span></span> mult_le_mono2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>            
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p'</span><span class="main">)</span> <span class="main">≤</span> <span class="var">?k'</span> <span class="main">*</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span>  
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> erg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">INV</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">INV</span> <span class="bound">l</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?k'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> erg <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Completeness"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wp1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> assn2 <span class="main">⇒</span> assn2"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">wp<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
 

<span class="keyword1" id="Nielson_Hoare-support_wpt"><span class="command">lemma</span></span> support_wpt<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊆</span> support <span class="free">Q</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> support_def wp1_def<span class="main">)</span> <span class="operator">blast</span>

  
<span class="keyword1" id="Nielson_Hoare-wp1_terminates"><span class="command">lemma</span></span> wp1_terminates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span> <span class="main">↓</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    
<span class="keyword1" id="Nielson_Hoare-wp1_SKIP"><span class="command">lemma</span></span> wp1_SKIP<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> SKIP <span class="free">Q</span> <span class="main">=</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp1_def<span class="main">)</span>

<span class="keyword1" id="Nielson_Hoare-wp1_Assign"><span class="command">lemma</span></span> wp1_Assign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">l</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp1_def<span class="main">)</span>

<span class="keyword1" id="Nielson_Hoare-wp1_Seq"><span class="command">lemma</span></span> wp1_Seq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp1_def fun_eq_iff<span class="main">)</span>

<span class="keyword1" id="Nielson_Hoare-wp1_If"><span class="command">lemma</span></span> wp1_If<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">ELSE</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">if</span> bval <span class="free">b</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp1_def fun_eq_iff<span class="main">)</span>

    
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">prec</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">==</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="Nielson_Hoare-wp1_prec_Seq_correct"><span class="command">lemma</span></span> wp1_prec_Seq_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">)</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> prec <span class="free">c1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">≤</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">)</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> wp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c1</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c2</span> <span class="free">Q</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> c1_term<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">ta</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span> <span class="main">∧</span> <span class="free">Q</span> <span class="free">l</span> <span class="bound">ta</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c2_term<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p'</span> <span class="main">⇓</span> <span class="skolem">t'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">l</span> <span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1_term bigstepT_the_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c2_term bigstepT_the_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c1_term bigstepT_the_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" prec <span class="free">c1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prec_def f <span class="keyword1"><span class="command">using</span></span> c2_term bigstep_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">" prec <span class="free">c1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span>  <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>
        <span class="main">=</span>  <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> wp <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">)</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">T</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> c12_term<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">P</span> <span class="main">⇓</span> <span class="skolem">T</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">l</span> <span class="skolem">T</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> c12_term bigstepT_the_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">from</span></span> c12_term <span class="keyword1"><span class="command">have</span></span> Ppp'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">=</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> Seq_tE<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> c1_term bigstep_det c2_term <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">+</span> prec <span class="free">c1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span>  <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>
        <span class="main">=</span>  <span class="skolem">p</span> <span class="main">+</span>  <span class="skolem">p'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p p' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ppp' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">finally</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> prec <span class="free">c1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">≤</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c1</span><span class="main">;;</span> <span class="free">c2</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> 
  


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">new</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> support <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span>

<span class="keyword1" id="Nielson_Hoare-bigstep_det"><span class="command">lemma</span></span> bigstep_det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p1</span> <span class="main">⇓</span> <span class="free">t1</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">p1</span><span class="main">=</span><span class="free">p</span> <span class="main">∧</span> <span class="free">t1</span><span class="main">=</span><span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> big_step_t_determ2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Nielson_Hoare-bigstepT_the_cost"><span class="command">lemma</span></span> bigstepT_the_cost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">P</span> <span class="main">⇓</span> <span class="free">T</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bigstep_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1" id="Nielson_Hoare-bigstepT_the_state"><span class="command">lemma</span></span> bigstepT_the_state<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">P</span> <span class="main">⇓</span> <span class="free">T</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bigstep_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
   
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> wp1WhileTrue'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> wp1_def<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t'</span> <span class="main">⇓</span> <span class="skolem">s''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">l</span> <span class="skolem">s''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">1</span><span class="main">+</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">t'</span> <span class="main">⇓</span> <span class="skolem">s''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Q <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> wp1_def<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">s''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">l</span> <span class="skolem">s''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> b  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t1</span> <span class="main">⇓</span> <span class="skolem">s'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t2</span> <span class="main">⇓</span> <span class="skolem">s''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Q <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> "</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> wp1WhileFalse'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span>  <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> wp1_def<span class="main">]</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">l</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> b  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">=</span><span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Q <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">l</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> b <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp1_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="Nielson_Hoare-wp1While"><span class="command">lemma</span></span> wp1While<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> bval <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="free">s</span>"</span></span><span class="main">)</span>      
  <span class="keyword1"><span class="command">using</span></span> wp1WhileTrue' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> wp1WhileFalse' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  
<span class="keyword1" id="Nielson_Hoare-wp1_prec2"><span class="command">lemma</span></span> wp1_prec2<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span><span class="main">::</span><span class="quoted">tbd</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c1</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span> <span class="main">∧</span>
           <span class="free">l</span> <span class="free">x</span> <span class="main">=</span> prec <span class="free">c1</span> <span class="free">e</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">e</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="free">x</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Big_StepT.bigstepT_the_state prec_def wp1_def<span class="main">)</span>
      
      
<span class="keyword1" id="Nielson_Hoare-wp1_prec"><span class="command">lemma</span></span> wp1_prec<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">e</span><span class="main">::</span><span class="quoted">tbd</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c1</span> <span class="free">Q</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span>
           <span class="free">l</span> <span class="free">x</span> <span class="main">=</span> prec <span class="free">c1</span> <span class="free">e</span> <span class="free">s</span> <span class="main">⟹</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">e</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="free">x</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wp1_def prec_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">p</span> <span class="skolem">t</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">l</span> <span class="free">x</span> <span class="main">=</span> <span class="free">e</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">l</span> <span class="skolem">t</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span> "</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="free">l</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">e</span> <span class="bound">t</span> <span class="main">=</span> <span class="free">e</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bigstepT_the_state<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 
  

<span class="keyword1" id="Nielson_Hoare-wp1_is_pre"><span class="command">lemma</span></span> wp1_is_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c</span> <span class="free">Q</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> SKIP
  <span class="keyword1"><span class="command">have</span></span> ff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span>SKIP<span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">n</span><span class="main">=</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>hoare1.Skip <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ff<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ff <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword1"><span class="command">have</span></span> gg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x1</span> <span class="bound">x2</span> <span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">x1</span> <span class="main">::=</span> <span class="bound">x2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">n</span><span class="main">=</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">case</span></span> Assign <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>hoare1.Assign <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gg<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>  
  <span class="comment1">― ‹choose a fresh logical variable x›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?x</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"new <span class="skolem">Q</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> support <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Seq.prems infinite_UNIV_listI
    <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">hence</span></span>  <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∉</span> support <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∉</span> support <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c2</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> support_wpt <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> x12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?x</span> <span class="main">∉</span> support <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;;</span><span class="skolem">c2</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> support_wpt <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

  <span class="comment1">― ‹assemble a postcondition Q1 that ensures the weakest precondition of Q before c2
        and saves the running time of c2 into the logical variable x›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c2</span> <span class="skolem">Q</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span>  <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="bound">l</span> <span class="var">?x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="var">?Q1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rev_finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ support_and<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_UnI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rev_finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ support_wpt<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> rev_finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ support_single<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="comment1">― ‹we can now specify this Q1 in the first Induction Hypothesis›</span>    
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">u</span><span class="main">.</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c1</span> <span class="var">?Q1</span> <span class="main">}</span> <span class="skolem">c1</span> <span class="main">{</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇓</span>  <span class="var">?Q1</span>  <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Seq<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  

  <span class="comment1">― ‹we can rewrite this into the form we need for the Seq rule›</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;;</span><span class="skolem">c2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">l</span> <span class="var">?x</span> <span class="main">=</span> <span class="main">(</span>prec <span class="skolem">c1</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">}</span> <span class="skolem">c1</span> <span class="main">{</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span>  <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">l</span> <span class="var">?x</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ pre <span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wp1_prec<span class="main">)</span> 

  <span class="comment1">― ‹we can now apply the Seq rule with the first IH (in the right shape A) and the second IH›</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;;</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">}</span> <span class="skolem">c1</span><span class="main">;;</span> <span class="skolem">c2</span> <span class="main">{</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="skolem">c1</span><span class="main">;;</span> <span class="skolem">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇓</span> <span class="skolem">Q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare1.Seq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> A Seq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
       <span class="comment1">― ‹finally some side conditions have to be proven›</span> 
       <span class="keyword1"><span class="command">using</span></span> Seq<span class="main">(</span>3<span class="main">)</span> x12 x2 wp1_prec_Seq_correct <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">b</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> If2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> bval <span class="skolem"><span class="skolem">b</span></span> <span class="bound"><span class="bound">s</span></span> <span class="keyword1"><span class="keyword1">then</span></span> <span class="keyword1"><span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">c1</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">else</span></span> <span class="keyword1"><span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">c2</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span>  <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span>rev_conj_cong<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Q</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> If.IH<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Q</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> If.IH<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> If_THE_True wp1_terminates If_THE_False<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>new <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_wpt<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> support <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinite_UNIV_listI
      <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> yQx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∉</span> support <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _  hoare1.While<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span> <span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span>  <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wp1While<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> wp1_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Nielson_Hoare.bigstepT_the_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> r t <span class="keyword1"><span class="command">have</span></span>   t2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> r t2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">≤</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> wp1_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">s''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">s''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> r<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Nielson_Hoare.bigstepT_the_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span> 
    <span class="keyword1"><span class="command">with</span></span> t <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t1</span> <span class="main">⇓</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t2</span> <span class="main">⇓</span> <span class="skolem">s''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="skolem">t1</span><span class="main">+</span><span class="skolem">t2</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Nielson_Hoare.bigstepT_the_cost bigstepT_the_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 2 s' <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span><span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Nielson_Hoare.bigstepT_the_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span><span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>  <span class="main">+</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> r A B sum<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span> 
    
    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="bound">l</span> <span class="var">?y</span><span class="main">}</span> <span class="skolem">c</span>
         <span class="main">{</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">l</span> <span class="var">?y</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ While<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="main"><span class="main">_</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">WHILE</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">DO</span></span> <span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> <span class="keyword1"><span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">WHILE</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">DO</span></span> <span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">l</span></span> <span class="var"><span class="var">?y</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> wp1While<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span>
        <span class="keyword3"><span class="command">assume</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword3"><span class="command">assume</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">l</span> <span class="var">?y</span>"</span></span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="var">?y</span> <span class="main">=</span> prec <span class="skolem">c</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> prec_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> 1 wp1_prec2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">c</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="main">_</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">]</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span>  <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="bound">l</span> <span class="var">?y</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_wpt<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> support_single<span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"new <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span> <span class="main">∈</span> support <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">)</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> yQx <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

    
<span class="keyword1" id="Nielson_Hoare-valid_wp"><span class="command">lemma</span></span> valid_wp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">p</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>1</sub></span> <span class="free">c</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">p</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hoare1_valid_def wp1_def<span class="main">)</span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> k <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> bigstepT_the_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>       
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> k <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> bigstepT_the_cost <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
    
<span class="keyword1"><span class="command">theorem</span></span> hoare1_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⊨<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">p</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">p</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>   
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ wp1_is_pre<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> valid_wp<span class="main">)</span>   
  
    
<span class="keyword1"><span class="command">corollary</span></span> hoare1_sound_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">p</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">⊨<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">p</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hoare1_sound hoare1_complete<span class="main">)</span>
    
<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="Nielson_VCG">
<div class="head">
<h1>Theory Nielson_VCG</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Max Haslbeck *)</span>

<span class="keyword1"><span class="command">theory</span></span> Nielson_VCG <span class="keyword2"><span class="keyword">imports</span></span> <a href="Nielson_Hoare.html">Nielson_Hoare</a> <span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Verification Condition Generator"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Annotated commands: commands where loops are annotated with
  invariants.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> acom <span class="main">=</span>
  Askip                  <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">SKIP</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span> <span class="main">|</span>
  Aassign <span class="quoted">vname</span> <span class="quoted">aexp</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">::=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>1000<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Aseq   <span class="quoted">acom</span> <span class="quoted">acom</span>       <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span>  <span class="main">[</span>60<span class="main">,</span> 61<span class="main">]</span> 60<span class="main">)</span> <span class="main">|</span>
  Aif <span class="quoted">bexp</span> <span class="quoted">acom</span> <span class="quoted">acom</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">IF</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">THEN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">ELSE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Aconseq <span class="quoted">assn2</span> <span class="quoted">assn2</span> <span class="quoted">tbd</span>  <span class="quoted">acom</span>
  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">'/</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">'/</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">CONSEQ</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span><span class="main">|</span>
  Awhile <span class="quoted"><span class="quoted">"<span class="main">(</span>assn2<span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span>state<span class="main">⇒</span>state<span class="main">)</span><span class="main">*</span><span class="main">(</span>tbd<span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">bexp</span> <span class="quoted">acom</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">WHILE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">DO</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span>
  
<span class="keyword1"><span class="command">notation</span></span> com.SKIP <span class="main">(</span><span class="quoted">"<span class="keyword1">SKIP</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Strip annotations:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">strip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> com"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="keyword1">SKIP</span> <span class="main">=</span> <span class="keyword1">SKIP</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>"</span></span>
  
  
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">"support of an expression"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"support and supportE"</span></span>
  
  
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">supportE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>char list <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>char list <span class="main">⇒</span> int<span class="main">)</span> <span class="main">⇒</span> nat<span class="main">)</span>  <span class="main">⇒</span> string set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">supportE</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">l1</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">l2</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l1</span> <span class="bound">s</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l2</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
  
  
<span class="keyword1" id="Nielson_VCG-expr_lupd"><span class="command">lemma</span></span> expr_lupd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> supportE <span class="free">Q</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="free">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> supportE_def fun_upd_other fun_eq_iff<span class="main">)</span>
    <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fun_upd_def<span class="main">)</span>

<span class="keyword1" id="Nielson_VCG-supportE_if"><span class="command">lemma</span></span> supportE_if<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="bound">l</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="free">B</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>
  <span class="main">⊆</span> supportE <span class="free">A</span> <span class="main">∪</span> supportE <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> supportE_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>


<span class="keyword1" id="Nielson_VCG-support_eq"><span class="command">lemma</span></span> support_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">l</span> <span class="free">x</span> <span class="main">=</span> <span class="free">E</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="free">E</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def supportE_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


<span class="keyword1" id="Nielson_VCG-support_impl_in"><span class="command">lemma</span></span> support_impl_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="free">e</span> <span class="main">⟶</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span>  <span class="free">H</span> <span class="free">e</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">T</span>
  <span class="main">⟹</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">G</span> <span class="free">e</span> <span class="main">⟶</span>  <span class="free">H</span> <span class="free">e</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Nielson_VCG-support_supportE"><span class="command">lemma</span></span> support_supportE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span> <span class="bound">e</span><span class="main">.</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span>  <span class="bound">P</span> <span class="main">(</span><span class="bound">e</span> <span class="bound">l</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="bound">e</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def supportE_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">P</span> <span class="skolem">e</span> <span class="skolem">x</span> <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">e</span> <span class="skolem">l1</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">e</span> <span class="skolem">l2</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">e</span> <span class="skolem">l1</span> <span class="main">=</span> <span class="skolem">e</span> <span class="skolem">l2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l1</span> <span class="bound">l2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="bound">l1</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">l2</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">e</span> <span class="bound">l1</span> <span class="bound">s</span> <span class="main">≠</span> <span class="skolem">e</span> <span class="bound">l2</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">l1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">l2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>            
<span class="keyword1"><span class="command">qed</span></span> 
  
<span class="comment1">― ‹collects the logical variables in the Invariants and Loop Bodies as well as the annotated
    assertions at CONSEQs of an annotated command›</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">varacom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> lvname set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">varacom</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">=</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varacom</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">=</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varacom</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">Qannot</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">=</span> support <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∪</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∪</span> support <span class="free"><span class="bound"><span class="entity">Qannot</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varacom</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> support <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∪</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varacom</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Weakest precondition from annotated commands:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">preT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> tbd <span class="main">⇒</span> tbd"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free">preT</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">preT</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free">preT</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">preT</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="free">preT</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>
  
  
<span class="keyword1" id="Nielson_VCG-preT_linear"><span class="command">lemma</span></span> preT_linear<span class="main">:</span> <span class="quoted"><span class="quoted">"preT <span class="free">C</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free">k</span> <span class="main">*</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free">k</span> <span class="main">*</span> preT <span class="free">C</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">postQ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> state <span class="main">⇒</span> state"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="comment1">(* seems to be forward?! *)</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">postQ</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">(</span><span class="free">postQ</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">postQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">then</span> <span class="free">postQ</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> <span class="free">postQ</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
    
<span class="keyword1" id="Nielson_VCG-TQ"><span class="command">lemma</span></span> TQ<span class="main">:</span> <span class="quoted"><span class="quoted">"preT <span class="free">C</span> <span class="free">e</span> <span class="free">s</span> <span class="main">=</span> <span class="free">e</span> <span class="main">(</span>postQ <span class="free">C</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
  
<span class="comment1">(* given a state, how often will a While loop be evaluated ? *)</span>  
<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">times</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> bexp <span class="main">⇒</span> acom <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">times</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">then</span> Suc <span class="main">(</span><span class="free">times</span> <span class="main">(</span>postQ <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  
    
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">z</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">z</span><span class="main">.</span> <span class="free">I</span> <span class="main">(</span>Suc <span class="bound">z</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟹</span> bval <span class="free">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">I</span> <span class="bound">z</span> <span class="main">(</span>postQ <span class="free">C</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  ii<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">I</span> <span class="main">0</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">~</span> bval <span class="free">b</span> <span class="bound">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> times_z<span class="main">:</span> <span class="quoted"><span class="quoted">"times <span class="free">s</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">z</span> <span class="free">s</span> <span class="main">⟹</span> times_dom <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">∧</span> times <span class="free">s</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"times_dom <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> times.domintros<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  ii<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0<span class="main"><span class="main">]</span></span> <span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"times <span class="skolem">s</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> times.psimps<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  ii<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0<span class="main"><span class="main">]</span></span><span class="main">)</span>
    
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> i<span class="main">[</span><span class="operator">OF</span> Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bv<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">z</span> <span class="main">(</span>postQ <span class="free">C</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> g<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"times_dom <span class="main">(</span>postQ <span class="free">C</span> <span class="skolem">s</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"times <span class="main">(</span>postQ <span class="free">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"times_dom <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> times.domintros<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> p1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"times <span class="skolem">s</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> Suc <span class="skolem">z</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> times.psimps<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> bv p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"times <span class="free">s</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">postQs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> bexp <span class="main">⇒</span> state <span class="main">⇒</span> state"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">postQs</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">then</span> <span class="main">(</span><span class="free">postQs</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">(</span>postQ <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>  <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">postQz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> state <span class="main">⇒</span> nat <span class="main">⇒</span> state"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">postQz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="free">postQz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span>postQ <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">preTz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> tbd <span class="main">⇒</span> nat <span class="main">⇒</span> tbd"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preTz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preTz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> preT <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="free">preTz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>
  
  
  
  
<span class="keyword1" id="Nielson_VCG-TzQ"><span class="command">lemma</span></span> TzQ<span class="main">:</span> <span class="quoted"><span class="quoted">"preTz <span class="free">C</span> <span class="free">e</span> <span class="free">n</span> <span class="free">s</span> <span class="main">=</span> <span class="free">e</span> <span class="main">(</span>postQz <span class="free">C</span> <span class="free">s</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TQ<span class="main">)</span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Weakest precondition from annotated commands:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pre</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> assn2 <span class="main">⇒</span> assn2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main">=</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span> 
  
<span class="keyword1" id="Nielson_VCG-supportE_preT"><span class="command">lemma</span></span> supportE_preT<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">%</span><span class="bound">l</span><span class="main">.</span> preT <span class="free">C</span> <span class="main">(</span><span class="free">e</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">b</span> <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> supportE_if<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Aif <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">A</span> <span class="skolem">y</span> <span class="skolem">C</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="skolem"><span class="skolem">E</span></span>  <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">=</span> <span class="main">(</span><span class="skolem">I</span><span class="main">,</span><span class="skolem">S</span><span class="main">,</span><span class="skolem">E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> supportE_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aseq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> supportE_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="Nielson_VCG-supportE_twicepreT"><span class="command">lemma</span></span> supportE_twicepreT<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">%</span><span class="bound">l</span><span class="main">.</span> preT <span class="free">C1</span> <span class="main">(</span>preT <span class="free">C2</span> <span class="main">(</span><span class="free">e</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> supportE_preT supportE_preT<span class="main"><span class="main">]</span></span><span class="main">)</span>



<span class="keyword1" id="Nielson_VCG-supportE_preTz"><span class="command">lemma</span></span> supportE_preTz<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">%</span><span class="bound">l</span><span class="main">.</span> preTz <span class="free">C</span> <span class="main">(</span><span class="free">e</span> <span class="bound">l</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> supportE_preT<span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1" id="Nielson_VCG-supportE_preTz_Un"><span class="command">lemma</span></span> supportE_preTz_Un<span class="main">:</span> <span class="comment1">(* like in support_wpw_Un *)</span>
  <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> preTz <span class="free">C</span> <span class="main">(</span><span class="free">e</span> <span class="bound">l</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="main">(</span><span class="keyword1">UN</span> <span class="bound">n</span><span class="main">.</span> supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> preTz <span class="free">C</span> <span class="main">(</span><span class="free">e</span> <span class="bound">l</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> supportE_def subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Nielson_VCG-supportE_preTz2"><span class="command">lemma</span></span> supportE_preTz2<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">%</span><span class="bound">l</span><span class="main">.</span> preTz <span class="free">C</span> <span class="main">(</span><span class="free">e</span> <span class="bound">l</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="main">(</span>supportE <span class="free">e</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> supportE_preTz_Un<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> supportE_preTz <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  


<span class="keyword1" id="Nielson_VCG-pff"><span class="command">lemma</span></span> pff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="free">I</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> support <span class="free">I</span> <span class="main">-</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>  <span class="keyword1"><span class="command">using</span></span> fun_upd_apply <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">smt</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> fun_upd_apply<span class="main">)</span>  <span class="keyword1"><span class="command">oops</span></span>
  
<span class="keyword1" id="Nielson_VCG-pff"><span class="command">lemma</span></span> pff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span><span class="main">.</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="free">I</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> support <span class="free">I</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>  <span class="keyword1"><span class="command">using</span></span> fun_upd_apply <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">smt</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> fun_upd_apply<span class="main">)</span>  


<span class="keyword1" id="Nielson_VCG-supportAB"><span class="command">lemma</span></span> supportAB<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">A</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">B</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> support <span class="free">A</span>"</span></span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> support_inv<span class="main">)</span> 
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>pre <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free">I</span><span class="main">,</span><span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="main">(</span><span class="free">E</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">C</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊆</span> support <span class="free">I</span>"</span></span> 
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> supportAB<span class="main">)</span> 

<span class="keyword1" id="Nielson_VCG-support_pre"><span class="command">lemma</span></span> support_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>pre <span class="free">C</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊆</span> support <span class="free">Q</span> <span class="main">∪</span> varacom <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">A</span> <span class="skolem">b</span> <span class="skolem">C</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="skolem"><span class="skolem">E</span></span>  <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">=</span> <span class="main">(</span><span class="skolem">I</span><span class="main">,</span><span class="main">(</span><span class="skolem">S</span><span class="main">,</span><span class="main">(</span><span class="skolem">E</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
  <span class="keyword1"><span class="command">have</span></span> support_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> A  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> supportAB  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aseq <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">x</span> <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> bval <span class="skolem">x</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> support <span class="skolem">Q</span> <span class="main">∪</span> varacom <span class="skolem">C1</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_impl<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> Aif<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">~</span> bval <span class="skolem">x</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> support <span class="skolem">Q</span> <span class="main">∪</span> varacom <span class="skolem">C2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_impl<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> Aif<span class="main">)</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> s1 s2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aconseq <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> support_def<span class="main">)</span> 

<span class="keyword1" id="Nielson_VCG-finite_support_pre"><span class="command">lemma</span></span> finite_support_pre<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="free">Q</span><span class="main">)</span>  <span class="main">⟹</span> finite <span class="main">(</span>varacom <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span>  finite <span class="main">(</span>support <span class="main">(</span>pre <span class="free">C</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_subset support_pre finite_UnI <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">time</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> tbd"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="keyword1">SKIP</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free">time</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">s</span> <span class="main">+</span> preT <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">time</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">+</span> <span class="free">time</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">+</span> <span class="free">time</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E'</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span>"</span></span>
   
    
<span class="keyword1" id="Nielson_VCG-supportE_single"><span class="command">lemma</span></span> supportE_single<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> supportE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="Nielson_VCG-supportE_plus"><span class="command">lemma</span></span> supportE_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">e1</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">+</span> <span class="free">e2</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="free">e1</span> <span class="main">∪</span> supportE <span class="free">e2</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> supportE_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 

<span class="keyword1" id="Nielson_VCG-supportE_Suc"><span class="command">lemma</span></span> supportE_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> Suc <span class="main">(</span><span class="free">e1</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> supportE <span class="free">e1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> supportE_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 


<span class="keyword1" id="Nielson_VCG-supportE_single2"><span class="command">lemma</span></span> supportE_single2<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> supportE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Nielson_VCG-supportE_time"><span class="command">lemma</span></span> supportE_time<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> time <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> supportE_single2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>   

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="free">I</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">I</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_upd_triv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="free">I</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span>Suc <span class="main">(</span><span class="bound">l</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">l</span> <span class="free">x</span> <span class="main">=</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">I</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span> <span class="skolem">l</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">.</span> <span class="free">I</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> Suc <span class="main">(</span><span class="bound">l</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span><span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> Suc <span class="main">(</span><span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_upd_triv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Verification condition:›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> assn2  <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span>pre <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>  
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> time <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="bound">s</span>  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> <span class="main">(</span>pre <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="bound">l'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l'</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="main">⟶</span>  pre <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span>   <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">s</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">+</span> preT <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">s</span> <span class="main">+</span> time <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">s</span>
  <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>postQ <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">s</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">s</span><span class="main">)</span> <span class="main">)</span> <span class="main">∧</span>
  <span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">)</span>"</span></span>
      
<span class="keyword1" id="Nielson_VCG-pre_mono"><span class="command">lemma</span></span> pre_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P'</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> pre <span class="free">C</span> <span class="free">P</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span> pre <span class="free">C</span> <span class="free">P'</span> <span class="free">l</span> <span class="free">s</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">P'</span></span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aseq <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">P</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Aseq<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Aseq<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> Aseq<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ A<span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">A</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="skolem"><span class="skolem">E</span></span>   <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">I</span><span class="main">,</span><span class="skolem">S</span><span class="main">,</span><span class="skolem">E</span> <span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Awhile <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> A <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

<span class="keyword1" id="Nielson_VCG-vc_mono"><span class="command">lemma</span></span> vc_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">P'</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> vc <span class="free">C</span> <span class="free">P</span> <span class="main">⟹</span> vc <span class="free">C</span> <span class="free">P'</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">P'</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pre_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pre_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness:›</span></span>
 
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">preSet</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">==</span> <span class="main">(</span>Ball <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">u</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">u</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="bound">x</span> <span class="main">=</span> preT <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">e</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">postSet</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">==</span> <span class="main">(</span>Ball <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">u</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">u</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">e</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ListUpdate</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ListUpdate</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ListUpdate</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">ListUpdate</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Nielson_VCG-allg"><span class="command">lemma</span></span> allg<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> U2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span> fst <span class="main">`</span> <span class="free">upds</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> <span class="free">A</span> <span class="bound">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">xs</span> <span class="main">⊆</span> fst <span class="main">`</span> <span class="free">upds</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">(</span>ListUpdate <span class="free">l''</span> <span class="free">xs</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="free">l''</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> axe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">(</span>ListUpdate <span class="free">l''</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> 
    <span class="main">=</span> <span class="free">A</span> <span class="main">(</span><span class="main">(</span>ListUpdate <span class="free">l''</span> <span class="skolem">xs</span> <span class="free">q</span><span class="main">)</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="free">q</span> <span class="skolem">e</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>  "</span></span> <span class="keyword1"><span class="command">unfolding</span></span> axe <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  <span class="free">A</span>  <span class="main">(</span>ListUpdate <span class="free">l''</span> <span class="skolem">xs</span> <span class="free">q</span><span class="main">)</span>  "</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> U2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Cons axe <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">A</span> <span class="free">l''</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>  

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ListUpdateE</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ListUpdateE</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span>   <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ListUpdateE</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="free">ListUpdateE</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>  <span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Nielson_VCG-ListUpdate_E"><span class="command">lemma</span></span> ListUpdate_E<span class="main">:</span> <span class="quoted"><span class="quoted">"ListUpdateE <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> ListUpdate <span class="free">f</span> <span class="free">xs</span> <span class="main">(</span><span class="main">%</span><span class="bound">e</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a xs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1" id="Nielson_VCG-allg_E"><span class="command">lemma</span></span> allg_E<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted">assn2</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> 
   <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">upds</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="bound">l</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">xs</span> <span class="main">⊆</span> fst <span class="main">`</span> <span class="free">upds</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">(</span>ListUpdateE <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">A</span> <span class="main">(</span>ListUpdate <span class="free">f</span> <span class="free">xs</span> <span class="main">(</span><span class="main">%</span><span class="bound">e</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allg<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ListUpdate_E<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Nielson_VCG-ListUpdateE_updates"><span class="command">lemma</span></span> ListUpdateE_updates<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> ListUpdateE <span class="free">l''</span> <span class="free">xs</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">=</span> snd <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">a</span> <span class="main">=</span> fst <span class="free">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> fstx<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="free">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> fstx  a <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a2 a <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>set <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> B A<span class="main">]</span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>
  
    
<span class="keyword1" id="Nielson_VCG-ListUpdate_updates"><span class="command">lemma</span></span> ListUpdate_updates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> ListUpdate <span class="free">l''</span> <span class="free">xs</span> <span class="main">(</span><span class="main">%</span><span class="bound">e</span><span class="main">.</span> <span class="free">l</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">l</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> axe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> axe
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="skolem">p</span>"</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">lesvars</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">==</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">preList</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preList</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">preList</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> preT <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="free">preList</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
        
<span class="keyword1" id="Nielson_VCG-preList_Seq"><span class="command">lemma</span></span> preList_Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">upds</span> <span class="main">(</span><span class="free">C1</span><span class="main">;;</span> <span class="free">C2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preList <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> preT <span class="free">C2</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="free">upds</span><span class="main">)</span> <span class="free">C1</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Nielson_VCG-support_True"><span class="command">lemma</span></span> support_True<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> support_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  
<span class="keyword1" id="Nielson_VCG-support_preList"><span class="command">lemma</span></span> support_preList<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>preList <span class="free">upds</span> <span class="free">C1</span><span class="main">)</span> <span class="main">⊆</span> lesvars <span class="free">upds</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">upds</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Un_least<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_eq<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> supportE_twicepreT subset_trans  supportE_single2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1" id="Nielson_VCG-preListpreSet"><span class="command">lemma</span></span> preListpreSet<span class="main">:</span> <span class="quoted"><span class="quoted">"preSet <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span> preList <span class="free">xs</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Nielson_VCG-preSetpreList"><span class="command">lemma</span></span> preSetpreList<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">xs</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span>  preSet <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="comment1">(* surprise. but makes sense, if the clauses are contradictory on the 
    left side, so are they on the right side *)</span>
<span class="keyword1" id="Nielson_VCG-preSetpreList_eq"><span class="command">lemma</span></span> preSetpreList_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">xs</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preSet <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>  


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">postList</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">postList</span> <span class="main">[]</span>  <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">postList</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="free">postList</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

  
<span class="keyword1" id="Nielson_VCG-support_postList"><span class="command">lemma</span></span> support_postList<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>postList <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> lesvars <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>    
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Un_least<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_eq<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> supportE_twicepreT subset_trans  supportE_single2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  
<span class="keyword1" id="Nielson_VCG-postpreList_inv"><span class="command">lemma</span></span> postpreList_inv<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="free">s</span> <span class="main">=</span> <span class="free">S</span> <span class="main">(</span>postQ <span class="free">C</span> <span class="free">s</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"postList <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="free">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">upds</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span>  preList <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="free">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">upds</span><span class="main">)</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">upds</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> axe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>    
  
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> axe <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> TQ<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  
  
  
<span class="keyword1" id="Nielson_VCG-postList_preList"><span class="command">lemma</span></span> postList_preList<span class="main">:</span> <span class="quoted"><span class="quoted">"postList <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> preT <span class="free">C</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="free">upds</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preList <span class="free">upds</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  
<span class="keyword1" id="Nielson_VCG-postSetpostList"><span class="command">lemma</span></span> postSetpostList<span class="main">:</span> <span class="quoted"><span class="quoted">"postList <span class="free">xs</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span>  postSet <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  

<span class="keyword1" id="Nielson_VCG-postListpostSet"><span class="command">lemma</span></span> postListpostSet<span class="main">:</span> <span class="quoted"><span class="quoted">"postSet <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span> postList <span class="free">xs</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1" id="Nielson_VCG-ListAskip"><span class="command">lemma</span></span> ListAskip<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">xs</span> Askip <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> postList <span class="free">xs</span>  <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Nielson_VCG-SetAskip"><span class="command">lemma</span></span> SetAskip<span class="main">:</span> <span class="quoted"><span class="quoted">"preSet <span class="free">U</span> Askip <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> postSet <span class="free">U</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Nielson_VCG-ListAassign"><span class="command">lemma</span></span> ListAassign<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">upds</span> <span class="main">(</span>Aassign <span class="free">x1</span> <span class="free">x2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> postList <span class="free">upds</span> <span class="free">l</span> <span class="main">(</span><span class="free">s</span><span class="main">[</span><span class="free">x2</span><span class="main">/</span><span class="free">x1</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Nielson_VCG-SetAassign"><span class="command">lemma</span></span> SetAassign<span class="main">:</span> <span class="quoted"><span class="quoted">"preSet <span class="free">U</span> <span class="main">(</span>Aassign <span class="free">x1</span> <span class="free">x2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> postSet <span class="free">U</span> <span class="free">l</span> <span class="main">(</span><span class="free">s</span><span class="main">[</span><span class="free">x2</span><span class="main">/</span><span class="free">x1</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1" id="Nielson_VCG-ListAconseq"><span class="command">lemma</span></span> ListAconseq<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">upds</span> <span class="main">(</span>Aconseq <span class="free">x1</span> <span class="free">x2</span> <span class="free">x3</span> <span class="free">C</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preList <span class="free">upds</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Nielson_VCG-SetAconseq"><span class="command">lemma</span></span> SetAconseq<span class="main">:</span> <span class="quoted"><span class="quoted">"preSet <span class="free">U</span> <span class="main">(</span>Aconseq <span class="free">x1</span> <span class="free">x2</span> <span class="free">x3</span> <span class="free">C</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preSet <span class="free">U</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Nielson_VCG-ListAif1"><span class="command">lemma</span></span> ListAif1<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="free">s</span> <span class="main">⟹</span> preList <span class="free">upds</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">C1</span> <span class="keyword1">ELSE</span> <span class="free">C2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preList <span class="free">upds</span> <span class="free">C1</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1" id="Nielson_VCG-SetAif1"><span class="command">lemma</span></span> SetAif1<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="free">s</span> <span class="main">⟹</span> preSet <span class="free">upds</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">C1</span> <span class="keyword1">ELSE</span> <span class="free">C2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preSet <span class="free">upds</span> <span class="free">C1</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1" id="Nielson_VCG-ListAif2"><span class="command">lemma</span></span> ListAif2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="free">b</span> <span class="free">s</span> <span class="main">⟹</span> preList <span class="free">upds</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">C1</span> <span class="keyword1">ELSE</span> <span class="free">C2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preList <span class="free">upds</span> <span class="free">C2</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Nielson_VCG-SetAif2"><span class="command">lemma</span></span> SetAif2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="free">b</span> <span class="free">s</span> <span class="main">⟹</span> preSet <span class="free">upds</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">C1</span> <span class="keyword1">ELSE</span> <span class="free">C2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preSet <span class="free">upds</span> <span class="free">C2</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
    
<span class="comment1">(*
  In upds we collect pairs of logical variables and time expressions, these logical variables
  are bound to the value of these expressions. postList upds C l s is an assertion stating that
  for every (x,e) in upds, l x = e s; preList upds C l s does the same, but pulls the expression
  e through the command c, i.e. stating for ever (x,e) in upds, l x = preT C e s. 

  we have to make sure, that no variable is assigned twice (the 5th premise), as well as they are 
  different from all the logical variables that occur in the annotated program C (4th premise)

  we have to make sure that we can always choose new logical variables (premise 2, 3)
*)</span>    
<span class="keyword1" id="Nielson_VCG-vc_sound"><span class="command">lemma</span></span> vc_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">Q</span> <span class="main">⟹</span> finite <span class="main">(</span>support <span class="free">Q</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>varacom <span class="free">C</span><span class="main">)</span>
  <span class="main">⟹</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">upds</span><span class="main">)</span> <span class="main">∩</span> varacom <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> distinct <span class="main">(</span>map fst <span class="free">upds</span><span class="main">)</span>
  <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="free">upds</span> <span class="free">C</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> time <span class="free">C</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="free">upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="free">C</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>    
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Askip <span class="skolem">Q</span> <span class="skolem">upds</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weaken_post<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> preList <span class="skolem"><span class="skolem">upds</span></span> Askip <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Skip<span class="main">)</span>  <span class="keyword1"><span class="command">using</span></span> ListAskip   
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aassign <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">Q</span> <span class="skolem">upds</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assign<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weaken_post<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> postList <span class="skolem"><span class="skolem">upds</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ListAassign<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> postQ.simps pre.simps<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">b</span> <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="skolem">upds</span> <span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assign<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> If2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> bval <span class="skolem"><span class="skolem">b</span></span> <span class="bound"><span class="bound">a</span></span> <span class="keyword1"><span class="keyword1">then</span></span>  time <span class="skolem"><span class="skolem">C1</span></span> <span class="bound"><span class="bound">a</span></span> <span class="keyword1"><span class="keyword1">else</span></span> time <span class="skolem"><span class="skolem">C2</span></span> <span class="bound"><span class="bound">a</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> rev_conj_cong<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ub_cost<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"time <span class="skolem"><span class="skolem">C1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> pre <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> preList <span class="skolem"><span class="skolem">upds</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> ListAif1
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Aif<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> rev_conj_cong<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ub_cost<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"time <span class="skolem"><span class="skolem">C2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="comment1">(* k=1 and *)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> pre <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> preList <span class="skolem"><span class="skolem">upds</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> ListAif2
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Aif<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aconseq <span class="skolem">P'</span> <span class="skolem">Qannot</span> <span class="skolem">eannot</span> <span class="skolem">C</span> <span class="skolem">Q</span> <span class="skolem">upds</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ih1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="skolem">Qannot</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ih1'<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>  time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">eannot</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                       
      
  <span class="keyword1"><span class="command">have</span></span> ih2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">Qannot</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Aconseq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Aconseq<span class="main">(</span>2-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    
  <span class="keyword1"><span class="command">have</span></span> G1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="main">(</span><span class="main">{</span><span class="skolem">P'</span><span class="main">/</span><span class="skolem">Qannot</span><span class="main">/</span><span class="skolem">eannot</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="skolem">C</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span> strip <span class="skolem">C</span>
         <span class="main">{</span> <span class="skolem">eannot</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="skolem">C</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span> strip <span class="skolem">C</span> <span class="main">{</span> time <span class="skolem">C</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Qannot</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Aconseq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Aconseq<span class="main">(</span>2-6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="main">(</span><span class="main">{</span><span class="skolem">P'</span><span class="main">/</span><span class="skolem">Qannot</span><span class="main">/</span><span class="skolem">eannot</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="skolem">C</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>
              time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="skolem">eannot</span> <span class="bound">s</span> <span class="main">∧</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> <span class="main">(</span>pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="skolem">C</span> <span class="bound">l'</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span>
                        <span class="main">(</span><span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="bound">t</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="bound">l'</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">t</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span>
      <span class="keyword3"><span class="command">assume</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> prelist<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="skolem">upds</span> <span class="main">(</span><span class="main">{</span><span class="skolem">P'</span><span class="main">/</span><span class="skolem">Qannot</span><span class="main">/</span><span class="skolem">eannot</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"time <span class="skolem">C</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">eannot</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ih1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                   
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
      <span class="comment1">― ‹we now have to construct a logical environment, that both
          * satisfies the annotated postcondition Qannot (we obtain it from the first IH)
          * lets the updates come true (we have to show that resetting these logical variables
              does not interfere with the other variables)›</span>  
      
      <span class="keyword1"><span class="command">from</span></span> ih1' P' <span class="keyword1"><span class="command">have</span></span> satQan<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> i'<span class="main">:</span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="skolem">l'</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Qannot</span> <span class="skolem">l'</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upds'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span>preT <span class="skolem">C</span> <span class="bound">e</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?l''</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ListUpdateE <span class="skolem">l'</span> <span class="var">?upds'</span><span class="main">)</span>"</span></span>
        
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span> <span class="skolem">n</span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="skolem">upds</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> support <span class="main">(</span>pre <span class="skolem">C</span> <span class="skolem">Qannot</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Aconseq<span class="main">(</span>5<span class="main">)</span> support_pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> U2<span class="main">=</span>this 
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span> <span class="skolem">n</span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="skolem">upds</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> support <span class="skolem">Qannot</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Aconseq<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Qannot</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> <span class="skolem">Qannot</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> K2<span class="main">=</span>this  
              
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="var">?l''</span>  <span class="main">=</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="skolem">l'</span>  "</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allg_E<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?upds</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"set <span class="skolem"><span class="skolem">upds</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> U2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">with</span></span> i' <span class="keyword1"><span class="command">have</span></span> i''<span class="main">:</span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="var">?l''</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Qannot</span> <span class="var">?l''</span> <span class="main">=</span> <span class="skolem">Qannot</span> <span class="skolem">l'</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allg_E<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?upds</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"set <span class="skolem"><span class="skolem">upds</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> K2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>              
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">%</span><span class="bound">l'</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span> <span class="var">?l''</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">l'</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">l'</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ii' <span class="keyword1"><span class="command">have</span></span> ii''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Qannot</span> <span class="var">?l''</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            
      <span class="keyword1"><span class="command">have</span></span> xs_upds<span class="main">:</span> <span class="quoted"><span class="quoted">"map fst <span class="var">?upds'</span> <span class="main">=</span> map fst <span class="skolem">upds</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>          
      <span class="keyword1"><span class="command">have</span></span> resets<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="var">?upds'</span> <span class="main">⟹</span> ListUpdateE <span class="skolem">l'</span> <span class="var">?upds'</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> snd <span class="bound">x</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ListUpdateE_updates<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> xs_upds<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Aconseq<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>         
        
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="skolem">upds</span> <span class="skolem">C</span> <span class="var">?l''</span> <span class="skolem">s</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> preListpreSet<span class="main"><span class="keyword3">,</span></span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">e</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?upds'</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">from</span></span> resets<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>  
          
      <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Qannot</span> <span class="var">?l''</span> <span class="skolem">t</span> <span class="main">⟹</span> postList <span class="skolem">upds</span> <span class="var">?l''</span> <span class="skolem">t</span> <span class="main">⟹</span> postList <span class="skolem">upds</span> <span class="skolem">l</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> postListpostSet<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>        
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">e</span><span class="main">)</span>            
        <span class="keyword1"><span class="command">from</span></span> postSetpostList<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"postSet <span class="main">(</span>set <span class="skolem">upds</span><span class="main">)</span> <span class="var">?l''</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l''</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">e</span> <span class="skolem">t</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>            
        <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">)</span> resets<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span>preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>   B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?l''</span> <span class="skolem">x</span> <span class="main">=</span> snd <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">from</span></span> A B <span class="keyword1"><span class="command">have</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="skolem">t</span> <span class="main">=</span> preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">from</span></span> preSetpreList<span class="main">[</span><span class="operator">OF</span> prelist<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"preSet <span class="main">(</span>set <span class="skolem">upds</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="skolem">P'</span><span class="main">/</span><span class="skolem">Qannot</span><span class="main">/</span><span class="skolem">eannot</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="skolem">x</span> <span class="main">=</span> preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">from</span></span> X Y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> 
          
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> <span class="main">(</span>pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="skolem">C</span> <span class="bound">l'</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∧</span>
                  <span class="main">(</span><span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">t</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="bound">l'</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>        
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?l''</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>        
        <span class="keyword1"><span class="command">using</span></span> i'' A ii'' B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span> 
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> G2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span>   
    <span class="keyword1"><span class="command">with</span></span> ih1' ih2' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
     
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> G1 G2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aseq <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="skolem">upds</span><span class="main">)</span>
   
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span><span class="skolem">C2</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span>  <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"support <span class="skolem">Q</span> <span class="main">∪</span> varacom <span class="skolem">C1</span> <span class="main">∪</span> varacom <span class="skolem">C2</span> <span class="main">∪</span> lesvars <span class="skolem">upds</span>"</span></span>  
  
  <span class="keyword1"><span class="command">have</span></span> finite_varacom<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varacom <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
  <span class="keyword1"><span class="command">have</span></span> sup_L<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>preList <span class="skolem">upds</span> <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span><span class="skolem">C2</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> lesvars <span class="skolem">upds</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> support_preList<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  
  <span class="comment1">― ‹choose a fresh logical variable ?y in order to pull through the cost of the second command›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="var">?P'</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> fP'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?P'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_varacom Aseq<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">from</span></span> fP' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="var">?P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinite_UNIV_listI
    <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> ynP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∉</span> <span class="var">?P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> ysupC1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∉</span> varacom <span class="skolem">C1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> support_pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> sup_B<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="var">?P</span> <span class="main">⊆</span> <span class="var">?P'</span>"</span></span>                         
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> support_pre sup_L <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
        
  <span class="comment1">― ‹we show the first goal: we can deduce the desired Hoare Triple›</span>  
  <span class="keyword1"><span class="command">have</span></span> C1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span> strip <span class="skolem">C1</span><span class="main">;;</span> strip <span class="skolem">C2</span>
         <span class="main">{</span> time <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Seq<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="comment1">― ‹start from the back: we can simply use the IH for C2, 
          and solve the side conditions automatically›</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span>  preList <span class="skolem">upds</span> <span class="skolem">C2</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">)</span><span class="main">}</span> strip <span class="skolem">C2</span> <span class="main">{</span> time <span class="skolem">C2</span> <span class="main">⇓</span> <span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Aseq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>  
      <span class="keyword1"><span class="command">using</span></span> Aseq<span class="main">(</span>3-7<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">next</span></span>    
    <span class="comment1">― ‹prepare the new updates: pull them through C2 and save the new execution time of C2 in ?y›</span>    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">a</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> preT <span class="skolem">C2</span> <span class="bound">e</span> <span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upds'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?y</span><span class="main">,</span>time <span class="skolem">C2</span><span class="main">)</span><span class="main">#</span><span class="var">?upds</span>"</span></span>   
      
    <span class="keyword1"><span class="command">have</span></span> dst_upds'<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="var">?upds'</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span>  ynP' Aseq<span class="main">(</span>7<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> 
        <span class="keyword1"><span class="command">using</span></span> image_iff <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> case_prod_beta' distinct_conv_nth<span class="main">)</span> 
    
    <span class="comment1">― ‹now use the first induction hypothesis (specialised with the augmented upds list, and the
        weakest precondition of Q through C as post condition)›</span>
    <span class="keyword1"><span class="command">have</span></span> IH1s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="var">?upds'</span> <span class="skolem">C1</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span> strip <span class="skolem">C1</span>
                    <span class="main">{</span> time <span class="skolem">C1</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds'</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Aseq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Aseq<span class="main">(</span>3-7<span class="main">)</span> ysupC1 dst_upds' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    
    <span class="comment1">― ‹glue it together with a consequence rule, side conditions are automatic›</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>pre <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">l</span> <span class="var">?y</span> <span class="main">=</span> preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="bound">s</span><span class="main">}</span> strip <span class="skolem">C1</span>
     <span class="main">{</span> time <span class="skolem">C1</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="skolem">C2</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> time <span class="skolem">C2</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">l</span> <span class="var">?y</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ IH1s<span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> preList_Seq postList_preList<span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="comment1">― ‹solve some side conditions showing that, ?y is indeed fresh›</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∉</span> support <span class="var">?P</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> sup_B ynP' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
    <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>preList <span class="skolem">upds</span> <span class="skolem">C2</span><span class="main">)</span> <span class="main">⊆</span> lesvars <span class="skolem">upds</span>"</span></span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> support_preList<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span>  <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="skolem">C2</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?P'</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> F support_pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> ynP'
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∉</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="skolem">C2</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
   
  <span class="comment1">― ‹we show the second goal: weakest precondition implies, that
        Q holds after the execution of C1 and C2›</span>  
  <span class="keyword1"><span class="command">have</span></span> C2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"pre <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">)</span>  <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span>  <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Aseq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> upds<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Aseq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span>  <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C2</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Aseq<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> upds<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Aseq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>        
    <span class="keyword1"><span class="command">from</span></span> p A B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> C1 C2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">A</span> <span class="skolem">b</span> <span class="skolem">C</span> <span class="skolem">Q</span> <span class="skolem">upds</span><span class="main">)</span>
  
  <span class="comment1">― ‹Let us first see, what we got from the induction hypothesis:›</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="skolem"><span class="skolem">E</span></span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">I</span><span class="main">,</span><span class="main">(</span><span class="skolem">S</span><span class="main">,</span><span class="main">(</span><span class="skolem">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹vc <span class="main">(</span>Awhile <span class="skolem">A</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">Q</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vc <span class="main">(</span>Awhile <span class="main">(</span><span class="skolem">I</span><span class="main">,</span><span class="skolem">S</span><span class="main">,</span><span class="skolem">E</span><span class="main">)</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span>  <span class="keyword1"><span class="command">have</span></span> vc<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="skolem">I</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span>  pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span>  <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">S</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">s</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> IQ2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span>
                         pre <span class="skolem">C</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span>
                          <span class="main">∧</span>  <span class="main">1</span> <span class="main">+</span> preT <span class="skolem">C</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">+</span> time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">S</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
    
  <span class="comment1">― ‹the logical variable x represents the number of loop unfoldings›</span>
       
  
  <span class="keyword1"><span class="command">from</span></span> IQ2 <span class="keyword1"><span class="command">have</span></span> IQ_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span>   bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">S</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> inv_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span>  <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span>   bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span>  pre <span class="skolem">C</span> <span class="skolem">I</span>  <span class="bound">l</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IQ2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  
  <span class="keyword1"><span class="command">have</span></span> yC<span class="main">:</span> <span class="quoted"><span class="quoted">" lesvars <span class="skolem">upds</span> <span class="main">∩</span> varacom <span class="skolem">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?INV</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span>"</span></span>      
    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lesvars <span class="skolem">upds</span> <span class="main">∩</span> support <span class="skolem">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    
  <span class="comment1">― ‹we need a fresh variable ?z to remember the time bound of the tail of the loop›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"lesvars <span class="skolem">upds</span> <span class="main">∪</span> varacom <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">SOME</span> <span class="bound">z</span><span class="main">::</span>lvname<span class="main">.</span> <span class="bound">z</span> <span class="main">∉</span> <span class="var">?P</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Awhile <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span><span class="main">∉</span><span class="var">?P</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> infinite_UNIV_listI
    <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> znP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> znP <span class="keyword1"><span class="command">have</span></span> <span class="comment1">(* znx:  "?z≠x" 
    and *)</span> zny<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> lesvars <span class="skolem">upds</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zI<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> support <span class="skolem">I</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> blb<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> varacom <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      
  <span class="keyword1"><span class="command">from</span></span> Awhile<span class="main">(</span>4<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 23<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varacom <span class="skolem">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>  26<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="skolem">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
   
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span>  pre <span class="skolem">C</span> <span class="skolem">I</span>  <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span>"</span></span>    
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Awhile<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>       
  <span class="keyword1"><span class="command">hence</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 
      
  <span class="comment1">― ‹we adapt the updates, by pulling them through the loop body 
      and remembering the time bound of the tail of the loop›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> fua<span class="main">:</span> <span class="quoted"><span class="quoted">"lesvars <span class="var">?upds</span> <span class="main">=</span> lesvars <span class="skolem">upds</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upds'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?z</span><span class="main">,</span><span class="skolem">E</span><span class="main">)</span> <span class="main">#</span> <span class="var">?upds</span>"</span></span> 
     
      
  <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∘</span> <span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       
  <span class="comment1">― ‹show that the Hoare Rule is derivable›</span>    
  <span class="keyword1"><span class="command">have</span></span> G1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="skolem">I</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">E</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> strip <span class="skolem">C</span>
         <span class="main">{</span> <span class="skolem">E</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> strip <span class="skolem">C</span>
              <span class="main">{</span> <span class="skolem">E</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span>bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">}</span>"</span></span>
    <span class="comment1">― ‹We use the While Rule and then have to show, that ...›</span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> While<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span> 
      <span class="comment1">― ‹A) the loop body preserves the loop invariant›</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lesvars <span class="var">?upds'</span> <span class="main">∩</span> varacom <span class="skolem">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> yC blb <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          
      <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="var">?upds'</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>6<span class="main">)</span> zny <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z<span class="main">)</span>       
      
      <span class="comment1">― ‹for showing preservation of the invariant, use the consequence rule ...›</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">∧</span> preT <span class="skolem">C</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="var">?z</span><span class="main">}</span>
       strip <span class="skolem">C</span> <span class="main">{</span>  time <span class="skolem">C</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">l</span> <span class="var">?z</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main">)</span>
        <span class="comment1">― ‹... and employ the induction hypothesis, ...›</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="var">?upds'</span> <span class="skolem">C</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span> strip <span class="skolem">C</span>
                <span class="main">{</span> time <span class="skolem">C</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds'</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Awhile.IH<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>              
      <span class="keyword1"><span class="command">next</span></span>
        <span class="comment1">― ‹finally we have to prove the side condition.›</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">∧</span> preT <span class="skolem">C</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="var">?z</span>
                   <span class="main">⟶</span> <span class="main">(</span>pre <span class="skolem">C</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="var">?upds'</span> <span class="skolem">C</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> time <span class="skolem">C</span> <span class="bound">s</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>              
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>
          <span class="keyword1"><span class="command">note</span></span> upds_invariant<span class="main">=</span>postpreList_inv<span class="main">[</span><span class="operator">OF</span> IQ_in<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">from</span></span> 2  upds_invariant   <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> inv_impl <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>   
      <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="comment1">― ‹B) the invariant with number of loop unfoldings greater than 0 implies true loop guard
             and running time is correctly bounded›</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> bval <span class="skolem">b</span> <span class="bound">s</span>  <span class="main">∧</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">1</span> <span class="main">+</span> preT <span class="skolem">C</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">+</span> time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="bound">s</span>"</span></span>        
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>          
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> IQ2 1<span class="main">(</span>1<span class="main">,</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="comment1">― ‹C) the invariant with number of loop unfoldings equal to 0 implies false loop guard
             and running time is correctly bounded›</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span>  <span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>  <span class="main">1</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="bound">s</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>  
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
          <span class="keyword1"><span class="command">using</span></span> pre2 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">next</span></span>
      <span class="comment1">― ‹D) ?z is indeed a fresh variable›</span>
      <span class="keyword1"><span class="command">have</span></span> pff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> lesvars <span class="var">?upds</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fua<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> support <span class="skolem">I</span> <span class="main">∪</span> support <span class="main">(</span>postList <span class="var">?upds</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> support_and<span class="main">)</span> 
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>postList <span class="var">?upds</span><span class="main">)</span> <span class="main">⊆</span> lesvars <span class="var">?upds</span>"</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> support_postList<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
      <span class="keyword1"><span class="command">finally</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> support <span class="skolem">I</span> <span class="main">∪</span> lesvars <span class="var">?upds</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> zI pff <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span>  <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="skolem">I</span><span class="main">,</span> <span class="skolem">S</span><span class="main">,</span> <span class="skolem">E</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>
              <span class="main">(</span><span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="skolem">E</span> <span class="bound">s</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> postList_preList<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>   g<span class="main">)</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span>  <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="bound">l</span> <span class="bound">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> pre2  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">upds</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword1"><span class="command">have</span></span> G2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"pre <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">I</span> <span class="skolem">l</span> <span class="skolem">s</span> <span class="main">⟹</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> less IQ2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">I</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> preT <span class="skolem">C</span> <span class="skolem">E</span> <span class="skolem">s</span> <span class="main">+</span> time <span class="skolem">C</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> step <span class="keyword1"><span class="command">have</span></span> I'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">E</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> time <span class="skolem">C</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> less <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
        <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>1<span class="main">)</span> I' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> pre2 less<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> I <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>   
  <span class="keyword1"><span class="command">qed</span></span>
   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">using</span></span> G1  G2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
<span class="keyword1"><span class="command">qed</span></span>
 


 


<span class="keyword1"><span class="command">corollary</span></span> vc_sound'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">Q</span>"</span></span> 
          <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varacom <span class="free">C</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span>time <span class="free">C</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> upds<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1-3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>      
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Nielson_VCG-preT_constant"><span class="command">lemma</span></span> preT_constant<span class="main">:</span> <span class="quoted"><span class="quoted">"preT <span class="free">C</span> <span class="main">(</span><span class="main">%</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
 

<span class="keyword1"><span class="command">corollary</span></span> vc_sound''<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vc <span class="free">C</span> <span class="free">Q</span><span class="main">;</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> time <span class="free">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">;</span>
  finite <span class="main">(</span>support <span class="free">Q</span><span class="main">)</span><span class="main">;</span> finite <span class="main">(</span>varacom <span class="free">C</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span><span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ub_cost<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"time <span class="free"><span class="free">C</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness:›</span></span>

<span class="keyword1" id="Nielson_VCG-vc_complete"><span class="command">lemma</span></span> vc_complete<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span>   <span class="main">∃</span><span class="bound">C</span><span class="main">.</span> strip <span class="bound">C</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∧</span> vc <span class="bound">C</span> <span class="free">Q</span> 
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="bound">C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="bound">C</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>  time <span class="bound">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span>  "</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span>   <span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?G</span> <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="bound">C</span> <span class="free">e</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoare1.induct <span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Skip
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?C</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> Askip"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">P</span> <span class="skolem">a</span> <span class="skolem">x</span>  <span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?C</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span><span class="main">(</span>Aassign <span class="skolem">x</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> fun_upd_apply<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">P</span> <span class="skolem">x</span> <span class="skolem">e2'</span> <span class="skolem">c1</span> <span class="skolem">e1</span> <span class="skolem">Q</span> <span class="skolem">e2</span> <span class="skolem">c2</span> <span class="skolem">R</span> <span class="skolem">e</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> Seq.IH<span class="main">(</span>1<span class="main">)</span>   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">l</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">e2'</span> <span class="bound">s</span><span class="main">)</span> <span class="skolem">c1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="bound">b</span> <span class="main">≤</span> <span class="bound">a</span> <span class="skolem">x</span><span class="main">)</span> <span class="skolem">C1</span> <span class="skolem">e1</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> ih1<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C1</span> <span class="main">=</span> <span class="skolem">c1</span>"</span></span>
    <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="bound">b</span> <span class="main">≤</span> <span class="bound">a</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="bound">l</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">e2'</span> <span class="bound">s</span> <span class="main">⟹</span> pre <span class="skolem">C1</span> <span class="main">(</span><span class="main">λ</span><span class="bound">la</span> <span class="bound">sa</span><span class="main">.</span> <span class="main">(</span><span class="skolem">Q</span> <span class="bound">la</span> <span class="bound">sa</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="bound">sa</span> <span class="main">≤</span> <span class="bound">la</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">l</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">e2'</span> <span class="bound">s</span> <span class="main">⟶</span>  time <span class="skolem">C1</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="bound">s</span><span class="main">)</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span>  <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="bound">l</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">e2'</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">l</span> <span class="skolem">x</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  <span class="keyword1"><span class="command">from</span></span> Seq.IH<span class="main">(</span>2<span class="main">)</span>   <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ih2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="skolem">Q</span> <span class="skolem">c2</span> <span class="skolem">R</span> <span class="skolem">C2</span> <span class="skolem">e2</span>  "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ih2<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C2</span> <span class="main">=</span> <span class="skolem">c2</span>"</span></span>
    <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">R</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> pre <span class="skolem">C2</span> <span class="skolem">R</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>  time <span class="skolem">C2</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e2</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span> <span class="main">.</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">R</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C2</span> <span class="bound">s</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?C</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span><span class="main">(</span>Aseq <span class="main">(</span>Aconseq <span class="skolem">P</span> <span class="skolem">Q</span> <span class="main">(</span>time <span class="skolem">C1</span><span class="main">)</span> <span class="skolem">C1</span><span class="main">)</span> <span class="skolem">C2</span><span class="main">)</span>"</span></span> <span class="comment1">(* with Q being (λla sa. (Q la sa ∧ e2 sa ≤ la x)) some less mono is needed *)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ih1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ih2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_mono<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ih1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>              
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> l s t
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">l</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">:=</span></span> <span class="skolem"><span class="skolem">e2'</span></span> <span class="skolem"><span class="skolem">s</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>              
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>              
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> pre_mono<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ih1<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>                
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> assn2_lupd<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Seq<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>                
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ih2<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> Seq<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>               
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> ih2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
      
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>      
      <span class="keyword1"><span class="command">from</span></span> 4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span><span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> Seq<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ih1<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span><span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> Seq<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> ih2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword1"><span class="command">with</span></span>  ih2<span class="main">(</span>5<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 5
      <span class="keyword1"><span class="command">from</span></span> ih1<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
        gg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span><span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">;</span> <span class="skolem">e2'</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="skolem">x</span><span class="main">⟧</span> <span class="main">⟹</span>   time <span class="skolem">C1</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span>max <span class="skolem"><span class="skolem">k</span></span>  <span class="skolem"><span class="skolem">k2</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> xnP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> support <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">have</span></span> 41<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> assn2_lupd<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> xnP<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> 5<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        
        <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"  time <span class="skolem">C1</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> gg<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">l</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">:=</span></span><span class="skolem"><span class="skolem">e2'</span></span> <span class="skolem"><span class="skolem">s</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> 41<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
        
        <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e2'</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
          <span class="keyword1"><span class="command">from</span></span>  1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> xnP<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
          <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span><span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span><span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ih1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">l</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">:=</span></span><span class="skolem"><span class="skolem">e2'</span></span> <span class="skolem"><span class="skolem">s</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> s<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" time <span class="skolem">C2</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e2</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ih2<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">with</span></span> F <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"time <span class="skolem">C2</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e2'</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> order_subst1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e2'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
        <span class="keyword1"><span class="command">qed</span></span>  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"time <span class="skolem">C1</span> <span class="skolem">s</span> <span class="main">+</span> preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">k</span>  <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e2'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>max <span class="skolem">k</span>  <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">(</span>max <span class="skolem">k</span>  <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e2'</span> <span class="skolem">s</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> nat_mult_max_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>max <span class="skolem">k</span>  <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e1</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">e2'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>max <span class="skolem">k</span>  <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Seq<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">finally</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"time <span class="skolem">C1</span> <span class="skolem">s</span> <span class="main">+</span> preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="main">(</span>max <span class="skolem">k</span>  <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">c1</span> <span class="skolem">e1</span> <span class="skolem">Q</span> <span class="skolem">c2</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> If.IH<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span> <span class="skolem">c1</span> <span class="skolem">Q</span> <span class="skolem">C1</span> <span class="skolem">e1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="keyword2"><span class="keyword">where</span></span> ih1<span class="main">:</span> <span class="quoted"><span class="quoted">" strip <span class="skolem">C1</span> <span class="main">=</span> <span class="skolem">c1</span> <span class="main">∧</span> vc <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟶</span> time <span class="skolem">C1</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="bound">s</span><span class="main">)</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> If.IH<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span> <span class="skolem">c2</span> <span class="skolem">Q</span> <span class="skolem">C2</span> <span class="skolem">e1</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> ih2<span class="main">:</span> <span class="quoted"><span class="quoted">" strip <span class="skolem">C2</span> <span class="main">=</span> <span class="skolem">c2</span> <span class="main">∧</span> vc <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span>bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C2</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span>bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟶</span> time <span class="skolem">C2</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="bound">s</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k'</span> <span class="main">==</span> max <span class="main">(</span><span class="skolem">k1</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">k2</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?C</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span><span class="main">(</span>Aif <span class="skolem">b</span> <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 5
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">k'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> l s  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">with</span></span> ih1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"time <span class="skolem">C1</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>time <span class="skolem">C1</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">k'</span> <span class="main">+</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k'_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">k'</span> <span class="main">+</span> <span class="skolem">k'</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k'_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">with</span></span> ih2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"time <span class="skolem">C2</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>time <span class="skolem">C2</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">k'</span> <span class="main">+</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k'_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">k'</span> <span class="main">+</span> <span class="skolem">k'</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k'_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>       
      <span class="keyword1"><span class="command">using</span></span> ih1 ih2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> ih1 ih2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">e'</span> <span class="skolem">y</span> <span class="skolem">c</span> <span class="skolem">e''</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> supportPre<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">e'</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">⊆</span> support <span class="skolem">P</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">y</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> support_and support_single   <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">from</span></span>   While.IH  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    ih<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">e'</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">c</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="bound">b</span> <span class="main">≤</span> <span class="bound">a</span> <span class="skolem">y</span><span class="main">)</span> <span class="skolem">C</span> <span class="skolem">e''</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> supportPre <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> ih2<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">a</span> <span class="bound">b</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="bound">b</span> <span class="main">≤</span> <span class="bound">a</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">;</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">;</span> <span class="skolem">e'</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="skolem">y</span> <span class="main">⟧</span> <span class="main">⟹</span> pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">la</span> <span class="bound">sa</span><span class="main">.</span> <span class="main">(</span><span class="skolem">P</span> <span class="bound">la</span> <span class="bound">sa</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="bound">sa</span> <span class="main">≤</span> <span class="bound">la</span> <span class="skolem">y</span><span class="main">)</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span>"</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">⟦</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">;</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">;</span> <span class="skolem">e'</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="skolem">y</span> <span class="main">⟧</span> <span class="main">⟹</span>   time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e''</span> <span class="bound">s</span> "</span></span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span><span class="main">⟦</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">;</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">;</span> <span class="skolem">e'</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="skolem">y</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">l</span> <span class="skolem">y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
   
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?S</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"postQs <span class="skolem">C</span> <span class="skolem">b</span>"</span></span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="skolem">l</span> <span class="skolem">s</span> <span class="main">⟹</span> postQs_dom <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="skolem">l</span> <span class="main">(</span><span class="var">?S</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">~</span> bval <span class="skolem">b</span> <span class="main">(</span><span class="var">?S</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span><span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> While<span class="main">(</span>2<span class="main">)</span> less<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">e''</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> e'e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e'</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">y</span><span class="main">:=</span><span class="skolem">e'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>3<span class="main">)</span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> While<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>    
        <span class="keyword1"><span class="command">from</span></span> ih2<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> True <span class="keyword1"><span class="command">have</span></span> ee'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e'</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">y</span> <span class="main">:=</span> <span class="skolem">e'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> P' <span class="keyword1"><span class="command">have</span></span> P''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>3<span class="main">)</span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> While<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">from</span></span> ee' e'e less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> this _ P''<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"postQs_dom <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> 
              <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">l</span> <span class="main">(</span>postQs <span class="skolem">C</span> <span class="skolem">b</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bval <span class="skolem">b</span> <span class="main">(</span>postQs <span class="skolem">C</span> <span class="skolem">b</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> d'<span class="main">:</span> <span class="quoted"><span class="quoted">"postQs_dom <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> d postQs.domintros<span class="main">)</span>           
        <span class="keyword1"><span class="command">have</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">P</span> <span class="skolem">l</span> <span class="main">(</span>postQs <span class="skolem">C</span> <span class="skolem">b</span> <span class="skolem">s</span><span class="main">)</span> "</span></span>
          <span class="keyword1"><span class="command">using</span></span> True d p postQs.domintros postQs.psimps <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
        <span class="keyword1"><span class="command">have</span></span> b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> bval <span class="skolem">b</span> <span class="main">(</span>postQs <span class="skolem">C</span> <span class="skolem">b</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> b d postQs.domintros postQs.pelims<span class="main">)</span>
          
        <span class="keyword1"><span class="command">from</span></span> d' p' b' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"postQs_dom <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> postQs.domintros <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?S</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> postQs.psimps False <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">from</span></span> 1 2 less<span class="main">(</span>3<span class="main">)</span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Pdom<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> postQs_dom <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">b</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="main">(</span><span class="var">?S</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="main">~</span> bval <span class="skolem">b</span> <span class="main">(</span><span class="var">?S</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
  <span class="keyword1"><span class="command">have</span></span> S1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="main">(</span><span class="var">?S</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pdom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> S2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">~</span> bval <span class="skolem">b</span> <span class="main">(</span><span class="var">?S</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Pdom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">have</span></span> S3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="var">?S</span> <span class="bound">s</span> <span class="main">=</span> <span class="var">?S</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> postQs.psimps Pdom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">have</span></span> S4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="var">?S</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> postQs.psimps Pdom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?w</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="skolem">P</span><span class="main">,</span><span class="var">?S</span><span class="main">,</span><span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> max <span class="skolem">k</span> <span class="main">1</span> <span class="main">*</span> <span class="skolem">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="main">(</span>Aconseq <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">la</span> <span class="bound">sa</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">la</span> <span class="bound">sa</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="bound">sa</span> <span class="main">≤</span> <span class="bound">la</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span>time <span class="skolem">C</span><span class="main">)</span> <span class="skolem">C</span><span class="main">)</span>"</span></span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?C</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> <span class="var">?w</span>"</span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ih <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>         
        <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">y</span> <span class="main">:=</span> <span class="skolem">e'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span> "</span></span>
          <span class="keyword1"><span class="command">using</span></span> 1 assn2_lupd<span class="main">[</span><span class="operator">OF</span> While<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
        <span class="keyword1"><span class="command">from</span></span> ih2<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">(</span><span class="skolem">y</span> <span class="main">:=</span> <span class="skolem">e'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">s</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">" time <span class="skolem">C</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e''</span> <span class="skolem">s</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> 1 z <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>         
        
        <span class="keyword1"><span class="command">from</span></span> ih2<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">(</span><span class="skolem">y</span> <span class="main">:=</span> <span class="skolem">e'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">s</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">y</span> <span class="main">:=</span> <span class="skolem">e'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 1 z <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">e'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        
        <span class="keyword1"><span class="command">with</span></span> TQ <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">e'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?eskal</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> max <span class="skolem">k</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"preT <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> max <span class="skolem">k</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e</span> <span class="bound">s</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> max <span class="skolem">k</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> preT_linear <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> B <span class="keyword1"><span class="command">have</span></span>  B<span class="main">:</span> <span class="quoted"><span class="quoted">"preT <span class="skolem">C</span> <span class="var">?eskal</span> <span class="skolem">s</span> <span class="main">≤</span> max <span class="skolem">k</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
        <span class="keyword1"><span class="command">from</span></span>  While.hyps<span class="main">(</span>2<span class="main">)</span> 1 <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">e''</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>       
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>preT <span class="skolem">C</span> <span class="var">?eskal</span> <span class="skolem">s</span> <span class="main">+</span> time <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e''</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e''</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> nat_mult_max_left <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="skolem">s</span> <span class="main">+</span> <span class="skolem">e''</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span>max <span class="skolem">k</span> <span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> 
          <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc mult_le_mono2<span class="main">)</span> 
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>preT <span class="skolem">C</span> <span class="var">?eskal</span> <span class="skolem">s</span> <span class="main">+</span> time <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="main">(</span>max <span class="skolem">k</span> <span class="main">1</span><span class="main">)</span> <span class="main">)</span> <span class="main">*</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> While.hyps<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 5
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_mono<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> ih2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 6
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> l s t <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">l</span></span><span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">y</span></span><span class="main"><span class="main">:=</span></span><span class="skolem"><span class="skolem">e'</span></span> <span class="skolem"><span class="skolem">s</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> 8<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">" bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">y</span> <span class="main">:=</span> <span class="skolem">e'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> While<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
            <span class="keyword1"><span class="command">with</span></span> b ih2<span class="main">(</span>2<span class="main">)</span>  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">la</span> <span class="bound">sa</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">la</span> <span class="bound">sa</span> <span class="main">∧</span> <span class="skolem">e</span> <span class="bound">sa</span> <span class="main">≤</span> <span class="bound">la</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">y</span> <span class="main">:=</span> <span class="skolem">e'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">t</span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">y</span> <span class="main">:=</span> <span class="skolem">e'</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">l</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> While<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>       
      <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S4 S3<span class="main">)</span>   
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 6
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> S1 S2<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>conseq <span class="skolem">P'</span> <span class="skolem">e</span> <span class="skolem">e'</span> <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">Q'</span> <span class="skolem">c</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="skolem">Q</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span>  <span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C</span> <span class="skolem">Q</span>  <span class="bound">l</span> <span class="bound">s</span> <span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span> <span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>  time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">from</span></span> conseq<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> cons<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">e</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">l'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">Q</span> <span class="bound">l'</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="skolem">Q'</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"Aconseq <span class="skolem"><span class="skolem">P'</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="main"><span class="main">(</span></span>time <span class="skolem"><span class="skolem">C</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">C</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> C<span class="main">(</span>2<span class="main">)</span>   
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">using</span></span> C<span class="main">(</span>2<span class="main">)</span> cons C<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> pre_mono<span class="main">)</span>        
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> C<span class="main">(</span>3<span class="main">)</span> conseq<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>        
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>      
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> C<span class="main">(</span>4<span class="main">)</span> conseq<span class="main">(</span>1<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">*</span></span><span class="skolem"><span class="skolem">k2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> l s
      <span class="keyword1"><span class="command">using</span></span> C<span class="main">(</span>5<span class="main">)</span> cons <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> absch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e'</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"time <span class="skolem">C</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">k</span>  <span class="main">*</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
        <span class="keyword1"><span class="command">using</span></span> absch order_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Vars">
<div class="head">
<h1>Theory Vars</h1>
</div>
<pre class="source"><span class="comment1">(* Author: Tobias Nipkow, Max Haslbeck *)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"The Variables in an Expression"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Vars <span class="keyword2"><span class="keyword">imports</span></span> <a href="Com.html">Com</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We need to collect the variables in both arithmetic and boolean
expressions. For a change we do not introduce two functions, e.g.\ <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>avars›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>bvars›</span></span></span></span>, but we overload the name <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vars›</span></span></span></span>
via a \emph{type class}, a device that originated with Haskell:›</span></span>
 
<span class="keyword1"><span class="command">class</span></span> vars <span class="main">=</span>
<span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">vars</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> <span class="main">⇒</span> vname set"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This defines a type class ``vars'' with a single
function of (coincidentally) the same name. Then we define two separated
instances of the class, one for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">aexp</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and one for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">bexp</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> aexp <span class="main">::</span> <span class="quoted">vars</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">vars_aexp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"aexp <span class="main">⇒</span> vname set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"vars <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"vars <span class="main">(</span>V <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"vars <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> vars <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>  <span class="main">|</span>
<span class="quoted"><span class="quoted">"vars <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> vars <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>  <span class="main">|</span>
<span class="quoted"><span class="quoted">"vars <span class="main">(</span>Div <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> vars <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span> 

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> bexp <span class="main">::</span> <span class="quoted">vars</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">vars_bexp</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bexp <span class="main">⇒</span> vname set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"vars <span class="main">(</span>Bc <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"vars <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"vars <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> vars <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"vars <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> vars <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vars <span class="main">(</span>Less <span class="main">(</span>Plus <span class="main">(</span>V <span class="inner_quoted">''z''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span>
  <span class="entity">eq_on</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> set <span class="main">⇒</span> bool"</span></span>
 <span class="main">(</span><span class="quoted">"<span class="keyword3">(</span>_ <span class="keyword1">=</span><span class="keyword3">/ </span>_<span class="keyword3">/ </span><span class="keyword1">on</span> _<span class="keyword3">)</span>"</span> <span class="main">[</span>50<span class="main">,</span>0<span class="main">,</span>50<span class="main">]</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main"><span class="free">=</span></span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="keyword1"><span class="free">on</span></span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="main">==</span> <span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">g</span></span></span> <span class="bound">x</span>"</span></span>

<span class="keyword1" id="Vars-aval_eq_if_eq_on_vars"><span class="command">lemma</span></span> aval_eq_if_eq_on_vars<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">on</span> vars <span class="free">a</span> <span class="main">⟹</span> aval <span class="free">a</span> <span class="free">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> aval <span class="free">a</span> <span class="free">s<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>          

<span class="keyword1" id="Vars-bval_eq_if_eq_on_vars"><span class="command">lemma</span></span> bval_eq_if_eq_on_vars<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> <span class="free">s<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">on</span> vars <span class="free">b</span> <span class="main">⟹</span> bval <span class="free">b</span> <span class="free">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> bval <span class="free">b</span> <span class="free">s<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Less <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"aval <span class="skolem">a1</span> <span class="free">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> aval <span class="skolem">a1</span> <span class="free">s<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"aval <span class="skolem">a2</span> <span class="free">s<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">=</span> aval <span class="skolem">a2</span> <span class="free">s<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>

 

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lvars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> vname set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">lvars</span> SKIP <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lvars</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lvars</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">lvars</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∪</span> <span class="free">lvars</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lvars</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">lvars</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∪</span> <span class="free">lvars</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">lvars</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">lvars</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">rvars</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> vname set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">rvars</span> SKIP <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rvars</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rvars</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">rvars</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∪</span> <span class="free">rvars</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rvars</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">)</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∪</span> <span class="free">rvars</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="main">∪</span> <span class="free">rvars</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">rvars</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">)</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∪</span> <span class="free">rvars</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> com <span class="main">::</span> <span class="quoted">vars</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="class_parameter">vars_com</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">=</span> lvars <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">∪</span> rvars <span class="free"><span class="bound"><span class="entity">c</span></span></span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">..</span></span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1" id="Vars-vars_com_simps"><span class="command">lemma</span></span> vars_com_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"vars SKIP <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="free">x</span><span class="main">::=</span><span class="free">e</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">∪</span> vars <span class="free">e</span>"</span></span>
  <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">)</span> <span class="main">=</span> vars <span class="free">c1</span> <span class="main">∪</span> vars <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">)</span> <span class="main">=</span> vars <span class="free">b</span> <span class="main">∪</span> vars <span class="free">c1</span> <span class="main">∪</span> vars <span class="free">c2</span>"</span></span>
  <span class="quoted"><span class="quoted">"vars <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> vars <span class="free">b</span> <span class="main">∪</span> vars <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> vars_com_def<span class="main">)</span>
 
   
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Nielson_VCGi">
<div class="head">
<h1>Theory Nielson_VCGi</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Nielson_VCGi
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Nielson_Hoare.html">Nielson_Hoare</a> <span class="quoted">"<a href="Vars.html">Vars</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Optimized Verification Condition Generator"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Annotated commands: commands where loops are annotated with invariants.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> acom <span class="main">=</span>
  Askip                  <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">SKIP</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span> <span class="main">|</span>
  Aassign <span class="quoted">vname</span> <span class="quoted">aexp</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">::=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>1000<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Aseq   <span class="quoted">acom</span> <span class="quoted">acom</span>       <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span>  <span class="main">[</span>60<span class="main">,</span> 61<span class="main">]</span> 60<span class="main">)</span> <span class="main">|</span>
  Aif <span class="quoted">bexp</span> <span class="quoted">acom</span> <span class="quoted">acom</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">IF</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">THEN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">ELSE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Aconseq <span class="quoted"><span class="quoted">"assn2<span class="main">*</span><span class="main">(</span>vname set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"assn2<span class="main">*</span><span class="main">(</span>vname set<span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"tbd <span class="main">*</span> <span class="main">(</span>vname set<span class="main">)</span>"</span></span>  <span class="quoted">acom</span>
  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">'/</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">'/</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">CONSEQ</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span><span class="main">|</span>
  Awhile <span class="quoted"><span class="quoted">"<span class="main">(</span>assn2<span class="main">*</span><span class="main">(</span>vname set<span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span>state<span class="main">⇒</span>state<span class="main">)</span><span class="main">*</span><span class="main">(</span>tbd<span class="main">*</span><span class="main">(</span><span class="main">(</span>vname set<span class="main">*</span><span class="main">(</span>vname <span class="main">⇒</span> vname set<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="quoted">bexp</span> <span class="quoted">acom</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">WHILE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">DO</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span>
  
<span class="keyword1"><span class="command">notation</span></span> com.SKIP <span class="main">(</span><span class="quoted">"<span class="keyword1">SKIP</span>"</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Strip annotations:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">strip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> com"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="keyword1">SKIP</span> <span class="main">=</span> <span class="keyword1">SKIP</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>"</span></span>
  
  
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">"support of an expression"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">supportE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>char list <span class="main">⇒</span> nat<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span>char list <span class="main">⇒</span> int<span class="main">)</span> <span class="main">⇒</span> nat<span class="main">)</span>  <span class="main">⇒</span> string set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">supportE</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l1</span> <span class="bound">l2</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="bound">x</span> <span class="main">⟶</span> <span class="bound">l1</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">l2</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l1</span> <span class="bound">s</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">l2</span> <span class="bound">s</span><span class="main">}</span>"</span></span>
  
  
<span class="keyword1" id="Nielson_VCGi-expr_lupd"><span class="command">lemma</span></span> expr_lupd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∉</span> supportE <span class="free">Q</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="main">(</span><span class="free">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> supportE_def fun_upd_other fun_eq_iff<span class="main">)</span>
    <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> fun_upd_def<span class="main">)</span>

 
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">varacom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> lvname set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">varacom</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">=</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varacom</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">=</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varacom</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">Qannot</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">=</span> support <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∪</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">∪</span> support <span class="free"><span class="bound"><span class="entity">Qannot</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varacom</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> support <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">∪</span> <span class="free">varacom</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> "</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varacom</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
     
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">varnewacom</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> lvname set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">varnewacom</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">=</span> <span class="free">varnewacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> <span class="free">varnewacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varnewacom</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">=</span> <span class="free">varnewacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> <span class="free">varnewacom</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varnewacom</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span><span class="main">=</span> <span class="free">varnewacom</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varnewacom</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">varnewacom</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">varnewacom</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  
<span class="keyword1" id="Nielson_VCGi-finite_varnewacom"><span class="command">lemma</span></span> finite_varnewacom<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varnewacom <span class="free">C</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>



<span class="keyword1"><span class="command">fun</span></span> <span class="entity">wf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> lvname set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="keyword1">SKIP</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">wf</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∪</span> varnewacom <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">wf</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">wf</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">∧</span> <span class="free">wf</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">Qannot</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span>finite <span class="main">(</span>support <span class="free"><span class="bound"><span class="entity">Qannot</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="free">wf</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">wf</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">=</span> <span class="main">(</span> <span class="free">wf</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Weakest precondition from annotated commands:›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">preT</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> tbd <span class="main">⇒</span> tbd"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free">preT</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">preT</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free">preT</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">preT</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="free">preT</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preT</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="keyword1">o</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span>"</span></span>
  

<span class="keyword1" id="Nielson_VCGi-preT_constant"><span class="command">lemma</span></span> preT_constant<span class="main">:</span> <span class="quoted"><span class="quoted">"preT <span class="free">C</span> <span class="main">(</span><span class="main">%</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">a</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Nielson_VCGi-preT_linear"><span class="command">lemma</span></span> preT_linear<span class="main">:</span> <span class="quoted"><span class="quoted">"preT <span class="free">C</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free">k</span> <span class="main">*</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free">k</span> <span class="main">*</span> preT <span class="free">C</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">postQ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> state <span class="main">⇒</span> state"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="comment1">(* seems to be forward?! *)</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span>  <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">postQ</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main">(</span><span class="free">postQ</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">postQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">then</span> <span class="free">postQ</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">else</span> <span class="free">postQ</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQ</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
  
  
  
<span class="comment1">(* function that, given a Command C and a set of variables 
  gives the set of variables, that Es depends on,
  meaning a set S where
  if s1 = s2 on S ⟶ ∀x:Es. postQ C s1 x = postQ C s2 x
*)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">fune</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> vname set <span class="main">⇒</span> vname set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fune</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fune</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">∪</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fune</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">=</span> <span class="free">fune</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">fune</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fune</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">=</span> <span class="free">fune</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fune</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∪</span> <span class="free">fune</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">∪</span> <span class="free">fune</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">fune</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">SS</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">LV</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">SS</span></span></span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="Nielson_VCGi-fune_mono"><span class="command">lemma</span></span> fune_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> fune <span class="free">C</span> <span class="free">A</span> <span class="main">⊆</span> fune <span class="free">C</span> <span class="free">B</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main">)</span>  
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_cases5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Awhile <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_supI1 le_supI2<span class="main">)</span>
  
  
<span class="keyword1" id="Nielson_VCGi-TQ"><span class="command">lemma</span></span> TQ<span class="main">:</span> <span class="quoted"><span class="quoted">"preT <span class="free">C</span> <span class="free">e</span> <span class="free">s</span> <span class="main">=</span> <span class="free">e</span> <span class="main">(</span>postQ <span class="free">C</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 


  
  
<span class="comment1">(* given a state, how often will a While loop be evaluated ? *)</span>  
<span class="keyword1"><span class="command">function</span></span> <span class="main">(</span>domintros<span class="main">)</span> <span class="entity">times</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> bexp <span class="main">⇒</span> acom <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">times</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">then</span> Suc <span class="main">(</span><span class="free">times</span> <span class="main">(</span>postQ <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">z</span> <span class="free">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  i<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">z</span><span class="main">.</span> <span class="free">I</span> <span class="main">(</span>Suc <span class="bound">z</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟹</span> bval <span class="free">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">I</span> <span class="bound">z</span> <span class="main">(</span>postQ <span class="free">C</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  ii<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">I</span> <span class="main">0</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">~</span> bval <span class="free">b</span> <span class="bound">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> times_z<span class="main">:</span> <span class="quoted"><span class="quoted">"times <span class="free">s</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="free">z</span> <span class="free">s</span> <span class="main">⟹</span> times_dom <span class="main">(</span><span class="free">s</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span> <span class="main">∧</span> times <span class="free">s</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> <span class="free">z</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 0
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"times_dom <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> times.domintros<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  ii<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0<span class="main"><span class="main">]</span></span> <span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"times <span class="skolem">s</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> times.psimps<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  ii<span class="main"><span class="main">[</span></span><span class="operator">OF</span> 0<span class="main"><span class="main">]</span></span><span class="main">)</span>
    
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">z</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> i<span class="main">[</span><span class="operator">OF</span> Suc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bv<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> g<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="skolem">z</span> <span class="main">(</span>postQ <span class="free">C</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">from</span></span> Suc<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> g<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"times_dom <span class="main">(</span>postQ <span class="free">C</span> <span class="skolem">s</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"times <span class="main">(</span>postQ <span class="free">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"times_dom <span class="main">(</span><span class="skolem">s</span><span class="main">,</span> <span class="free">b</span><span class="main">,</span> <span class="free">C</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> times.domintros<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> p1<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"times <span class="skolem">s</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> Suc <span class="skolem">z</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> times.psimps<span class="main">[</span><span class="operator">OF</span> A<span class="main">]</span> bv p2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"times <span class="free">s</span> <span class="free">b</span> <span class="free">C</span> <span class="main">=</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">postQz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> state <span class="main">⇒</span> nat <span class="main">⇒</span> state"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">postQz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">postQz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span>  <span class="main">(</span><span class="free">postQz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span>postQ <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">preTz</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> tbd <span class="main">⇒</span> nat <span class="main">⇒</span> tbd"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preTz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">preTz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> preT <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="free">preTz</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span>
  
  
  
<span class="keyword1" id="Nielson_VCGi-TzQ"><span class="command">lemma</span></span> TzQ<span class="main">:</span> <span class="quoted"><span class="quoted">"preTz <span class="free">C</span> <span class="free">e</span> <span class="free">n</span> <span class="free">s</span> <span class="main">=</span> <span class="free">e</span> <span class="main">(</span>postQz <span class="free">C</span> <span class="free">s</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">s</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TQ<span class="main">)</span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Weakest precondition from annotated commands:›</span></span>

  <span class="comment1">(* if the annotated command contains no loops,
  then the weakest precondition is just some mangled post condition
  in the other case, 
  the weakest precondition is essentially the annotated invariant
  of the first while loop, mangled somewhat by the commands
  preceding the loop. *)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pre</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> assn2 <span class="main">⇒</span> assn2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main">=</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Ps</span></span></span><span class="main">)</span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">SS</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span>"</span></span> 
  
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">qdeps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> vname set <span class="main">⇒</span> vname set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">qdeps</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span>  <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">qdeps</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">∪</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">qdeps</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span>  <span class="main">=</span> <span class="free">qdeps</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">qdeps</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">qdeps</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Ps</span></span></span><span class="main">)</span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Ps</span></span></span>"</span></span> <span class="main">|</span> <span class="comment1">(* the variables P' depends on *)</span>
  <span class="quoted"><span class="quoted">"<span class="free">qdeps</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∪</span> <span class="free">qdeps</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="main">∪</span> <span class="free">qdeps</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span>"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">qdeps</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span>"</span></span> <span class="comment1">(* the variables I depends on *)</span> 
   
<span class="keyword1" id="Nielson_VCGi-qdeps_mono"><span class="command">lemma</span></span> qdeps_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">⊆</span> <span class="free">B</span> <span class="main">⟹</span> qdeps <span class="free">C</span> <span class="free">A</span> <span class="main">⊆</span> qdeps <span class="free">C</span> <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">A</span></span> <span class="quoted"><span class="free">B</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> le_supI1 le_supI2<span class="main">)</span>
  
<span class="keyword1" id="Nielson_VCGi-supportE_if"><span class="command">lemma</span></span> supportE_if<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> <span class="free">b</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">A</span> <span class="bound">l</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="free">B</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>
  <span class="main">⊆</span> supportE <span class="free">A</span> <span class="main">∪</span> supportE <span class="free">B</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> supportE_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Nielson_VCGi-supportE_preT"><span class="command">lemma</span></span> supportE_preT<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">%</span><span class="bound">l</span><span class="main">.</span> preT <span class="free">C</span> <span class="main">(</span><span class="free">e</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">b</span> <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> supportE_if<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Aif <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">A</span> <span class="skolem">y</span> <span class="skolem">C</span> <span class="skolem">e</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">=</span> <span class="main">(</span><span class="skolem">I</span><span class="main">,</span><span class="skolem">S</span><span class="main">,</span><span class="skolem">E</span><span class="main">,</span><span class="skolem">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_cases4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> A <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> supportE_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aseq<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> supportE_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="Nielson_VCGi-supportE_twicepreT"><span class="command">lemma</span></span> supportE_twicepreT<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">%</span><span class="bound">l</span><span class="main">.</span> preT <span class="free">C1</span> <span class="main">(</span>preT <span class="free">C2</span> <span class="main">(</span><span class="free">e</span> <span class="bound">l</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="free">e</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> supportE_preT supportE_preT<span class="main"><span class="main">]</span></span><span class="main">)</span>



<span class="keyword1" id="Nielson_VCGi-supportE_preTz"><span class="command">lemma</span></span> supportE_preTz<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">%</span><span class="bound">l</span><span class="main">.</span> preTz <span class="free">C</span> <span class="main">(</span><span class="free">e</span> <span class="bound">l</span><span class="main">)</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="free">e</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Suc <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> supportE_preT<span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="keyword1" id="Nielson_VCGi-supportE_preTz_Un"><span class="command">lemma</span></span> supportE_preTz_Un<span class="main">:</span> <span class="comment1">(* like in support_wpw_Un *)</span>
  <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> preTz <span class="free">C</span> <span class="main">(</span><span class="free">e</span> <span class="bound">l</span><span class="main">)</span> <span class="main">(</span><span class="bound">l</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="free">x</span> <span class="main">(</span><span class="keyword1">UN</span> <span class="bound">n</span><span class="main">.</span> supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> preTz <span class="free">C</span> <span class="main">(</span><span class="free">e</span> <span class="bound">l</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> supportE_def subset_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Nielson_VCGi-support_eq"><span class="command">lemma</span></span> support_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">l</span> <span class="free">x</span> <span class="main">=</span> <span class="free">E</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="free">E</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def supportE_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


<span class="keyword1" id="Nielson_VCGi-support_impl_in"><span class="command">lemma</span></span> support_impl_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="free">e</span> <span class="main">⟶</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span>  <span class="free">H</span> <span class="free">e</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">T</span>
  <span class="main">⟹</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">G</span> <span class="free">e</span> <span class="main">⟶</span>  <span class="free">H</span> <span class="free">e</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Nielson_VCGi-support_supportE"><span class="command">lemma</span></span> support_supportE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span> <span class="bound">e</span><span class="main">.</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span>  <span class="bound">P</span> <span class="main">(</span><span class="bound">e</span> <span class="bound">l</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="bound">e</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def supportE_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subsetI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">P</span> <span class="skolem">e</span> <span class="skolem">x</span> <span class="skolem">l1</span> <span class="skolem">l2</span> <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">e</span> <span class="skolem">l1</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">e</span> <span class="skolem">l2</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">e</span> <span class="skolem">l1</span> <span class="main">=</span> <span class="skolem">e</span> <span class="skolem">l2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">l1</span> <span class="bound">l2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">.</span> <span class="bound">y</span> <span class="main">≠</span> <span class="skolem">x</span> <span class="main">⟶</span> <span class="bound">l1</span> <span class="bound">y</span> <span class="main">=</span> <span class="bound">l2</span> <span class="bound">y</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">e</span> <span class="bound">l1</span> <span class="bound">s</span> <span class="main">≠</span> <span class="skolem">e</span> <span class="bound">l2</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">l1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">l2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> P <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>            
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Nielson_VCGi-support_pre"><span class="command">lemma</span></span> support_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>pre <span class="free">C</span> <span class="free">Q</span><span class="main">)</span> <span class="main">⊆</span> support <span class="free">Q</span> <span class="main">∪</span> varacom <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">A</span> <span class="skolem">b</span> <span class="skolem">C</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I2</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="skolem"><span class="skolem">Es</span></span> <span class="skolem"><span class="skolem">SS</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">=</span> <span class="main">(</span><span class="skolem">I2</span><span class="main">,</span><span class="main">(</span><span class="skolem">S</span><span class="main">,</span><span class="main">(</span><span class="skolem">E</span><span class="main">,</span><span class="skolem">Es</span><span class="main">,</span><span class="skolem">SS</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_cases5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="skolem"><span class="skolem">Is</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I2</span><span class="main">=</span><span class="main">(</span><span class="skolem">I</span><span class="main">,</span><span class="skolem">Is</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">note</span></span> A<span class="main">=</span>this A
  <span class="keyword1"><span class="command">have</span></span> support_inv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> A  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aseq <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">x</span> <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> s1<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> bval <span class="skolem">x</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> support <span class="skolem">Q</span> <span class="main">∪</span> varacom <span class="skolem">C1</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_impl<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> Aif<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> s2<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">~</span> bval <span class="skolem">x</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> support <span class="skolem">Q</span> <span class="main">∪</span> varacom <span class="skolem">C2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_impl<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> Aif<span class="main">)</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> s1 s2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aconseq <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="skolem"><span class="skolem">d</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span><span class="main">=</span><span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x2</span><span class="main">=</span><span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="skolem">d</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x3</span><span class="main">=</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">with</span></span> Aconseq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> support_def<span class="main">)</span> 

<span class="keyword1" id="Nielson_VCGi-finite_support_pre"><span class="command">lemma</span></span> finite_support_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="free">Q</span><span class="main">)</span>  <span class="main">⟹</span> finite <span class="main">(</span>varacom <span class="free">C</span><span class="main">)</span> <span class="main">⟹</span>  finite <span class="main">(</span>support <span class="main">(</span>pre <span class="free">C</span> <span class="free">Q</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> finite_subset support_pre finite_UnI <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">time</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> tbd"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="keyword1">SKIP</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free">time</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">s</span> <span class="main">+</span> preT <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">time</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="main">+</span> <span class="free">time</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="main">1</span> <span class="main">+</span> <span class="free">time</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">time</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E'</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span>"</span></span>
   
   
<span class="comment1">(* the set of variables, i need to know about, i.e. s1 and s2 have to agree on 
  s.th. time C s1 = time C s2 *)</span>    
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">kdeps</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> vname set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">kdeps</span> <span class="keyword1">SKIP</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">kdeps</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">kdeps</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">kdeps</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> fune <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">kdeps</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">kdeps</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span>  vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">∪</span> <span class="free">kdeps</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">∪</span> <span class="free">kdeps</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">kdeps</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E'</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">SS</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">kdeps</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span>"</span></span>  
     
     
<span class="keyword1" id="Nielson_VCGi-supportE_single"><span class="command">lemma</span></span> supportE_single<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> supportE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1" id="Nielson_VCGi-supportE_plus"><span class="command">lemma</span></span> supportE_plus<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">e1</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">+</span> <span class="free">e2</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> supportE <span class="free">e1</span> <span class="main">∪</span> supportE <span class="free">e2</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> supportE_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 

<span class="keyword1" id="Nielson_VCGi-supportE_Suc"><span class="command">lemma</span></span> supportE_Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> Suc <span class="main">(</span><span class="free">e1</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> supportE <span class="free">e1</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> supportE_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 


<span class="keyword1" id="Nielson_VCGi-supportE_single2"><span class="command">lemma</span></span> supportE_single2<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="main">.</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> supportE_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Nielson_VCGi-supportE_time"><span class="command">lemma</span></span> supportE_time<span class="main">:</span> <span class="quoted"><span class="quoted">"supportE <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> time <span class="free">C</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> supportE_single2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>   

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="free">I</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span><span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="bound">l</span> <span class="free">x</span> <span class="main">=</span> <span class="main">0</span> <span class="main">⟶</span> <span class="free">I</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_upd_triv<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="free">I</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span>Suc <span class="main">(</span><span class="bound">l</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="bound">l</span> <span class="free">x</span> <span class="main">=</span> Suc <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="free">I</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span> <span class="skolem">l</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span><span class="main">.</span> <span class="free">I</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> Suc <span class="main">(</span><span class="bound">l</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> l<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span><span class="skolem">n</span><span class="main">)</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">(</span><span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> Suc <span class="main">(</span><span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span><span class="skolem">n</span><span class="main">)</span><span class="main">)</span> <span class="free">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_upd_triv<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Verification condition:›</span></span>

     
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">funStar</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">funStar</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">y</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">∈</span><span class="main">{</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="bound">x</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="Nielson_VCGi-funStart_prop1"><span class="command">lemma</span></span> funStart_prop1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> <span class="main">(</span>funStar <span class="free">f</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> funStar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="Nielson_VCGi-funStart_prop2"><span class="command">lemma</span></span> funStart_prop2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="free">x</span> <span class="main">⊆</span> <span class="main">(</span>funStar <span class="free">f</span><span class="main">)</span> <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> funStar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> assn2 <span class="main">⇒</span> vname set <span class="main">⇒</span> vname set <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span> <span class="free"><span class="bound"><span class="entity">LVE</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span>pre <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">(</span>qdeps <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span><span class="main">)</span> <span class="main">(</span>fune <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">LVE</span></span></span> <span class="main">∪</span> kdeps <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span> <span class="free"><span class="bound"><span class="entity">LVE</span></span></span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span> <span class="free"><span class="bound"><span class="entity">LVE</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span> <span class="free"><span class="bound"><span class="entity">LVE</span></span></span> <span class="main">∧</span> <span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span> <span class="free"><span class="bound"><span class="entity">LVE</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>  
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Ps</span></span></span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Qs</span></span></span><span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">e'</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span> <span class="free"><span class="bound"><span class="entity">LVE</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">Qs</span></span></span> <span class="free"><span class="bound"><span class="entity">LVE</span></span></span>  <span class="comment1">― ‹evtl <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>LV›</span></span> weglassen - glaub eher nicht›</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Ps</span></span></span><span class="main">.</span> <span class="bound">s1</span> <span class="bound">x</span><span class="main">=</span><span class="bound">s2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">l</span> <span class="bound">s2</span><span class="main">)</span>    <span class="comment1">― ‹annotation <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>Ps›</span></span> (the set of variables <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>P'›</span></span> depends on) is correct›</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Qs</span></span></span><span class="main">.</span> <span class="bound">s1</span> <span class="bound">x</span><span class="main">=</span><span class="bound">s2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">s2</span><span class="main">)</span>    <span class="comment1">― ‹annotation <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>Qs›</span></span> (the set of variables <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>Q›</span></span> depends on) is correct›</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">.</span> <span class="bound">s1</span> <span class="bound">x</span><span class="main">=</span><span class="bound">s2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="bound">s1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="bound">s2</span><span class="main">)</span>          <span class="comment1">― ‹annotation <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>es›</span></span> (the set of variables <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>e'›</span></span> depends on) is correct›</span>
              <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> time <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">e'</span></span></span> <span class="bound">s</span>  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> <span class="main">(</span>pre <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="bound">l'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l'</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
  
  <span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">SS</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span> <span class="free"><span class="bound"><span class="entity">LVE</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">Is</span></span></span><span class="main">.</span> <span class="bound">s1</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">s2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">l</span> <span class="bound">s2</span><span class="main">)</span>  <span class="comment1">― ‹annotation <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>Is›</span></span> is correct›</span>
        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">LVE</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span><span class="main">.</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">Ss</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">SS</span></span></span> <span class="bound">y</span> <span class="keyword1">in</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="bound">Ss</span><span class="main">.</span> <span class="bound">s1</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">s2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">s1</span><span class="main">)</span> <span class="bound">y</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">s2</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>                   <span class="comment1">― ‹annotation <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>SS›</span></span> is correct, for only one step›</span>
        <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">.</span> <span class="bound">s1</span> <span class="bound">x</span><span class="main">=</span><span class="bound">s2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">s1</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">s2</span><span class="main">)</span>                                <span class="comment1">― ‹annotation <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>es›</span></span> (the set of variables <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>E›</span></span> depends on) is correct›</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span>   <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">s</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">+</span> preT <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">s</span> <span class="main">+</span> time <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">s</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">LVE</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span><span class="main">.</span> <span class="main">(</span>funStar <span class="free"><span class="bound"><span class="entity">SS</span></span></span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="bound">v</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="main">(</span>postQ <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="bound">v</span><span class="main">)</span> <span class="main">)</span> <span class="main">∧</span>
  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="bound">s</span> <span class="main">≥</span> <span class="main">1</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">v</span><span class="main">∈</span><span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">LVE</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span><span class="main">.</span> <span class="main">(</span>funStar <span class="free"><span class="bound"><span class="entity">SS</span></span></span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="bound">v</span>  <span class="main">=</span> <span class="bound">s</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">∧</span>
  <span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="free"><span class="bound"><span class="entity">Is</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="free"><span class="bound"><span class="entity">LVE</span></span></span><span class="main">.</span> <span class="main">(</span>funStar <span class="free"><span class="bound"><span class="entity">SS</span></span></span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness:›</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">preSet</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">==</span> <span class="main">(</span>Ball <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">u</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">u</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="bound">x</span> <span class="main">=</span> preT <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">e</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">postSet</span> <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">==</span> <span class="main">(</span>Ball <span class="free"><span class="bound"><span class="entity">U</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">u</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">u</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">e</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ListUpdate</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ListUpdate</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ListUpdate</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">ListUpdate</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Nielson_VCGi-allg"><span class="command">lemma</span></span> allg<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> U2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span> fst <span class="main">`</span> <span class="free">upds</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> <span class="free">A</span> <span class="bound">l</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">xs</span> <span class="main">⊆</span> fst <span class="main">`</span> <span class="free">upds</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">(</span>ListUpdate <span class="free">l''</span> <span class="free">xs</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="free">l''</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> axe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">(</span>ListUpdate <span class="free">l''</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">xs</span><span class="main">)</span> <span class="free">q</span><span class="main">)</span> 
    <span class="main">=</span> <span class="free">A</span> <span class="main">(</span><span class="main">(</span>ListUpdate <span class="free">l''</span> <span class="skolem">xs</span> <span class="free">q</span><span class="main">)</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="free">q</span> <span class="skolem">e</span> <span class="skolem">x</span><span class="main">)</span><span class="main">)</span>  "</span></span> <span class="keyword1"><span class="command">unfolding</span></span> axe <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  <span class="free">A</span>  <span class="main">(</span>ListUpdate <span class="free">l''</span> <span class="skolem">xs</span> <span class="free">q</span><span class="main">)</span>  "</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> U2<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Cons axe <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="free">A</span> <span class="free">l''</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> Cons <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>  

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">ListUpdateE</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ListUpdateE</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span>   <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span>"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">ListUpdateE</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>  <span class="main">=</span> <span class="main">(</span><span class="free">ListUpdateE</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span>  <span class="main">)</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">:=</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Nielson_VCGi-ListUpdate_E"><span class="command">lemma</span></span> ListUpdate_E<span class="main">:</span> <span class="quoted"><span class="quoted">"ListUpdateE <span class="free">f</span> <span class="free">xs</span> <span class="main">=</span> ListUpdate <span class="free">f</span> <span class="free">xs</span> <span class="main">(</span><span class="main">%</span><span class="bound">e</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a xs <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1" id="Nielson_VCGi-allg_E"><span class="command">lemma</span></span> allg_E<span class="main">:</span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">A</span><span class="main">::</span><span class="quoted">assn2</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> 
   <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span> <span class="bound">n</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">upds</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">(</span><span class="bound">l</span><span class="main">(</span><span class="bound">x</span> <span class="main">:=</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="bound">l</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="free">xs</span> <span class="main">⊆</span> fst <span class="main">`</span> <span class="free">upds</span>"</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">(</span>ListUpdateE <span class="free">f</span> <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="free">f</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="free">A</span> <span class="main">(</span>ListUpdate <span class="free">f</span> <span class="free">xs</span> <span class="main">(</span><span class="main">%</span><span class="bound">e</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">A</span> <span class="free">f</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allg<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ListUpdate_E<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1" id="Nielson_VCGi-ListUpdateE_updates"><span class="command">lemma</span></span> ListUpdateE_updates<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> set <span class="free">xs</span> <span class="main">⟹</span> ListUpdateE <span class="free">l''</span> <span class="free">xs</span> <span class="main">(</span>fst <span class="free">x</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="free">x</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">a</span> <span class="main">=</span> fst <span class="free">x</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">with</span></span> True <span class="keyword1"><span class="command">have</span></span> fstx<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="free">x</span><span class="main">=</span><span class="skolem">y</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> fstx  a <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="skolem">a</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a2 a <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">∈</span>set <span class="skolem">xs</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="skolem">xs</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> B A<span class="main">]</span> False
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="Nielson_VCGi-ListUpdate_updates"><span class="command">lemma</span></span> ListUpdate_updates<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="main">⟹</span> ListUpdate <span class="free">l''</span> <span class="free">xs</span> <span class="main">(</span><span class="main">%</span><span class="bound">e</span><span class="main">.</span> <span class="free">l</span><span class="main">)</span> <span class="free">x</span> <span class="main">=</span> <span class="free">l</span> <span class="free">x</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">q</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> axe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">p</span><span class="main">,</span><span class="skolem">q</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> axe
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="skolem">p</span>"</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">lesvars</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">==</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">preList</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">preList</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">preList</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> preT <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="free">preList</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
      
  
<span class="keyword1" id="Nielson_VCGi-preList_Seq"><span class="command">lemma</span></span> preList_Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">upds</span> <span class="main">(</span><span class="free">C1</span><span class="main">;;</span> <span class="free">C2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preList <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> preT <span class="free">C2</span> <span class="bound">e</span><span class="main">,</span> fune <span class="free">C2</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="free">upds</span><span class="main">)</span> <span class="free">C1</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> True<span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> support_def 
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  
<span class="keyword1" id="Nielson_VCGi-support_preList"><span class="command">lemma</span></span> support_preList<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>preList <span class="free">upds</span> <span class="free">C1</span><span class="main">)</span> <span class="main">⊆</span> lesvars <span class="free">upds</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">upds</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Un_least<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_eq<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> supportE_twicepreT subset_trans  supportE_single2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1" id="Nielson_VCGi-preListpreSet"><span class="command">lemma</span></span> preListpreSet<span class="main">:</span> <span class="quoted"><span class="quoted">"preSet <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span> preList <span class="free">xs</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Nil
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="Nielson_VCGi-preSetpreList"><span class="command">lemma</span></span> preSetpreList<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">xs</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span>  preSet <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>


<span class="comment1">(* surprise. but makes sense, if the clauses are contradictory on the 
    left side, so are they on the right side *)</span>
<span class="keyword1" id="Nielson_VCGi-preSetpreList_eq"><span class="command">lemma</span></span> preSetpreList_eq<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">xs</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preSet <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>  


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">postList</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">postList</span> <span class="main">[]</span>  <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> True"</span></span>
<span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">postList</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">xs</span></span></span><span class="main">)</span>  <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="free">postList</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"postList <span class="free">xs</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span>foldr <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="bound">acc</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">l</span> <span class="bound">x</span> <span class="main">=</span> <span class="bound">e</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">acc</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="free">xs</span> <span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>  
  
<span class="keyword1" id="Nielson_VCGi-support_postList"><span class="command">lemma</span></span> support_postList<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>postList <span class="free">xs</span><span class="main">)</span> <span class="main">⊆</span> lesvars <span class="free">xs</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>    
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Un_least<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_eq<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> supportE_twicepreT subset_trans  supportE_single2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  
  
  
<span class="keyword1" id="Nielson_VCGi-postList_preList"><span class="command">lemma</span></span> postList_preList<span class="main">:</span> <span class="quoted"><span class="quoted">"postList <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> preT <span class="free">C2</span> <span class="bound">e</span><span class="main">,</span> fune <span class="free">C2</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="free">upds</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preList <span class="free">upds</span> <span class="free">C2</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  
<span class="keyword1" id="Nielson_VCGi-postSetpostList"><span class="command">lemma</span></span> postSetpostList<span class="main">:</span> <span class="quoted"><span class="quoted">"postList <span class="free">xs</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span>  postSet <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
  

<span class="keyword1" id="Nielson_VCGi-postListpostSet"><span class="command">lemma</span></span> postListpostSet<span class="main">:</span> <span class="quoted"><span class="quoted">"postSet <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">⟹</span> postList <span class="free">xs</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">xs</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="main">(</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> a
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Nielson_VCGi-postListpostSet2"><span class="command">lemma</span></span> postListpostSet2<span class="main">:</span> <span class="quoted"><span class="quoted">" postList <span class="free">xs</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> postSet <span class="main">(</span>set <span class="free">xs</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> postListpostSet postSetpostList <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>



<span class="keyword1" id="Nielson_VCGi-ListAskip"><span class="command">lemma</span></span> ListAskip<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">xs</span> Askip <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> postList <span class="free">xs</span>  <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">xs</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Nielson_VCGi-SetAskip"><span class="command">lemma</span></span> SetAskip<span class="main">:</span> <span class="quoted"><span class="quoted">"preSet <span class="free">U</span> Askip <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> postSet <span class="free">U</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Nielson_VCGi-ListAassign"><span class="command">lemma</span></span> ListAassign<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">upds</span> <span class="main">(</span>Aassign <span class="free">x1</span> <span class="free">x2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> postList <span class="free">upds</span> <span class="free">l</span> <span class="main">(</span><span class="free">s</span><span class="main">[</span><span class="free">x2</span><span class="main">/</span><span class="free">x1</span><span class="main">]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Nielson_VCGi-SetAassign"><span class="command">lemma</span></span> SetAassign<span class="main">:</span> <span class="quoted"><span class="quoted">"preSet <span class="free">U</span> <span class="main">(</span>Aassign <span class="free">x1</span> <span class="free">x2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> postSet <span class="free">U</span> <span class="free">l</span> <span class="main">(</span><span class="free">s</span><span class="main">[</span><span class="free">x2</span><span class="main">/</span><span class="free">x1</span><span class="main">]</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


<span class="keyword1" id="Nielson_VCGi-ListAconseq"><span class="command">lemma</span></span> ListAconseq<span class="main">:</span> <span class="quoted"><span class="quoted">"preList <span class="free">upds</span> <span class="main">(</span>Aconseq <span class="free">x1</span> <span class="free">x2</span> <span class="free">x3</span> <span class="free">C</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preList <span class="free">upds</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Nielson_VCGi-SetAconseq"><span class="command">lemma</span></span> SetAconseq<span class="main">:</span> <span class="quoted"><span class="quoted">"preSet <span class="free">U</span> <span class="main">(</span>Aconseq <span class="free">x1</span> <span class="free">x2</span> <span class="free">x3</span> <span class="free">C</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preSet <span class="free">U</span> <span class="free">C</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="Nielson_VCGi-ListAif1"><span class="command">lemma</span></span> ListAif1<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="free">s</span> <span class="main">⟹</span> preList <span class="free">upds</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">C1</span> <span class="keyword1">ELSE</span> <span class="free">C2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preList <span class="free">upds</span> <span class="free">C1</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1" id="Nielson_VCGi-SetAif1"><span class="command">lemma</span></span> SetAif1<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="free">s</span> <span class="main">⟹</span> preSet <span class="free">upds</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">C1</span> <span class="keyword1">ELSE</span> <span class="free">C2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preSet <span class="free">upds</span> <span class="free">C1</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1" id="Nielson_VCGi-ListAif2"><span class="command">lemma</span></span> ListAif2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="free">b</span> <span class="free">s</span> <span class="main">⟹</span> preList <span class="free">upds</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">C1</span> <span class="keyword1">ELSE</span> <span class="free">C2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preList <span class="free">upds</span> <span class="free">C2</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">upds</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

<span class="keyword1" id="Nielson_VCGi-SetAif2"><span class="command">lemma</span></span> SetAif2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="free">b</span> <span class="free">s</span> <span class="main">⟹</span> preSet <span class="free">upds</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">C1</span> <span class="keyword1">ELSE</span> <span class="free">C2</span><span class="main">)</span> <span class="free">l</span> <span class="free">s</span> <span class="main">=</span> preSet <span class="free">upds</span> <span class="free">C2</span> <span class="free">l</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">K</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">K</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> qdeps <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">LVQ</span></span></span> <span class="main">⟶</span> pre <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> pre <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">l</span> <span class="bound">s2</span><span class="main">)</span>"</span></span>
  

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">K2</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">K2</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">==</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> fune <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span> <span class="main">⟶</span> preT <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s1</span> <span class="main">=</span> preT <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s2</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">K3</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">K3</span> <span class="free"><span class="bound"><span class="entity">upds</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">upds</span></span></span><span class="main">.</span> K2 <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">b</span> <span class="bound">c</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">K4</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">K4</span> <span class="free"><span class="bound"><span class="entity">upds</span></span></span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span>K <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">LV</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> K3 <span class="free"><span class="bound"><span class="entity">upds</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> kdeps <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟶</span> time <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">s1</span> <span class="main">=</span> time <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="bound">s2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Nielson_VCGi-k4If"><span class="command">lemma</span></span> k4If<span class="main">:</span> <span class="quoted"><span class="quoted">"K4 <span class="free">upds</span> <span class="free">LVQ</span> <span class="free">C1</span> <span class="free">Q</span> <span class="main">⟹</span> K4 <span class="free">upds</span> <span class="free">LVQ</span> <span class="free">C2</span> <span class="free">Q</span> <span class="main">⟹</span> K4 <span class="free">upds</span> <span class="free">LVQ</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">C1</span> <span class="keyword1">ELSE</span> <span class="free">C2</span><span class="main">)</span> <span class="free">Q</span>"</span></span>    
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> fl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">A</span> <span class="main">⊆</span> <span class="bound">B</span> <span class="main">⟹</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="bound">B</span> <span class="main">⟹</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"K4 <span class="free">upds</span> <span class="free">LVQ</span> <span class="free">C1</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"K4 <span class="free">upds</span> <span class="free">LVQ</span> <span class="free">C2</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"K4 <span class="free">upds</span> <span class="free">LVQ</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">C1</span> <span class="keyword1">ELSE</span> <span class="free">C2</span><span class="main">)</span> <span class="free">Q</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> K4_def K_def K3_def K2_def <span class="keyword1"><span class="command">using</span></span> bval_eq_if_eq_on_vars fl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
   

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Soundness"</span></span>
  
<span class="keyword1" id="Nielson_VCGi-vc_sound"><span class="command">lemma</span></span> vc_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">Q</span> <span class="free">LVQ</span> <span class="free">LVE</span> <span class="main">⟹</span> finite <span class="main">(</span>support <span class="free">Q</span><span class="main">)</span>
  <span class="main">⟹</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="free">upds</span><span class="main">)</span> <span class="main">∩</span> varacom <span class="free">C</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> distinct <span class="main">(</span>map fst <span class="free">upds</span><span class="main">)</span>
  <span class="main">⟹</span> finite <span class="main">(</span>varacom <span class="free">C</span><span class="main">)</span> 
  <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="free">LVQ</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="free">LVE</span> <span class="main">⟶</span> postList <span class="free">upds</span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> postList <span class="free">upds</span> <span class="bound">l</span> <span class="bound">s2</span><span class="main">)</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">∈</span>set <span class="free">upds</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="bound">c</span> <span class="main">⟶</span> <span class="bound">b</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">b</span> <span class="bound">s2</span><span class="main">)</span><span class="main">)</span>             <span class="comment1">― ‹<span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>c›</span></span> are really the variables <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>b›</span></span> depends on›</span>
  <span class="main">⟹</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">∈</span>set <span class="free">upds</span><span class="main">.</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">LVE</span>                                     <span class="comment1">― ‹in <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>LV›</span></span> are all the variables that the expressions in <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>upds›</span></span> depend on›</span>
  <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="free">upds</span> <span class="free">C</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> time <span class="free">C</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="free">upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="free">C</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  K4 <span class="free">upds</span> <span class="free">LVQ</span> <span class="free">C</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span> <span class="quoted"><span class="free">upds</span></span> <span class="quoted"><span class="free">LVE</span></span> <span class="quoted"><span class="free">LVQ</span></span><span class="main">)</span>    
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Askip <span class="skolem">Q</span> <span class="skolem">upds</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> K4_def K_def K3_def K2_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weaken_post<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> preList <span class="skolem"><span class="skolem">upds</span></span> Askip <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Skip<span class="main">)</span>  <span class="keyword1"><span class="command">using</span></span> ListAskip    
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aassign <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">Q</span> <span class="skolem">upds</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> K_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Assign<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weaken_post<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> postList <span class="skolem"><span class="skolem">upds</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ListAassign<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> postQ.simps pre.simps<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>  
        <span class="keyword1"><span class="command">unfolding</span></span> K4_def K2_def K3_def K_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">b</span> <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="skolem">upds</span> <span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> Aif<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="skolem">LVQ</span> <span class="skolem">LVE</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="skolem">LVQ</span> <span class="skolem">LVE</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> kT<span class="main">:</span> <span class="quoted"><span class="quoted">"K4 <span class="skolem">upds</span> <span class="skolem">LVQ</span> <span class="skolem">C1</span> <span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Aif<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1 Aif<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> _ Aif<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> Aif<span class="main">(</span>5-11<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C2</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> kF<span class="main">:</span> <span class="quoted"><span class="quoted">"K4 <span class="skolem">upds</span> <span class="skolem">LVQ</span> <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> Aif<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2 Aif<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> _ Aif<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">]</span> Aif<span class="main">(</span>5-11<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> If2<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">a</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> bval <span class="skolem"><span class="skolem">b</span></span> <span class="bound"><span class="bound">a</span></span> <span class="keyword1"><span class="keyword1">then</span></span>  time <span class="skolem"><span class="skolem">C1</span></span> <span class="bound"><span class="bound">a</span></span> <span class="keyword1"><span class="keyword1">else</span></span> time <span class="skolem"><span class="skolem">C2</span></span> <span class="bound"><span class="bound">a</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> rev_conj_cong<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ub_cost<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"time <span class="skolem"><span class="skolem">C1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> pre <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> preList <span class="skolem"><span class="skolem">upds</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> ListAif1
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Aif<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> Aif
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">cong</span><span class="main"><span class="main">:</span></span> rev_conj_cong<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ub_cost<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"time <span class="skolem"><span class="skolem">C2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="comment1">(* k=1 and *)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> pre <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> preList <span class="skolem"><span class="skolem">upds</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> ListAif2
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Aif<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> Aif
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> T F kT kF  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> k4If<span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aconseq <span class="skolem">P'2</span> <span class="skolem">Qannot2</span> <span class="skolem">eannot2</span> <span class="skolem">C</span> <span class="skolem">Q</span> <span class="skolem">upds</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P'</span></span> <span class="skolem"><span class="skolem">Ps</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P'2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">P'</span><span class="main">,</span><span class="skolem">Ps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Qannot</span></span> <span class="skolem"><span class="skolem">Q's</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Qannot2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">Qannot</span><span class="main">,</span><span class="skolem">Q's</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">eannot</span></span> <span class="skolem"><span class="skolem">es</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">eannot2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">eannot</span><span class="main">,</span><span class="skolem">es</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
  <span class="keyword1"><span class="command">have</span></span> ih0<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="skolem">Qannot</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Aconseq<span class="main">(</span>3<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
  <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹vc <span class="main">(</span><span class="main">{</span><span class="skolem">P'2</span><span class="main">/</span><span class="skolem">Qannot2</span><span class="main">/</span><span class="skolem">eannot2</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">Q</span> <span class="skolem">LVQ</span> <span class="skolem">LVE</span>›</span></span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ih1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="skolem">Q's</span> <span class="skolem">LVE</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ih2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">P'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>  time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">eannot</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="bound">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Ps</span><span class="main">.</span> <span class="bound">s1</span> <span class="bound">x</span><span class="main">=</span><span class="bound">s2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">P'</span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> <span class="skolem">P'</span> <span class="bound">l</span> <span class="bound">s2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> qc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span> <span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">Q's</span><span class="main">.</span> <span class="bound">s1</span> <span class="bound">x</span><span class="main">=</span><span class="bound">s2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">Qannot</span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> <span class="skolem">Qannot</span> <span class="bound">l</span> <span class="bound">s2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> ec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">es</span><span class="main">.</span> <span class="bound">s1</span> <span class="bound">x</span><span class="main">=</span><span class="bound">s2</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟶</span> <span class="skolem">eannot</span> <span class="bound">s1</span> <span class="main">=</span> <span class="skolem">eannot</span> <span class="bound">s2</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span>  k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="skolem">C</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span> strip <span class="skolem">C</span> <span class="main">{</span> time <span class="skolem">C</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Qannot</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>
    <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">Qannot</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> K4 <span class="skolem">upds</span> <span class="skolem">Q's</span> <span class="skolem">C</span> <span class="skolem">Qannot</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Aconseq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Aconseq<span class="main">(</span>2-10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      
  <span class="keyword1"><span class="command">note</span></span> ih<span class="main">=</span>k<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> ihsnd<span class="main">=</span>k<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> e<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"time <span class="skolem"><span class="skolem">C</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> pre <span class="skolem"><span class="skolem">C</span></span> <span class="skolem"><span class="skolem">Qannot</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> preList <span class="skolem"><span class="skolem">upds</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">Qannot</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> postList <span class="skolem"><span class="skolem">upds</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ih<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> k0 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>      
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> ih2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">l</span> <span class="skolem">s</span> <span class="skolem">t</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">have</span></span> finupds<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>set <span class="skolem">upds</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span> <span class="skolem">n</span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="skolem">upds</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> support <span class="main">(</span>pre <span class="skolem">C</span> <span class="skolem">Qannot</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Aconseq<span class="main">(</span>4<span class="main">)</span> support_pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>                
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> U2<span class="main">=</span>this 
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span> <span class="skolem">n</span> <span class="skolem">x</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="skolem">upds</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∉</span> support <span class="skolem">Qannot</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Aconseq<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> assn2_lupd<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Qannot</span> <span class="main">(</span><span class="skolem">l</span><span class="main">(</span><span class="skolem">x</span> <span class="main">:=</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> <span class="skolem">Qannot</span> <span class="skolem">l</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> K2<span class="main">=</span>this  
                           
      <span class="keyword1"><span class="command">from</span></span> ih2 3<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">l'</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l'</span></span> <span class="keyword2"><span class="keyword">where</span></span> i'<span class="main">:</span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="skolem">l'</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Qannot</span> <span class="skolem">l'</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> lxlx<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span><span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="skolem">upds</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">l'</span> <span class="bound">x</span> <span class="main">=</span> <span class="skolem">l</span> <span class="bound">x</span>"</span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">from</span></span> * <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">l''</span></span> <span class="keyword2"><span class="keyword">where</span></span> i'<span class="main">:</span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="skolem">l''</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Qannot</span> <span class="skolem">l''</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        
        <span class="keyword1"><span class="command">note</span></span> allg<span class="main">=</span>allg<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">e</span> <span class="bound">x</span><span class="main">.</span> <span class="skolem">l</span> <span class="bound">x</span>"</span></span><span class="main">]</span>
        
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="main">(</span>ListUpdate <span class="skolem">l''</span> <span class="skolem">upds</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span>  <span class="main">=</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="skolem">l''</span>  "</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allg<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?upds</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"set <span class="skolem"><span class="skolem">upds</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> U2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">with</span></span> i' <span class="keyword1"><span class="command">have</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="main">(</span>ListUpdate <span class="skolem">l''</span> <span class="skolem">upds</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Qannot</span> <span class="main">(</span>ListUpdate <span class="skolem">l''</span> <span class="skolem">upds</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Qannot</span> <span class="skolem">l''</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allg<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?upds</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"set <span class="skolem"><span class="skolem">upds</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> K2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
                
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">%</span><span class="bound">l'</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span>ListUpdate <span class="skolem">l''</span> <span class="skolem">upds</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">l'</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">l''</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> ii' <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Qannot</span> <span class="main">(</span>ListUpdate <span class="skolem">l''</span> <span class="skolem">upds</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="skolem">l</span><span class="main">)</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        
        <span class="keyword1"><span class="command">{</span></span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
          <span class="keyword3"><span class="command">assume</span></span> as<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="main">(</span>set <span class="skolem">upds</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ListUpdate <span class="skolem">l''</span> <span class="skolem">upds</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="skolem">l</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">l</span> <span class="skolem">x</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ListUpdate_updates<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> as   <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> kla<span class="main">=</span>this        
        
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">thesis</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> 1<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> U<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> K<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> kla<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
      
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upds'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span>preT <span class="skolem">C</span> <span class="bound">e</span> <span class="skolem">s</span><span class="main">,</span>fune <span class="skolem">C</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?upds'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
      <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">xs</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xs</span> <span class="main">=</span> map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span>preT <span class="skolem">C</span> <span class="bound">e</span> <span class="skolem">s</span><span class="main">,</span>fune <span class="skolem">C</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">xs</span><span class="main">=</span> <span class="var">?upds'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                                
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="main">(</span>ListUpdateE <span class="skolem">l'</span> <span class="skolem">xs</span><span class="main">)</span>  <span class="main">=</span> pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="skolem">l'</span> "</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allg_E<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?upds</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?upds'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> U2<span class="main">)</span>  
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>   <span class="keyword1"><span class="command">unfolding</span></span> xs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> i' <span class="keyword1"><span class="command">have</span></span> U<span class="main">:</span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">Qannot</span> <span class="main">(</span>ListUpdateE <span class="skolem">l'</span> <span class="skolem">xs</span> <span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Qannot</span> <span class="main">(</span>ListUpdateE <span class="skolem">l'</span> <span class="skolem">xs</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Qannot</span> <span class="skolem">l'</span> "</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allg_E<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> <span class="var">?upds</span><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?upds'</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> K2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command">unfolding</span></span> xs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">%</span><span class="bound">l'</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">(</span>ListUpdateE <span class="skolem">l'</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">l'</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Qannot</span> <span class="bound">l'</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span> <span class="skolem">l'</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> ii' <span class="keyword1"><span class="command">have</span></span> K<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Qannot</span> <span class="main">(</span>ListUpdateE <span class="skolem">l'</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">t</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">t</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  
        
      <span class="keyword1"><span class="command">have</span></span> xs_upds<span class="main">:</span> <span class="quoted"><span class="quoted">"map fst <span class="skolem">xs</span> <span class="main">=</span> map fst <span class="skolem">upds</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> xs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
      <span class="keyword1"><span class="command">have</span></span> grr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="var">?upds'</span> <span class="main">⟹</span> ListUpdateE <span class="skolem">l'</span> <span class="skolem">xs</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ListUpdateE_updates<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> xs_upds<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Aconseq<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">unfolding</span></span> xs_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"ListUpdateE <span class="skolem"><span class="skolem">l'</span></span> <span class="skolem"><span class="skolem">xs</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> preListpreSet<span class="main">)</span>   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span><span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">e</span> <span class="skolem">v</span><span class="main">)</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span> preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span><span class="main">,</span> fune <span class="skolem">C</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?upds'</span>"</span></span>  
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
          <span class="keyword1"><span class="command">from</span></span> grr<span class="main">[</span><span class="operator">OF</span> this<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
         
          <span class="keyword1"><span class="command">qed</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> <span class="comment1">(* Qannot must be independent of x *)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> postListpostSet<span class="main">)</span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">e</span> <span class="skolem">v</span><span class="main">)</span>
            <span class="keyword1"><span class="command">with</span></span> lxlx<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> fF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">l'</span> <span class="skolem">x</span>"</span></span>  
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
            
            <span class="keyword1"><span class="command">from</span></span> postSetpostList<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"postSet <span class="main">(</span>set <span class="skolem">upds</span><span class="main">)</span> <span class="main">(</span>ListUpdateE <span class="skolem">l'</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>ListUpdateE <span class="skolem">l'</span> <span class="skolem">xs</span><span class="main">)</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">e</span> <span class="skolem">t</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>            
            <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>3<span class="main">)</span> grr<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span><span class="main">,</span>preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span><span class="main">,</span> fune <span class="skolem">C</span> <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>   B<span class="main">:</span> <span class="quoted"><span class="quoted">"ListUpdateE <span class="skolem">l'</span> <span class="skolem">xs</span> <span class="skolem">x</span> <span class="main">=</span> fst <span class="main">(</span>snd <span class="main">(</span><span class="skolem">x</span><span class="main">,</span> preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span><span class="main">,</span> fune <span class="skolem">C</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
            <span class="keyword1"><span class="command">from</span></span> A B <span class="keyword1"><span class="command">have</span></span> X<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="skolem">t</span> <span class="main">=</span> preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">from</span></span> preSetpreList<span class="main">[</span><span class="operator">OF</span> 3<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"preSet <span class="main">(</span>set <span class="skolem">upds</span><span class="main">)</span> <span class="main">(</span><span class="main">{</span><span class="skolem">P'2</span><span class="main">/</span><span class="skolem">Qannot2</span><span class="main">/</span><span class="skolem">eannot2</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="skolem">x</span> <span class="main">=</span> preT <span class="skolem">C</span> <span class="skolem">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
            <span class="keyword1"><span class="command">from</span></span> X Y <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> ihsnd ih2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> ihsnd<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">]</span> pc <span class="keyword1"><span class="command">unfolding</span></span> K4_def K_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
              <span class="keyword1"><span class="command">unfolding</span></span> K3_def K2_def <span class="keyword1"><span class="command">using</span></span> ec <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aseq <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="skolem">upds</span><span class="main">)</span>
   
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span><span class="skolem">C2</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span>  <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"support <span class="skolem">Q</span> <span class="main">∪</span> varacom <span class="skolem">C1</span> <span class="main">∪</span> varacom <span class="skolem">C2</span> <span class="main">∪</span> lesvars <span class="skolem">upds</span>"</span></span>
  
  
  <span class="keyword1"><span class="command">have</span></span> finite_varacom<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varacom <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
  <span class="keyword1"><span class="command">have</span></span> finite_varacomC2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varacom <span class="skolem">C2</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ finite_varacom<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?y</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="var">?P'</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> sup_L<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>preList <span class="skolem">upds</span> <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span><span class="skolem">C2</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> lesvars <span class="skolem">upds</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> support_preList<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  
  
  <span class="keyword1"><span class="command">have</span></span> sup_B<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="var">?P</span> <span class="main">⊆</span> <span class="var">?P'</span>"</span></span>                         
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> support_pre sup_L <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> fP'<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="var">?P'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_varacom Aseq<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>5<span class="main">)</span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> <span class="var">?P'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> infinite_UNIV_listI
    <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> ynP'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∉</span> <span class="var">?P'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> 
  <span class="keyword1"><span class="command">hence</span></span> ysupPreC2Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∉</span> support <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ysupC1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∉</span> varacom <span class="skolem">C1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> support_pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> Aseq<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lesvars <span class="skolem">upds</span> <span class="main">∩</span> varacom <span class="skolem">C2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> Aseq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Seq<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 2   
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span>  preList <span class="skolem">upds</span> <span class="skolem">C2</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">)</span><span class="main">}</span> strip <span class="skolem">C2</span> <span class="main">{</span> time <span class="skolem">C2</span> <span class="main">⇓</span> <span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="skolem">upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weaken_post<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> postList <span class="skolem"><span class="skolem">upds</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> 2<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>      
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"time <span class="skolem">C1</span> <span class="skolem">s</span> <span class="main">+</span> preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">s</span>  <span class="main">≤</span> time <span class="skolem">C1</span> <span class="skolem">s</span> <span class="main">+</span> preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 1 
     
    
    <span class="keyword1"><span class="command">from</span></span> ynP' <span class="keyword1"><span class="command">have</span></span> yC1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∉</span> varacom <span class="skolem">C1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> xC1<span class="main">:</span> <span class="quoted"><span class="quoted">"lesvars <span class="skolem">upds</span> <span class="main">∩</span> varacom <span class="skolem">C1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Aseq<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> finite_support_pre<span class="main">[</span><span class="operator">OF</span> Aseq<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> finite_varacomC2<span class="main">]</span> 
    <span class="keyword1"><span class="command">have</span></span> G<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 
         
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">a</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> preT <span class="skolem">C2</span> <span class="bound">e</span><span class="main">,</span> fune <span class="skolem">C2</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span>"</span></span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upds'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?y</span><span class="main">,</span>time <span class="skolem">C2</span><span class="main">,</span> kdeps <span class="skolem">C2</span><span class="main">)</span><span class="main">#</span><span class="var">?upds</span>"</span></span>
    
    <span class="keyword1"><span class="command">{</span></span> 
      <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">" lesvars <span class="var">?upds'</span> <span class="main">=</span> <span class="main">{</span><span class="var">?y</span><span class="main">}</span> <span class="main">∪</span> lesvars <span class="skolem">upds</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> Aseq<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"lesvars <span class="skolem">upds</span> <span class="main">∩</span> varacom <span class="skolem">C1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" lesvars <span class="var">?upds'</span> <span class="main">∩</span> varacom <span class="skolem">C1</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> A <span class="keyword1"><span class="command">using</span></span> ysupC1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> klar<span class="main">=</span>this
    
    <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> preT <span class="skolem">C2</span> <span class="bound">e</span><span class="main">,</span> fune <span class="skolem">C2</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span> <span class="skolem">c</span> <span class="skolem">X</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> lesvars <span class="skolem">X</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">,</span><span class="skolem">c</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">X</span>"</span></span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> helper<span class="main">=</span>this
    
    <span class="keyword1"><span class="command">have</span></span> dmap<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="var">?upds'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> t<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> e <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> helper<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="var"><span class="quoted"><span class="var"><span class="quoted"><span class="var">?y</span></span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">upds</span></span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">e</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="keyword1"><span class="command">using</span></span> ynP' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">note</span></span> bla1<span class="main">=</span>1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"pre <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> upds<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?upds'</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> G klar dmap<span class="main">]</span>  
      
    <span class="keyword1"><span class="command">note</span></span> bla<span class="main">=</span>1<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">]</span> 
    <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> kal<span class="main">:</span> <span class="quoted"><span class="quoted">"lesvars <span class="skolem">upds</span> <span class="main">∩</span> varacom <span class="skolem">C2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> bla<span class="main">[</span><span class="operator">OF</span> kal Aseq.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">,</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bla4<span class="main">:</span> <span class="quoted"><span class="quoted">"K4 <span class="skolem">upds</span> <span class="skolem">LVQ</span> <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span>   <span class="keyword1"><span class="command">have</span></span> bla<span class="main">:</span> <span class="quoted"><span class="quoted">"K <span class="skolem">C2</span> <span class="skolem">LVQ</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> K4_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span>  
        <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="var">?upds'</span> <span class="skolem">C1</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>
      strip <span class="skolem">C1</span>
      <span class="main">{</span> time <span class="skolem">C1</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds'</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span> <span class="main">∧</span>
  <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>  K4 <span class="var">?upds'</span> <span class="main">(</span>qdeps <span class="skolem">C2</span> <span class="skolem">LVQ</span><span class="main">)</span> <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"pre <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">Q</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> upds<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?upds'</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>10<span class="main"><span class="main">)</span></span> G klar dmap<span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1        
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> bla  <span class="keyword1"><span class="command">unfolding</span></span> K_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span><span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span> <span class="skolem">s1</span> <span class="skolem">s2</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> bla4 <span class="keyword1"><span class="command">using</span></span> Aseq.prems<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> K4_def K3_def K2_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> 1
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"time <span class="skolem">C2</span> <span class="skolem">s1</span> <span class="main">=</span> time <span class="skolem">C2</span> <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          
          <span class="keyword1"><span class="command">have</span></span> post<span class="main">:</span> <span class="quoted"><span class="quoted">"postList <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> preT <span class="skolem">C2</span> <span class="bound">e</span><span class="main">,</span> fune <span class="skolem">C2</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">s1</span> <span class="main">=</span> postList <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> preT <span class="skolem">C2</span> <span class="bound">e</span><span class="main">,</span> fune <span class="skolem">C2</span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">s2</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?IH</span> <span class="skolem">upds</span>"</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> 1 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">upds</span></span><span class="main">)</span> 
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">upds</span><span class="main">)</span>
            <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?IH</span> <span class="skolem">upds</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">⊆</span> <span class="skolem">LVE</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> s12v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s1</span> <span class="main">=</span> <span class="skolem">s2</span> <span class="keyword1">on</span> fune <span class="skolem">C2</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> a <span class="keyword1"><span class="command">using</span></span> fune_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
            <span class="keyword1"><span class="command">with</span></span> Cons<span class="main">(</span>3<span class="main">)</span> IH a <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
          
          <span class="keyword1"><span class="command">from</span></span> post t <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 3
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">using</span></span> bla4 <span class="keyword1"><span class="command">unfolding</span></span> K4_def K3_def K2_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 4
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">aa</span> <span class="skolem">b</span><span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> Aseq.prems<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span> <span class="main">⊆</span> <span class="skolem">LVE</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> fune_mono <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fune <span class="skolem">C2</span> <span class="skolem">b</span> <span class="main">⊆</span> fune <span class="skolem">C2</span> <span class="skolem">LVE</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">qed</span></span>
       
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">l</span> <span class="var">?y</span> <span class="main">=</span> preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="bound">s</span><span class="main">}</span> strip <span class="skolem">C1</span>
         <span class="main">{</span> time <span class="skolem">C1</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="skolem">C2</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> time <span class="skolem">C2</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">l</span> <span class="var">?y</span><span class="main">}</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> preList_Seq postList_preList<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
    <span class="keyword1"><span class="command">from</span></span> A<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"K <span class="skolem">C1</span> <span class="main">(</span>qdeps <span class="skolem">C2</span> <span class="skolem">LVQ</span><span class="main">)</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> A2<span class="main">:</span> <span class="quoted"><span class="quoted">"K3 <span class="var">?upds'</span> <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> A3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> kdeps <span class="skolem">C1</span> <span class="main">⟶</span> time <span class="skolem">C1</span> <span class="bound">s1</span> <span class="main">=</span> time <span class="skolem">C1</span> <span class="bound">s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> K4_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> bla4 <span class="keyword1"><span class="command">have</span></span> B1<span class="main">:</span> <span class="quoted"><span class="quoted">"K <span class="skolem">C2</span> <span class="skolem">LVQ</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B2<span class="main">:</span> <span class="quoted"><span class="quoted">"K3 <span class="skolem">upds</span> <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> kdeps <span class="skolem">C2</span> <span class="main">⟶</span> time <span class="skolem">C2</span> <span class="bound">s1</span> <span class="main">=</span> time <span class="skolem">C2</span> <span class="bound">s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> K4_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"K4 <span class="skolem">upds</span> <span class="skolem">LVQ</span> <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">Q</span> "</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> K4_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> A1 B1 <span class="keyword1"><span class="command">unfolding</span></span> K_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> A2 B2 <span class="keyword1"><span class="command">unfolding</span></span> K3_def K2_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s1 s2 <span class="keyword1"><span class="command">using</span></span> A3 B3 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"time <span class="skolem">C1</span> <span class="skolem">s1</span> <span class="main">=</span> time <span class="skolem">C1</span> <span class="skolem">s2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> A2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> fune <span class="skolem">C1</span> <span class="main">(</span>kdeps <span class="skolem">C2</span><span class="main">)</span> <span class="main">⟶</span> preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="bound">s1</span> <span class="main">=</span> preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="bound">s2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> K3_def K2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">s1</span> <span class="main">=</span>  preT <span class="skolem">C1</span> <span class="main">(</span>time <span class="skolem">C2</span><span class="main">)</span> <span class="skolem">s2</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> t p <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>    
    <span class="keyword1"><span class="command">from</span></span> ynP' sup_B <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∉</span> support <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>preList <span class="skolem">upds</span> <span class="skolem">C2</span><span class="main">)</span> <span class="main">⊆</span> lesvars <span class="skolem">upds</span>"</span></span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> support_preList<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span>  <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="skolem">C2</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?P'</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_trans<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> F support_pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> ynP'
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?y</span> <span class="main">∉</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span>  <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="skolem">upds</span> <span class="skolem">C2</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span> 
    
    
    <span class="keyword1"><span class="command">note</span></span> bla<span class="main">=</span>6<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 6<span class="main"><span class="main">(</span></span>11<span class="main"><span class="main">,</span></span>3<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">]</span> 
    <span class="keyword1"><span class="command">from</span></span> 6<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> kal<span class="main">:</span> <span class="quoted"><span class="quoted">"lesvars <span class="skolem">upds</span> <span class="main">∩</span> varacom <span class="skolem">C2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> bla<span class="main">[</span><span class="operator">OF</span> kal Aseq.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">,</span></span>6<span class="main"><span class="main">,</span></span>7<span class="main"><span class="main">,</span></span>8<span class="main"><span class="main">,</span></span>9<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bla4<span class="main">:</span> <span class="quoted"><span class="quoted">"K4 <span class="skolem">upds</span> <span class="skolem">LVQ</span> <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span>   <span class="keyword1"><span class="command">have</span></span> bla<span class="main">:</span> <span class="quoted"><span class="quoted">"K <span class="skolem">C2</span> <span class="skolem">LVQ</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> K4_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">have</span></span> 11<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">)</span><span class="main">)</span> "</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_pre<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> 6<span class="main">(</span>3<span class="main">,</span>4<span class="main">,</span>10<span class="main">)</span>  finite_varacomC2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">)</span>  <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span>  <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C1</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> 6<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> upds<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> bla <span class="keyword1"><span class="command">unfolding</span></span> K_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span>  <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C2</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> 6<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> upds<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">using</span></span> Aseq.prems<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">from</span></span> A B 6 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">A</span> <span class="skolem">b</span> <span class="skolem">C</span> <span class="skolem">Q</span> <span class="skolem">upds</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I2</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="skolem"><span class="skolem">Es</span></span> <span class="skolem"><span class="skolem">SS</span></span> <span class="keyword2"><span class="keyword">where</span></span> aha<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">I2</span><span class="main">,</span><span class="main">(</span><span class="skolem">S</span><span class="main">,</span><span class="main">(</span><span class="skolem">E</span><span class="main">,</span><span class="skolem">Es</span><span class="main">,</span><span class="skolem">SS</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_cases5 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="skolem"><span class="skolem">Is</span></span> <span class="keyword2"><span class="keyword">where</span></span> aha2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I2</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">I</span><span class="main">,</span> <span class="skolem">Is</span><span class="main">)</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?LV</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span> <span class="main">∪</span> <span class="skolem">LVQ</span><span class="main">.</span> <span class="main">(</span>funStar <span class="skolem">SS</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">have</span></span> LVE_LVE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">LVE</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span><span class="main">.</span> <span class="main">(</span>funStar <span class="skolem">SS</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> funStart_prop1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> LV_LV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">LVE</span> <span class="main">∪</span> <span class="skolem">LVQ</span> <span class="main">⊆</span> <span class="var">?LV</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> funStart_prop1  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> LV_LV2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span> <span class="main">∪</span> <span class="skolem">LVQ</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊆</span> <span class="var">?LV</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> funStart_prop2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">have</span></span> LVE_LV2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span><span class="main">.</span> <span class="main">(</span>funStar <span class="skolem">SS</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> funStart_prop2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">note</span></span> aha <span class="main">=</span> aha2 aha 
  <span class="keyword1"><span class="command">with</span></span> aha aha2 <span class="quoted"><span class="quoted">‹vc <span class="main">(</span>Awhile <span class="skolem">A</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">Q</span> <span class="skolem">LVQ</span> <span class="skolem">LVE</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vc <span class="main">(</span>Awhile <span class="main">(</span><span class="main">(</span><span class="skolem">I</span><span class="main">,</span><span class="skolem">Is</span><span class="main">)</span><span class="main">,</span><span class="skolem">S</span><span class="main">,</span><span class="skolem">E</span><span class="main">,</span><span class="skolem">Es</span><span class="main">,</span><span class="skolem">SS</span><span class="main">)</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">Q</span> <span class="skolem">LVQ</span> <span class="skolem">LVE</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span>                 
  <span class="keyword1"><span class="command">have</span></span> vc<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="skolem">I</span> <span class="skolem">Is</span> <span class="main">(</span><span class="skolem">Es</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span><span class="main">.</span> <span class="main">(</span>funStar <span class="skolem">SS</span><span class="main">)</span> <span class="bound">y</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> IQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span>  <span class="main">1</span> <span class="main">+</span> preT <span class="skolem">C</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">+</span> time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">S</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span> <span class="keyword1">on</span> <span class="var">?LV</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">S</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">on</span> <span class="var">?LV</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Is<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="skolem">Is</span> <span class="main">⟶</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s2</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Ss<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span> <span class="main">∪</span> <span class="skolem">LVQ</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">Ss</span> <span class="main">=</span> <span class="skolem">SS</span> <span class="bound">y</span> <span class="keyword1">in</span> <span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="bound">Ss</span> <span class="main">⟶</span> <span class="skolem">S</span> <span class="bound">s1</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">S</span> <span class="bound">s2</span> <span class="bound">y</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Es<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="skolem">Es</span> <span class="main">⟶</span> <span class="skolem">E</span> <span class="bound">s1</span> <span class="main">=</span> <span class="skolem">E</span> <span class="bound">s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">S</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">s</span> <span class="keyword1">on</span> <span class="var">?LV</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> IQ2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span> pre <span class="skolem">C</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span>  <span class="main">1</span> <span class="main">+</span> preT <span class="skolem">C</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">+</span> time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">S</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span> <span class="keyword1">on</span> <span class="var">?LV</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Ss2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">y</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">S</span> <span class="bound">s1</span> <span class="main">=</span> <span class="skolem">S</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="skolem">LVE</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> Ss <span class="keyword1"><span class="command">have</span></span> Ssc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">c</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">c</span> <span class="main">⊆</span> <span class="skolem">LVE</span> <span class="main">⟹</span>  <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="bound">c</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⟹</span> <span class="skolem">S</span> <span class="bound">s1</span> <span class="main">=</span> <span class="skolem">S</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="bound">c</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">from</span></span> IQ <span class="keyword1"><span class="command">have</span></span> IQ_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">S</span> <span class="bound">s</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span> <span class="keyword1">on</span> <span class="var">?LV</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> inv_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">⟹</span> pre <span class="skolem">C</span> <span class="skolem">I</span>  <span class="bound">l</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> IQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  
  <span class="keyword1"><span class="command">have</span></span> yC<span class="main">:</span> <span class="quoted"><span class="quoted">"lesvars <span class="skolem">upds</span> <span class="main">∩</span> varacom <span class="skolem">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>4<span class="main">)</span> aha <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upds</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"map <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span><span class="bound">e</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?INV</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span>"</span></span> 
    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lesvars <span class="skolem">upds</span> <span class="main">∩</span> support <span class="skolem">I</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> aha <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"lesvars <span class="skolem">upds</span> <span class="main">∪</span> varacom <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?z</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="keyword1">SOME</span> <span class="bound">z</span><span class="main">::</span>lvname<span class="main">.</span> <span class="bound">z</span> <span class="main">∉</span> <span class="var">?P</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">del</span><span class="main"><span class="main">:</span></span> aha<span class="main">)</span>   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> Awhile<span class="main"><span class="main">(</span></span>6<span class="main"><span class="main">)</span></span><span class="main">)</span>  
  <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">z</span><span class="main">.</span> <span class="bound">z</span><span class="main">∉</span><span class="var">?P</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> infinite_UNIV_listI
    <span class="keyword1"><span class="command">using</span></span> ex_new_if_finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">hence</span></span> znP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> <span class="var">?P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> someI_ex<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> znP <span class="keyword1"><span class="command">have</span></span>   
      zny<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> lesvars <span class="skolem">upds</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> zI<span class="main">:</span>   <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> support <span class="skolem">I</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> blb<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> varacom <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aha<span class="main">)</span>
  
  <span class="keyword1"><span class="command">from</span></span> Awhile<span class="main">(</span>4<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 23<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varacom <span class="skolem">C</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span>  26<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="skolem">I</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_subset aha<span class="main">)</span> 
   
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span>  pre <span class="skolem">C</span> <span class="skolem">I</span>  <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Awhile<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">THEN</span> conjunct2<span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span>  Is <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>8<span class="main">)</span> LVE_LVE  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subsetD sup.cobounded2<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>10<span class="main">)</span> LVE_LVE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">hence</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">I</span>  <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   
  <span class="keyword1"><span class="command">have</span></span> fua<span class="main">:</span> <span class="quoted"><span class="quoted">"lesvars <span class="var">?upds</span> <span class="main">=</span> lesvars <span class="skolem">upds</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?upds'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?z</span><span class="main">,</span><span class="skolem">E</span><span class="main">,</span><span class="skolem">Es</span><span class="main">)</span> <span class="main">#</span> <span class="var">?upds</span>"</span></span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> aha <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">n</span> <span class="main">⟹</span> <span class="skolem">I</span> <span class="skolem">l</span> <span class="skolem">s</span> <span class="main">⟹</span> <span class="skolem">Q</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="skolem">l</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> less IQ2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="skolem">I</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">S</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">on</span> <span class="var">?LV</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> preT <span class="skolem">C</span> <span class="skolem">E</span> <span class="skolem">s</span> <span class="main">+</span> time <span class="skolem">C</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> step <span class="keyword1"><span class="command">have</span></span> I'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">E</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> time <span class="skolem">C</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> TQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> less <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
        <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>1<span class="main">)</span> I' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">with</span></span> step <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> S  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>7<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LV_LV SUP_union contra_subsetD sup.boundedE<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">with</span></span> pre2 less<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">s</span> <span class="main">=</span> <span class="skolem">s</span>  <span class="keyword1">on</span> <span class="var">?LV</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>7<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> LV_LV SUP_union contra_subsetD sup.boundedE<span class="main">)</span>  
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> I <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">l</span> <span class="main">(</span>postQ <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 1    
   <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">e</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∘</span> <span class="skolem">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
   
   <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"lesvars <span class="var">?upds'</span> <span class="main">∩</span> varacom <span class="skolem">C</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> yC blb <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        
        <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="main">∘</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> fst"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="var">?upds'</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>5<span class="main">)</span> zny <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> z<span class="main">)</span>
          
        <span class="keyword1"><span class="command">have</span></span> klae<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span> <span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">B</span> <span class="main">⊆</span> <span class="bound">A</span> <span class="main">⟹</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="bound">A</span> <span class="main">⟹</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="bound">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> Awhile<span class="main">(</span>8<span class="main">)</span> Awhile<span class="main">(</span>9<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> gl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">a</span> <span class="bound">b</span> <span class="bound">c</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span> <span class="main">∈</span> set <span class="skolem">upds</span> <span class="main">⟹</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="bound">c</span> <span class="main">⟹</span> <span class="bound">b</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">b</span> <span class="bound">s2</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">have</span></span> CombALL<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> preList <span class="var">?upds'</span> <span class="skolem">C</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>
                  strip <span class="skolem">C</span>
                  <span class="main">{</span> time <span class="skolem">C</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds'</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">}</span>   <span class="main">∧</span>
<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> K4 <span class="main">(</span><span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">z</span> <span class="main">∉</span> lesvars <span class="skolem">upds</span> <span class="main">∪</span> varacom <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span><span class="main">,</span> <span class="skolem">E</span><span class="main">,</span> <span class="skolem">Es</span><span class="main">)</span> <span class="main">#</span> map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span><span class="main">)</span> <span class="skolem">Is</span> <span class="skolem">C</span> <span class="skolem">I</span> "</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Awhile.IH<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> upds<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?upds'</span></span>"</span></span></span> <span class="main"><span class="main">]</span></span> <span class="main">)</span>
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>  
          
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command">using</span></span> Is <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">using</span></span> Is <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
            <span class="keyword1"><span class="command">using</span></span> Is Es <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>   
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> postListpostSet2<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span> 
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="skolem">x</span> <span class="skolem">e</span> <span class="skolem">v</span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">s1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span>  Awhile<span class="main">(</span>10<span class="main">)</span> 1<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> vLC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">⊆</span> <span class="skolem">LVE</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">v</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vLC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span><span class="main">.</span> funStar <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LVE_LV2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">v</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊆</span>  <span class="skolem">Es</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span><span class="main">.</span> funStar <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">s1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">s2</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> gl<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Ssc<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
              <span class="keyword1"><span class="command">using</span></span> st 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">l</span> <span class="skolem">s1</span> <span class="skolem">s2</span> <span class="skolem">x</span> <span class="skolem">e</span> <span class="skolem">v</span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>5<span class="main">,</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">s2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span>  Awhile<span class="main">(</span>10<span class="main">)</span> 2<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> vLC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">⊆</span> <span class="skolem">LVE</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">have</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">v</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vLC <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">⊆</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span><span class="main">.</span> funStar <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> LVE_LV2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">v</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span> <span class="main">⊆</span>  <span class="skolem">Es</span> <span class="main">∪</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">y</span><span class="main">∈</span><span class="skolem">LVE</span><span class="main">.</span> funStar <span class="skolem">SS</span> <span class="bound">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">s1</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">s2</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> gl<span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Ssc<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
              <span class="keyword1"><span class="command">using</span></span> st 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
          <span class="keyword1"><span class="command">qed</span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Es <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> gl<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Ss Awhile<span class="main">(</span>10<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>10<span class="main">)</span> LVE_LV2 <span class="keyword1"><span class="command">by</span></span>  <span class="operator">blast</span>       
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">THEN</span> conjunct2<span class="main">,</span> <span class="operator">THEN</span> conjunct2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
          K<span class="main">:</span> <span class="quoted"><span class="quoted">"K <span class="skolem">C</span> <span class="skolem">Is</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> K3<span class="main">:</span> <span class="quoted"><span class="quoted">"K3 <span class="var">?upds'</span> <span class="skolem">C</span> <span class="skolem">I</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Kt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> kdeps <span class="skolem">C</span> <span class="main">⟶</span> time <span class="skolem">C</span> <span class="bound">s1</span> <span class="main">=</span> time <span class="skolem">C</span> <span class="bound">s2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> K4_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"K4 <span class="skolem">upds</span> <span class="skolem">LVQ</span> <span class="main">(</span><span class="main">{</span><span class="skolem">A</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">)</span> <span class="skolem">Q</span>"</span></span> 
          <span class="keyword1"><span class="command">unfolding</span></span> K4_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> K <span class="keyword1"><span class="command">unfolding</span></span> K_def aha <span class="keyword1"><span class="command">using</span></span> Is <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> K3 <span class="keyword1"><span class="command">unfolding</span></span> K3_def K2_def aha <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x e v <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> gl<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Ssc<span class="main">)</span>  <span class="keyword1"><span class="command">using</span></span> Awhile<span class="main">(</span>10<span class="main">)</span> 
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Kt Es <span class="keyword1"><span class="command">unfolding</span></span> aha <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> aha<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?INV</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> e'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">E</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="var"><span class="var">?INV</span></span> <span class="bound"><span class="bound">l</span></span> <span class="bound"><span class="bound">s</span></span> <span class="main"><span class="main">∧</span></span> <span class="main"><span class="main">~</span></span> bval <span class="skolem"><span class="skolem">b</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 3
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> postList_preList<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> <span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span>  g<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="comment1">(* post condition is satisfied after exiting the loop *)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Awhile<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Aw7<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="skolem">LVE</span> <span class="main">⟹</span>  postList <span class="skolem">upds</span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> postList <span class="skolem">upds</span> <span class="bound">l</span> <span class="bound">s2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"postList <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="bound">e</span><span class="main">,</span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">x</span><span class="main">,</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="bound">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="bound">s</span><span class="main">)</span><span class="main">,</span> <span class="main">⋃</span><span class="bound">x</span><span class="main">∈</span><span class="bound">v</span><span class="main">.</span> <span class="skolem">SS</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="skolem">upds</span><span class="main">)</span> <span class="skolem">l</span> <span class="skolem">s</span> <span class="main">=</span>
                postList <span class="skolem">upds</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">upds</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> postList <span class="skolem">upds</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  Aw7<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="skolem">s</span>"</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">l</span>"</span></span><span class="main">]</span> pre2 2 LV_LV
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> While<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1          
        
        
        <span class="keyword1"><span class="command">note</span></span> Comb<span class="main">=</span>CombALL<span class="main">[</span><span class="operator">THEN</span> conjunct1<span class="main">]</span>
        
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">∧</span> preT <span class="skolem">C</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">l</span> <span class="var">?z</span><span class="main">}</span>
         strip <span class="skolem">C</span> <span class="main">{</span>  time <span class="skolem">C</span> <span class="main">⇓</span> <span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">l</span> <span class="var">?z</span><span class="main">}</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> Comb<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span> 
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> IQ_in<span class="main">[</span><span class="operator">OF</span> 2<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> gl Awhile<span class="main">(</span>10<span class="main">,</span>9<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"postList <span class="var">?upds</span> <span class="skolem">l</span> <span class="skolem">s</span> <span class="main">=</span> 
                preList <span class="var">?upds</span> <span class="skolem">C</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?IH</span> <span class="skolem">upds</span>"</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">upds</span></span><span class="main">)</span> 
            <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span>  <span class="skolem">upds'</span><span class="main">)</span>
            <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">v</span></span> <span class="keyword2"><span class="keyword">where</span></span> axe<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">y</span><span class="main">,</span><span class="skolem">e</span><span class="main">,</span><span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
            <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?IH</span> <span class="skolem">upds'</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Cons<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
              <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>2-5<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span> axe <span class="keyword1"><span class="command">have</span></span> ke<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="skolem">v</span> <span class="main">⟹</span> <span class="skolem">e</span> <span class="bound">s1</span> <span class="main">=</span> <span class="skolem">e</span> <span class="bound">s2</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">have</span></span> vLC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">⊆</span> <span class="skolem">LVE</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> axe Cons<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">have</span></span> step<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">(</span><span class="skolem">S</span> <span class="main">(</span>postQ <span class="skolem">C</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ke<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Cons<span class="main">(</span>2<span class="main">)</span>  <span class="keyword1"><span class="command">using</span></span> vLC LV_LV 2<span class="main">(</span>3<span class="main">)</span> 
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> axe <span class="keyword1"><span class="command">using</span></span> IH step <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
                <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> TQ<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> y<span class="main">)</span> 
        <span class="keyword1"><span class="command">qed</span></span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> inv_impl<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>  <span class="main">1</span> <span class="main">+</span> preT <span class="skolem">C</span> <span class="skolem">E</span> <span class="bound">s</span> <span class="main">+</span> time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span>   <span class="skolem">E</span> <span class="bound">s</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command">using</span></span> 1 IQ <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">next</span></span> 
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">~</span>bval <span class="skolem">b</span> <span class="bound">s</span> <span class="main">∧</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>  <span class="main">1</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="bound">s</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> pre <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">qed</span></span>  
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> pff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> lesvars <span class="var">?upds</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fua<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> support <span class="skolem">I</span> <span class="main">∪</span> support <span class="main">(</span>postList <span class="var">?upds</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> support_and<span class="main">)</span> 
        <span class="keyword1"><span class="command">also</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"support <span class="main">(</span>postList <span class="var">?upds</span><span class="main">)</span>
          <span class="main">⊆</span> lesvars <span class="var">?upds</span>"</span></span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> support_postList<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
        <span class="keyword1"><span class="command">finally</span></span> 
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⊆</span> support <span class="skolem">I</span> <span class="main">∪</span> lesvars <span class="var">?upds</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?z</span> <span class="main">∉</span> support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> postList <span class="var">?upds</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> contra_subsetD<span class="main">)</span> 
          <span class="keyword1"><span class="command">using</span></span> zI pff <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span> 
    
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
 

<span class="keyword1"><span class="command">corollary</span></span> vc_sound'<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">Q</span> <span class="free">Qset</span> <span class="main">{}</span>"</span></span> 
          <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varacom <span class="free">C</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span>"</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="free">Qset</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span>time <span class="free">C</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> upds<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>      
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">corollary</span></span> vc_sound''<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">Q</span> <span class="free">Qset</span> <span class="main">{}</span>"</span></span> 
          <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="free">Q</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>varacom <span class="free">C</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> time <span class="free">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s1</span> <span class="bound">s2</span> <span class="bound">l</span><span class="main">.</span> <span class="bound">s1</span> <span class="main">=</span> <span class="bound">s2</span> <span class="keyword1">on</span> <span class="free">Qset</span> <span class="main">⟹</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s1</span> <span class="main">=</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span><span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq_old<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> upds<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>2-3<span class="main"><span class="main">)</span></span><span class="main"><span class="main">,</span></span> <span class="operator">THEN</span> conjunct1<span class="main"><span class="main">]</span></span><span class="main">)</span>      
    <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>4<span class="main">,</span>5<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
<span class="keyword1"><span class="command">qed</span></span>    

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Nielson_VCGi_complete">
<div class="head">
<h1>Theory Nielson_VCGi_complete</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Nielson_VCGi_complete
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Nielson_VCG.html">Nielson_VCG</a> <a href="Nielson_VCGi.html">Nielson_VCGi</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Completeness"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As the improved VCG for the Nielson logic is only more liberal in the sense that
      the S annotation is only checked for "interesting" variables, if we specify the
      set of interesting variables to be all variables we basically get the same
      verification conditions as for the normal VCG.
      In that sense, we can prove the completeness of the improved VCG with the completeness
      theorem of the normal VCG. 

      For that, we formulate some translation functions and in the end show completeness of the
      improved VCG:›</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">transl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"Nielson_VCG.acom <span class="main">⇒</span> Nielson_VCGi.acom"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">transl</span> <span class="keyword1">SKIP</span> <span class="main">=</span> <span class="keyword1">SKIP</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">transl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">transl</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">transl</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free">transl</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">transl</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free">transl</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free">transl</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">transl</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">,</span>UNIV<span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">,</span>UNIV<span class="main">)</span><span class="main">/</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">D</span></span></span><span class="main">,</span>UNIV<span class="main">)</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free">transl</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">transl</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">,</span>UNIV<span class="main">)</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">S</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">,</span>UNIV<span class="main">,</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> UNIV<span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free">transl</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Nielson_VCGi_complete-qdeps_UNIV"><span class="command">lemma</span></span> qdeps_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"qdeps <span class="main">(</span>transl <span class="free">C</span><span class="main">)</span> UNIV <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Nielson_VCGi_complete-fune_UNIV"><span class="command">lemma</span></span> fune_UNIV<span class="main">:</span> <span class="quoted"><span class="quoted">"fune <span class="main">(</span>transl <span class="free">C</span><span class="main">)</span> UNIV <span class="main">=</span> UNIV"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1" id="Nielson_VCGi_complete-pre_transl"><span class="command">lemma</span></span> pre_transl<span class="main">:</span> <span class="quoted"><span class="quoted">"Nielson_VCGi.pre <span class="main">(</span>transl <span class="free">C</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> Nielson_VCG.pre <span class="free">C</span> <span class="free">Q</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Nielson_VCGi_complete-preT_transl"><span class="command">lemma</span></span> preT_transl<span class="main">:</span> <span class="quoted"><span class="quoted">"Nielson_VCGi.preT <span class="main">(</span>transl <span class="free">C</span><span class="main">)</span> <span class="free">E</span> <span class="main">=</span> Nielson_VCG.preT <span class="free">C</span> <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">E</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Nielson_VCGi_complete-postQ_transl"><span class="command">lemma</span></span> postQ_transl<span class="main">:</span> <span class="quoted"><span class="quoted">"Nielson_VCGi.postQ <span class="main">(</span>transl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> Nielson_VCG.postQ <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Nielson_VCGi_complete-time_transl"><span class="command">lemma</span></span> time_transl<span class="main">:</span> <span class="quoted"><span class="quoted">"Nielson_VCGi.time <span class="main">(</span>transl <span class="free">C</span><span class="main">)</span>  <span class="main">=</span> Nielson_VCG.time <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> preT_transl<span class="main">)</span>


<span class="keyword1" id="Nielson_VCGi_complete-vc_transl"><span class="command">lemma</span></span> vc_transl<span class="main">:</span> <span class="quoted"><span class="quoted">"Nielson_VCG.vc <span class="free">C</span> <span class="free">Q</span> <span class="main">⟹</span> Nielson_VCGi.vc <span class="main">(</span>transl <span class="free">C</span><span class="main">)</span> <span class="free">Q</span> UNIV UNIV"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aconseq <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">x3</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_transl time_transl<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">A</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">A</span><span class="main">=</span><span class="main">(</span><span class="skolem">I</span><span class="main">,</span><span class="skolem">S</span><span class="main">,</span><span class="skolem">E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> prod_cases3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> Awhile <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_transl preT_transl time_transl postQ_transl<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">presburger</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> qdeps_UNIV fune_UNIV pre_transl<span class="main">)</span> 
  
<span class="keyword1" id="Nielson_VCGi_complete-strip_transl"><span class="command">lemma</span></span> strip_transl<span class="main">:</span> <span class="quoted"><span class="quoted">"Nielson_VCGi.strip <span class="main">(</span>transl <span class="free">C</span><span class="main">)</span> <span class="main">=</span> Nielson_VCG.strip <span class="free">C</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

   
<span class="keyword1" id="Nielson_VCGi_complete-vc_restrict_complete"><span class="command">lemma</span></span> vc_restrict_complete<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> Nielson_VCGi.strip <span class="bound">C</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∧</span> Nielson_VCGi.vc <span class="bound">C</span> <span class="free">Q</span> UNIV UNIV 
  <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> Nielson_VCGi.pre <span class="bound">C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">l</span> <span class="main">(</span>Nielson_VCGi.postQ <span class="bound">C</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>
  <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span>  Nielson_VCGi.time <span class="bound">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span>  "</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?G</span> <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="bound">C</span> <span class="free">e</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"Nielson_VCG.strip <span class="skolem">C</span> <span class="main">=</span> <span class="free">c</span>"</span></span> <span class="quoted"><span class="quoted">"Nielson_VCG.vc <span class="skolem">C</span> <span class="free">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> Nielson_VCG.pre <span class="skolem">C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">l</span> <span class="main">(</span>Nielson_VCG.postQ <span class="skolem">C</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> Nielson_VCG.time <span class="skolem">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> vc_complete<span class="main">[</span><span class="operator">OF</span> assms<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"transl <span class="skolem">C</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> C <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?G</span> <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="var">?C</span> <span class="free">e</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> strip_transl vc_transl pre_transl postQ_transl time_transl<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">..</span></span>
<span class="keyword1"><span class="command">qed</span></span>



<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Nielson_Examples">
<div class="head">
<h1>Theory Nielson_Examples</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Nielson_Examples
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Nielson_VCG.html">Nielson_VCG</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹example›</span></span>
  
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True<span class="main">}</span> <span class="keyword1">SKIP</span><span class="main">;;</span> <span class="keyword1">SKIP</span> <span class="main">{</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?T</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True"</span></span>
 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True<span class="main">}</span> strip <span class="main">(</span>Aconseq <span class="var">?T</span> <span class="var">?T</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span>Aseq Askip Askip<span class="main">)</span><span class="main">)</span> <span class="main">{</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True<span class="main">}</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound''<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
 <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>  
  
  
   
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="free">P</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> strip Askip <span class="main">{</span>time Askip <span class="main">⇓</span> <span class="free">P</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="Nielson_Examples-support_single2"><span class="command">lemma</span></span> support_single2<span class="main">:</span> <span class="quoted"><span class="quoted">"support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> support_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True <span class="main">}</span> strip <span class="main">(</span>Aassign <span class="free">a</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span>time <span class="main">(</span>Aassign <span class="free">a</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> support_single2<span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True <span class="main">}</span> strip <span class="main">(</span> <span class="main">(</span><span class="free">a</span> <span class="main">::=</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Askip <span class="main">)</span> <span class="main">{</span>time <span class="main">(</span> <span class="main">(</span><span class="free">a</span> <span class="main">::=</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> Askip <span class="main">)</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="free">a</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> support_single2<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True <span class="main">}</span> strip <span class="main">(</span> <span class="main">(</span><span class="free">a</span> <span class="main">::=</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="free">b</span> <span class="main">::=</span> <span class="main">(</span>V <span class="free">a</span><span class="main">)</span> <span class="main">)</span> <span class="main">{</span>time <span class="main">(</span> <span class="main">(</span><span class="free">a</span> <span class="main">::=</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> <span class="free">b</span> <span class="main">::=</span> <span class="main">(</span>V <span class="free">a</span><span class="main">)</span> <span class="main">)</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="free">b</span> <span class="main">=</span> <span class="main">1</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> support_single2<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span>     
  E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> nat <span class="main">(</span><span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free">I</span><span class="main">,</span><span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="main">(</span><span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> Less <span class="main">(</span>V <span class="free">a</span><span class="main">)</span> <span class="main">(</span>N <span class="numeral">3</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="free">a</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="free">a</span><span class="main">)</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span> <span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">s</span> <span class="free">a</span> <span class="main">⟹</span> time <span class="free">C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="numeral">9</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> C E <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">"Count up to 3"</span></span>

<span class="keyword1" id="Nielson_Examples-example_count_upto_3"><span class="command">lemma</span></span> example_count_upto_3<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> 
  I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="free">a</span> <span class="main">≥</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">-</span> nat <span class="main">(</span><span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">s</span> <span class="free">a</span> <span class="main">≥</span> <span class="numeral">3</span> <span class="keyword1">then</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="bound">s</span><span class="main">(</span><span class="free">a</span><span class="main">:=</span><span class="numeral">3</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free">I</span><span class="main">,</span><span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="main">(</span><span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> Less <span class="main">(</span>V <span class="free">a</span><span class="main">)</span> <span class="main">(</span>N <span class="numeral">3</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="free">a</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="free">a</span><span class="main">)</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span> <span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">s</span> <span class="free">a</span> <span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span>time <span class="free">C</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> C
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I E <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I E <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I S <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> I  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> support_inv<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 


<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">"Count up to b"</span></span>

<span class="keyword1" id="Nielson_Examples-example_count_upto_b"><span class="command">lemma</span></span> example_count_upto_b<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> 
  I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="free">a</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>nat <span class="free">b</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="bound">s</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">s</span> <span class="free">a</span> <span class="main">≥</span> <span class="free">b</span> <span class="keyword1">then</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="bound">s</span><span class="main">(</span><span class="free">a</span><span class="main">:=</span><span class="free">b</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">(</span><span class="free">I</span><span class="main">,</span><span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="main">(</span><span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> Less <span class="main">(</span>V <span class="free">a</span><span class="main">)</span> <span class="main">(</span>N <span class="free">b</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="free">a</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="free">a</span><span class="main">)</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span> <span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">s</span> <span class="free">a</span> <span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span>time <span class="free">C</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> C
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I E S support_inv<span class="main">)</span>

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">" Example: multiplication by repeated addition"</span></span>

<span class="keyword1" id="Nielson_Examples-helper"><span class="command">lemma</span></span> helper<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span><span class="main">::</span>int<span class="main">)</span> <span class="main">*</span> <span class="free">B</span> <span class="main">+</span> <span class="free">B</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">*</span> <span class="free">B</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> distrib_right<span class="main">)</span>
  
<span class="keyword1" id="Nielson_Examples-mult"><span class="command">lemma</span></span> mult<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>  
  I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">≥</span> <span class="main">0</span>  <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span>  <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span>  <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="keyword1">then</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="bound">s</span><span class="main">(</span><span class="inner_quoted">''y''</span><span class="main">:=</span><span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''z''</span><span class="main">:=</span><span class="bound">s</span> <span class="inner_quoted">''a''</span>  <span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span>N <span class="main">0</span><span class="main">)</span><span class="main">;;</span> <span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">;;</span> <span class="main">{</span><span class="main">(</span><span class="free">I</span><span class="main">,</span><span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="main">(</span><span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>  <span class="keyword1">WHILE</span> Less <span class="main">(</span>V <span class="inner_quoted">''z''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''b''</span><span class="main">)</span> <span class="main">;;</span> <span class="inner_quoted">''z''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''z''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>nat<span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span>  <span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> <span class="free">f</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> C 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound''<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I E S distrib_right support_inv f<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> helper<span class="main">)</span>   
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      

<span class="comment1">(* try to use abstraction *)</span>    
<span class="keyword1" id="Nielson_Examples-mult_abstract"><span class="command">lemma</span></span> mult_abstract<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>  
  I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">≥</span> <span class="main">0</span>  <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span>  <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span>  <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  E<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">2</span><span class="main">*</span> <span class="main">(</span><span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  S<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="keyword1">then</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="bound">s</span><span class="main">(</span><span class="inner_quoted">''y''</span><span class="main">:=</span><span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''z''</span><span class="main">:=</span><span class="bound">s</span> <span class="inner_quoted">''a''</span>  <span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  lb<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">lb</span><span class="main">::</span>acom<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">&lt;</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span>  <span class="main">/</span><span class="free">I</span><span class="main">/</span><span class="free">e</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''b''</span><span class="main">)</span> <span class="main">;;</span> <span class="inner_quoted">''z''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''z''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  l<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">l</span><span class="main">::</span>acom<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free">I</span><span class="main">,</span><span class="main">(</span><span class="free">S</span><span class="main">,</span><span class="main">(</span><span class="free">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>  <span class="keyword1">WHILE</span>  <span class="main">(</span>Less <span class="main">(</span>V <span class="inner_quoted">''z''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''a''</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="free">lb</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  e'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e'</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  wl<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">wl</span><span class="main">::</span>acom<span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="free">I</span><span class="main">/</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">I</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">/</span><span class="free">e'</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free">l</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">::</span>acom<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span>N <span class="main">0</span><span class="main">)</span><span class="main">;;</span> <span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">;;</span> <span class="free">wl</span> <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> nat<span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span>  <span class="main">}</span> strip <span class="main">(</span>  <span class="main">{</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">/</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">/</span> <span class="free">f</span><span class="main">}</span> <span class="keyword1">CONSEQ</span> <span class="free">C</span><span class="main">)</span> <span class="main">{</span> <span class="free">f</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> C 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound''<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I E S distrib_right support_inv f e<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> helper<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">100</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">100</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     

<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Example: nested loops›</span></span>

<span class="keyword1" id="Nielson_Examples-nested"><span class="command">lemma</span></span> nested<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>   
    I2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I2</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''b''</span> <span class="main">≥</span> <span class="main">0</span>  <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">&gt;</span>  <span class="bound">s</span> <span class="inner_quoted">''z''</span>  <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span>   <span class="bound">s</span> <span class="inner_quoted">''b''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''g''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''g''</span> <span class="main">≥</span> <span class="main">0</span>  <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span>  <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''g''</span>  <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
 
  I1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">I1</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''b''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">≥</span>  <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">≥</span> <span class="main">0</span>  <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span>  <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span>  <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  
  
  E2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E2</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span> <span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''g''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  S2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S2</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">s</span> <span class="inner_quoted">''g''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''b''</span> <span class="keyword1">then</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="bound">s</span><span class="main">(</span><span class="inner_quoted">''y''</span><span class="main">:=</span><span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span>  <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''b''</span> <span class="main">,</span> <span class="inner_quoted">''g''</span><span class="main">:=</span><span class="bound">s</span> <span class="inner_quoted">''b''</span>  <span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
     
  E1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E1</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="main">(</span> <span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span>  <span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  S1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">S1</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">s</span> <span class="inner_quoted">''z''</span> <span class="main">≥</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="keyword1">then</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="bound">s</span><span class="main">(</span><span class="inner_quoted">''y''</span><span class="main">:=</span><span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">,</span> <span class="inner_quoted">''z''</span><span class="main">:=</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">,</span> <span class="inner_quoted">''g''</span><span class="main">:=</span><span class="bound">s</span> <span class="inner_quoted">''b''</span>  <span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">C</span> <span class="main">=</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> <span class="main">(</span>N <span class="main">0</span><span class="main">)</span><span class="main">;;</span> 
  <span class="inner_quoted">''z''</span> <span class="main">::=</span> <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>
  <span class="main">{</span><span class="main">(</span><span class="free">I1</span><span class="main">,</span><span class="main">(</span><span class="free">S1</span><span class="main">,</span><span class="main">(</span><span class="free">E1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>  <span class="keyword1">WHILE</span> Less <span class="main">(</span>V <span class="inner_quoted">''z''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="keyword1">DO</span>
  <span class="main">(</span>
  <span class="inner_quoted">''g''</span> <span class="main">::=</span> <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">;;</span>                                                 
  <span class="main">(</span>
  <span class="main">{</span><span class="main">(</span><span class="free">I2</span><span class="main">,</span><span class="main">(</span><span class="free">S2</span><span class="main">,</span><span class="main">(</span><span class="free">E2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>  <span class="keyword1">WHILE</span> Less <span class="main">(</span>V <span class="inner_quoted">''g''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''b''</span><span class="main">)</span> <span class="keyword1">DO</span>
  <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span><span class="main">;;</span>
  <span class="inner_quoted">''g''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''g''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span><span class="main">)</span>
  
  <span class="main">)</span> <span class="main">;;</span>  
  <span class="inner_quoted">''z''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''z''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">1</span><span class="main">)</span><span class="main">)</span>
  <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
  f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="numeral">3</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">*</span>nat<span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span><span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> <span class="main">(</span>nat<span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">*</span> nat<span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">≤</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''b''</span> <span class="main">≥</span> <span class="main">0</span>  <span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> <span class="free">f</span> <span class="main">⇓</span> <span class="main">%</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''y''</span> <span class="main">=</span> <span class="bound">s</span> <span class="inner_quoted">''a''</span> <span class="main">*</span> <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> C 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound''<span class="main">)</span> 
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span> 
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span> <span class="comment1">(* outer loop: invariant implies precondition of body *)</span> 
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I1 <span class="keyword1"><span class="command">unfolding</span></span> I2   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="main">)</span>   
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span> <span class="comment1">(* outer loop:  E1 is correct *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I1 S2  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> E2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> E2   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> E1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''a''</span> <span class="main">&gt;</span> <span class="skolem">s</span> <span class="inner_quoted">''z''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''z''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span> <span class="main">≥</span> <span class="main">1</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted">"1"</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">linarith</span> 
        <span class="keyword1"><span class="command">using</span></span> g 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''z''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
        <span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''z''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span>
        "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span>  <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> p<span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">n</span> <span class="bound">na</span><span class="main">.</span> <span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">*</span> <span class="bound">na</span> <span class="main">-</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">n</span> <span class="main">*</span> <span class="main">(</span><span class="bound">na</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2<span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">also</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> z
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''z''</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span> <span class="main">+</span> <span class="main">(</span><span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''a''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''z''</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="numeral">4</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">)</span>›</span></span> add.left_commute diff_add distrib_left mult.right_neutral p<span class="main">)</span>  
      
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
    
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>3 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>  <span class="comment1">(* outer loop: S is preserved *)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="main">∑</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>nat <span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">=</span> int <span class="main">(</span><span class="main">∑</span><span class="main">{</span><span class="main">0</span><span class="main">..</span>nat <span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.last_plus<span class="main">)</span>    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> bla<span class="main">=</span>this
    <span class="keyword1"><span class="command">from</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I1 S1 S2  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  <span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''a''</span> <span class="main">=</span>  <span class="skolem">s</span> <span class="inner_quoted">''z''</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">linarith</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> a<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 1
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left mult.commute fun_upd_twist<span class="main">)</span>     
    <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>4 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span> <span class="comment1">(* outer loop: post condition is correct after exiting the loop *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I1  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>5 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span> <span class="comment1">(* outer loop: time expression is correct after exiting the loop *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I1 E1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>6 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span> <span class="comment1">(* outer loop: S correct if loop guard not fullfilled *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I1 S1 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    
    
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>7 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>  <span class="comment1">(* inner loop: invariant for &gt;0 implies loop guard *)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command">next</span></span> 
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>8 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span> <span class="comment1">(* inner loop:  E1 is correct *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I2    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span>  E2  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>9 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span>  <span class="comment1">(* inner loop: S is preserved *)</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">i</span> <span class="main">::</span> <span class="quoted">int</span> <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"int <span class="main">(</span><span class="main">∑</span><span class="main">{</span><span class="main">0</span><span class="main">..&lt;</span>nat <span class="skolem">i</span><span class="main">}</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">i</span> <span class="main">=</span> int <span class="main">(</span><span class="main">∑</span><span class="main">{</span><span class="main">0</span><span class="main">..</span>nat <span class="skolem">i</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sum.last_plus<span class="main">)</span>    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> bla<span class="main">=</span>this
    <span class="keyword1"><span class="command">from</span></span> 9 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I2   S2  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  <span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
  <span class="keyword1"><span class="command">next</span></span>  
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>10 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span> <span class="comment1">(* inner loop: post condition is correct after exiting the loop *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I2 I1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left mult.commute<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>11 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span> <span class="comment1">(* inner loop: time expression is correct after exiting the loop *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I2 E2 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>12 <span class="skolem">l</span> <span class="skolem">s</span><span class="main">)</span> <span class="comment1">(* inner loop: S correct if loop guard not fullfilled *)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I2 S2 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> I1 C E1 f distrib_left mult.commute<span class="main">)</span>    
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> I1 I2 support_single2<span class="main">)</span>  

   
  
  
  
<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">"with logical variables"</span></span>

<span class="keyword1" id="Nielson_Examples-fin_sup_single"><span class="command">lemma</span></span> fin_sup_single<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">l</span> <span class="free">a</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_single<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">lemmas</span></span> fin_support <span class="main">=</span> fin_sup_single 
  
<span class="keyword1" id="Nielson_Examples-finite_support_and"><span class="command">lemma</span></span> finite_support_and<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>support <span class="free">A</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>support <span class="free">B</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>support <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">A</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> <span class="free">B</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="operator">OF</span> support_and<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Nielson_Sqrt">
<div class="head">
<h1>Theory Nielson_Sqrt</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Nielson_Sqrt
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Nielson_VCGi.html">Nielson_VCGi</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Discrete.html">HOL-Library.Discrete</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
     
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Example: discrete square root in Nielson's logic›</span></span>  
  
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As an example, consider the following program that computes the discrete square root:›</span></span>  
     
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">c</span> <span class="main">::</span> <span class="quoted">com</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span> 
         <span class="inner_quoted">''l''</span><span class="main">::=</span> N <span class="main">0</span> <span class="main">;;</span>
         <span class="inner_quoted">''m''</span> <span class="main">::=</span> N <span class="main">0</span> <span class="main">;;</span>
         <span class="inner_quoted">''r''</span><span class="main">::=</span> Plus <span class="main">(</span>N <span class="main">1</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">;;</span>
         <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span>Less <span class="main">(</span>Plus <span class="main">(</span>N <span class="main">1</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''l''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''r''</span><span class="main">)</span><span class="main">)</span> 
              <span class="keyword1">DO</span> <span class="main">(</span><span class="inner_quoted">''m''</span> <span class="main">::=</span> <span class="main">(</span>Div <span class="main">(</span>Plus <span class="main">(</span>V <span class="inner_quoted">''l''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''r''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>N <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> 
                 <span class="main">(</span><span class="keyword1">IF</span> Not <span class="main">(</span>Less <span class="main">(</span>Times <span class="main">(</span>V <span class="inner_quoted">''m''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''m''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> 
                    <span class="keyword1">THEN</span> <span class="inner_quoted">''l''</span> <span class="main">::=</span> V <span class="inner_quoted">''m''</span>
                    <span class="keyword1">ELSE</span> <span class="inner_quoted">''r''</span> <span class="main">::=</span> V <span class="inner_quoted">''m''</span><span class="main">)</span><span class="main">;;</span>
                 <span class="inner_quoted">''m''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this theory we will show that its running time is in the order of magnitude of the
      logarithm of the variable ''x''›</span></span>  
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹a little lemma we need later for bounding the running time:›</span></span>
  
<span class="keyword1" id="Nielson_Sqrt-absch"><span class="command">lemma</span></span> absch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="numeral">5</span> <span class="main">*</span> <span class="bound">k</span> <span class="main">≤</span> <span class="numeral">96</span> <span class="main">+</span> <span class="numeral">100</span> <span class="main">*</span> Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">state</span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> 
  <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span> "</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">=</span>  <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">≥</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_power_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> one_le_power<span class="main">)</span>          
  <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> nn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">5</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="numeral">96</span> <span class="main">+</span> <span class="numeral">100</span> <span class="main">*</span> Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">≥</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">5</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">*</span> <span class="main">(</span>Discrete.log <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">*</span> Discrete.log <span class="main">(</span><span class="main">1</span> <span class="main">+</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> F<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">5</span> <span class="main">*</span> Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> monoD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> log_mono<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">*</span>  Discrete.log <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_mult_distrib<span class="main">)</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">+</span> <span class="numeral">5</span> <span class="main">*</span> <span class="main">(</span>Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">96</span> <span class="main">+</span> <span class="numeral">100</span> <span class="main">*</span> Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> nn <span class="keyword1"><span class="command">have</span></span> gt1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> F<span class="main">[</span><span class="operator">unfolded</span> gt1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> log_Suc_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def add.right_neutral gt1 i n_not_Suc_n nat_numeral nat_power_eq_Suc_0_iff numeral_2_eq_2 numeral_One<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gt1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>
    
  
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For simplicity we assume, that during the process all segments between ''l'' and ''r'' have
      as length a power of two. This simplifies the analysis.
      To obtain this we choose the precondition P accordingly.

      Now lets show the correctness of our time complexity: the binary search is in O(log ''x'') ›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span>  <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span>  <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> e <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span>  <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      Q<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> True<span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> c <span class="main">{</span> <span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  
  <span class="comment1">― ‹first we create an annotated command›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="inner_quoted">''m''</span> <span class="main">::=</span> 
              <span class="main">(</span>Div <span class="main">(</span>Plus <span class="main">(</span>V <span class="inner_quoted">''l''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''r''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>N <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> 
              <span class="main">(</span><span class="keyword1">IF</span> Not <span class="main">(</span>Less <span class="main">(</span>Times <span class="main">(</span>V <span class="inner_quoted">''m''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''m''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> 
                <span class="keyword1">THEN</span> <span class="inner_quoted">''l''</span> <span class="main">::=</span> V <span class="inner_quoted">''m''</span>
                <span class="keyword1">ELSE</span> <span class="inner_quoted">''r''</span> <span class="main">::=</span> V <span class="inner_quoted">''m''</span><span class="main">)</span><span class="main">;;</span>
              <span class="main">(</span><span class="inner_quoted">''m''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">)</span><span class="main">::</span>acom"</span></span>
  <span class="comment1">― ‹with an Invariant›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="main">::</span> <span class="quoted">assn2</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''l''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">)</span> <span class="main">∧</span> <span class="bound">s</span> <span class="inner_quoted">''l''</span> <span class="main">≥</span> <span class="main">0</span> <span class="main">)</span>"</span></span>
    
  <span class="comment1">― ‹and an time bound annotation for the loop›</span>  
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="main">::</span> <span class="quoted">tbd</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">≡</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="numeral">5</span> <span class="main">*</span> Discrete.log <span class="main">(</span>nat<span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''l''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">S</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> state"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">S</span> <span class="main">≡</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="bound">s</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">Es</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vname <span class="main">⇒</span> vname set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Es</span>  <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
    
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">R</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>assn2<span class="main">*</span><span class="main">(</span>vname set<span class="main">)</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="main">(</span>state<span class="main">⇒</span>state<span class="main">)</span><span class="main">*</span><span class="main">(</span>tbd<span class="main">*</span><span class="main">(</span><span class="main">(</span>vname set<span class="main">*</span><span class="main">(</span>vname <span class="main">⇒</span> vname set<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span><span class="main">=</span><span class="main">(</span><span class="main">(</span><span class="skolem">I</span><span class="main">,</span><span class="main">{</span><span class="inner_quoted">''l''</span><span class="main">,</span><span class="inner_quoted">''r''</span><span class="main">}</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="skolem">S</span><span class="main">,</span><span class="main">(</span><span class="skolem">E</span><span class="main">,</span><span class="main">(</span><span class="main">{</span><span class="inner_quoted">''l''</span><span class="main">,</span><span class="inner_quoted">''r''</span><span class="main">}</span><span class="main">,</span><span class="skolem">Es</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="inner_quoted">''l''</span><span class="main">::=</span> N <span class="main">0</span> <span class="main">;;</span> <span class="main">(</span><span class="inner_quoted">''m''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">)</span> <span class="main">;;</span> <span class="inner_quoted">''r''</span><span class="main">::=</span> Plus <span class="main">(</span>N <span class="main">1</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">;;</span> <span class="main">(</span><span class="main">{</span><span class="skolem">R</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="main">(</span>Less <span class="main">(</span>Plus <span class="main">(</span>N <span class="main">1</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''l''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''r''</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="var">?lb</span><span class="main">)</span>"</span></span>
  
  <span class="comment1">― ‹we show that the annotated command corresponds to the command we are interested in›</span>  
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="var">?C</span> <span class="main">=</span> c"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="comment1">― ‹now we show that the annotated command is correct; here we use the improved VCG and the
      Nielson›</span>
  <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> strip <span class="var">?C</span> <span class="main">{</span><span class="free">e</span>  <span class="main">⇓</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vc_sound''<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>     
    
    <span class="comment1">― ‹A) first lets show the verification conditions:›</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vc <span class="var">?C</span> <span class="free">Q</span> <span class="main">{}</span> <span class="main">{}</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> R_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> vc.simps<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> E_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span><span class="main">::</span><span class="quoted">state</span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">l</span>
      <span class="keyword3"><span class="command">assume</span></span>  I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> I <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="main">::</span> <span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> 3 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr0I <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="skolem">k'</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_pred<span class="main">)</span> 
          
      <span class="keyword1"><span class="command">from</span></span> 3 k' <span class="keyword1"><span class="command">have</span></span> R1<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          R2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>         
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> E1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          E2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>         
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">s</span><span class="main">(</span><span class="inner_quoted">''l''</span> <span class="main">:=</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">,</span> <span class="inner_quoted">''m''</span> <span class="main">:=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
          <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="skolem">l</span> <span class="main">(</span><span class="skolem">s</span><span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">:=</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">,</span> <span class="inner_quoted">''m''</span> <span class="main">:=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 4 <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
          
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">E</span> <span class="main">(</span><span class="skolem">s</span><span class="main">(</span><span class="inner_quoted">''l''</span> <span class="main">:=</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">,</span> <span class="inner_quoted">''m''</span> <span class="main">:=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> E_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">unfolding</span></span> R1 3 k' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span>  <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_power_eq nat_mult_distrib<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">E</span> <span class="main">(</span><span class="skolem">s</span><span class="main">(</span><span class="inner_quoted">''r''</span> <span class="main">:=</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">,</span> <span class="inner_quoted">''m''</span> <span class="main">:=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> E_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">unfolding</span></span> R2 3 k' <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span>  <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_power_eq nat_mult_distrib<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> E_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"Suc <span class="main">0</span> <span class="main">≤</span> <span class="skolem">E</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> E_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>    
  <span class="keyword1"><span class="command">next</span></span>
    <span class="comment1">― ‹B) lets show that the precondition implies the weakest precondition, and that the
            time bound of C can be bounded by log ''x''›</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="var">?C</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">∧</span> time <span class="var">?C</span> <span class="bound">s</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="free">e</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">100</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> P R_def I_def E_def e <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_power_eq absch<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
    <span class="comment1">― ‹last side conditions are proven automatically›</span>
    <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> Q support_inv R_def I_def<span class="main">)</span>
    
  <span class="comment1">― ‹now we conclude with the correctness of the Hoare triple involving the time bound›</span>
  <span class="keyword1"><span class="command">from</span></span> s v <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

  
  



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Quant_Hoare">
<div class="head">
<h1>Theory Quant_Hoare</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Quantitative Hoare Logic (due to Carbonneaux)"</span></span>
<span class="keyword1"><span class="command">theory</span></span> Quant_Hoare
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Big_StepT.html">Big_StepT</a> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Extended_Nat.html">HOL-Library.Extended_Nat</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">eq</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">==</span> <span class="main">(</span>And <span class="main">(</span>Not <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Not <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   
<span class="keyword1"><span class="command">type_synonym</span></span> lvname <span class="main">=</span> <span class="quoted">string</span>
<span class="keyword1"><span class="command">type_synonym</span></span> assn <span class="main">=</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> bool"</span></span> <span class="comment1">(* time bound *)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> qassn <span class="main">=</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> enat"</span></span> <span class="comment1">(* time bound *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The support of an assn2›</span></span>
 

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">state_subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> aexp <span class="main">⇒</span> vname <span class="main">⇒</span> state"</span></span>
  <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">'/</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>1000<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">emb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> enat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">↑</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">emb</span> False <span class="main">=</span> <span class="main">∞</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">emb</span> True <span class="main">=</span> <span class="main">0</span>"</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Validity of quantitative Hoare Triple"</span></span>
  
<span class="comment1">(* this definition refines the definition of validity of normal Hoare Triple for total correctness  *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hoare2_valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"qassn <span class="main">⇒</span> com <span class="main">⇒</span> qassn <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">⟷</span>  <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">≥</span> <span class="bound">p</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Hoare logic for quantiative reasoning"</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hoare2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"qassn <span class="main">⇒</span> com <span class="main">⇒</span> qassn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>

Skip<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> SKIP <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

Assign<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>
       <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span><span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>3</sub></span></span></span> <span class="main"><span class="free">}</span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>
 
While<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>   <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span>bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="main">%</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">t</span> <span class="main">+</span> <span class="main">1</span> <span class="main"><span class="free">}</span></span>   <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span><span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span>  <span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

conseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">s</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span> <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹derived rules›</span></span>

<span class="keyword1" id="Quant_Hoare-strengthen_pre"><span class="command">lemma</span></span> strengthen_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P'</span> <span class="bound">s</span><span class="main">;</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conseq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1" id="Quant_Hoare-weaken_post"><span class="command">lemma</span></span> weaken_post<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">;</span>  <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≥</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conseq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1" id="Quant_Hoare-Assign'"><span class="command">lemma</span></span> Assign'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">≥</span> eSuc <span class="main">(</span> <span class="free">Q</span><span class="main">(</span><span class="bound">s</span><span class="main">[</span><span class="free">a</span><span class="main">/</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">x</span> <span class="main">::=</span> <span class="free">a</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Assign<span class="main"><span class="main">]</span></span><span class="main">)</span>    

<span class="keyword1" id="Quant_Hoare-progress"><span class="command">lemma</span></span> progress<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_t.induct<span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>
    

<span class="keyword1" id="Quant_Hoare-FalseImplies"><span class="command">lemma</span></span> FalseImplies<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">∞</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hoare2.Skip hoare2.Assign hoare2.Seq hoare2.conseq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.conseq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.If<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">∞</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hoare2.If hoare2.conseq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.conseq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.While<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">∞</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.conseq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Soundness"</span></span>

  
  
    
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The soundness theorem:›</span></span>
   
<span class="keyword1" id="Quant_Hoare-help1"><span class="command">lemma</span></span> help1<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">" enat <span class="free">a</span> <span class="main">+</span> <span class="free">X</span> <span class="main">≤</span> <span class="free">Y</span>"</span></span>
    <span class="quoted"><span class="quoted">"enat <span class="free">b</span> <span class="main">+</span> <span class="free">Z</span> <span class="main">≤</span> <span class="free">X</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span><span class="free">a</span> <span class="main">+</span> <span class="free">b</span><span class="main">)</span> <span class="main">+</span> <span class="free">Z</span> <span class="main">≤</span> <span class="free">Y</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab_semigroup_add_class.add_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add_left_mono order_trans plus_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    
<span class="keyword1" id="Quant_Hoare-help2'"><span class="command">lemma</span></span> help2'<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">p</span> <span class="main">+</span> <span class="free">INV</span> <span class="free">t</span>  <span class="main">≤</span> <span class="free">INV</span> <span class="free">s</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">p</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">INV</span> <span class="free">s</span> <span class="main">=</span> enat <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">INV</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">INV</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms iadd_le_enat_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
<span class="keyword1" id="Quant_Hoare-help2"><span class="command">lemma</span></span> help2<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"enat <span class="free">p</span> <span class="main">+</span> <span class="free">INV</span> <span class="free">t</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="free">INV</span> <span class="free">s</span>"</span></span>
     <span class="quoted"><span class="quoted">"<span class="free">INV</span> <span class="free">s</span> <span class="main">=</span> enat <span class="free">n</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">INV</span> <span class="free">t</span> <span class="main">&lt;</span> <span class="free">INV</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms le_less_trans not_less_iff_gr_or_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
  
    
<span class="keyword1" id="Quant_Hoare-Seq_sound"><span class="command">lemma</span></span> Seq_sound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P1</span><span class="main">}</span> <span class="free">C1</span> <span class="main">{</span><span class="free">P2</span><span class="main">}</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P2</span><span class="main">}</span> <span class="free">C2</span> <span class="main">{</span><span class="free">P3</span><span class="main">}</span>"</span></span> 
    <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P1</span><span class="main">}</span> <span class="free">C1</span> <span class="main">;;</span> <span class="free">C2</span> <span class="main">{</span><span class="free">P3</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> hoare2_valid_def                             
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
  <span class="keyword3"><span class="command">assume</span></span> ninfP1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P1</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare2_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">p1</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">⇓</span> <span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p1</span> <span class="main">+</span> <span class="free">P2</span> <span class="skolem">t1</span> <span class="main">≤</span> <span class="free">P1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> ninfP1 <span class="keyword1"><span class="command">have</span></span> ninfP2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P2</span> <span class="skolem">t1</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  <span class="keyword1"><span class="command">with</span></span> assms<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare2_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">p2</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C2</span><span class="main">,</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p2</span> <span class="main">+</span> <span class="free">P3</span> <span class="skolem">t2</span> <span class="main">≤</span> <span class="free">P2</span> <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> ninfP2 <span class="keyword1"><span class="command">have</span></span> ninfP3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P3</span> <span class="skolem">t2</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
  
  <span class="keyword1"><span class="command">from</span></span> Big_StepT.Seq<span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> bigstep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C1</span><span class="main">;;</span> <span class="free">C2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> help1<span class="main">[</span><span class="operator">OF</span> q1 q2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> potential<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span><span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">+</span> <span class="free">P3</span> <span class="skolem">t2</span> <span class="main">≤</span> <span class="free">P1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">C1</span><span class="main">;;</span> <span class="free">C2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> <span class="free">P3</span> <span class="bound">t</span> <span class="main">≤</span> <span class="free">P1</span> <span class="skolem">s</span> "</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">t2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">p1</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">p2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> bigstep potential <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
<span class="keyword1"><span class="command">qed</span></span>    
    
    
<span class="keyword1"><span class="command">theorem</span></span> hoare2_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoare2.induct<span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Skip <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare2_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eSuc_enat_iff eSuc_enat<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">P</span> <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare2_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">s</span></span><span class="main"><span class="main">[</span></span><span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">/</span></span><span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eSuc_enat_iff eSuc_enat<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">P1</span> <span class="skolem">C1</span> <span class="skolem">P2</span> <span class="skolem">C2</span> <span class="skolem">P3</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Seq_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">c1</span> <span class="skolem">Q</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">unfolding</span></span> hoare2_valid_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eSuc <span class="main">(</span><span class="skolem">P</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> enat_ord_simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c1</span> <span class="keyword1">ELSE</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> <span class="skolem">Q</span> <span class="bound">t</span> <span class="main">≤</span> eSuc <span class="main">(</span><span class="skolem">P</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">s</span> <span class="main">+</span> emb <span class="main">(</span>bval <span class="skolem">b</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> If<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare2_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">t</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">P</span> <span class="skolem">s</span> <span class="main">+</span> emb <span class="main">(</span>bval <span class="skolem">b</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> Big_StepT.IfTrue<span class="main">[</span><span class="operator">OF</span> True 1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c1</span> <span class="keyword1">ELSE</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">p</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> q True <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eSuc_enat eSuc_ile_mono iadd_Suc<span class="main">)</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">s</span> <span class="main">+</span> emb <span class="main">(</span><span class="main">~</span> bval <span class="skolem">b</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> If<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare2_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">t</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">P</span> <span class="skolem">s</span> <span class="main">+</span> emb <span class="main">(</span><span class="main">~</span> bval <span class="skolem">b</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> Big_StepT.IfFalse<span class="main">[</span><span class="operator">OF</span> False 1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c1</span> <span class="keyword1">ELSE</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">p</span></span><span class="main"><span class="main">+</span></span><span class="main"><span class="main">1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> q False <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eSuc_enat eSuc_ile_mono iadd_Suc<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>conseq <span class="skolem">P</span> <span class="skolem">c</span> <span class="skolem">Q</span> <span class="skolem">P'</span> <span class="skolem">Q'</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare2_valid_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> conseq<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_less_trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
    <span class="keyword1"><span class="command">with</span></span> conseq<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare2_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
    <span class="keyword1"><span class="command">with</span></span> conseq<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> <span class="skolem">Q'</span> <span class="bound">t</span> <span class="main">≤</span> <span class="skolem">P'</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> add_left_mono dual_order.trans<span class="main">)</span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">INV</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>  
    
  <span class="keyword1"><span class="command">from</span></span> While<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare2_valid_def<span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> WH2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">INV</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> <span class="skolem">INV</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">INV</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute add.left_commute<span class="main">)</span>     
        
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare2_valid_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> ninfINV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> enat_ord_simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">=</span> enat <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_infinity_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
    
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In order to prove validity, we induct on the value of the Invariant, which is a finite number
          and decreases in every loop iteration. For each step we show that validity holds.›</span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">=</span> enat <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">INV</span> <span class="bound">t</span> <span class="main">+</span> emb <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">n</span><span class="main">)</span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command">using</span></span> WhileFalse<span class="main">[</span><span class="operator">OF</span> False<span class="main">]</span> one_enat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="comment1">― ‹obtain the loop body from the outer IH›</span>
        <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>2<span class="main">)</span> WH2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="skolem">INV</span> <span class="skolem">s</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

        <span class="comment1">― ‹prepare premises to ...›</span>
        <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="skolem">INV</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> help2 less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ninfINVt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> enat_ord_simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">=</span> enat <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_infinity_eq
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="comment1">― ‹... obtain the tail of the While loop from the inner IH›</span>
        <span class="keyword1"><span class="command">from</span></span> i ii less<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">p2</span></span>
          <span class="keyword2"><span class="keyword">where</span></span> o2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t2</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">t2</span> <span class="main">+</span> emb <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> ende<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="skolem">b</span> <span class="skolem">t2</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> q2 ninfINVt
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i one_enat_def<span class="main">)</span> 
            
        <span class="comment1">― ‹combine body and tail to one loop unrolling:›</span>
        <span class="comment1">― ‹- the Bigstep Semantic›</span>
        <span class="keyword1"><span class="command">from</span></span> WhileTrue<span class="main">[</span><span class="operator">OF</span> True o o2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> BigStep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="comment1">― ‹- the potentialPreservation›</span>       
        <span class="keyword1"><span class="command">from</span></span> ende q2 <span class="keyword1"><span class="command">have</span></span> q2'<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p2</span> <span class="main">+</span> <span class="skolem">INV</span> <span class="skolem">t2</span> <span class="main">≤</span> <span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        
        <span class="keyword1"><span class="command">have</span></span> potentialPreservation<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">t2</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span>"</span></span>     
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">t2</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span>
            <span class="main">=</span> enat <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">INV</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ende <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> enat <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span> enat <span class="skolem">p2</span> <span class="main">+</span> <span class="skolem">INV</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> enat <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q2'
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab_semigroup_add_class.add_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add_left_mono<span class="main">)</span> 
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.commute add_left_mono eSuc_enat iadd_Suc plus_1_eSuc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">t2</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
            
        <span class="comment1">― ‹finally combine BigStep Semantic and TimeBound›</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">p2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> BigStep potentialPreservation<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> 
       <span class="keyword1"><span class="command">qed</span></span> 
     <span class="keyword1"><span class="command">qed</span></span>  
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">INV</span> <span class="bound">t</span> <span class="main">+</span> emb <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>        
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 



  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Completeness"</span></span>
    
  
<span class="comment1">(* the WeakestPrePotential  *)</span>  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wp2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> qassn <span class="main">⇒</span> qassn"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">wp<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">∞</span><span class="main">)</span>  <span class="keyword1">then</span> enat <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quant_Hoare-wp2_alt"><span class="command">lemma</span></span> wp2_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">↓</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">then</span> enat <span class="main">(</span><span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">Q</span> <span class="main">(</span><span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> bigstepT_the_state wp2_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split<span class="main">)</span>    
    

<span class="keyword1"><span class="command">theorem</span></span> wp2_is_weakestprePotential<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span>  wp2_def hoare2_valid_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">oops</span></span>
  
  
<span class="keyword1" id="Quant_Hoare-wp2_Skip"><span class="command">lemma</span></span> wp2_Skip<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> SKIP <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free">Q</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp2_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SKIPnot<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SKIPp SKIPt<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> one_enat_def plus_1_eSuc<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    

<span class="keyword1" id="Quant_Hoare-wp2_Assign"><span class="command">lemma</span></span> wp2_Assign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free">Q</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp2_def ASSp ASSt ASSnot eSuc_enat<span class="main">)</span> 

   
  
<span class="keyword1" id="Quant_Hoare-wp2_Seq"><span class="command">lemma</span></span> wp2_Seq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wp2_def <span class="comment1">(* what rule is doing: it uses the extensionality (ext) of functions *)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="improper">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> ter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">u</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> bigstepT_the_state<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> bigstepT_the_state<span class="main">[</span><span class="operator">OF</span> ii<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> t2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> bigstepT_the_cost<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> firstcost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p1</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> bigstepT_the_cost<span class="main">[</span><span class="operator">OF</span> ii<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> secondcost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p2</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">have</span></span> totalcost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span><span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bigstepT_the_cost<span class="main">[</span><span class="operator">OF</span> ter<span class="main">]</span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> totalstate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span><span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bigstepT_the_state<span class="main">[</span><span class="operator">OF</span> ter<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ta</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">ta</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">u</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">ta</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">ta</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="keyword1">then</span> enat <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> Ex <span class="main">(</span>big_step_t <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">Q</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">ta</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> c2 if_True<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Q bigstepT_the_state ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 1 if_True t t2 c2 C totalcost totalstate firstcost secondcost<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 2 if_False<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">using</span></span> 2  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
<span class="keyword1"><span class="command">qed</span></span>
   

<span class="keyword1" id="Quant_Hoare-wp2_If"><span class="command">lemma</span></span> wp2_If<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">ELSE</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">if</span> bval <span class="free">b</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp2_def fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x t p i ta ia xa <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> IfTrue<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> bigstepT_the_state<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> IfTrue<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> bigstepT_the_cost<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bigstepT_the_cost bigstepT_the_state<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat<span class="main">)</span>            
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bigstepT_the_state bigstepT_the_cost<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bigstepT_the_state bigstepT_the_cost<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">i</span> <span class="skolem">ta</span> <span class="skolem">ia</span> <span class="skolem">xa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> f<span class="main">=</span> IfFalse<span class="main">[</span><span class="operator">THEN</span> bigstepT_the_state<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quoted"><span class="skolem">xa</span></span> <span class="quoted"><span class="skolem">ta</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">xa</span>"</span></span> <span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> f2<span class="main">=</span> IfFalse<span class="main">[</span><span class="operator">THEN</span> bigstepT_the_cost<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quoted"><span class="skolem">xa</span></span> <span class="quoted"><span class="skolem">ta</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">xa</span>"</span></span> <span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> g<span class="main">=</span> bigstep_det<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f f2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 1 g
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat<span class="main">)</span>   
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bigstepT_the_state bigstepT_the_cost<span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
 

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> wp2WhileTrue<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="free">s</span>  <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> b w <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">⇓</span> <span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ta</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">ta</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">t</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">p2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">ta</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">ta</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="keyword1">then</span> enat <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> Ex <span class="main">(</span>big_step_t <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">Q</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">ta</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">t1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">p1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> g if_True<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span>   bigstepT_the_state bigstepT_the_cost w' q <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="free">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> enat <span class="skolem">p</span> <span class="main">+</span> <span class="free">Q</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wp2_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> h if_True<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bigstepT_the_state<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c<span class="main"><span class="main">]</span></span> bigstepT_the_cost<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c<span class="main"><span class="main">]</span></span> g if_True bigstepT_the_state<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w'<span class="main"><span class="main">]</span></span> bigstepT_the_cost<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w'<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> sum
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def ab_semigroup_add_class.add_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add.commute add.right_neutral eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> plus_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wp2_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> True if_True<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bigstepT_the_state bigstepT_the_cost w <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wp2_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> False if_False<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="free">s</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> wp2WhileTrue'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="free">s</span>  <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> b w <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">⇓</span> <span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">↓</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">↓</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">t1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="free">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> enat <span class="skolem">p</span> <span class="main">+</span> <span class="free">Q</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wp2_alt <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> z if_True<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bigstepT_the_state<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c<span class="main"><span class="main">]</span></span> bigstepT_the_cost<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c<span class="main"><span class="main">]</span></span> z2 if_True bigstepT_the_state<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w'<span class="main"><span class="main">]</span></span> bigstepT_the_cost<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w'<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> sum
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def ab_semigroup_add_class.add_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add.commute add.right_neutral eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> plus_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wp2_alt <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> True if_True<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bigstepT_the_state bigstepT_the_cost w <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">↓</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">↓</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">↓</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">↓</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">with</span></span> A P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">↓</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bigstepT_the_state <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">s''</span></span> <span class="keyword2"><span class="keyword">where</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span><span class="skolem">s'</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">t'</span> <span class="main">⇓</span> <span class="skolem">s''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">1</span><span class="main">+</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">t'</span> <span class="main">⇓</span> <span class="skolem">s''</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> WhileTrue<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> b A B <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">↓</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">↓</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span><span class="main">↓</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp2_alt <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> if_False False<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp2_alt <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> if_False False<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> wp2WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">Q</span> <span class="free">s</span>  <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> b <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span>Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span> <span class="main">=</span>  <span class="free">Q</span> <span class="free">s</span>  <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wp2_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> True if_True<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> w c bigstepT_the_cost bigstepT_the_state <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_enat_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wp2_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> False if_False<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 
    
<span class="keyword1" id="Quant_Hoare-thet_WhileFalse"><span class="command">lemma</span></span> thet_WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="free">b</span> <span class="free">s</span> <span class="main">⟹</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1" id="Quant_Hoare-thes_WhileFalse"><span class="command">lemma</span></span> thes_WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="free">b</span> <span class="free">s</span> <span class="main">⟹</span> <span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> wp2WhileFalse'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="free">s</span>  <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> b <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">↓</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp2_alt <span class="keyword1"><span class="command">using</span></span> b <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> T if_True<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> thet_WhileFalse thes_WhileFalse one_enat_def<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span> 
  
  
<span class="comment1">(* note that ≤ is sufficient for the completness proof *)</span>
<span class="keyword1" id="Quant_Hoare-wp2While"><span class="command">lemma</span></span> wp2While<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> bval <span class="free">b</span> <span class="free">s</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="free">s</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="free">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span>"</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="free">s</span>"</span></span><span class="main">)</span>      
  <span class="keyword1"><span class="command">using</span></span> wp2WhileTrue' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">using</span></span> wp2WhileFalse' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
 
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Q</span><span class="main">.</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="bound">Q</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="bound">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?I</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> bval <span class="free">b</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="bound">s</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="var">?I</span> <span class="bound">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="free">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?I</span> <span class="bound">t</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">using</span></span> wp2While <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">from</span></span> hoare2.While<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?I</span>"</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="var">?I</span> <span class="bound">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="free">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="main">λ</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="var">?I</span> <span class="bound">t</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="main">⟹</span>
          <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="var">?I</span> <span class="bound">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="var">?I</span> <span class="bound">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="free">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">from</span></span> C<span class="main">[</span><span class="operator">OF</span> B<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="var">?I</span> <span class="bound">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="var">?I</span> <span class="bound">s</span><span class="main">)</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="free">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>                           
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> D<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> wp2While <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
                            

<span class="keyword1" id="Quant_Hoare-wp2_is_pre"><span class="command">lemma</span></span> wp2_is_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="free">Q</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> SKIP <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hoare2.Skip<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Assign <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>hoare2.Assign<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Seq <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>hoare2.Seq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">x1</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">Q</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> hoare2.If <span class="main">)</span>  
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.conseq<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.conseq<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span>       
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.While<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">if</span></span> bval <span class="skolem"><span class="skolem">b</span></span> <span class="bound"><span class="bound">s</span></span> <span class="keyword1"><span class="keyword1">then</span></span> <span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">WHILE</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">DO</span></span> <span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">Q</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">s</span></span> <span class="keyword1"><span class="keyword1">else</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>       
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span>        
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> While<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">WHILE</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">DO</span></span> <span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">Q</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>      
    <span class="keyword1"><span class="command">using</span></span> wp2While <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>       
<span class="keyword1"><span class="command">qed</span></span>
  
  
  
<span class="keyword1" id="Quant_Hoare-wp2_is_weakestprePotential1"><span class="command">lemma</span></span> wp2_is_weakestprePotential1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hoare2_valid_def wp2_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">i</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p'</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p'</span> <span class="main">+</span> <span class="free">Q</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bigstepT_the_state<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span> bigstepT_the_cost<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span> ii<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>  
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">force</span>
  
<span class="keyword1" id="Quant_Hoare-wp2_is_weakestprePotential2"><span class="command">lemma</span></span> wp2_is_weakestprePotential2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hoare2_valid_def wp2_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span> <span class="skolem">i</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">=</span> enat <span class="bound">i</span><span class="main">)</span> <span class="keyword1">then</span> enat <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> Ex <span class="main">(</span>big_step_t <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">Q</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span> <span class="main">≤</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">i</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">=</span> enat <span class="bound">i</span><span class="main">)</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> True A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> <span class="free">Q</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bigstepT_the_cost<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span> bigstepT_the_state<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span> <span class="main">∧</span> enat <span class="skolem">p</span> <span class="main">+</span> <span class="free">Q</span> <span class="skolem">t</span> <span class="main">≤</span> enat <span class="skolem">i</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> A <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span> <span class="main">≥</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>   
<span class="keyword1"><span class="command">qed</span></span>
          
<span class="keyword1"><span class="command">theorem</span></span> wp2_is_weakestprePotential<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">c</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span>   wp2_is_weakestprePotential2  wp2_is_weakestprePotential1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

   
   
<span class="keyword1"><span class="command">theorem</span></span> hoare2_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>  
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wp2_is_pre<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
<span class="keyword1"><span class="command">using</span></span> wp2_is_weakestprePotential1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

 


<span class="keyword1"><span class="command">corollary</span></span> hoare2_sound_complete<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hoare2_sound hoare2_complete<span class="main">)</span>



<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Quant_VCG">
<div class="head">
<h1>Theory Quant_VCG</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Verification Condition Generator"</span></span>
<span class="keyword1"><span class="command">theory</span></span> Quant_VCG
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Quant_Hoare.html">Quant_Hoare</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">datatype</span></span> acom <span class="main">=</span>
  Askip                  <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">SKIP</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span> <span class="main">|</span>
  Aassign <span class="quoted">vname</span> <span class="quoted">aexp</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">::=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>1000<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Aseq   <span class="quoted">acom</span> <span class="quoted">acom</span>       <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span>  <span class="main">[</span>60<span class="main">,</span> 61<span class="main">]</span> 60<span class="main">)</span> <span class="main">|</span>
  Aif <span class="quoted">bexp</span> <span class="quoted">acom</span> <span class="quoted">acom</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">IF</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">THEN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">ELSE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Awhile <span class="quoted">qassn</span> <span class="quoted">bexp</span> <span class="quoted">acom</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">WHILE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">DO</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> com.SKIP <span class="main">(</span><span class="quoted">"<span class="keyword1">SKIP</span>"</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">strip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> com"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="keyword1">SKIP</span> <span class="main">=</span> <span class="keyword1">SKIP</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pre</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> qassn <span class="main">⇒</span> qassn"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span>  <span class="keyword1">else</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span>  <span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
   
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> qassn <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span>pre <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>  
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span>  <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>pre <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span>bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Soundness of VCG"</span></span>
  
<span class="keyword1" id="Quant_VCG-vc_sound"><span class="command">lemma</span></span> vc_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">Q</span> <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span>pre <span class="free">C</span> <span class="free">Q</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">b</span> <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Aif1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span>pre <span class="skolem">C1</span> <span class="skolem">Q</span><span class="main">}</span> strip <span class="skolem">C1</span> <span class="main">{</span><span class="skolem">Q</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Aif2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">}</span> strip <span class="skolem">C2</span> <span class="main">{</span><span class="skolem">Q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.conseq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.If<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> bval <span class="skolem"><span class="skolem">b</span></span> <span class="bound"><span class="bound">s</span></span> <span class="keyword1"><span class="keyword1">then</span></span> pre <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">s</span></span> <span class="keyword1"><span class="keyword1">else</span></span> pre <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">Q</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.conseq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> Aif1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.conseq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> Aif2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">I</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">Q</span><span class="main">.</span> vc <span class="skolem">C</span> <span class="bound">Q</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span>pre <span class="skolem">C</span> <span class="bound">Q</span><span class="main">}</span> strip <span class="skolem">C</span> <span class="main">{</span><span class="bound">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="bound">s</span> <span class="main">≤</span>  <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     
  <span class="keyword1"><span class="command">from</span></span> i iii <span class="keyword1"><span class="command">have</span></span>  A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span>pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> strip <span class="skolem">C</span> <span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
  <span class="keyword1"><span class="command">have</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> strip <span class="skolem">C</span> <span class="main">{</span><span class="skolem">Q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.conseq<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.While<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">I</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.conseq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hoare2.Skip hoare2.Assign hoare2.Seq <span class="main">)</span>
  
  
<span class="keyword1" id="Quant_VCG-vc_sound'"><span class="command">lemma</span></span> vc_sound'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>vc <span class="free">C</span> <span class="free">Q</span> <span class="main">;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2.conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Completeness"</span></span>
  
<span class="keyword1" id="Quant_VCG-pre_mono"><span class="command">lemma</span></span> pre_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="free">C</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">≤</span> pre <span class="free">C</span> <span class="free">P</span> <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">P'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>    
    
    
<span class="keyword1" id="Quant_VCG-vc_mono"><span class="command">lemma</span></span> vc_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">P</span> <span class="main">⟹</span> vc <span class="free">C</span> <span class="free">P'</span>"</span></span>    
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">P'</span></span><span class="main">)</span>  
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">I</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_mono<span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_mono<span class="main">)</span>
    
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">C</span><span class="main">.</span> strip <span class="bound">C</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∧</span> vc <span class="bound">C</span> <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="bound">C</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span>   <span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?G</span> <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoare2.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Skip <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?C</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> Askip"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">P</span> <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?C</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span><span class="main">(</span>Aassign <span class="skolem">x</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip1<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C1</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="skolem">Q</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip2<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C2</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc2<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">IF</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">THEN</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword1"><span class="keyword1">ELSE</span></span> <span class="skolem"><span class="skolem">C2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> strip1 strip2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> vc1 vc2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command">using</span></span> pre1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> pre2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip1<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C1</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">s</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip2<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C2</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc2<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">s</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">s</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"pre <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> pre_mono<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> pre2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> pre1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> pre <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">C1</span></span> <span class="main"><span class="main">;;</span></span> <span class="skolem"><span class="skolem">C2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> strip1 strip2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> vc1 vc2 vc_mono pre2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>      
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">I</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> While<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">I</span></span><span class="main"><span class="main">}</span></span> <span class="keyword1"><span class="keyword1">WHILE</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">DO</span></span> <span class="skolem"><span class="skolem">C</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> strip <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pre vc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>conseq <span class="skolem">P</span> <span class="skolem">c</span> <span class="skolem">Q</span> <span class="skolem">P'</span> <span class="skolem">Q'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">P</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   
  <span class="keyword1"><span class="command">from</span></span> pre_mono<span class="main">[</span><span class="operator">OF</span> conseq<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Q'</span> <span class="bound">s</span> <span class="main">≤</span> pre <span class="skolem">C</span> <span class="skolem">Q</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> vc conseq<span class="main">(</span>3<span class="main">)</span> vc_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pre conseq<span class="main">(</span>2<span class="main">)</span> 1 <span class="keyword1"><span class="command">using</span></span> order.trans  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
     
  
  
  
    
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Quant_Examples">
<div class="head">
<h1>Theory Quant_Examples</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Examples"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Quant_Examples
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Quant_VCG.html">Quant_VCG</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sum</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">sum</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">wsum</span> <span class="main">==</span>
  <span class="keyword1">WHILE</span> Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span>
  <span class="keyword1">DO</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">;;</span>
      <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="Quant_Examples-example"><span class="command">lemma</span></span> example<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> wsum <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> While<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> enat <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">3</span></span> <span class="main"><span class="main">*</span></span> nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign'<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> Suc_eq_plus1 Suc_nat_eq_nat_zadd1 distrib_left_numeral eSuc_numeral enat_numeral eq_iff iadd_Suc_right nat_mult_1_right one_add_one plus_1_eSuc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Quant_Examples-example_sound"><span class="command">lemma</span></span> example_sound<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> wsum <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare2_sound<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> example<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Examples for the use of the VCG›</span></span>
      
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Wsum</span> <span class="main">==</span>  
  <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span>
  <span class="keyword1">DO</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">;;</span>
      <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> wsum <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> strip <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> Wsum<span class="main">)</span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> Suc_eq_plus1 Suc_nat_eq_nat_zadd1 distrib_left_numeral eSuc_numeral enat_numeral eq_iff iadd_Suc_right nat_mult_1_right one_add_one plus_1_eSuc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>          
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>          
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>          
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>          
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>      
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="QuantK_Hoare">
<div class="head">
<h1>Theory QuantK_Hoare</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Quantitative Hoare Logic (big-O style)›</span></span>

<span class="keyword1"><span class="command">theory</span></span> QuantK_Hoare
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Big_StepT.html">Big_StepT</a> <a href="../../HOL/HOL/Complex_Main.html">Complex_Main</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Extended_Nat.html">HOL-Library.Extended_Nat</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">eq</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">==</span> <span class="main">(</span>And <span class="main">(</span>Not <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>Not <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   
<span class="keyword1"><span class="command">type_synonym</span></span> lvname <span class="main">=</span> <span class="quoted">string</span>
<span class="keyword1"><span class="command">type_synonym</span></span> assn <span class="main">=</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> bool"</span></span> <span class="comment1">(* time bound *)</span>
<span class="keyword1"><span class="command">type_synonym</span></span> qassn <span class="main">=</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> enat"</span></span> <span class="comment1">(* time bound *)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The support of an assn2›</span></span>
 
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">state_subst</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> aexp <span class="main">⇒</span> vname <span class="main">⇒</span> state"</span></span>
  <span class="main">(</span><span class="quoted">"_<span class="keyword1">[</span>_<span class="keyword1">'/</span>_<span class="keyword1">]</span>"</span> <span class="main">[</span>1000<span class="main">,</span>0<span class="main">,</span>0<span class="main">]</span> 999<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main"><span class="free">[</span></span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main"><span class="free">/</span></span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main"><span class="free">]</span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">:=</span> aval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">emb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> enat"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">↑</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">emb</span> False <span class="main">=</span> <span class="main">∞</span>"</span></span>
 <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">emb</span> True <span class="main">=</span> <span class="main">0</span>"</span></span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Definition of Validity"</span></span>
  
<span class="comment1">(* this definition refines the normal Hoare Triple Validity *)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hoare2o_valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"qassn <span class="main">⇒</span> com <span class="main">⇒</span> qassn <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub>'</span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">⟷</span>  <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> enat <span class="bound">k</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">≥</span> <span class="bound">p</span> <span class="main">+</span> enat <span class="bound">k</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Hoare Rules"</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hoareQ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"qassn <span class="main">⇒</span> com <span class="main">⇒</span> qassn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub>'</span> <span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>

Skip<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> SKIP <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

Assign<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>
       <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span><span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>3</sub></span></span></span> <span class="main"><span class="free">}</span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>
 
While<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>   <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span>bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="main">%</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">t</span> <span class="main">+</span> <span class="main">1</span> <span class="main"><span class="free">}</span></span>   <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span><span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span>  <span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

conseq<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">≤</span> enat <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">*</span>  <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">s</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> enat <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span> 
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Derived Rules›</span></span>

<span class="keyword1" id="QuantK_Hoare-const"><span class="command">lemma</span></span> const<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="free">k</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">s</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="free">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">}</span><span class="main">;</span>  <span class="free">k</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hoareQ'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"qassn <span class="main">⇒</span> com <span class="main">⇒</span> qassn <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>Z</sub></span> <span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>

ZSkip<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> SKIP <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

ZAssign<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

ZIf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span><span class="main">;</span>
       <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span><span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

ZSeq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>3</sub></span></span></span> <span class="main"><span class="free">}</span></span><span class="main">⟧</span> <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P<span class="hidden">⇩</span><sub>3</sub></span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>
 
ZWhile<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>   <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span>bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="main">%</span><span class="bound">t</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">t</span> <span class="main">+</span> <span class="main">1</span> <span class="main"><span class="free">}</span></span>   <span class="main">⟧</span>
   <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span><span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span>  <span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

Zconseq'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">≤</span>  <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">s</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span> <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>   <span class="main">|</span>
   
Zconst<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span><span class="main"><span class="free">}</span></span><span class="main">;</span>  <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>Z</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  
    

<span class="keyword1" id="QuantK_Hoare-Zconseq"><span class="command">lemma</span></span> Zconseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">≤</span> enat <span class="free">k</span> <span class="main">*</span>  <span class="free">P'</span> <span class="bound">s</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> enat <span class="free">k</span> <span class="main">*</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">;</span> <span class="free">k</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="keyword1">⊢<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Zconst<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">k</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">P'</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">c</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Q'</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Zconseq'<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">P</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    
<span class="keyword1" id="QuantK_Hoare-ZQ"><span class="command">lemma</span></span> ZQ<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="keyword1">⊢<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span> <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoareQ'.induct<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hoareQ.Skip  hoareQ.Assign hoareQ.If hoareQ.Seq hoareQ.While<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> conseq<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> one_enat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> k P c Q  <span class="keyword1"><span class="command">using</span></span> const <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1" id="QuantK_Hoare-QZ"><span class="command">lemma</span></span> QZ<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span> <span class="main">⟹</span>  <span class="keyword1">⊢<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoareQ.induct<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ZSkip  ZAssign ZIf ZSeq ZWhile <span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> Zconseq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      
<span class="keyword1" id="QuantK_Hoare-QZ_iff"><span class="command">lemma</span></span> QZ_iff<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span> <span class="main">⟷</span>  <span class="keyword1">⊢<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span>   
<span class="keyword1"><span class="command">using</span></span> ZQ QZ <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>      

  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Soundness"</span></span>

<span class="keyword1" id="QuantK_Hoare-enatSuc0"><span class="command">lemma</span></span> enatSuc0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">*</span> <span class="free">x</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> one_enat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
 
    
<span class="keyword1"><span class="command">theorem</span></span> hoareQ_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>  <span class="main">⟹</span>  <span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> hoare2o_valid_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span>  <span class="operator">induction</span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoareQ.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Skip <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">s</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>    
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.left_neutral add.right_neutral eSuc_enat iadd_Suc le_iff_add zero_enat_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">P</span> <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">s</span></span><span class="main"><span class="main">[</span></span><span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">/</span></span><span class="skolem"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.left_neutral add.right_neutral  eSuc_enat iadd_Suc le_iff_add zero_enat_def<span class="main">)</span>      
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">P1</span> <span class="skolem">C1</span> <span class="skolem">P2</span> <span class="skolem">C2</span> <span class="skolem">P3</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="keyword2"><span class="keyword">where</span></span> Seq3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P1</span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C1</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">P2</span> <span class="bound">t</span> <span class="main">≤</span> enat <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">P1</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> Seq4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P2</span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">P3</span> <span class="bound">t</span> <span class="main">≤</span> enat <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">P2</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?k</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"lcm <span class="skolem">k1</span> <span class="skolem">k2</span>"</span></span> <span class="comment1">(* or k1*k2 *)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var">?k</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> 10 20 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lcm <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> lcm_pos_nat<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> ninfP1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> Seq3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">⇓</span> <span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q1<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">P2</span> <span class="skolem">t1</span> <span class="main">≤</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">P1</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> ninfP1 <span class="keyword1"><span class="command">have</span></span> ninfP2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="skolem">t1</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_le 10 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">with</span></span> Seq4 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C2</span><span class="main">,</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p2</span> <span class="main">+</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">P3</span> <span class="skolem">t2</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">P2</span> <span class="skolem">t1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> ninfP2 <span class="keyword1"><span class="command">have</span></span> ninfP3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P3</span> <span class="skolem">t2</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> not_le 20  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u2</span></span> <span class="keyword2"><span class="keyword">where</span></span> u2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P3</span> <span class="skolem">t2</span> <span class="main">=</span> enat <span class="skolem">u2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ninfP2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> u1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P2</span> <span class="skolem">t1</span> <span class="main">=</span> enat <span class="skolem">u1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> ninfP1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u0</span></span> <span class="keyword2"><span class="keyword">where</span></span> u0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P1</span> <span class="skolem">s</span> <span class="main">=</span> enat <span class="skolem">u0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> Big_StepT.Seq<span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span><span class="main">+</span><span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> 10 20 <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Divides.div_positive<span class="main">)</span>
        
    <span class="keyword1"><span class="command">have</span></span> za<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k1</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k2</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lcm_nat_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dvd_div_mult<span class="main">)</span>
        
    <span class="keyword1"><span class="command">have</span></span> za2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?k</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k2</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">k1</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> lcm_nat_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dvd_div_mult gcd_dvd2 mult.commute<span class="main">)</span>
        
    <span class="keyword1"><span class="command">from</span></span> q1<span class="main">[</span><span class="operator">unfolded</span> u1 u2 u0<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">u1</span> <span class="main">≤</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">u0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> q2<span class="main">[</span><span class="operator">unfolded</span> u1 u2 u0<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"  <span class="skolem">p2</span> <span class="main">+</span> <span class="skolem">k2</span> <span class="main">*</span>   <span class="skolem">u2</span> <span class="main">≤</span> <span class="skolem">k2</span> <span class="main">*</span>   <span class="skolem">u1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span><span class="main">+</span><span class="skolem">p2</span> <span class="main">+</span> <span class="var">?k</span> <span class="main">*</span> <span class="skolem">u2</span> <span class="main">≤</span> <span class="skolem">p1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k1</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="skolem">p2</span>  <span class="main">+</span> <span class="var">?k</span> <span class="main">*</span> <span class="skolem">u2</span>  "</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">k2</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="skolem">p1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k1</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="skolem">p2</span>  <span class="main">+</span> <span class="var">?k</span> <span class="main">*</span> <span class="skolem">u2</span>  "</span></span> <span class="keyword1"><span class="command">using</span></span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>                                      
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k2</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="skolem">p1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k1</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">p2</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">*</span> <span class="skolem">u2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> za<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>  
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">k2</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="skolem">p1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k1</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">k2</span> <span class="main">*</span>   <span class="skolem">u1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> y
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_left_mono distrib_left le_iff_add<span class="main">)</span>   
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k2</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="skolem">p1</span> <span class="main">+</span> <span class="var">?k</span> <span class="main">*</span> <span class="skolem">u1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> za<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k2</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="skolem">p1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k2</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">*</span><span class="main">(</span><span class="skolem">k1</span><span class="main">*</span> <span class="skolem">u1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> za2<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">k2</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">*</span><span class="skolem">u1</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">k2</span> <span class="keyword1">div</span> gcd <span class="skolem">k1</span> <span class="skolem">k2</span><span class="main">)</span><span class="main">*</span><span class="main">(</span><span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">u0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> z  
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="var">?k</span> <span class="main">*</span> <span class="skolem">u0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> za2<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span>   
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span><span class="main">+</span><span class="skolem">p2</span> <span class="main">+</span> <span class="var">?k</span> <span class="main">*</span> <span class="skolem">u2</span> <span class="main">≤</span> <span class="var">?k</span> <span class="main">*</span> <span class="skolem">u0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span><span class="skolem">p1</span><span class="main">+</span><span class="skolem">p2</span><span class="main">)</span> <span class="main">+</span> <span class="var">?k</span> <span class="main">*</span> <span class="skolem">P3</span> <span class="skolem">t2</span> <span class="main">≤</span> <span class="var">?k</span> <span class="main">*</span> <span class="skolem">P1</span> <span class="skolem">s</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> u0 u2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
    <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C1</span><span class="main">;;</span> <span class="skolem">C2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> <span class="var">?k</span> <span class="main">*</span> <span class="skolem">P3</span> <span class="bound">t</span> <span class="main">≤</span> <span class="var">?k</span> <span class="main">*</span> <span class="skolem">P1</span> <span class="skolem">s</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">c1</span> <span class="skolem">Q</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kT</span></span> <span class="keyword2"><span class="keyword">where</span></span> If3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="bound">t</span> <span class="main">≤</span> enat <span class="skolem">kT</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">P</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">kT</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">kF</span></span> <span class="keyword2"><span class="keyword">where</span></span> If4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">kF</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="bound">t</span> <span class="main">≤</span> enat <span class="skolem">kF</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">P</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">kF</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">kT</span></span><span class="main"><span class="main">*</span></span><span class="skolem"><span class="skolem">kF</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> T F <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"eSuc <span class="main">(</span><span class="skolem">P</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> enat_ord_simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u0</span></span> <span class="keyword2"><span class="keyword">where</span></span> u0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">s</span> <span class="main">=</span> enat <span class="skolem">u0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c1</span> <span class="keyword1">ELSE</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="bound">t</span> <span class="main">≤</span> enat <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> eSuc <span class="main">(</span><span class="skolem">P</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">s</span> <span class="main">+</span> emb <span class="main">(</span>bval <span class="skolem">b</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> If3 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c1</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> enat <span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">≤</span> enat <span class="skolem">kT</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">P</span> <span class="skolem">s</span> <span class="main">+</span> emb <span class="main">(</span>bval <span class="skolem">b</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> Big_StepT.IfTrue<span class="main">[</span><span class="operator">OF</span> True 1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c1</span> <span class="keyword1">ELSE</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
           
      <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i T True
        <span class="keyword1"><span class="command">using</span></span> less_irrefl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> u1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">=</span> enat <span class="skolem">u1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> q True <span class="keyword1"><span class="command">have</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">u1</span> <span class="main">≤</span> <span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">u0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u0 u1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span>  <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">u1</span> <span class="main">≤</span> <span class="skolem">kF</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">u1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_eq_if<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">kF</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span>  <span class="main">+</span> <span class="skolem">kT</span>  <span class="main">*</span> <span class="skolem">u1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib2<span class="main">)</span>  
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">kF</span><span class="main">*</span><span class="main">(</span><span class="main">1</span>  <span class="main">+</span> <span class="skolem">kT</span>  <span class="main">*</span> <span class="skolem">u0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> q' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> Suc <span class="skolem">u0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span>  <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">u1</span> <span class="main">≤</span>  <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> Suc <span class="skolem">u0</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> enat <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">≤</span> enat <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> eSuc <span class="main">(</span><span class="skolem">P</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> u1 u0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> i <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">s</span> <span class="main">+</span> emb <span class="main">(</span><span class="main">~</span>bval <span class="skolem">b</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> If4 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> enat <span class="skolem">kF</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">≤</span> enat <span class="skolem">kF</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">P</span> <span class="skolem">s</span> <span class="main">+</span> emb <span class="main">(</span><span class="main">~</span>bval <span class="skolem">b</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> Big_StepT.IfFalse<span class="main">[</span><span class="operator">OF</span> False 1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">c1</span> <span class="keyword1">ELSE</span> <span class="skolem">c2</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">+</span> <span class="main">1</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
           
      <span class="keyword1"><span class="command">from</span></span> q <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i F False
        <span class="keyword1"><span class="command">using</span></span> less_irrefl <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u1</span></span> <span class="keyword2"><span class="keyword">where</span></span> u1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">=</span> enat <span class="skolem">u1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> q False <span class="keyword1"><span class="command">have</span></span> q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="skolem">kF</span> <span class="main">*</span> <span class="skolem">u1</span> <span class="main">≤</span> <span class="skolem">kF</span> <span class="main">*</span> <span class="skolem">u0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> u0 u1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span>  <span class="main">(</span><span class="skolem">kF</span> <span class="main">*</span> <span class="skolem">kT</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">u1</span> <span class="main">≤</span> <span class="skolem">kT</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">kF</span> <span class="main">*</span> <span class="skolem">kT</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">u1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> T 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult_eq_if<span class="main">)</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">kT</span><span class="main">*</span><span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span>  <span class="main">+</span> <span class="skolem">kF</span>  <span class="main">*</span> <span class="skolem">u1</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_mult_distrib2<span class="main">)</span>  
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">kT</span><span class="main">*</span><span class="main">(</span><span class="main">1</span>  <span class="main">+</span> <span class="skolem">kF</span>  <span class="main">*</span> <span class="skolem">u0</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> q' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">kF</span> <span class="main">*</span> <span class="skolem">kT</span><span class="main">)</span> <span class="main">*</span> Suc <span class="skolem">u0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> F <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">finally</span></span> 
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span>  <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">u1</span> <span class="main">≤</span>  <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> Suc <span class="skolem">u0</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mult.commute<span class="main">)</span> 
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span><span class="skolem">p</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> enat <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">≤</span> enat <span class="main">(</span><span class="skolem">kT</span> <span class="main">*</span> <span class="skolem">kF</span><span class="main">)</span> <span class="main">*</span> eSuc <span class="main">(</span><span class="skolem">P</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> u1 u0 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>conseq <span class="skolem">P</span> <span class="skolem">c</span> <span class="skolem">Q</span> <span class="skolem">k1</span> <span class="skolem">P'</span> <span class="skolem">Q'</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> conseq<span class="main">(</span>5<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> c4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="bound">t</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">P</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">*</span></span><span class="skolem"><span class="skolem">k1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span><span class="skolem">k1</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 0 conseq<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> conseq<span class="main">(</span>2<span class="main">,</span>4<span class="main">)</span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> le_less_trans
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> enat.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> enat_ord_simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> imult_is_infinity<span class="main">)</span>  
    <span class="keyword1"><span class="command">with</span></span> c4 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="skolem">t</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>   
               
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> enat <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">k1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q'</span> <span class="skolem">t</span> <span class="main">=</span> enat <span class="skolem">p</span> <span class="main">+</span> enat <span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="main">(</span> <span class="main">(</span>enat <span class="skolem">k1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q'</span> <span class="skolem">t</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc times_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>       
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> enat <span class="skolem">p</span> <span class="main">+</span> enat <span class="main">(</span><span class="skolem">k</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conseq<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add_left_mono distrib_left le_iff_add<span class="main">)</span>  
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> enat <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">k1</span><span class="main">)</span>  <span class="main">*</span> <span class="skolem">P'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> conseq<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> mult.assoc mult_left_mono not_less not_less_zero times_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> enat <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">k1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q'</span> <span class="skolem">t</span> <span class="main">≤</span> enat <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">k1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">P'</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">k1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">Q'</span> <span class="bound">t</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">k1</span><span class="main">)</span> <span class="main">*</span> <span class="skolem">P'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">INV</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> W2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">INV</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> g0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> ninfINV<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> enat_ord_simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">=</span> enat <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_infinity_eq
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
    
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">=</span> enat <span class="skolem">n</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="bound">t</span> <span class="main">+</span> emb <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">s</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">n</span><span class="main">)</span> 
      
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"Suc <span class="main"><span class="main">0</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> WhileFalse<span class="main"><span class="main">[</span></span><span class="operator">OF</span> False<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> False 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_enat_def<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> g0
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def Suc_ile_eq add.commute add_left_mono distrib_left enat_0_iff<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mult.right_neutral not_gr_zero one_enat_def<span class="main">)</span>    
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>2<span class="main">)</span> W2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="bound">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">INV</span> <span class="skolem">s</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> o bigstep_progress <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
             
            
        <span class="keyword1"><span class="command">from</span></span> q  <span class="keyword1"><span class="command">have</span></span> pf<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">INV</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> dual_order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>2<span class="main">)</span> 
          <span class="keyword1"><span class="command">using</span></span> g0 not_le <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">invt</span></span> <span class="keyword2"><span class="keyword">where</span></span> invt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">=</span> enat <span class="skolem">invt</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> pf g0 <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">t</span>  <span class="main">&lt;</span> <span class="skolem">INV</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> less<span class="main">(</span>2<span class="main">)</span> invt
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> Suc_ile_eq add.commute eSuc_enat enat_ord_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> nat_mult_le_cancel_disj plus_1_eSuc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> times_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
              
              
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ninfINVt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> less<span class="main">(</span>2<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> enat_ord_simps<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">=</span> enat <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> not_infinity_eq
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">with</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n'</span> <span class="main">&lt;</span> <span class="skolem">n</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> g <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> i ii less<span class="main">(</span>1<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t2</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> o2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q2<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p2</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">t2</span> <span class="main">+</span> emb <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="skolem">t2</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span> <span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">have</span></span> ende<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="skolem">b</span> <span class="skolem">t2</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> q2 g0 ninfINVt
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> i one_enat_def<span class="main">)</span> 
        <span class="keyword1"><span class="command">from</span></span> WhileTrue<span class="main">[</span><span class="operator">OF</span> True o o2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       
        <span class="keyword1"><span class="command">from</span></span> ende q2 <span class="keyword1"><span class="command">have</span></span> q2'<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p2</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">INV</span> <span class="skolem">t2</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="main"><span class="main">+</span></span> <span class="skolem"><span class="skolem">p2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> ende <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>  enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">INV</span> <span class="skolem">t2</span> <span class="main">=</span> enat <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span> enat <span class="skolem">p2</span> <span class="main">+</span>  enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">INV</span> <span class="skolem">t2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> enat <span class="main">(</span>Suc <span class="skolem">p</span><span class="main">)</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">t</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q2'
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ab_semigroup_add_class.add_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add_left_mono<span class="main">)</span> 
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="main">1</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> q
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> add.commute add_left_mono eSuc_enat iadd_Suc plus_1_eSuc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> g0
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Suc_leI one_enat_def<span class="main">)</span> 
          <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span>  enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add.commute distrib_left<span class="main">)</span>
          <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>Suc <span class="main">(</span><span class="skolem">p</span> <span class="main">+</span> <span class="skolem">p2</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span>  enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">INV</span> <span class="skolem">t2</span> <span class="main">≤</span>  enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">qed</span></span>
        
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="bound">t</span> <span class="main">+</span> emb <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">INV</span> <span class="skolem">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span> 

  
<span class="keyword1" id="QuantK_Hoare-conseq'"><span class="command">lemma</span></span> conseq'<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">;</span>  <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P'</span> <span class="bound">s</span><span class="main">;</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">Q</span> <span class="bound">s</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="QuantK_Hoare-strengthen_pre"><span class="command">lemma</span></span> strengthen_pre<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P'</span> <span class="bound">s</span><span class="main">;</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="QuantK_Hoare-weaken_post"><span class="command">lemma</span></span> weaken_post<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">;</span>  <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≥</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="QuantK_Hoare-Assign'"><span class="command">lemma</span></span> Assign'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">≥</span> eSuc <span class="main">(</span> <span class="free">Q</span><span class="main">(</span><span class="bound">s</span><span class="main">[</span><span class="free">a</span><span class="main">/</span><span class="free">x</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">x</span> <span class="main">::=</span> <span class="free">a</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> strengthen_pre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ Assign<span class="main"><span class="main">]</span></span><span class="main">)</span>

  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Completeness"</span></span>
    
<span class="keyword1" id="QuantK_Hoare-bigstep_det"><span class="command">lemma</span></span> bigstep_det<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p1</span> <span class="main">⇓</span> <span class="free">t1</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">c1</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span> <span class="main">⟹</span> <span class="free">p1</span><span class="main">=</span><span class="free">p</span> <span class="main">∧</span> <span class="free">t1</span><span class="main">=</span><span class="free">t</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> big_step_t_determ2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="QuantK_Hoare-bigstepT_the_cost"><span class="command">lemma</span></span> bigstepT_the_cost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">P</span> <span class="main">⇓</span> <span class="free">T</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">n</span><span class="main">.</span> <span class="main">∃</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bigstep_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 

<span class="keyword1" id="QuantK_Hoare-bigstepT_the_state"><span class="command">lemma</span></span> bigstepT_the_state<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">P</span> <span class="main">⇓</span> <span class="free">T</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">a</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">a</span><span class="main">)</span> <span class="main">=</span> <span class="free">T</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> bigstep_det <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 


<span class="keyword1" id="QuantK_Hoare-SKIPnot"><span class="command">lemma</span></span> SKIPnot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="main">(</span>SKIP<span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">s</span><span class="main">≠</span><span class="free">t</span> <span class="main">∨</span> <span class="free">p</span><span class="main">≠</span>Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

 
<span class="keyword1" id="QuantK_Hoare-SKIPp"><span class="command">lemma</span></span> SKIPp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span>SKIP<span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1" id="QuantK_Hoare-SKIPt"><span class="command">lemma</span></span> SKIPt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span>SKIP<span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 


<span class="keyword1" id="QuantK_Hoare-ASSp"><span class="command">lemma</span></span> ASSp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> Ex <span class="main">(</span>big_step_t <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">e</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1" id="QuantK_Hoare-ASSt"><span class="command">lemma</span></span> ASSt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">e</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="free">s</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">e</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 

<span class="keyword1" id="QuantK_Hoare-ASSnot"><span class="command">lemma</span></span> ASSnot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">¬</span> <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">e</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span> <span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">p</span><span class="main">≠</span>Suc <span class="main">0</span> <span class="main">∨</span> <span class="free">t</span><span class="main">≠</span><span class="free">s</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">e</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The completeness proof proceeds along the same lines as the one for partial
correctness. First we have to strengthen our notion of weakest precondition
to take termination into account:›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wpQ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> qassn <span class="main">⇒</span> qassn"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">∞</span><span class="main">)</span>  <span class="keyword1">then</span> enat <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
<span class="keyword1" id="QuantK_Hoare-wpQ_skip"><span class="command">lemma</span></span> wpQ_skip<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> SKIP <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free">Q</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wpQ_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SKIPnot<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SKIPp SKIPt<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> one_enat_def plus_1_eSuc<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    

<span class="keyword1" id="QuantK_Hoare-wpQ_ass"><span class="command">lemma</span></span> wpQ_ass<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free">Q</span> <span class="main">(</span><span class="bound">s</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">e</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wpQ_def ASSp ASSt ASSnot eSuc_enat<span class="main">)</span> 

<span class="keyword1" id="QuantK_Hoare-wpt_Seq"><span class="command">lemma</span></span> wpt_Seq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">Q</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> wpQ_def
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="improper">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> ter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">u</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword1"><span class="command">from</span></span> bigstepT_the_state<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> bigstepT_the_state<span class="main">[</span><span class="operator">OF</span> ii<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> t2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">u</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> bigstepT_the_cost<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> firstcost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p1</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> bigstepT_the_cost<span class="main">[</span><span class="operator">OF</span> ii<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> secondcost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> <span class="main">∃</span><span class="bound">u</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">u</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p2</span>"</span></span>  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">have</span></span> totalcost<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> Ex <span class="main">(</span>big_step_t <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bigstepT_the_cost<span class="main">[</span><span class="operator">OF</span> ter<span class="main">]</span> p <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> totalstate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">u</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> bigstepT_the_state<span class="main">[</span><span class="operator">OF</span> ter<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ta</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">ta</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">u</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p2</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">ta</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">ta</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="keyword1">then</span> enat <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> Ex <span class="main">(</span>big_step_t <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">Q</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">ta</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">t</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">p1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> c2 if_True<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> Q bigstepT_the_state ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 1 if_True t t2 c2 C totalcost totalstate firstcost secondcost<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 2 if_False<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">using</span></span> 2  
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
<span class="keyword1"><span class="command">qed</span></span>
   

<span class="keyword1" id="QuantK_Hoare-wpQ_If"><span class="command">lemma</span></span> wpQ_If<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">ELSE</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1">if</span> bval <span class="free">b</span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wpQ_def fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> x t p i ta ia xa <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> IfTrue<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> bigstepT_the_state<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> IfTrue<span class="main"><span class="main">[</span></span><span class="operator">THEN</span> bigstepT_the_cost<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bigstepT_the_cost bigstepT_the_state<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat<span class="main">)</span>            
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bigstepT_the_state bigstepT_the_cost<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bigstepT_the_state bigstepT_the_cost<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">x</span> <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">i</span> <span class="skolem">ta</span> <span class="skolem">ia</span> <span class="skolem">xa</span><span class="main">)</span>
  <span class="keyword1"><span class="command">note</span></span> f<span class="main">=</span> IfFalse<span class="main">[</span><span class="operator">THEN</span> bigstepT_the_state<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quoted"><span class="skolem">xa</span></span> <span class="quoted"><span class="skolem">ta</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">xa</span>"</span></span> <span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> f2<span class="main">=</span> IfFalse<span class="main">[</span><span class="operator">THEN</span> bigstepT_the_cost<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="free">b</span></span> <span class="quoted"><span class="skolem">x</span></span> <span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="quoted"><span class="skolem">xa</span></span> <span class="quoted"><span class="skolem">ta</span></span> <span class="quoted"><span class="quoted">"Suc <span class="skolem">xa</span>"</span></span> <span class="quoted"><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword1"><span class="command">note</span></span> g<span class="main">=</span> bigstep_det<span class="main">[</span><span class="operator">OF</span> 1<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 1<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">]</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> f f2<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 1 g
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat<span class="main">)</span>   
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> 2
  <span class="keyword1"><span class="command">then</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bigstepT_the_state bigstepT_the_cost<span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="QuantK_Hoare-hoareQ_inf"><span class="command">lemma</span></span> hoareQ_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">∞</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hoareQ.Skip hoareQ.Assign hoareQ.Seq hoareQ.conseq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.conseq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.If<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">∞</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hoareQ.If hoareQ.conseq<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.conseq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.While<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">∞</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.conseq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"bval <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> wpQ_WhileTrue<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="free">s</span>  <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> b w <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">t1</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p1</span> <span class="main">⇓</span> <span class="skolem">t1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p2</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sum<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">p1</span> <span class="main">+</span> <span class="skolem">p2</span> <span class="main">=</span> <span class="skolem">p</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ta</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">t1</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">ta</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">t</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">p2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
  <span class="keyword1"><span class="command">have</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">∃</span><span class="bound">ta</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">ta</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="keyword1">then</span> enat <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">p</span><span class="main">.</span> Ex <span class="main">(</span>big_step_t <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="bound">p</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="free">Q</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">ta</span><span class="main">.</span> <span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">ta</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">∞</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">t1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">p1</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> g if_True<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span>   bigstepT_the_state bigstepT_the_cost w' q <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="free">s</span> <span class="main">+</span> <span class="main">1</span> <span class="main">=</span> enat <span class="skolem">p</span> <span class="main">+</span> <span class="free">Q</span> <span class="skolem">t</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wpQ_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> h if_True<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> bigstepT_the_state<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c<span class="main"><span class="main">]</span></span> bigstepT_the_cost<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c<span class="main"><span class="main">]</span></span> g if_True bigstepT_the_state<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w'<span class="main"><span class="main">]</span></span> bigstepT_the_cost<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w'<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> sum
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def ab_semigroup_add_class.add_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> add.commute add.right_neutral eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> plus_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wpQ_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> True if_True<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> bigstepT_the_state bigstepT_the_cost w <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wpQ_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> False if_False<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">~</span> bval <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> wpQ_WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">Q</span> <span class="free">s</span>  <span class="main">+</span> <span class="main">1</span> <span class="main">≤</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True
  <span class="keyword1"><span class="command">with</span></span> b <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">with</span></span> b <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">s</span><span class="main">=</span><span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span>Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span> <span class="main">=</span>  <span class="free">Q</span> <span class="free">s</span>  <span class="main">+</span> <span class="main">1</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wpQ_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> True if_True<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> w c bigstepT_the_cost bigstepT_the_state <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_enat_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wpQ_def 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> False if_False<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 
                            

<span class="keyword1" id="QuantK_Hoare-wpQ_is_pre"><span class="command">lemma</span></span> wpQ_is_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">c</span> <span class="free">Q</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> SKIP <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hoareQ.Skip<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Assign <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>hoareQ.Assign<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Seq <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>hoareQ.Seq<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">x1</span> <span class="skolem">c1</span> <span class="skolem">c2</span> <span class="skolem">Q</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> hoareQ.If <span class="main">)</span>  
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.conseq<span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.conseq<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>   
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.While<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">if</span></span> bval <span class="skolem"><span class="skolem">b</span></span> <span class="bound"><span class="bound">s</span></span> <span class="keyword1"><span class="keyword1">then</span></span>  <span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="skolem"><span class="skolem">c</span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">WHILE</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">DO</span></span> <span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">Q</span></span><span class="main"><span class="main">)</span></span> <span class="bound"><span class="bound">s</span></span> <span class="keyword1"><span class="keyword1">else</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> While<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">WHILE</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">DO</span></span> <span class="skolem"><span class="skolem">c</span></span><span class="main"><span class="main">)</span></span> <span class="skolem"><span class="skolem">Q</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="improper">s</span>"</span></span><span class="main">)</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> wpQ_WhileTrue <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> wpQ_WhileFalse <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> wpQ_WhileTrue <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> wpQ_WhileFalse <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="improper">s</span>"</span></span><span class="main">)</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1" id="QuantK_Hoare-wpQ_is_pre'"><span class="command">lemma</span></span> wpQ_is_pre'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">c</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> enat <span class="free">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">)</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> enat <span class="free">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">)</span><span class="main">}</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> wpQ_is_pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    
<span class="keyword1" id="QuantK_Hoare-wpQ_is_weakestprePotential1"><span class="command">lemma</span></span> wpQ_is_weakestprePotential1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">c</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> enat <span class="bound">k</span><span class="main">*</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">≤</span> enat <span class="bound">k</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hoare2o_valid_def wpQ_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="skolem">t</span> <span class="skolem">p</span> <span class="skolem">i</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="skolem">t</span> <span class="main">=</span> enat <span class="skolem">i</span>"</span></span>
    
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span><span class="keyword1">↓<span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="main">(</span><span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main">)</span> 
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p'</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p'</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span>  <span class="free">Q</span> <span class="skolem">t</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> bigstepT_the_state<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span> bigstepT_the_cost<span class="main"><span class="main">[</span></span><span class="operator">OF</span> i<span class="main"><span class="main">]</span></span> ii<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">qed</span></span>  
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">p</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∨</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">=</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">s</span> <span class="main">=</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>   

<span class="keyword1"><span class="command">theorem</span></span> hoareQ_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> wpQ_is_weakestprePotential1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span> <span class="free">c</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wpQ_is_pre'<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> 1<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">theorem</span></span> hoareQ_complete'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> hoare2o_valid_def
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="bound">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">≤</span> enat <span class="bound">k</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wpQ_is_pre'<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k1<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">k</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q1<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free"><span class="quoted"><span class="free">Q</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span>  wpQ_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span><span class="main">)</span> 
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">with</span></span> f <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p'</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p'</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p'</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="skolem">t</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
        <span class="keyword1"><span class="command">from</span></span> ii k True <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> imult_is_infinity <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
        <span class="keyword1"><span class="command">have</span></span> kla<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> iii i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> bigstepT_the_state<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span>
            <span class="keyword1"><span class="command">unfolding</span></span> bigstepT_the_cost<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> kla<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">corollary</span></span> hoareQ_sound_complete<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> hoareQ_sound hoareQ_complete<span class="main">)</span>
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Example"</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">X</span><span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">X</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span>  
 Z<span class="main">:</span> <span class="quoted"><span class="quoted">"eSuc <span class="main">(</span>enat <span class="main">(</span>nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span> <span class="main">*</span> nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> enat <span class="main">(</span><span class="numeral">5</span> <span class="main">*</span> <span class="main">(</span>nat <span class="main">(</span><span class="free">X</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> nat <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> enat <span class="main">(</span>nat <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> zero_enat_def<span class="main">)</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"eSuc <span class="main">0</span> <span class="main">≤</span> enat <span class="main">(</span>nat <span class="free">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ileI1
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span>nat <span class="free">X</span><span class="main">)</span> <span class="main">≤</span>  <span class="main">(</span>nat <span class="main">(</span><span class="free">X</span><span class="main">*</span><span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> nn nat_mult_distrib  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> D<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="main">(</span>nat <span class="free">X</span><span class="main">)</span> <span class="main">≤</span> enat <span class="main">(</span>nat <span class="main">(</span><span class="free">X</span><span class="main">*</span><span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
  <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>enat <span class="main">(</span>nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span> <span class="main">*</span> nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">4</span><span class="main">*</span> enat <span class="main">(</span>nat <span class="main">(</span><span class="free">X</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>   
    <span class="keyword1"><span class="command">using</span></span> nn nat_mult_distrib
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_eq_enat<span class="main">)</span>    
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"eSuc <span class="main">(</span>enat <span class="main">(</span>nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span> <span class="main">*</span> nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
    <span class="main">=</span> eSuc <span class="main">0</span> <span class="main">+</span>  <span class="main">(</span>enat <span class="main">(</span>nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span> <span class="main">*</span> nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> one_eSuc plus_1_eSuc<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> enat <span class="main">(</span>nat <span class="free">X</span><span class="main">)</span> <span class="main">+</span>  <span class="main">(</span>enat <span class="main">(</span>nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span> <span class="main">*</span> nat <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> A  add_right_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> enat <span class="main">(</span>nat <span class="free">X</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">*</span> enat <span class="main">(</span>nat <span class="main">(</span><span class="free">X</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> enat <span class="main">(</span>nat <span class="main">(</span><span class="free">X</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="numeral">4</span><span class="main">*</span> enat <span class="main">(</span>nat <span class="main">(</span><span class="free">X</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> D <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">5</span><span class="main">*</span> enat <span class="main">(</span>nat <span class="main">(</span><span class="free">X</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> eSuc_numeral mult_eSuc semiring_norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  enat <span class="main">(</span> <span class="numeral">5</span><span class="main">*</span> nat <span class="main">(</span><span class="free">X</span> <span class="main">*</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> numeral_eq_enat<span class="main">)</span> 
  <span class="keyword1"><span class="command">finally</span></span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>
          
     
 
<span class="keyword1" id="QuantK_Hoare-weakenpre"><span class="command">lemma</span></span> weakenpre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">;</span>   <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">≤</span>  <span class="free">P'</span> <span class="bound">s</span><span class="main">)</span>  <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> conseq<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">1</span></span><span class="main">]</span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  

<span class="keyword1" id="QuantK_Hoare-whileDecr"><span class="command">lemma</span></span> whileDecr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="main">(</span>Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="main">(</span>SKIP<span class="main">;;</span> SKIP<span class="main">;;</span> <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">0</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">4</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> While<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> enat <span class="numeral"><span class="numeral">4</span></span> <span class="main"><span class="main">*</span></span> <span class="main"><span class="main">(</span></span>enat <span class="main"><span class="main">(</span></span>nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> one_enat_def plus_enat_simps times_enat_simps enat_ord_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="main"><span class="main">(</span></span><span class="inner_quoted"><span class="inner_quoted">''x''</span></span> <span class="main"><span class="main">::=</span></span> Plus <span class="main"><span class="main">(</span></span>V <span class="inner_quoted"><span class="inner_quoted">''x''</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>N <span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> enat <span class="numeral"><span class="numeral">4</span></span> <span class="main"><span class="main">*</span></span> enat <span class="main"><span class="main">(</span></span>nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">t</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="main"><span class="main">(</span></span>SKIP<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> eSuc <span class="main"><span class="main">(</span></span>enat <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">4</span></span> <span class="main"><span class="main">*</span></span> nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Skip<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> one_enat_def plus_enat_simps times_enat_simps enat_ord_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eSuc_enat<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Skip<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
    
<span class="keyword1" id="QuantK_Hoare-whileDecrIf"><span class="command">lemma</span></span> whileDecrIf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="main">(</span>Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="main">(</span> <span class="main">(</span><span class="keyword1">IF</span> Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''z''</span><span class="main">)</span> <span class="keyword1">THEN</span> SKIP<span class="main">;;</span> SKIP <span class="keyword1">ELSE</span> SKIP <span class="main">)</span><span class="main">;;</span> <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> While<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">6</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> I1<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> enat <span class="numeral"><span class="numeral">6</span></span> <span class="main"><span class="main">*</span></span> <span class="main"><span class="main">(</span></span>enat <span class="main"><span class="main">(</span></span>nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> one_enat_def plus_enat_simps times_enat_simps enat_ord_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="main"><span class="main">(</span></span><span class="inner_quoted"><span class="inner_quoted">''x''</span></span> <span class="main"><span class="main">::=</span></span> Plus <span class="main"><span class="main">(</span></span>V <span class="inner_quoted"><span class="inner_quoted">''x''</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>N <span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> enat <span class="numeral"><span class="numeral">6</span></span> <span class="main"><span class="main">*</span></span> enat <span class="main"><span class="main">(</span></span>nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">t</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> If<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">IF</span></span> Less <span class="main"><span class="main">(</span></span>N <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>V <span class="inner_quoted"><span class="inner_quoted">''z''</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">THEN</span></span> SKIP<span class="main"><span class="main">;;</span></span> SKIP <span class="keyword1"><span class="keyword1">ELSE</span></span> SKIP <span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> eSuc <span class="main"><span class="main">(</span></span>enat <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">6</span></span> <span class="main"><span class="main">*</span></span> nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="main"><span class="main">(</span></span>SKIP<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> eSuc <span class="main"><span class="main">(</span></span>enat <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">6</span></span> <span class="main"><span class="main">*</span></span> nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Skip<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Skip<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Skip<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> one_enat_def plus_enat_simps times_enat_simps enat_ord_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eSuc_enat<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> one_enat_def plus_enat_simps times_enat_simps enat_ord_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eSuc_enat<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   
    
<span class="keyword1" id="QuantK_Hoare-whileDecrIf2"><span class="command">lemma</span></span> whileDecrIf2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="main">(</span>Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="main">(</span> <span class="main">(</span><span class="keyword1">IF</span> Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''z''</span><span class="main">)</span> <span class="keyword1">THEN</span> SKIP<span class="main">;;</span> SKIP <span class="keyword1">ELSE</span> SKIP <span class="main">)</span><span class="main">;;</span> <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">0</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> While<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">6</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> I1<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> enat <span class="numeral"><span class="numeral">6</span></span> <span class="main"><span class="main">*</span></span> <span class="main"><span class="main">(</span></span>enat <span class="main"><span class="main">(</span></span>nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="main"><span class="main">(</span></span><span class="inner_quoted"><span class="inner_quoted">''x''</span></span> <span class="main"><span class="main">::=</span></span> Plus <span class="main"><span class="main">(</span></span>V <span class="inner_quoted"><span class="inner_quoted">''x''</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>N <span class="main"><span class="main">(</span></span><span class="main"><span class="main">-</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">t</span></span><span class="main"><span class="main">.</span></span> enat <span class="numeral"><span class="numeral">6</span></span> <span class="main"><span class="main">*</span></span> enat <span class="main"><span class="main">(</span></span>nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">t</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> If<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="main"><span class="main">(</span></span><span class="keyword1"><span class="keyword1">IF</span></span> Less <span class="main"><span class="main">(</span></span>N <span class="main"><span class="main">0</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span>V <span class="inner_quoted"><span class="inner_quoted">''z''</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">THEN</span></span> SKIP<span class="main"><span class="main">;;</span></span> SKIP <span class="keyword1"><span class="keyword1">ELSE</span></span> SKIP <span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> eSuc <span class="main"><span class="main">(</span></span>enat <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">6</span></span> <span class="main"><span class="main">*</span></span> nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="hidden">⇩</span><sub>2</sub><span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">wp<span class="hidden">⇩</span><sub>Q</sub></span></span> <span class="main"><span class="main">(</span></span>SKIP<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> eSuc <span class="main"><span class="main">(</span></span>enat <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">6</span></span> <span class="main"><span class="main">*</span></span> nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span> <span class="main"><span class="main">-</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">+</span></span> <span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Skip<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Skip<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Skip<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>        
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> one_enat_def plus_enat_simps times_enat_simps enat_ord_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eSuc_enat<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> one_enat_def plus_enat_simps times_enat_simps enat_ord_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> eSuc_enat<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> one_enat_def plus_enat_simps times_enat_simps enat_ord_code<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="QuantK_VCG">
<div class="head">
<h1>Theory QuantK_VCG</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Verification Condition Generator"</span></span>
<span class="keyword1"><span class="command">theory</span></span> QuantK_VCG
<span class="keyword2"><span class="keyword">imports</span></span> <a href="QuantK_Hoare.html">QuantK_Hoare</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Ceiling integer division on extended natural numbers"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">mydiv</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">dvd</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
   
<span class="keyword1" id="QuantK_VCG-mydivcode"><span class="command">lemma</span></span> mydivcode<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="free">D</span><span class="main">≥</span><span class="free">k</span> <span class="main">⟹</span> mydiv <span class="free">D</span> <span class="free">k</span> <span class="main">=</span> Suc <span class="main">(</span>mydiv <span class="main">(</span><span class="free">D</span><span class="main">-</span><span class="free">k</span><span class="main">)</span> <span class="free">k</span><span class="main">)</span>"</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> mydiv_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> le_div_geq<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> dvd_minus_self <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
<span class="keyword1" id="QuantK_VCG-mydivcode1"><span class="command">lemma</span></span> mydivcode1<span class="main">:</span> <span class="quoted"><span class="quoted">"mydiv <span class="main">0</span> <span class="free">k</span> <span class="main">=</span> <span class="main">0</span>"</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> mydiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
<span class="keyword1" id="QuantK_VCG-mydivcode2"><span class="command">lemma</span></span> mydivcode2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="main">0</span><span class="main">&lt;</span><span class="free">D</span> <span class="main">⟹</span> <span class="free">D</span><span class="main">&lt;</span><span class="free">k</span> <span class="main">⟹</span> mydiv <span class="free">D</span> <span class="free">k</span> <span class="main">=</span> Suc <span class="main">0</span>"</span></span>  
  <span class="keyword1"><span class="command">unfolding</span></span> mydiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="QuantK_VCG-mydiv_mono"><span class="command">lemma</span></span> mydiv_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≤</span><span class="free">b</span> <span class="main">⟹</span> mydiv <span class="free">a</span> <span class="free">k</span> <span class="main">≤</span> mydiv <span class="free">b</span> <span class="free">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> mydiv_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="keyword1">dvd</span> <span class="free">a</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_le_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> div_le_mono le_Suc_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">k</span> <span class="keyword1">dvd</span> <span class="free">b</span>"</span></span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> div_le_mono<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_leI add.right_neutral div_le_mono div_mult_mod_eq dvd_imp_mod_0 le_add1 le_antisym less_le<span class="main">)</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      
<span class="keyword1" id="QuantK_VCG-mydiv_cancel"><span class="command">lemma</span></span> mydiv_cancel<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> mydiv <span class="main">(</span><span class="free">k</span> <span class="main">*</span> <span class="free">i</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="free">i</span>"</span></span>    
  <span class="keyword1"><span class="command">unfolding</span></span> mydiv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">≤</span> <span class="free">k</span><span class="main">*</span><span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> mydiv_le_E<span class="main">:</span> <span class="quoted"><span class="quoted">"mydiv <span class="free">B</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">A</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> mydiv_mono<span class="main">[</span><span class="operator">OF</span> B<span class="main">]</span> <span class="keyword2"><span class="keyword">and</span></span> k mydiv_cancel <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1" id="QuantK_VCG-mydiv_mult_leq"><span class="command">lemma</span></span> mydiv_mult_leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">l</span><span class="main">≤</span><span class="free">k</span> <span class="main">⟹</span> mydiv <span class="main">(</span><span class="free">l</span><span class="main">*</span><span class="free">A</span><span class="main">)</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">A</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mydiv_le_E<span class="main">)</span>
   
<span class="keyword1" id="QuantK_VCG-mydiv_cancel3"><span class="command">lemma</span></span> mydiv_cancel3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="free">i</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">*</span> mydiv <span class="free">i</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mydiv_def dividend_less_times_div le_eq_less_or_eq<span class="main">)</span>  
                                                                                                    
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ediv</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">k</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">=</span><span class="main">∞</span> <span class="keyword1">then</span> <span class="main">∞</span> <span class="keyword1">else</span> enat <span class="main">(</span>mydiv <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">i</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">=</span>enat <span class="bound">i</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>  
  
<span class="keyword1" id="QuantK_VCG-ediv_enat"><span class="command">lemma</span></span> ediv_enat<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ediv <span class="main">(</span>enat <span class="free">a</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> enat <span class="main">(</span>mydiv <span class="free">a</span> <span class="free">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ediv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="QuantK_VCG-ediv_mydiv"><span class="command">lemma</span></span> ediv_mydiv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"ediv <span class="main">(</span>enat <span class="free">a</span><span class="main">)</span> <span class="free">k</span> <span class="main">≤</span> enat <span class="free">f</span> <span class="main">⟷</span> mydiv <span class="free">a</span> <span class="free">k</span> <span class="main">≤</span> <span class="free">f</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ediv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="QuantK_VCG-ediv_mono"><span class="command">lemma</span></span> ediv_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span><span class="main">≤</span><span class="free">b</span> <span class="main">⟹</span> ediv <span class="free">a</span> <span class="free">k</span> <span class="main">≤</span> ediv <span class="free">b</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ediv_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mydiv_mono<span class="main">)</span> 

<span class="keyword1" id="QuantK_VCG-ediv_cancel2"><span class="command">lemma</span></span> ediv_cancel2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> ediv <span class="main">(</span>enat <span class="free">k</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="free">k</span> <span class="main">=</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ediv_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="main">∞</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> mydiv_cancel <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
<span class="keyword1" id="QuantK_VCG-ediv_cancel3"><span class="command">lemma</span></span> ediv_cancel3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">k</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟹</span> <span class="free">A</span> <span class="main">≤</span> enat <span class="free">k</span> <span class="main">*</span> ediv <span class="free">A</span> <span class="free">k</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> ediv_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">A</span><span class="main">=</span><span class="main">∞</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> mydiv_cancel3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Definition of VCG"</span></span>    
  
<span class="keyword1"><span class="command">datatype</span></span> acom <span class="main">=</span>
  Askip                  <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">SKIP</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span> <span class="main">|</span>
  Aassign <span class="quoted">vname</span> <span class="quoted">aexp</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">::=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>1000<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Aseq   <span class="quoted">acom</span> <span class="quoted">acom</span>       <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span>  <span class="main">[</span>60<span class="main">,</span> 61<span class="main">]</span> 60<span class="main">)</span> <span class="main">|</span> 
  Aif <span class="quoted">bexp</span> <span class="quoted">acom</span> <span class="quoted">acom</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">IF</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">THEN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">ELSE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Awhile <span class="quoted">qassn</span> <span class="quoted">bexp</span> <span class="quoted">acom</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">WHILE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">DO</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span>
 <span class="main">|</span>  Abst <span class="quoted">nat</span> <span class="quoted">acom</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">Ab</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span>

<span class="keyword1"><span class="command">notation</span></span> com.SKIP <span class="main">(</span><span class="quoted">"<span class="keyword1">SKIP</span>"</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">strip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> com"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="keyword1">SKIP</span> <span class="main">=</span> <span class="keyword1">SKIP</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">Ab</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span>"</span></span>
    
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pre</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> qassn <span class="main">⇒</span> qassn"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">/</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> eSuc <span class="main">(</span><span class="keyword1">if</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span> <span class="keyword1">then</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span>  <span class="keyword1">else</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span>  <span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">}</span> <span class="keyword1">Ab</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> ediv <span class="main">(</span><span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">*</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In contrast to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">pre</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">vc</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> produces a formula that is independent of the state:›</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> qassn <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span>pre <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>  
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span>  <span class="main">(</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span>  <span class="main">(</span>pre <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span>bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">}</span> <span class="keyword1">Ab</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">*</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">&gt;</span><span class="main">0</span> <span class="comment1">⌦‹∧ (∀s. pre C (λs. enat k * Q s) s ≤ enat k * ediv (pre C (λs. enat k * Q s) s) k)›</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Soundness of VCG"</span></span>
  
<span class="keyword1" id="QuantK_VCG-vc_sound"><span class="command">lemma</span></span> vc_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">Q</span> <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>pre <span class="free">C</span> <span class="free">Q</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">b</span> <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Aif1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>pre <span class="skolem">C1</span> <span class="skolem">Q</span><span class="main">}</span> strip <span class="skolem">C1</span> <span class="main">{</span><span class="skolem">Q</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Aif2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">}</span> strip <span class="skolem">C2</span> <span class="main">{</span><span class="skolem">Q</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.If<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> bval <span class="skolem"><span class="skolem">b</span></span> <span class="bound"><span class="bound">s</span></span> <span class="keyword1"><span class="keyword1">then</span></span> pre <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">s</span></span> <span class="keyword1"><span class="keyword1">else</span></span> pre <span class="skolem"><span class="skolem">C2</span></span> <span class="skolem"><span class="skolem">Q</span></span> <span class="bound"><span class="bound">s</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">Q</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> Aif1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> Aif2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"bval <span class="skolem">b</span> <span class="skolem">s</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">I</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">Q</span><span class="main">.</span> vc <span class="skolem">C</span> <span class="bound">Q</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>pre <span class="skolem">C</span> <span class="bound">Q</span><span class="main">}</span> strip <span class="skolem">C</span> <span class="main">{</span><span class="bound">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> ii'<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span> 
   <span class="keyword2"><span class="keyword">and</span></span> ii''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">s</span> <span class="main">≤</span>  <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span> 
     <span class="keyword2"><span class="keyword">and</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">from</span></span> i iii <span class="keyword1"><span class="command">have</span></span>  A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> strip <span class="skolem">C</span> <span class="main">{</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> While<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">I</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> A<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ii'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">using</span></span> ii'' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Abst <span class="skolem">k</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> vc<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">k</span><span class="main">*</span> <span class="skolem">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Abst<span class="main">(</span>1<span class="main">)</span> vc <span class="keyword1"><span class="command">have</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>pre <span class="skolem">C</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">k</span><span class="main">*</span><span class="skolem">Q</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span> strip <span class="skolem">C</span> <span class="main">{</span><span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">k</span><span class="main">*</span><span class="skolem">Q</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">using</span></span> ediv_cancel3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> hoareQ.Skip hoareQ.Assign hoareQ.Seq <span class="main">)</span>


<span class="keyword1" id="QuantK_VCG-vc_sound'"><span class="command">lemma</span></span> vc_sound'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>vc <span class="free">C</span> <span class="free">Q</span> <span class="main">;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="QuantK_VCG-vc_sound''"><span class="command">lemma</span></span> vc_sound''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>vc <span class="free">C</span> <span class="free">Q'</span> <span class="main">;</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span>  pre <span class="free">C</span> <span class="free">Q'</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">k</span> <span class="main">*</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span>  <span class="main">;</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> enat <span class="free">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">Q'</span> <span class="bound">s</span><span class="main">)</span><span class="main">;</span> <span class="free">k</span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ.conseq <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Completeness"</span></span> 
  
<span class="keyword1" id="QuantK_VCG-pre_mono"><span class="command">lemma</span></span> pre_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="free">C</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">≤</span> pre <span class="free">C</span> <span class="free">P</span> <span class="bound">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">P'</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ediv_mono mult_left_mono <span class="main">)</span>    
      
<span class="keyword1" id="QuantK_VCG-vc_mono"><span class="command">lemma</span></span> vc_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">P</span> <span class="main">⟹</span> vc <span class="free">C</span> <span class="free">P'</span>"</span></span>    
  <span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">P'</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">I</span> <span class="skolem">b</span> <span class="skolem">C</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_mono<span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Abst <span class="skolem">x1</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> mult_left_mono<span class="main">)</span>  
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pre_mono<span class="main">)</span>
      
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">C</span><span class="main">.</span> strip <span class="bound">C</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∧</span> vc <span class="bound">C</span> <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="bound">C</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span>   <span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?G</span> <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoareQ.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>conseq <span class="skolem">P</span> <span class="skolem">c</span> <span class="skolem">Q</span> <span class="skolem">k</span> <span class="skolem">P'</span> <span class="skolem">Q'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">P</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">Q'</span> <span class="bound">s</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">≤</span> pre <span class="skolem">C</span> <span class="skolem">Q</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> pre_mono conseq<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command">also</span></span> 
    <span class="keyword1"><span class="command">from</span></span> pre conseq<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span>  <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">P'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> order.trans <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">Q'</span> <span class="bound">s</span><span class="main">)</span> <span class="skolem">s</span>  <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">P'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"ediv <span class="main">(</span>pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">Q'</span> <span class="bound">s</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">k</span>  <span class="main">≤</span> ediv <span class="main">(</span>enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">P'</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ediv_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">note</span></span>  ediv_cancel2<span class="main">[</span><span class="operator">OF</span> conseq<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"ediv <span class="main">(</span>pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">Q'</span> <span class="bound">s</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="skolem">P'</span> <span class="skolem">s</span>"</span></span>    
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> compensate<span class="main">=</span>this
  
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">}</span></span> <span class="keyword1"><span class="keyword1">Ab</span></span> <span class="skolem"><span class="skolem">C</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> strip <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> vc vc_mono conseq<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> compensate <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Skip <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?C</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> Askip"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">P</span> <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?C</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span><span class="main">(</span>Aassign <span class="skolem">x</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip1<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C1</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="skolem">Q</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">P</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip2<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C2</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc2<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">P</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span><span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">IF</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">THEN</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword1"><span class="keyword1">ELSE</span></span> <span class="skolem"><span class="skolem">C2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> strip1 strip2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  <span class="keyword1"><span class="command">using</span></span> vc1 vc2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command">using</span></span> pre1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> pre2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>      
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip1<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C1</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">s</span> <span class="main">≤</span>   <span class="skolem">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">s</span><span class="main">)</span>"</span></span>    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip2<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C2</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc2<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">s</span> <span class="main">≤</span>   <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">s</span>"</span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">s</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"pre <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> pre_mono<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> pre2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> pre1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> pre <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">C1</span></span> <span class="main"><span class="main">;;</span></span> <span class="skolem"><span class="skolem">C2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> strip1 strip2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>  <span class="keyword1"><span class="command">using</span></span> vc1 vc2 vc_mono pre2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span>  pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">I</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> While<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">I</span></span><span class="main"><span class="main">}</span></span> <span class="keyword1"><span class="keyword1">WHILE</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">DO</span></span> <span class="skolem"><span class="skolem">C</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> strip <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> pre vc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>Z</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">C</span><span class="main">.</span> strip <span class="bound">C</span> <span class="main">=</span> <span class="free">c</span> <span class="main">∧</span> vc <span class="bound">C</span> <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="bound">C</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="free">P</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
  <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">_</span> <span class="main">⟹</span>   <span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?G</span> <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoareQ'.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ZSkip <span class="skolem">P</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?C</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span> Askip"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ZAssign <span class="skolem">P</span> <span class="skolem">a</span> <span class="skolem">x</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span><span class="main">.</span> <span class="var">?C</span> <span class="bound">C</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?C</span><span class="main">(</span>Aassign <span class="skolem">x</span> <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ZIf <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ZIf<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip1<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C1</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> ZIf<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip2<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C2</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc2<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span><span class="main">¬</span> bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="keyword1"><span class="keyword1">IF</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">THEN</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword1"><span class="keyword1">ELSE</span></span> <span class="skolem"><span class="skolem">C2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> strip1 strip2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> vc1 vc2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pre1<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pre2<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ZSeq <span class="skolem">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ZSeq<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip1<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C1</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pre1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C1</span> <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">s</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> ZSeq<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip2<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C2</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc2<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pre2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span> <span class="bound">s</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">P<span class="hidden">⇩</span><sub>3</sub></span><span class="main">)</span> <span class="skolem">s</span> <span class="main">≤</span> <span class="skolem">P<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">s</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> order.trans<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> b<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"pre <span class="skolem"><span class="skolem">C1</span></span> <span class="skolem"><span class="skolem">P<span class="hidden">⇩</span><sub>2</sub></span></span> <span class="skolem"><span class="skolem">s</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> pre_mono<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> pre2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> pre1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> pre <span class="main">=</span> this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="skolem"><span class="skolem">C1</span></span> <span class="main"><span class="main">;;</span></span> <span class="skolem"><span class="skolem">C2</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> strip1 strip2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> vc1 vc2 vc_mono pre2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>      
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>ZWhile <span class="skolem">I</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> ZWhile<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">+</span> <span class="main">↑</span> <span class="main">(</span>bval <span class="skolem">b</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">I</span></span><span class="main"><span class="main">}</span></span> <span class="keyword1"><span class="keyword1">WHILE</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword1"><span class="keyword1">DO</span></span> <span class="skolem"><span class="skolem">C</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> strip <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pre vc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Zconseq' <span class="skolem">P</span> <span class="skolem">c</span> <span class="skolem">Q</span> <span class="skolem">P'</span> <span class="skolem">Q'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Q</span> <span class="bound">s</span> <span class="main">≤</span> <span class="skolem">P</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   
  <span class="keyword1"><span class="command">from</span></span> pre_mono<span class="main">[</span><span class="operator">OF</span> Zconseq'<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="skolem">Q'</span> <span class="bound">s</span> <span class="main">≤</span> pre <span class="skolem">C</span> <span class="skolem">Q</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem"><span class="quoted"><span class="skolem">C</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> vc Zconseq'<span class="main">(</span>3<span class="main">)</span> vc_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> pre Zconseq'<span class="main">(</span>2<span class="main">)</span> 1 <span class="keyword1"><span class="command">using</span></span> order.trans  <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Zconst <span class="skolem">k</span> <span class="skolem">P</span> <span class="skolem">c</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> strip<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="bound">a</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">Q</span> <span class="bound">a</span><span class="main">)</span> <span class="bound">s</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">P</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="skolem"><span class="skolem">k</span></span><span class="main"><span class="main">}</span></span> <span class="keyword1"><span class="keyword1">Ab</span></span> <span class="skolem"><span class="skolem">C</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> strip <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> vc k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">using</span></span> ediv_mono<span class="main">[</span><span class="operator">OF</span> pre<span class="main">]</span> ediv_cancel2<span class="main">[</span><span class="operator">OF</span> k<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
    
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="QuantK_Examples">
<div class="head">
<h1>Theory QuantK_Examples</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Examples for quantitative Hoare logic"</span></span>
<span class="keyword1"><span class="command">theory</span></span> QuantK_Examples
<span class="keyword2"><span class="keyword">imports</span></span> <a href="QuantK_VCG.html">QuantK_VCG</a>
<span class="keyword2"><span class="keyword">begin</span></span>





<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sum</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">sum</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">wsum</span> <span class="main">==</span>
  <span class="keyword1">WHILE</span> Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span>
  <span class="keyword1">DO</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">;;</span>
      <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1" id="QuantK_Examples-example"><span class="command">lemma</span></span> example<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> wsum <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq'<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> While<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> I<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">λ</span></span><span class="bound"><span class="bound">s</span></span><span class="main"><span class="main">.</span></span> enat <span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">3</span></span> <span class="main"><span class="main">*</span></span> nat <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">s</span></span> <span class="inner_quoted"><span class="inner_quoted">''x''</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign'<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> Suc_eq_plus1 Suc_nat_eq_nat_zadd1 distrib_left_numeral eSuc_numeral enat_numeral eq_iff iadd_Suc_right nat_mult_1_right one_add_one plus_1_eSuc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="QuantK_Examples-example_sound"><span class="command">lemma</span></span> example_sound<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> wsum <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoareQ_sound<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> example<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="var">?A</span> <span class="bound">s</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> wsum <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq'<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> While<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign'<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="improper">s</span> <span class="inner_quoted">''x''</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>    
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>    
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign'<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">oops</span></span>
     
    
    
    
    
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Example for VCG"</span></span>
  
  
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">SKIP</span> <span class="main">;;</span> <span class="keyword1">SKIP</span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">1</span><span class="main">}</span> strip <span class="main">(</span><span class="main">{</span><span class="numeral">2</span><span class="main">}</span> <span class="keyword1">Ab</span> <span class="main">(</span><span class="keyword1">SKIP</span> <span class="main">;;</span> <span class="keyword1">SKIP</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eSuc_enat zero_enat_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mydivcode mydivcode1 mydivcode2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_enat_def<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1" id="QuantK_Examples-hoareQ_Seq_assoc"><span class="command">lemma</span></span> hoareQ_Seq_assoc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">A</span><span class="main">;;</span> <span class="free">B</span><span class="main">;;</span> <span class="free">C</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">=</span> <span class="main">(</span><span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">A</span><span class="main">;;</span> <span class="main">(</span><span class="free">B</span><span class="main">;;</span> <span class="free">C</span><span class="main">)</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hoare2o_valid_def hoareQ_sound_complete Seq_t_assoc<span class="main">)</span> 
  
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">1</span><span class="main">}</span> <span class="keyword1">SKIP</span>  <span class="main">;;</span> <span class="keyword1">SKIP</span> <span class="main">;;</span> <span class="keyword1">SKIP</span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">1</span><span class="main">}</span> strip <span class="main">(</span><span class="main">{</span><span class="numeral">2</span><span class="main">}</span> <span class="keyword1">Ab</span> <span class="main">(</span><span class="keyword1">SKIP</span> <span class="main">;;</span> <span class="main">{</span><span class="numeral">2</span><span class="main">}</span> <span class="keyword1">Ab</span> <span class="main">(</span><span class="keyword1">SKIP</span> <span class="main">;;</span> <span class="keyword1">SKIP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eSuc_enat zero_enat_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mydivcode mydivcode1 mydivcode2<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> one_enat_def hoareQ_Seq_assoc<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
  
  
   
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Wsum</span> <span class="main">==</span>  
  <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="numeral">3</span> <span class="main">*</span> nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span>
  <span class="keyword1">DO</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">;;</span>
      <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> wsum <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="numeral">2</span> <span class="main">+</span> <span class="numeral">3</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> strip <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> Wsum<span class="main">)</span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span> <span class="operator">smt</span> Suc_eq_plus1 Suc_nat_eq_nat_zadd1 distrib_left_numeral eSuc_numeral enat_numeral eq_iff iadd_Suc_right nat_mult_1_right one_add_one plus_1_eSuc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>          
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>          
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>          
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>          
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>      
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> n0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="free">n</span> <span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> wsum <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">from</span></span> n0 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span>Suc <span class="skolem">n'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> not0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="free">n</span> <span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> strip <span class="main">(</span><span class="main">{</span><span class="numeral">5</span><span class="main">}</span> <span class="keyword1">Ab</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> Wsum<span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span> <span class="operator">smt</span> Suc_eq_plus1 Suc_nat_eq_nat_zadd1 distrib_left_numeral eSuc_numeral enat_numeral eq_iff iadd_Suc_right nat_mult_1_right one_add_one plus_1_eSuc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>          
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>          
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> n'<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mydiv_le_E<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>          
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>      
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>
   
<span class="keyword1"><span class="command">lemma</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> <span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> wsum <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>  
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="free">n</span><span class="main">+</span><span class="main">1</span><span class="main">)</span> <span class="main">+</span> emb <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span><span class="main">)</span><span class="main">}</span> strip <span class="main">(</span><span class="main">{</span><span class="numeral">3</span><span class="main">}</span> <span class="keyword1">Ab</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">;;</span> Wsum<span class="main">)</span><span class="main">)</span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">0</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_sound'<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span> <span class="operator">smt</span> Suc_eq_plus1 Suc_nat_eq_nat_zadd1 distrib_left_numeral eSuc_numeral enat_numeral eq_iff iadd_Suc_right nat_mult_1_right one_add_one plus_1_eSuc<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> semiring_norm<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>   
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>          
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> int <span class="free">n</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>          
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> mydiv_le_E<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>          
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>      
   <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>   
    
   
    
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Wsum1</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">==</span>  
  <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main">*</span> nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">}</span> <span class="keyword1">WHILE</span> Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span>
  <span class="keyword1">DO</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">;;</span>
      <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">Wsum2</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">vier</span></span></span> <span class="main">==</span>  
  <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> enat <span class="main">(</span><span class="free"><span class="bound"><span class="entity">vier</span></span></span> <span class="main">*</span> <span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">+</span>  <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>  <span class="main">}</span> <span class="keyword1">WHILE</span> Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span>
  <span class="keyword1">DO</span> <span class="main">(</span><span class="inner_quoted">''y''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''y''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">;;</span>
      <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   
  
    


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="QuantK_Sqrt">
<div class="head">
<h1>Theory QuantK_Sqrt</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> QuantK_Sqrt 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="QuantK_VCG.html">QuantK_VCG</a> <span class="quoted">"<a href="../../HOL/HOL-Library/Discrete.html">HOL-Library.Discrete</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span> 
     
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Example: discrete square root in the quantitative Hoare logic›</span></span>  
  
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹As an example, consider the following program that computes the discrete square root:›</span></span>  
     
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">c</span> <span class="main">::</span> <span class="quoted">com</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">c</span><span class="main">=</span> 
         <span class="inner_quoted">''l''</span><span class="main">::=</span> N <span class="main">0</span> <span class="main">;;</span>
         <span class="inner_quoted">''m''</span> <span class="main">::=</span> N <span class="main">0</span> <span class="main">;;</span>
         <span class="inner_quoted">''r''</span><span class="main">::=</span> Plus <span class="main">(</span>N <span class="main">1</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">;;</span>
         <span class="main">(</span><span class="keyword1">WHILE</span> <span class="main">(</span>Less <span class="main">(</span>Plus <span class="main">(</span>N <span class="main">1</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''l''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''r''</span><span class="main">)</span><span class="main">)</span> 
              <span class="keyword1">DO</span> <span class="main">(</span><span class="inner_quoted">''m''</span> <span class="main">::=</span> <span class="main">(</span>Div <span class="main">(</span>Plus <span class="main">(</span>V <span class="inner_quoted">''l''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''r''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>N <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> 
                 <span class="main">(</span><span class="keyword1">IF</span> Not <span class="main">(</span>Less <span class="main">(</span>Times <span class="main">(</span>V <span class="inner_quoted">''m''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''m''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> 
                    <span class="keyword1">THEN</span> <span class="inner_quoted">''l''</span> <span class="main">::=</span> V <span class="inner_quoted">''m''</span>
                    <span class="keyword1">ELSE</span> <span class="inner_quoted">''r''</span> <span class="main">::=</span> V <span class="inner_quoted">''m''</span><span class="main">)</span><span class="main">;;</span>
                 <span class="inner_quoted">''m''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> 
 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In this theory we will show that its running time is in the order of magnitude of the
      logarithm of the variable ''x''›</span></span>  
     

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹a little lemma we need later for bounding the running time:›</span></span>
  
<span class="keyword1" id="QuantK_Sqrt-absch"><span class="command">lemma</span></span> absch<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span> <span class="main">⟹</span> <span class="numeral">5</span> <span class="main">*</span> <span class="bound">k</span> <span class="main">≤</span> <span class="numeral">96</span> <span class="main">+</span> <span class="numeral">100</span> <span class="main">*</span> Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span> <span class="main">::</span> <span class="quoted">state</span> <span class="keyword2"><span class="keyword">and</span></span>  <span class="skolem">k</span> <span class="main">::</span> <span class="quoted">nat</span> 
  <span class="keyword3"><span class="command">assume</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span> "</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">=</span>  <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">≥</span> <span class="main">0</span>"</span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_power_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> one_le_power<span class="main">)</span>          
  <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span><span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> i<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">using</span></span> nn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">5</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">≤</span> <span class="numeral">96</span> <span class="main">+</span> <span class="numeral">100</span> <span class="main">*</span> Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">≥</span> <span class="main">1</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">5</span> <span class="main">*</span> <span class="skolem">k</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">*</span> <span class="main">(</span>Discrete.log <span class="main">(</span><span class="numeral">2</span><span class="main">^</span><span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>     <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">*</span> Discrete.log <span class="main">(</span><span class="main">1</span> <span class="main">+</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> F<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">5</span> <span class="main">*</span> Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> monoD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> log_mono<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">*</span>  Discrete.log <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> nat_mult_distrib<span class="main">)</span> 
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="numeral">5</span> <span class="main">+</span> <span class="numeral">5</span> <span class="main">*</span> <span class="main">(</span>Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> True <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="numeral">96</span> <span class="main">+</span> <span class="numeral">100</span> <span class="main">*</span> Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">with</span></span> nn <span class="keyword1"><span class="command">have</span></span> gt1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''x''</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> F<span class="main">[</span><span class="operator">unfolded</span> gt1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span> <span class="main">=</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> log_Suc_zero <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="main">0</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> One_nat_def add.right_neutral gt1 i n_not_Suc_n nat_numeral nat_power_eq_Suc_0_iff numeral_2_eq_2 numeral_One<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> gt1<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>
    
  
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹For simplicity we assume, that during the process all segments between ''l'' and ''r'' have
      as length a power of two. This simplifies the analysis.
      To obtain this we choose the prepotential P accordingly.

      Now lets show the correctness of our time complexity: the binary search is in O(log ''x'') ›</span></span>
    
<span class="keyword1"><span class="command">lemma</span></span> 
  <span class="keyword2"><span class="keyword">assumes</span></span>   
    P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span>  <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span>  <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span>Discrete.log <span class="main">(</span>nat <span class="main">(</span> <span class="bound">s</span> <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
      Q<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">" <span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> c <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="comment1">― ‹first we create an annotated command›</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?lb</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="inner_quoted">''m''</span> <span class="main">::=</span> 
              <span class="main">(</span>Div <span class="main">(</span>Plus <span class="main">(</span>V <span class="inner_quoted">''l''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''r''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>N <span class="numeral">2</span><span class="main">)</span><span class="main">)</span> <span class="main">;;</span> 
              <span class="main">(</span><span class="keyword1">IF</span> Not <span class="main">(</span>Less <span class="main">(</span>Times <span class="main">(</span>V <span class="inner_quoted">''m''</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''m''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> 
                <span class="keyword1">THEN</span> <span class="inner_quoted">''l''</span> <span class="main">::=</span> V <span class="inner_quoted">''m''</span>
                <span class="keyword1">ELSE</span> <span class="inner_quoted">''r''</span> <span class="main">::=</span> V <span class="inner_quoted">''m''</span><span class="main">)</span><span class="main">;;</span>
              <span class="main">(</span><span class="inner_quoted">''m''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">)</span><span class="main">::</span>acom"</span></span>
  <span class="comment1">― ‹with an invariant potential›</span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span>   <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">::</span>state<span class="main">.</span> <span class="main">(</span><span class="main">(</span> emb <span class="main">(</span>  <span class="bound">s</span> <span class="inner_quoted">''l''</span><span class="main">≥</span><span class="main">0</span>   <span class="main">∧</span> <span class="main">(</span> <span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="bound">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="bound">s</span> <span class="inner_quoted">''l''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span> <span class="main">)</span> <span class="main">+</span> <span class="numeral">5</span> <span class="main">*</span> Discrete.log <span class="main">(</span>nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="bound">s</span> <span class="inner_quoted">''l''</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">::</span>enat<span class="main">)</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?C</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">(</span><span class="inner_quoted">''l''</span><span class="main">::=</span> N <span class="main">0</span><span class="main">)</span> <span class="main">::</span> acom<span class="main">)</span> <span class="main">;;</span> <span class="main">(</span><span class="inner_quoted">''m''</span> <span class="main">::=</span> N <span class="main">0</span><span class="main">)</span> <span class="main">;;</span> <span class="inner_quoted">''r''</span><span class="main">::=</span> Plus <span class="main">(</span>N <span class="main">1</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">;;</span> <span class="main">(</span><span class="main">{</span><span class="skolem">I</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="main">(</span>Less <span class="main">(</span>Plus <span class="main">(</span>N <span class="main">1</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''l''</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''r''</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">DO</span> <span class="var">?lb</span><span class="main">)</span>"</span></span>
  
  <span class="comment1">― ‹we show that the annotated command corresponds to the command we are interested in›</span>
  <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="var">?C</span> <span class="main">=</span> c"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> c_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="comment1">― ‹now we show that the annotated command is correct; here we use the VCG for the QuantK logic›</span>
  <span class="keyword1"><span class="command">have</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> strip <span class="var">?C</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> vc_sound''<span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span> 
    
    <span class="comment1">― ‹A) first lets show the verification conditions:›</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"vc <span class="var">?C</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> I_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span>  <span class="main">-</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr0I <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="skolem">k'</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_pred<span class="main">)</span>  
        <span class="keyword1"><span class="command">from</span></span> 1 k' <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> gN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''l''</span><span class="main">≤</span><span class="skolem">s</span> <span class="inner_quoted">''r''</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''l''</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">)</span> <span class="main">=</span>  nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> gN  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_diff_distrib nat_div_distrib<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            
        <span class="keyword1"><span class="command">have</span></span> R'<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="main">-</span>  nat <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k'</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> n<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> R nat_power_eq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> S'<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> gN <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_diff_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nat_power_eq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gN <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
            
        <span class="keyword1"><span class="command">from</span></span> N  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span> <span class="main"><span class="main">:</span></span> R R' S' k'<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>    
      <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span>  <span class="main">-</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">&lt;</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≤</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">k</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">,</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> gr0I <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">=</span><span class="skolem">k'</span><span class="main">+</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Suc_eq_plus1 Suc_pred<span class="main">)</span>            
        <span class="keyword1"><span class="command">from</span></span> 1 k' <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> gN<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''l''</span><span class="main">≤</span><span class="skolem">s</span> <span class="inner_quoted">''r''</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''l''</span><span class="main">≥</span><span class="main">0</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s</span> <span class="inner_quoted">''r''</span> <span class="main">≥</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> 1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span> <span class="main">-</span> <span class="skolem">s</span> <span class="inner_quoted">''l''</span><span class="main">)</span> <span class="main">=</span>  nat <span class="main">(</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> gN  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nat_diff_distrib nat_div_distrib<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            
        <span class="keyword1"><span class="command">have</span></span> R'<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span> <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="keyword1">div</span> <span class="numeral">2</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k'</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> n<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> R nat_power_eq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">have</span></span> S'<span class="main">:</span> <span class="quoted"><span class="quoted">"nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''r''</span><span class="main">)</span> <span class="main">-</span> nat <span class="main">(</span><span class="skolem">s</span> <span class="inner_quoted">''l''</span><span class="main">)</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="skolem">k</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> gN <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> nat_diff_distrib<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span> 1<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nat_power_eq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span> <span class="main"><span class="main">:</span></span> R R' S' k'<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>        
      <span class="keyword1"><span class="command">qed</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>        
  <span class="keyword1"><span class="command">next</span></span>
    <span class="comment1">― ‹B) lets show that the precondition implies the weakest precondition, and that the
            time bound of C can be bounded by log ''x''›</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pre <span class="var">?C</span> <span class="free">Q</span> <span class="skolem">s</span> <span class="main">≤</span> enat <span class="numeral">100</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span>  I_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> P<span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">k</span><span class="main">.</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">s</span> <span class="inner_quoted">''x''</span>   <span class="main">=</span> <span class="numeral">2</span> <span class="main">^</span> <span class="bound">k</span><span class="main">)</span>"</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> eSuc_enat plus_1_eSuc<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nat_power_eq<span class="main">)</span> 
        <span class="keyword1"><span class="command">using</span></span> absch <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">from</span></span> s v <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Partial_Evaluation">
<div class="head">
<h1>Theory Partial_Evaluation</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Partial States"</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Partial evaluation of expressions›</span></span>    
<span class="keyword1"><span class="command">theory</span></span> Partial_Evaluation
<span class="keyword2"><span class="keyword">imports</span></span> <a href="AExp.html">AExp</a> <a href="Vars.html">Vars</a>
<span class="keyword2"><span class="keyword">begin</span></span>

                      
<span class="keyword1"><span class="command">type_synonym</span></span> partstate <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vname <span class="main">⇒</span> val option<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emb</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"partstate <span class="main">⇒</span> state <span class="main">⇒</span> state"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">emb</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="bound">v</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span>Some <span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">r</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">part</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"state <span class="main">⇒</span> partstate"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">part</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">v</span><span class="main">.</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
   
<span class="keyword1" id="Partial_Evaluation-emb_part"><span class="command">lemma</span></span> emb_part<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"emb <span class="main">(</span>part <span class="free">s</span><span class="main">)</span> <span class="free">q</span> <span class="main">=</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> emb_def part_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Partial_Evaluation-part_emb"><span class="command">lemma</span></span> part_emb<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="free">ps</span> <span class="main">=</span> UNIV <span class="main">⟹</span> part <span class="main">(</span>emb <span class="free">ps</span> <span class="free">q</span><span class="main">)</span> <span class="main">=</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> emb_def part_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domD option.case_eq_if<span class="main">)</span> 
      
   
<span class="keyword1" id="Partial_Evaluation-dom_part"><span class="command">lemma</span></span> dom_part<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>part <span class="free">s</span><span class="main">)</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> part_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">optplus</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int option <span class="main">⇒</span> int option <span class="main">⇒</span> int option"</span></span>   <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">optplus</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">a'</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">b'</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="bound">a'</span> <span class="main">+</span> <span class="bound">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">opttimes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int option <span class="main">⇒</span> int option <span class="main">⇒</span> int option"</span></span>   <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">opttimes</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">a'</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">b'</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="bound">a'</span> <span class="main">*</span> <span class="bound">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">optdiv</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int option <span class="main">⇒</span> int option <span class="main">⇒</span> int option"</span></span>   <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">optdiv</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">a'</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">b'</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="bound">a'</span> <span class="keyword1">div</span> <span class="bound">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
                                            
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">paval'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"aexp <span class="main">⇒</span> partstate <span class="main">⇒</span> val option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">paval'</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">paval'</span> <span class="main">(</span>V <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">paval'</span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> optplus <span class="main">(</span><span class="free">paval'</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>   <span class="main">(</span><span class="free">paval'</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">paval'</span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> opttimes <span class="main">(</span><span class="free">paval'</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>   <span class="main">(</span><span class="free">paval'</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">paval'</span> <span class="main">(</span>Div <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> optdiv <span class="main">(</span><span class="free">paval'</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>   <span class="main">(</span><span class="free">paval'</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
  

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"paval' <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="free">v</span> <span class="main">⟹</span> vars <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Plus<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a1</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> Plus<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a2</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Plus<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> Plus<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Times<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a1</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> Times<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a2</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Times<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> Times<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Div <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Div<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a1</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> Div<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a2</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Div<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> Div<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span>  <span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="Partial_Evaluation-paval'_aval"><span class="command">lemma</span></span> paval'_aval<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="free">v</span> <span class="main">⟹</span> aval <span class="free">a</span> <span class="main">(</span>emb <span class="free">ps</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Plus<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a1</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> Plus<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a2</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Plus<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> Plus<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> Plus<span class="main">(</span>3<span class="main">)</span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Times<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a1</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> Times<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a2</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Times<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> Times<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> Times<span class="main">(</span>3<span class="main">)</span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Div <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Div<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a1</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> Div<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a2</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Div<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> Div<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> Div<span class="main">(</span>3<span class="main">)</span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> emb_def<span class="main">)</span>
  
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">paval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"aexp <span class="main">⇒</span> partstate <span class="main">⇒</span> val"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">paval</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">paval</span> <span class="main">(</span>V <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> the <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">paval</span> <span class="main">(</span>Plus <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">paval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">+</span> <span class="free">paval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">paval</span> <span class="main">(</span>Times <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">paval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">*</span> <span class="free">paval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">paval</span> <span class="main">(</span>Div <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free">paval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="keyword1">div</span> <span class="free">paval</span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span>
  
<span class="keyword1" id="Partial_Evaluation-paval_aval"><span class="command">lemma</span></span> paval_aval<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">ps</span> <span class="main">⟹</span> paval <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> aval <span class="free">a</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">case</span> <span class="free">ps</span> <span class="bound">v</span> <span class="keyword1">of</span> None <span class="main">⇒</span> <span class="free">s</span> <span class="bound">v</span> <span class="main">|</span> Some <span class="bound">r</span> <span class="main">⇒</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Partial_Evaluation-paval'_paval"><span class="command">lemma</span></span> paval'_paval<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">ps</span> <span class="main">⟹</span> paval' <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="main">(</span>paval <span class="free">a</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

<span class="keyword1" id="Partial_Evaluation-paval_paval'"><span class="command">lemma</span></span> paval_paval'<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="free">v</span> <span class="main">⟹</span> paval <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> <span class="free">v</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Plus<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a1</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> Plus<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a2</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Plus<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> Plus<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> Plus<span class="main">(</span>3<span class="main">)</span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Times<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a1</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> Times<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a2</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Times<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> Times<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> Times<span class="main">(</span>3<span class="main">)</span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Div <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Div<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v1</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a1</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v1</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">with</span></span> Div<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a2</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="skolem">v2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">from</span></span> Div<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 1<span class="main">]</span> Div<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> 2<span class="main">]</span> Div<span class="main">(</span>3<span class="main">)</span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp_all</span>
      
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pbval</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bexp <span class="main">⇒</span> partstate <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pbval</span> <span class="main">(</span>Bc <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pbval</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">pbval</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pbval</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">pbval</span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∧</span> <span class="free">pbval</span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pbval</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span>paval <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">&lt;</span> paval <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span>"</span></span>
  

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">optnot</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">optnot</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">a'</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="main">~</span><span class="bound">a'</span><span class="main">)</span><span class="main">)</span>"</span></span>
                                            
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">optand</span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">optand</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">a'</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">b'</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="bound">a'</span> <span class="main">∧</span> <span class="bound">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">optless</span>   <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">optless</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">a'</span> <span class="main">⇒</span> <span class="main">(</span><span class="keyword1">case</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">of</span> None <span class="main">⇒</span> None <span class="main">|</span> Some <span class="bound">b'</span> <span class="main">⇒</span> Some <span class="main">(</span><span class="bound">a'</span> <span class="main">&lt;</span> <span class="bound">b'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
                                            
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pbval'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bexp <span class="main">⇒</span> partstate <span class="main">⇒</span> bool option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pbval'</span> <span class="main">(</span>Bc <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">v</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pbval'</span> <span class="main">(</span>Not <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span>optnot <span class="main">(</span><span class="free">pbval'</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pbval'</span> <span class="main">(</span>And <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span>optand <span class="main">(</span><span class="free">pbval'</span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free">pbval'</span> <span class="free"><span class="bound"><span class="entity">b<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pbval'</span> <span class="main">(</span>Less <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span>optless <span class="main">(</span>paval' <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">(</span>paval' <span class="free"><span class="bound"><span class="entity">a<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  

<span class="keyword1" id="Partial_Evaluation-pbval'_pbval"><span class="command">lemma</span></span> pbval'_pbval<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">ps</span> <span class="main">⟹</span> pbval' <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="main">(</span>pbval <span class="free">a</span> <span class="free">ps</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> paval'_paval<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Partial_Evaluation-paval_aval_vars"><span class="command">lemma</span></span> paval_aval_vars<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">ps</span> <span class="main">⟹</span> paval <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> aval <span class="free">a</span> <span class="main">(</span>emb <span class="free">ps</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> emb_def<span class="main">)</span> 

<span class="keyword1" id="Partial_Evaluation-pbval_bval_vars"><span class="command">lemma</span></span> pbval_bval_vars<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="free">ps</span> <span class="main">⟹</span> pbval <span class="free">b</span> <span class="free">ps</span> <span class="main">=</span> bval <span class="free">b</span> <span class="main">(</span>emb <span class="free">ps</span> <span class="free">s</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> paval_aval_vars<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> s<span class="main"><span class="main">=</span></span><span class="quoted"><span class="free">s</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
<span class="keyword1" id="Partial_Evaluation-paval'dom"><span class="command">lemma</span></span> paval'dom<span class="main">:</span> <span class="quoted"><span class="quoted">"paval' <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="free">v</span> <span class="main">⟹</span> vars <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Plus <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>   
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> domD option.case_eq_if option.collapse subset_iff<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>  
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Times <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>   
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> domD option.case_eq_if option.collapse subset_iff<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Div <span class="skolem">a1</span> <span class="skolem">a2</span><span class="main">)</span>     
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> domD option.case_eq_if option.collapse subset_iff<span class="main">)</span> 
<span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Product_Separation_Algebra">
<div class="head">
<h1>Theory Product_Separation_Algebra</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Product_Separation_Algebra
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../Separation_Algebra/Separation_Algebra.html">Separation_Algebra.Separation_Algebra</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>                 
   
<span class="keyword1"><span class="command">instantiation</span></span> <span class="quoted">"prod"</span> <span class="main">::</span> <span class="main">(</span><span class="quoted">sep_algebra</span><span class="main">,</span> <span class="quoted">sep_algebra</span><span class="main">)</span> <span class="quoted">sep_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>
 
<span class="keyword1"><span class="command">definition</span></span>
  zero_prod_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span> <span class="main">≡</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  plus_prod_def<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="main">≡</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="main">+</span> fst <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="main">,</span> snd <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="main">+</span> snd <span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main">)</span> "</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  sep_disj_prod_def<span class="main">:</span> <span class="quoted"><span class="quoted">"sep_disj <span class="free"><span class="bound"><span class="entity">m1</span></span></span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="main">≡</span> sep_disj <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main">)</span> <span class="main">(</span>fst <span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main">)</span> <span class="main">∧</span> sep_disj <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main">)</span> <span class="main">(</span>snd <span class="free"><span class="bound"><span class="entity">m2</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span>  <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_prod_def zero_prod_def plus_prod_def 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_commuteI<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> sep_add_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_add_assoc<span class="main">)</span>   
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>  <span class="keyword1"><span class="command">using</span></span> sep_disj_addD1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">using</span></span> sep_disj_addI1  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword2"><span class="keyword">end</span></span>
   
<span class="keyword1" id="Product_Separation_Algebra-sep_disj_prod_commute"><span class="command">lemma</span></span> sep_disj_prod_commute<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 

<span class="keyword1" id="Product_Separation_Algebra-sep_disj_prod_conv"><span class="command">lemma</span></span> sep_disj_prod_conv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">x</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span><span class="free">b</span><span class="main">,</span> <span class="free">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span><span class="main">##</span><span class="free">b</span> <span class="main">∧</span> <span class="free">x</span><span class="main">##</span><span class="free">y</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Product_Separation_Algebra-sep_plus_prod_conv"><span class="command">lemma</span></span> sep_plus_prod_conv<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="free">ps'</span><span class="main">,</span> <span class="free">n'</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">ps</span> <span class="main">+</span> <span class="free">ps'</span><span class="main">,</span> <span class="free">n</span> <span class="main">+</span> <span class="free">n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> plus_prod_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>sep_algebra<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">b</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
   <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">a</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def sep_disj_prod_def plus_prod_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      
<span class="keyword1"><span class="command">instantiation</span></span> nat <span class="main">::</span> <span class="quoted">sep_algebra</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span>
  sep_disj_nat_def<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"sep_disj <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m1</span></span></span><span class="main">::</span>nat<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">m2</span></span></span> <span class="main">≡</span> True"</span></span>
 
<span class="keyword1"><span class="command">instance</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">standard</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
<span class="keyword2"><span class="keyword">end</span></span>
  
<span class="comment1">(* examples *)</span>
   
<span class="comment1">(* now nat can be used as a separation algebra *)</span>
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">Q</span> <span class="main">**</span> <span class="free">H</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="free">H</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>
    
<span class="comment1">(* and any pair of separation algebras also is *)</span>    
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>sep_algebra<span class="main">)</span> <span class="main">*</span> <span class="main">(</span><span class="tfree">'b</span><span class="main">::</span>sep_algebra<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">Q</span> <span class="main">**</span> <span class="free">H</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="free">H</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">*</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">Q</span> <span class="main">**</span> <span class="free">H</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="free">H</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>
        
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Sep_Algebra_Add">
<div class="head">
<h1>Theory Sep_Algebra_Add</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Sep_Algebra_Add
  <span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="../Separation_Algebra/Separation_Algebra.html">Separation_Algebra.Separation_Algebra</a>"</span> <span class="quoted">"<a href="../Separation_Algebra/Sep_Heap_Instance.html">Separation_Algebra.Sep_Heap_Instance</a>"</span>
    <a href="Product_Separation_Algebra.html">Product_Separation_Algebra</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">puree</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="tfree">'h</span><span class="main">::</span>sep_algebra <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">↑</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">puree</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">h</span><span class="main">.</span> <span class="bound">h</span><span class="main">=</span><span class="main">0</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>"</span></span>

<span class="keyword1" id="Sep_Algebra_Add-puree_alt"><span class="command">lemma</span></span> puree_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">↑</span><span class="free">Φ</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="free">Φ</span><span class="main">⟩</span> <span class="keyword1">and</span> <span class="main">□</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> puree_def sep_empty_def<span class="main">)</span>

<span class="keyword1" id="Sep_Algebra_Add-pure_alt"><span class="command">lemma</span></span> pure_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟨</span><span class="free">Φ</span><span class="main">⟩</span> <span class="main">=</span> <span class="main">(</span><span class="main">↑</span><span class="free">Φ</span> <span class="main">**</span> sep_true<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">clarsimp</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> puree_def<span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">aa</span> <span class="main">::</span> <span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">aaa</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      ff1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">p</span> <span class="bound">pa</span> <span class="bound">a</span> <span class="bound">pb</span> <span class="bound">pc</span> <span class="bound">aa</span><span class="main">.</span> <span class="main">(</span><span class="main">¬</span> <span class="main">(</span><span class="bound">p</span> <span class="main">∧*</span> <span class="bound">pa</span><span class="main">)</span> <span class="bound">a</span> <span class="main">∨</span> <span class="bound">p</span> <span class="main">(</span><span class="skolem">aaa</span> <span class="bound">p</span> <span class="bound">pb</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">pb</span> <span class="main">∧*</span>
<span class="bound">pa</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">¬</span> <span class="bound">pb</span> <span class="main">(</span><span class="skolem">aaa</span> <span class="bound">p</span> <span class="bound">pb</span><span class="main">)</span> <span class="main">∨</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">p</span> <span class="main">∧*</span> <span class="bound">pc</span><span class="main">)</span> <span class="bound">aa</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">pb</span> <span class="main">∧*</span> <span class="bound">pc</span><span class="main">)</span> <span class="bound">aa</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> sep_globalise<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧*</span> <span class="bound">p</span><span class="main">)</span> <span class="skolem">aa</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> sep_conj_commuteI sep_conj_sep_emptyE
sep_empty_def<span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">Φ</span> <span class="main">∨</span> <span class="free">Φ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="skolem">aa</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ff1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> sep_conj_commuteI<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">Φ</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="free">Φ</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">::</span><span class="tfree">'a</span><span class="main">)</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="bound">a</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1"><span class="command">abbreviation</span></span> <span class="entity">NO_PURE</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'h</span><span class="main">::</span>sep_algebra <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">NO_PURE</span> <span class="free"><span class="bound"><span class="entity">X</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">≡</span> <span class="main">(</span>NO_MATCH <span class="main">(</span><span class="main">⟨</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">⟩</span><span class="main">::</span><span class="tfree">'h</span><span class="main">⇒</span>bool<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> NO_MATCH <span class="main">(</span><span class="main">(</span><span class="main">↑</span><span class="free"><span class="bound"><span class="entity">X</span></span></span><span class="main">)</span><span class="main">::</span><span class="tfree">'h</span><span class="main">⇒</span>bool<span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">named_theorems</span></span> sep_simplify <span class="quoted">‹Assertion simplifications›</span>

<span class="keyword1" id="Sep_Algebra_Add-sep_reorder"><span class="command">lemma</span></span> sep_reorder<span class="main">[</span><span class="operator">sep_simplify</span><span class="main">]</span><span class="main">:</span>  
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">a</span> <span class="main">∧*</span> <span class="free">b</span><span class="main">)</span> <span class="main">∧*</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">∧*</span> <span class="free">b</span> <span class="main">∧*</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>NO_PURE <span class="free">X</span> <span class="free">a</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span> <span class="main">**</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">b</span> <span class="main">**</span> <span class="free">a</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span>NO_PURE <span class="free">X</span> <span class="free">b</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">b</span> <span class="main">∧*</span> <span class="free">a</span> <span class="main">∧*</span> <span class="free">c</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">∧*</span> <span class="free">b</span> <span class="main">∧*</span> <span class="free">c</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">⟨</span><span class="free">P</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="free">P</span><span class="main">⟩</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">↑</span><span class="free">P</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">↑</span><span class="free">P</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"NO_PURE <span class="free">X</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">⟨</span><span class="free">P</span><span class="main">⟩</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="free">P</span><span class="main">⟩</span> <span class="main">**</span> <span class="free">Q</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"NO_PURE <span class="free">X</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">↑</span><span class="free">P</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">↑</span><span class="free">P</span> <span class="main">**</span> <span class="free">Q</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep.add_ac<span class="main">)</span>

<span class="keyword1" id="Sep_Algebra_Add-sep_combine1"><span class="command">lemma</span></span> sep_combine1<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">↑</span><span class="free">P</span> <span class="main">**</span> <span class="main">↑</span><span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">↑</span><span class="main">(</span><span class="free">P</span><span class="main">∧</span><span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">P</span><span class="main">⟩</span> <span class="main">**</span> <span class="main">⟨</span><span class="free">Q</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">P</span><span class="main">∧</span><span class="free">Q</span><span class="main">⟩</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">↑</span><span class="free">P</span> <span class="main">**</span> <span class="main">⟨</span><span class="free">Q</span><span class="main">⟩</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">P</span><span class="main">∧</span><span class="free">Q</span><span class="main">⟩</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">P</span><span class="main">⟩</span> <span class="main">**</span> <span class="main">↑</span><span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="main">⟨</span><span class="free">P</span><span class="main">∧</span><span class="free">Q</span><span class="main">⟩</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_conj_def puree_def <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">0</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sep_Algebra_Add-sep_combine2"><span class="command">lemma</span></span> sep_combine2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">↑</span><span class="free">P</span> <span class="main">**</span> <span class="main">↑</span><span class="free">Q</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">↑</span><span class="main">(</span><span class="free">P</span><span class="main">∧</span><span class="free">Q</span><span class="main">)</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">P</span><span class="main">⟩</span> <span class="main">**</span> <span class="main">⟨</span><span class="free">Q</span><span class="main">⟩</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="free">P</span><span class="main">∧</span><span class="free">Q</span><span class="main">⟩</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">↑</span><span class="free">P</span> <span class="main">**</span> <span class="main">⟨</span><span class="free">Q</span><span class="main">⟩</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="free">P</span><span class="main">∧</span><span class="free">Q</span><span class="main">⟩</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⟨</span><span class="free">P</span><span class="main">⟩</span> <span class="main">**</span> <span class="main">↑</span><span class="free">Q</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⟨</span><span class="free">P</span><span class="main">∧</span><span class="free">Q</span><span class="main">⟩</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sep.add_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sep_Algebra_Add-sep_extract_pure"><span class="command">lemma</span></span> sep_extract_pure<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
  <span class="quoted"><span class="quoted">"NO_MATCH True <span class="free">P</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⟨</span><span class="free">P</span><span class="main">⟩</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="main">(</span>sep_true <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">↑</span><span class="free">P</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span> <span class="free">h</span><span class="main">)</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">↑</span>True <span class="main">=</span> <span class="main">□</span>"</span></span>
  <span class="quoted"><span class="quoted">"<span class="main">↑</span>False <span class="main">=</span> sep_false"</span></span>
  <span class="keyword1"><span class="command">using</span></span> sep_conj_sep_true_right <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> puree_def sep_empty_def<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1" id="Sep_Algebra_Add-sep_pure_front2"><span class="command">lemma</span></span> sep_pure_front2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">↑</span><span class="free">P</span> <span class="main">**</span> <span class="free">A</span> <span class="main">**</span> <span class="main">↑</span><span class="free">Q</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">↑</span><span class="main">(</span><span class="free">P</span> <span class="main">∧</span> <span class="free">Q</span><span class="main">)</span> <span class="main">**</span> <span class="free">F</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_reorder<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="Sep_Algebra_Add-ex_h_simps"><span class="command">lemma</span></span> ex_h_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
  <span class="quoted"><span class="quoted">"Ex <span class="main">(</span><span class="main">↑</span><span class="free">Φ</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">Φ</span>"</span></span>
  <span class="quoted"><span class="quoted">"Ex <span class="main">(</span><span class="main">↑</span><span class="free">Φ</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">Φ</span> <span class="main">∧</span> Ex <span class="free">P</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">Φ</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span> option<span class="main">)</span> <span class="main">*</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">Q</span> <span class="main">**</span> <span class="free">H</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="free">H</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>
    
<span class="comment1">(* map_le *)</span>
<span class="keyword1" id="Sep_Algebra_Add-map_le_substate_conv"><span class="command">lemma</span></span> map_le_substate_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"map_le <span class="main">=</span> sep_substate"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> map_le_def sep_substate_def sep_disj_fun_def plus_fun_def domain_def dom_def none_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> m1 m2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">%</span></span><span class="bound"><span class="bound">x</span></span><span class="main"><span class="main">.</span></span> <span class="keyword1"><span class="keyword1">if</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">∃</span></span><span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">.</span></span> <span class="skolem"><span class="skolem">m1</span></span> <span class="bound"><span class="bound">x</span></span> <span class="main"><span class="main">=</span></span> Some <span class="bound"><span class="bound">y</span></span><span class="main"><span class="main">)</span></span> <span class="keyword1"><span class="keyword1">then</span></span> None <span class="keyword1"><span class="keyword1">else</span></span> <span class="skolem"><span class="skolem">m2</span></span> <span class="bound"><span class="bound">x</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Big_StepT_Partial">
<div class="head">
<h1>Theory Big_StepT_Partial</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Big step Semantics on partial states"</span></span>

<span class="keyword1"><span class="command">theory</span></span> Big_StepT_Partial
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Partial_Evaluation.html">Partial_Evaluation</a> <a href="Big_StepT.html">Big_StepT</a> <span class="quoted">"<a href="Sep_Algebra_Add.html">SepLogAdd/Sep_Algebra_Add</a>"</span>  
    <span class="quoted">"<a href="../../HOL/HOL-Eisbach/Eisbach.html">HOL-Eisbach.Eisbach</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">type_synonym</span></span> lvname <span class="main">=</span> <span class="quoted">string</span> 
<span class="keyword1"><span class="command">type_synonym</span></span> pstate_t <span class="main">=</span> <span class="quoted"><span class="quoted">"partstate <span class="main">*</span> nat"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> assnp <span class="main">=</span> <span class="quoted"><span class="quoted">"partstate <span class="main">⇒</span> bool"</span></span>
<span class="keyword1"><span class="command">type_synonym</span></span> assn2 <span class="main">=</span> <span class="quoted"><span class="quoted">"pstate_t <span class="main">⇒</span> bool"</span></span> 

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹helper functions›</span></span>
     
<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹restrict›</span></span>
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">restrict</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">restrict</span> <span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">x</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">x</span><span class="main">:</span><span class="free"><span class="bound"><span class="entity">S</span></span></span> <span class="keyword1">then</span> Some <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="bound">x</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span>"</span></span>
   
<span class="keyword1" id="Big_StepT_Partial-restrictI"><span class="command">lemma</span></span> restrictI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="free">S</span><span class="main">.</span> <span class="free">s1</span> <span class="bound">x</span> <span class="main">=</span> <span class="free">s2</span> <span class="bound">x</span> <span class="main">⟹</span> restrict <span class="free">S</span> <span class="free">s1</span> <span class="main">=</span> restrict <span class="free">S</span> <span class="free">s2</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> restrict_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
<span class="keyword1" id="Big_StepT_Partial-restrictE"><span class="command">lemma</span></span> restrictE<span class="main">:</span> <span class="quoted"><span class="quoted">"restrict <span class="free">S</span> <span class="free">s1</span> <span class="main">=</span> restrict <span class="free">S</span> <span class="free">s2</span> <span class="main">⟹</span> <span class="free">s1</span> <span class="main">=</span> <span class="free">s2</span> <span class="keyword1">on</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> restrict_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> option.inject<span class="main">)</span>   
        
<span class="keyword1" id="Big_StepT_Partial-dom_restrict"><span class="command">lemma</span></span> dom_restrict<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>restrict <span class="free">S</span> <span class="free">s</span><span class="main">)</span> <span class="main">=</span> <span class="free">S</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> restrict_def
  <span class="keyword1"><span class="command">using</span></span> domIff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
       
<span class="keyword1" id="Big_StepT_Partial-restrict_less_part"><span class="command">lemma</span></span> restrict_less_part<span class="main">:</span> <span class="quoted"><span class="quoted">"restrict <span class="free">S</span> <span class="free">t</span> <span class="main">≼</span> part <span class="free">t</span>"</span></span>      
  <span class="keyword1"><span class="command">unfolding</span></span> restrict_def map_le_substate_conv<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> map_le_def part_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
   
<span class="keyword1"><span class="command">paragraph</span></span> <span class="quoted"><span class="plain_text">‹Heap helper functions›</span></span> 
        
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lmaps_to_expr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"aexp <span class="main">⇒</span> val <span class="main">⇒</span> assn2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lmaps_to_expr</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> dom <span class="bound">s</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∧</span> paval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lmaps_to_expr_x</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vname <span class="main">⇒</span> aexp <span class="main">⇒</span> val <span class="main">⇒</span> assn2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lmaps_to_expr_x</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> dom <span class="bound">s</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span> <span class="main">∧</span> paval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
      
<span class="keyword1" id="Big_StepT_Partial-subState"><span class="command">lemma</span></span> subState<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≼</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">v</span> <span class="main">∈</span> dom <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="free">v</span> <span class="main">=</span> <span class="free">y</span> <span class="free">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> map_le_substate_conv<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> map_le_def  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
       
<span class="keyword1"><span class="command">lemma</span></span>  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ps</span><span class="main">::</span> <span class="quoted">partstate</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span><span class="main">::</span><span class="quoted">state</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">ps</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">≼</span> part <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> emb_update<span class="main">:</span> <span class="quoted"><span class="quoted">"emb <span class="main">[</span><span class="free">x</span> <span class="main">↦</span> paval <span class="free">a</span> <span class="free">ps</span><span class="main">]</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span>emb <span class="free">ps</span> <span class="free">s</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">a</span> <span class="main">(</span>emb <span class="free">ps</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">unfolding</span></span> emb_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span><span class="main">=</span><span class="free">x</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> paval_aval<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> part_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span> <span class="main">∈</span> dom <span class="free">ps</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> subState <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domIff<span class="main">)</span>       
  
<span class="keyword1" id="Big_StepT_Partial-paval_aval2"><span class="command">lemma</span></span> paval_aval2<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">ps</span> <span class="main">⟹</span> <span class="free">ps</span> <span class="main">≼</span> part <span class="free">s</span> <span class="main">⟹</span> paval <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> aval <span class="free">a</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> subState <span class="keyword1"><span class="command">unfolding</span></span> part_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  
    
<span class="keyword1"><span class="command">lemma</span></span>  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">ps</span><span class="main">::</span> <span class="quoted">partstate</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">s</span><span class="main">::</span><span class="quoted">state</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">ps</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">≼</span> part <span class="free">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> emb_update2<span class="main">:</span> <span class="quoted"><span class="quoted">"emb <span class="main">(</span><span class="free">ps</span><span class="main">(</span><span class="free">x</span> <span class="main">↦</span> paval <span class="free">a</span> <span class="free">ps</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span>emb <span class="free">ps</span> <span class="free">s</span><span class="main">)</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">a</span> <span class="main">(</span>emb <span class="free">ps</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
      <span class="keyword1"><span class="command">unfolding</span></span> emb_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">v</span><span class="main">=</span><span class="free">x</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> paval_aval<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>             
     
    
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"Big step Semantics on partial states"</span></span>

<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">big_step_t_part</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">×</span> partstate <span class="main">⇒</span> nat <span class="main">⇒</span> partstate <span class="main">⇒</span> bool"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> _ <span class="keyword1">⇓</span> _"</span> 55<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>
Skip<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP<span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> Suc <span class="main">0</span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
Assign<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span> <span class="main">⊆</span> dom <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">;</span> paval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">ps'</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">↦</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> Suc <span class="main">0</span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">ps'</span></span></span>"</span></span> <span class="main">|</span>

Seq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s3</span></span></span> <span class="main">;</span> <span class="free"><span class="bound"><span class="entity">z</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">;;</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s3</span></span></span>"</span></span> <span class="main">|</span>

IfTrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">;</span> dom <span class="free"><span class="bound"><span class="entity">ps'</span></span></span> <span class="main">=</span> dom <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">;</span> pbval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">ps'</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">ps'</span></span></span>"</span></span> <span class="main">|</span>
IfFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">;</span> dom <span class="free"><span class="bound"><span class="entity">ps'</span></span></span> <span class="main">=</span> dom <span class="free"><span class="bound"><span class="entity">ps</span></span></span> <span class="main">;</span> <span class="main">¬</span> pbval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">ps'</span></span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="main">1</span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c1</span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">ps</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">ps'</span></span></span>"</span></span> <span class="main">|</span>
WhileFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">;</span> <span class="main">¬</span> pbval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> Suc <span class="main">0</span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s</span></span></span>"</span></span> <span class="main">|</span>
WhileTrue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> pbval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">;</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">;</span>  <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s3</span></span></span><span class="main">;</span> <span class="main">1</span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">+</span><span class="free"><span class="bound"><span class="entity">y</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">z</span></span></span>  <span class="main">⟧</span> 
          <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="keyword1"><span class="free">⇒<span class="hidden">⇩</span><sub>A</sub></span></span> <span class="free"><span class="bound"><span class="entity">z</span></span></span> <span class="main"><span class="free">⇓</span></span> <span class="free"><span class="bound"><span class="entity">s3</span></span></span>"</span></span>


<span class="keyword1"><span class="command">declare</span></span> big_step_t_part.intros <span class="main">[</span><span class="operator">intro</span><span class="main">]</span>

    
<span class="keyword1"><span class="command">inductive_cases</span></span> Skip_tE3<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>SKIP<span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">x</span> <span class="main">⇓</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> Skip_tE3 
<span class="keyword1"><span class="command">inductive_cases</span></span> Assign_tE3<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">a</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> Assign_tE3
<span class="keyword1"><span class="command">inductive_cases</span></span> Seq_tE3<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c1</span><span class="main">;;</span><span class="free">c2</span><span class="main">,</span><span class="free">s1</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">p</span> <span class="main">⇓</span> <span class="free">s3</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> Seq_tE3
<span class="keyword1"><span class="command">inductive_cases</span></span> If_tE3<span class="main">[</span><span class="operator">elim</span><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c1</span> <span class="keyword1">ELSE</span> <span class="free">c2</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">x</span> <span class="main">⇓</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> If_tE3
<span class="keyword1"><span class="command">inductive_cases</span></span> While_tE3<span class="main">[</span><span class="operator">elim</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span><span class="free">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">x</span> <span class="main">⇓</span> <span class="free">t</span>"</span></span>
<span class="keyword1"><span class="command">thm</span></span> While_tE3

  
<span class="keyword1"><span class="command">lemmas</span></span> big_step_t_part_induct <span class="main">=</span> big_step_t_part.induct<span class="main">[</span><span class="operator">split_format</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">complete</span><span class="main"><span class="main">)</span></span><span class="main">]</span>
  
  
<span class="keyword1" id="Big_StepT_Partial-big_step_t3_post_dom_conv"><span class="command">lemma</span></span> big_step_t3_post_dom_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">t</span> <span class="main">⇓</span> <span class="free">ps'</span> <span class="main">⟹</span> dom <span class="free">ps'</span> <span class="main">=</span> dom <span class="free">ps</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_t_part_induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_fun_def plus_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">metis</span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      
<span class="keyword1" id="Big_StepT_Partial-add_update_distrib"><span class="command">lemma</span></span> add_update_distrib<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps1</span> <span class="free">x1</span> <span class="main">=</span> Some <span class="free">y</span> <span class="main">⟹</span> <span class="free">ps1</span> <span class="main">##</span> <span class="free">ps2</span> <span class="main">⟹</span> vars <span class="free">x2</span> <span class="main">⊆</span> dom <span class="free">ps1</span> <span class="main">⟹</span> <span class="free">ps1</span><span class="main">(</span><span class="free">x1</span> <span class="main">↦</span> paval <span class="free">x2</span> <span class="free">ps1</span><span class="main">)</span> <span class="main">+</span> <span class="free">ps2</span>  <span class="main">=</span> <span class="main">(</span><span class="free">ps1</span> <span class="main">+</span> <span class="free">ps2</span><span class="main">)</span><span class="main">(</span><span class="free">x1</span> <span class="main">↦</span> paval <span class="free">x2</span> <span class="free">ps1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_fun_def plus_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_iff_not_equal domI domain_conv<span class="main">)</span>   
  
<span class="keyword1" id="Big_StepT_Partial-paval_extend"><span class="command">lemma</span></span> paval_extend<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">ps1</span> <span class="main">##</span> <span class="free">ps2</span> <span class="main">⟹</span> vars <span class="free">a</span> <span class="main">⊆</span> dom <span class="free">ps1</span> <span class="main">⟹</span> paval <span class="free">a</span> <span class="main">(</span><span class="free">ps1</span> <span class="main">+</span> <span class="free">ps2</span><span class="main">)</span> <span class="main">=</span> paval <span class="free">a</span> <span class="free">ps1</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_fun_def domain_conv<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domI map_add_comm map_add_dom_app_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> option.sel plus_fun_conv<span class="main">)</span> 
    
<span class="keyword1" id="Big_StepT_Partial-pbval_extend"><span class="command">lemma</span></span> pbval_extend<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps1</span> <span class="main">##</span> <span class="free">ps2</span> <span class="main">⟹</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="free">ps1</span> <span class="main">⟹</span> pbval <span class="free">b</span> <span class="main">(</span><span class="free">ps1</span> <span class="main">+</span> <span class="free">ps2</span><span class="main">)</span> <span class="main">=</span> pbval <span class="free">b</span> <span class="free">ps1</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> paval_extend<span class="main">)</span> 
     
    
<span class="keyword1" id="Big_StepT_Partial-Framer"><span class="command">lemma</span></span> Framer<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">ps1</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span> <span class="free">ps1'</span> <span class="main">⟹</span> <span class="free">ps1</span> <span class="main">##</span> <span class="free">ps2</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">ps1</span> <span class="main">+</span> <span class="free">ps2</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span>  <span class="free">ps1'</span><span class="main">+</span><span class="free">ps2</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_t_part_induct<span class="main">)</span>  
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Skip <span class="skolem">s</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> big_step_t_part.Skip<span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">ps</span> <span class="skolem">v</span> <span class="skolem">ps'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> big_step_t_part.Assign<span class="main">)</span>  
    <span class="keyword1"><span class="command">using</span></span> Assign 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xa</span><span class="main">=</span><span class="skolem">x</span>"</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> paval_extend<span class="main">[</span><span class="operator">unfolded</span> plus_fun_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_fun_def
       <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> disjoint_iff_not_equal domI domain_conv<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IfTrue <span class="skolem">b</span> <span class="skolem">ps</span> <span class="skolem">ps'</span> <span class="skolem">c1</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> big_step_t_part.IfTrue<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pbval_extend<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>IfFalse <span class="skolem">b</span> <span class="skolem">ps</span> <span class="skolem">ps'</span> <span class="skolem">c2</span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">c1</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> big_step_t_part.IfFalse<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pbval_extend<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WhileFalse <span class="skolem">b</span> <span class="skolem">s</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> big_step_t_part.WhileFalse<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pbval_extend<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>WhileTrue <span class="skolem">b</span> <span class="skolem">s1</span> <span class="skolem">c</span> <span class="skolem">x</span> <span class="skolem">s2</span> <span class="skolem">y</span> <span class="skolem">s3</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> big_step_t3_post_dom_conv<span class="main">[</span><span class="operator">OF</span> WhileTrue<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom <span class="skolem">s2</span> <span class="main">=</span> dom <span class="skolem">s1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> WhileTrue<span class="main">(</span>8<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">##</span> <span class="free">ps2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_fun_def domain_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> WhileTrue <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> big_step_t_part.WhileTrue<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pbval_extend<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">c1</span> <span class="skolem">s1</span> <span class="skolem">x</span> <span class="skolem">s2</span> <span class="skolem">c2</span> <span class="skolem">y</span> <span class="skolem">s3</span> <span class="skolem">z</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> big_step_t3_post_dom_conv<span class="main">[</span><span class="operator">OF</span> Seq<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom <span class="skolem">s2</span> <span class="main">=</span> dom <span class="skolem">s1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Seq<span class="main">(</span>6<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">s2</span> <span class="main">##</span> <span class="free">ps2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_fun_def domain_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">with</span></span> Seq <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> big_step_t_part.Seq<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
   
   
<span class="keyword1" id="Big_StepT_Partial-Framer2"><span class="command">lemma</span></span> Framer2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">ps1</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span> <span class="free">ps1'</span> <span class="main">⟹</span> <span class="free">ps1</span> <span class="main">##</span> <span class="free">ps2</span> <span class="main">⟹</span> <span class="free">ps</span> <span class="main">=</span> <span class="free">ps1</span> <span class="main">+</span> <span class="free">ps2</span> <span class="main">⟹</span> <span class="free">ps'</span> <span class="main">=</span> <span class="free">ps1'</span><span class="main">+</span><span class="free">ps2</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span> <span class="free">ps'</span> "</span></span>
  <span class="keyword1"><span class="command">using</span></span> Framer <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="comment1">(* connection to bigstep2 *)</span>
   
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Relation to BigStep Semantic on full states›</span></span> 
    
<span class="keyword1" id="Big_StepT_Partial-paval_aval_part"><span class="command">lemma</span></span> paval_aval_part<span class="main">:</span> <span class="quoted"><span class="quoted">"paval <span class="free">a</span> <span class="main">(</span>part <span class="free">s</span><span class="main">)</span> <span class="main">=</span> aval <span class="free">a</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> part_def<span class="main">)</span> 
<span class="keyword1" id="Big_StepT_Partial-pbval_bval_part"><span class="command">lemma</span></span> pbval_bval_part<span class="main">:</span> <span class="quoted"><span class="quoted">"pbval <span class="free">b</span> <span class="main">(</span>part <span class="free">s</span><span class="main">)</span> <span class="main">=</span> bval <span class="free">b</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> paval_aval_part<span class="main">)</span> 
 
    
<span class="keyword1" id="Big_StepT_Partial-part_paval_aval"><span class="command">lemma</span></span> part_paval_aval<span class="main">:</span> <span class="quoted"><span class="quoted">"part <span class="main">(</span><span class="free">s</span><span class="main">(</span><span class="free">x</span> <span class="main">:=</span> aval <span class="free">a</span> <span class="free">s</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> part <span class="free">s</span><span class="main">(</span><span class="free">x</span> <span class="main">↦</span> paval <span class="free">a</span> <span class="main">(</span>part <span class="free">s</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">xa</span><span class="main">=</span><span class="free">x</span>"</span></span><span class="main">)</span>  
    <span class="keyword1"><span class="command">unfolding</span></span> part_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> domIff map_le_def map_le_substate_conv option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> part_def paval_aval2 subsetI<span class="main">)</span> 
       
      
<span class="keyword1" id="Big_StepT_Partial-full_to_part"><span class="command">lemma</span></span> full_to_part<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">m</span> <span class="main">⇓</span> <span class="free">s'</span> <span class="main">⟹</span>  <span class="main">(</span><span class="free">C</span><span class="main">,</span> part <span class="free">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span> part <span class="free">s'</span> "</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_t_induct<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> Skip <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> Assign<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> part_paval_aval <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Seq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> IfTrue<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pbval_bval_part<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> IfFalse<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pbval_bval_part<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> WhileFalse<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pbval_bval_part<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> WhileTrue<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pbval_bval_part<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>        
  
<span class="keyword1" id="Big_StepT_Partial-part_to_full'"><span class="command">lemma</span></span> part_to_full'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span> <span class="free">ps'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> emb <span class="free">ps</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">m</span> <span class="main">⇓</span> emb <span class="free">ps'</span> <span class="free">s</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_t_part_induct<span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">a</span> <span class="skolem">x</span> <span class="skolem">ps</span> <span class="skolem">v</span> <span class="skolem">ps'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"paval <span class="skolem">a</span> <span class="skolem">ps</span> <span class="main">=</span> aval <span class="skolem">a</span> <span class="main">(</span>emb <span class="skolem">ps</span> <span class="free">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> paval_aval_vars<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Assign<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">have</span></span> g <span class="main">:</span><span class="quoted"><span class="quoted">"emb <span class="skolem">ps'</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span>emb <span class="skolem">ps</span> <span class="free">s</span><span class="main">)</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>aval <span class="skolem">a</span> <span class="main">(</span>emb <span class="skolem">ps</span> <span class="free">s</span><span class="main">)</span> <span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Assign z<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> emb_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>      
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> g<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> big_step_t.Assign<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pbval_bval_vars<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  
  
<span class="keyword1" id="Big_StepT_Partial-part_to_full"><span class="command">lemma</span></span> part_to_full<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> part <span class="free">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span> part <span class="free">s'</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">m</span> <span class="main">⇓</span> <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> part <span class="free">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span> part <span class="free">s'</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> emb <span class="main">(</span>part <span class="free">s</span><span class="main">)</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">m</span> <span class="main">⇓</span> emb <span class="main">(</span>part <span class="free">s'</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> part_to_full'<span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">m</span> <span class="main">⇓</span> <span class="free">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1" id="Big_StepT_Partial-part_full_equiv"><span class="command">lemma</span></span> part_full_equiv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">m</span> <span class="main">⇓</span> <span class="free">s'</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> part <span class="free">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span> part <span class="free">s'</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> part_to_full full_to_part <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>    
    
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹more properties›</span></span>
    
<span class="keyword1" id="Big_StepT_Partial-big_step_t3_gt0"><span class="command">lemma</span></span> big_step_t3_gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">x</span> <span class="main">⇓</span> <span class="free">ps'</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_t_part_induct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        
<span class="keyword1" id="Big_StepT_Partial-big_step_t3_same"><span class="command">lemma</span></span> big_step_t3_same<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span> <span class="free">ps'</span> <span class="main">==&gt;</span>  <span class="free">ps</span> <span class="main">=</span> <span class="free">ps'</span> <span class="keyword1">on</span> UNIV <span class="main">-</span> lvars <span class="free">C</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> big_step_t_part_induct<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_fun_def plus_fun_def<span class="main">)</span> 
    
<span class="keyword1" id="Big_StepT_Partial-avalDirekt3_correct"><span class="command">lemma</span></span> avalDirekt3_correct<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> N <span class="free">v</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span> <span class="free">ps'</span> <span class="main">⟹</span> paval' <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> Some <span class="free">v</span> <span class="main">⟹</span>  <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">a</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">m</span> <span class="main">⇓</span> <span class="free">ps'</span>"</span></span> 
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> Assign<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> paval_paval' paval'dom<span class="main">)</span> 
    


  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Partial State›</span></span>    
  
 
  
<span class="comment1">(* partialstate and nat is a separation algebra ! *)</span>  
<span class="keyword1"><span class="command">lemma</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">h</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>vname <span class="main">⇒</span> val option<span class="main">)</span> <span class="main">*</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">Q</span> <span class="main">**</span> <span class="free">H</span><span class="main">)</span> <span class="free">h</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="free">H</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">h</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>
        
<span class="keyword1" id="Big_StepT_Partial-separate_othogonal_commuted'"><span class="command">lemma</span></span> separate_othogonal_commuted'<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">ps</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="free">s</span> <span class="main">⟷</span> <span class="free">P</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span>snd <span class="free">s</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span>fst <span class="free">s</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  
   
 
<span class="keyword1" id="Big_StepT_Partial-separate_othogonal_commuted"><span class="command">lemma</span></span> separate_othogonal_commuted<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">ps</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>  
   
    
<span class="keyword1" id="Big_StepT_Partial-separate_othogonal"><span class="command">lemma</span></span> separate_othogonal<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">ps</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">P</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="main">0</span><span class="main">)</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"  <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">n'</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="bound">n'</span><span class="main">)</span> <span class="main">∧</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="free">ps</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> Suc <span class="bound">n'</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">x</span> <span class="main">##</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">x</span> <span class="main">+</span> <span class="skolem">y</span>"</span></span> 
      <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="free">b</span> <span class="main">⊆</span>  dom <span class="bound">s</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">case</span> <span class="skolem">y</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">c</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> Suc <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">x</span> <span class="main">=</span> <span class="free">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> snd <span class="skolem">x</span> <span class="main">+</span> Suc <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword1"><span class="command">with</span></span> 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> snd <span class="skolem">x</span><span class="main">)</span> <span class="main">∧</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="free">ps</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> Suc <span class="main">(</span>snd <span class="skolem">x</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span> 
       
    
    
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Dollar and Pointsto›</span></span>    
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dollar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇒</span> assn2"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">$</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">dollar</span> <span class="free"><span class="bound"><span class="entity">q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">0</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">q</span></span></span><span class="main">)</span>"</span></span>
  
  
<span class="keyword1" id="Big_StepT_Partial-sep_reorder_dollar_aux"><span class="command">lemma</span></span> sep_reorder_dollar_aux<span class="main">:</span>  
    <span class="quoted"><span class="quoted">"NO_MATCH <span class="main">(</span><span class="main">$</span><span class="free">X</span><span class="main">)</span> <span class="free">A</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">$</span><span class="free">B</span> <span class="main">**</span> <span class="free">A</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">$</span><span class="free">B</span><span class="main">)</span>"</span></span>   
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span><span class="free">X</span> <span class="main">**</span> <span class="main">$</span><span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">$</span><span class="main">(</span><span class="free">X</span><span class="main">+</span><span class="free">Y</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> <span class="dynamic"><span class="dynamic">sep_simplify</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> dollar_def sep_conj_def sep_disj_prod_def sep_disj_nat_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
     
<span class="keyword1"><span class="command">lemmas</span></span> sep_reorder_dollar <span class="main">=</span> sep_conj_assoc sep_reorder_dollar_aux

<span class="keyword1" id="Big_StepT_Partial-stardiff"><span class="command">lemma</span></span> stardiff<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧*</span> <span class="main">$</span><span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>  P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span> <span class="main">-</span> <span class="free">m</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">m</span><span class="main">≤</span><span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">$</span><span class="main">0</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dollar_def sep_conj_def sep_disj_prod_def sep_disj_nat_def  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">embP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>partstate <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> partstate <span class="main">×</span> nat <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">embP</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  
    
<span class="keyword1" id="Big_StepT_Partial-orthogonal_split"><span class="command">lemma</span></span> orthogonal_split<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>embP <span class="free">Q</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>embP <span class="free">P</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">m</span><span class="main">)</span>"</span></span>   
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Q</span> <span class="main">=</span> <span class="free">P</span> <span class="main">∧</span> <span class="free">n</span> <span class="main">=</span> <span class="free">m</span><span class="main">)</span> <span class="main">∨</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> False<span class="main">)</span> <span class="main">∧</span> <span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> False<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> embP_def dollar_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">unfolding</span></span>  sep_disj_prod_def  plus_prod_def  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv snd_conv<span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      
<span class="comment1">(* how to set up case rules *)</span>      
      
<span class="keyword1" id="Big_StepT_Partial-F"><span class="command">lemma</span></span> F<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>embP <span class="free">Q</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>embP <span class="free">P</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">m</span><span class="main">)</span>"</span></span>   
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>blub<span class="main">)</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="main">|</span>
          <span class="main">(</span>da<span class="main">)</span>  <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> False<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> False<span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">using</span></span> assms orthogonal_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Big_StepT_Partial-T"><span class="command">lemma</span></span> T<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>embP <span class="free">Q</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>embP <span class="free">P</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">m</span><span class="main">)</span>"</span></span>   
  <span class="keyword2"><span class="keyword">obtains</span></span> <span class="main">(</span>blub<span class="main">)</span> <span class="free">x</span><span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="free">P</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span> <span class="main">=</span> <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span><span class="main">=</span><span class="free">x</span>"</span></span> <span class="main">|</span>
          <span class="main">(</span>da<span class="main">)</span>  <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> False<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> False<span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> assms orthogonal_split <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">pointsto</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vname <span class="main">⇒</span> val <span class="main">⇒</span> assn2"</span></span>  <span class="main">(</span><span class="quoted">"_ <span class="keyword1">↪</span> _"</span> <span class="main">[</span>56<span class="main">,</span>51<span class="main">]</span> 56<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">↪</span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">↦</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">]</span> <span class="main">∧</span> <span class="bound">c</span><span class="main">=</span><span class="main">0</span><span class="main">)</span>"</span></span>
  
<span class="comment1">(* If you don't mind syntax ambiguity: *)</span>
<span class="keyword1"><span class="command">notation</span></span> pred_ex <span class="main">(</span><span class="keyword2"><span class="keyword">binder</span></span> <span class="quoted">"<span class="keyword1">∃</span>"</span> 10<span class="main">)</span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">maps_to_ex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vname <span class="main">⇒</span> assn2"</span></span> <span class="main">(</span><span class="quoted">"_ <span class="keyword1">↪</span> <span class="keyword1">-</span>"</span> <span class="main">[</span>56<span class="main">]</span> 56<span class="main">)</span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main"><span class="free">↪</span></span> <span class="main"><span class="free">-</span></span> <span class="main">≡</span> <span class="main">∃</span><span class="bound">y</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">↪</span> <span class="bound">y</span>"</span></span>
        
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lmaps_to_ex</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vname set <span class="main">⇒</span> assn2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lmaps_to_ex</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> dom <span class="bound">s</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">xs</span></span></span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
   
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="main">-</span><span class="main">)</span> <span class="main">(</span><span class="free">s</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">∈</span> dom <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> maps_to_ex_def pointsto_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">lmaps_to_axpr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bexp <span class="main">⇒</span> bool <span class="main">⇒</span> assnp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lmaps_to_axpr</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">bv</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">ps</span><span class="main">.</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> pbval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">ps</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">bv</span></span></span> <span class="main">)</span>"</span></span>
 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">lmaps_to_axpr'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bexp <span class="main">⇒</span> bool <span class="main">⇒</span> assnp"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">lmaps_to_axpr'</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">bv</span></span></span> <span class="main">=</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="free"><span class="bound"><span class="entity">bv</span></span></span>"</span></span>
  
   
    
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Frame Inference›</span></span>
      
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Frame</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Frame</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span>    <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="keyword1">imp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span>"</span></span> 
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Frame'</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">Frame'</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span>"</span></span>  

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">cnv</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">cnv</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">y</span></span></span> <span class="main">==</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">y</span></span></span>"</span></span>
  
<span class="keyword1" id="Big_StepT_Partial-cnv_I"><span class="command">lemma</span></span> cnv_I<span class="main">:</span> <span class="quoted"><span class="quoted">"cnv <span class="free">x</span> <span class="free">x</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> cnv_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
<span class="keyword1" id="Big_StepT_Partial-Frame'_conv"><span class="command">lemma</span></span> Frame'_conv<span class="main">:</span> <span class="quoted"><span class="quoted">"Frame <span class="free">P</span> <span class="free">Q</span> <span class="free">F</span> <span class="main">=</span> Frame' <span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="main">□</span><span class="main">)</span> <span class="main">□</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">□</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> Frame_def Frame'_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>     
    
<span class="keyword1" id="Big_StepT_Partial-Frame'I"><span class="command">lemma</span></span> Frame'I<span class="main">:</span> <span class="quoted"><span class="quoted">"Frame' <span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="main">□</span><span class="main">)</span> <span class="main">□</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">□</span><span class="main">)</span> <span class="free">F</span> <span class="main">⟹</span> cnv <span class="free">F</span> <span class="free">F'</span> <span class="main">⟹</span> Frame <span class="free">P</span> <span class="free">Q</span> <span class="free">F'</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> Frame_def Frame'_def cnv_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="Big_StepT_Partial-FrameD"><span class="command">lemma</span></span> FrameD<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Frame <span class="free">P</span> <span class="free">Q</span> <span class="free">F</span>"</span></span> <span class="quoted"><span class="quoted">" <span class="free">P</span> <span class="free">s</span> "</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">F</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> Frame_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_commute<span class="main">)</span>    
    
<span class="keyword1" id="Big_StepT_Partial-Frame'_match"><span class="command">lemma</span></span> Frame'_match<span class="main">:</span> <span class="quoted"><span class="quoted">"Frame' <span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">P'</span><span class="main">)</span> <span class="main">□</span> <span class="free">Q</span> <span class="free">F</span> <span class="main">⟹</span> Frame' <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">P'</span> <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span> Frame_def Frame'_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> hide_lams<span class="main"><span class="main">)</span></span> prod.collapse sep.mult_assoc sep_conj_impl1<span class="main">)</span>   
    
<span class="keyword1" id="Big_StepT_Partial-R"><span class="command">lemma</span></span> R<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="free">A</span> <span class="keyword1">imp</span> <span class="free">B</span><span class="main">)</span> <span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">A</span> <span class="main">**</span> <span class="main">$</span><span class="free">n</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="free">B</span> <span class="main">**</span> <span class="main">$</span><span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="free">s</span>"</span></span>    
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">A</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="free">s</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">h1</span></span> <span class="skolem"><span class="skolem">h2</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="skolem">h1</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">$</span><span class="free">n</span> <span class="skolem">h2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">h1</span> <span class="main">##</span> <span class="skolem">h2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">s</span> <span class="main">=</span> <span class="skolem">h1</span><span class="main">+</span><span class="skolem">h2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> assms A <span class="keyword1"><span class="command">have</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="skolem">h1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">B</span> <span class="main">**</span> <span class="main">$</span><span class="free">n</span><span class="main">)</span> <span class="free">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> B n disj <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 
  
<span class="keyword1" id="Big_StepT_Partial-Frame'_matchdollar"><span class="command">lemma</span></span> Frame'_matchdollar<span class="main">:</span>  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Frame' <span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">P'</span> <span class="main">**</span> <span class="main">$</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">□</span> <span class="free">Q</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≥</span><span class="free">m</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"Frame' <span class="main">(</span><span class="main">$</span><span class="free">n</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">P'</span> <span class="main">(</span><span class="main">$</span><span class="free">m</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
 <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Frame_def Frame'_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">b</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧*</span> <span class="free">P'</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="free">F</span> <span class="main">∧*</span> <span class="free">Q</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>
        <span class="main">⟷</span> <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧*</span> <span class="free">P'</span> <span class="main">∧*</span> <span class="main">$</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="free">m</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="main">(</span><span class="free">F</span> <span class="main">∧*</span> <span class="free">Q</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nm sep_reorder_dollar<span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">P</span> <span class="main">∧*</span> <span class="free">P'</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="keyword1">imp</span> <span class="main">(</span><span class="free">F</span> <span class="main">∧*</span> <span class="free">Q</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">m</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>     
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> g<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> R<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧*</span> <span class="free">P'</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">F</span> <span class="main">∧*</span> <span class="free">Q</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
                                                            
<span class="keyword1" id="Big_StepT_Partial-Frame'_nomatch"><span class="command">lemma</span></span> Frame'_nomatch<span class="main">:</span> <span class="quoted"><span class="quoted">" Frame' <span class="free">P</span> <span class="main">(</span><span class="free">p</span> <span class="main">**</span> <span class="free">P'</span><span class="main">)</span> <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="free">F</span><span class="main">⟹</span> Frame' <span class="main">(</span><span class="free">p</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">P'</span> <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span>  Frame'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>   
    
<span class="keyword1" id="Big_StepT_Partial-Frame'_nomatchempty"><span class="command">lemma</span></span> Frame'_nomatchempty<span class="main">:</span> <span class="quoted"><span class="quoted">" Frame' <span class="free">P</span> <span class="free">P'</span> <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="free">F</span><span class="main">⟹</span> Frame' <span class="main">(</span><span class="main">□</span> <span class="main">**</span> <span class="free">P</span><span class="main">)</span> <span class="free">P'</span> <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span> <span class="free">F</span>"</span></span> 
  <span class="keyword1"><span class="command">unfolding</span></span>  Frame'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span> 
        
<span class="comment1">(* this will only be reached after a Frame'_match move, where P' is □ *)</span>    
<span class="keyword1" id="Big_StepT_Partial-Frame'_end"><span class="command">lemma</span></span> Frame'_end<span class="main">:</span> <span class="quoted"><span class="quoted">" Frame' <span class="free">P</span> <span class="main">□</span> <span class="main">□</span> <span class="free">P</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span>  Frame'_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>   
        
<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">"Frame <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v1</span> <span class="main">∧*</span> <span class="free">y</span> <span class="main">↪</span> <span class="free">v2</span><span class="main">)</span>  <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="var">?v</span><span class="main">)</span> <span class="var">?F</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Frame'I<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sep_conj_assoc<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Frame'_match<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Frame'_end<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sep_conj_ac sep_conj_empty' sep_conj_empty<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> cnv_I<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">"Frame <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v1</span> <span class="main">∧*</span> <span class="free">y</span> <span class="main">↪</span> <span class="free">v2</span><span class="main">)</span>  <span class="main">(</span><span class="free">y</span> <span class="main">↪</span> <span class="var">?v</span><span class="main">)</span> <span class="var">?F</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Frame'I<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sep_conj_assoc<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Frame'_end Frame'_match Frame'_nomatchempty Frame'_nomatch<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sep_conj_assoc<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sep_conj_ac sep_conj_empty' sep_conj_empty<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> cnv_I<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        
<span class="keyword1"><span class="command">method</span></span> frame_inference_init <span class="main">=</span> <span class="main">(</span><span class="operator">rule</span> Frame'I<span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sep_conj_assoc<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">method</span></span> frame_inference_solve <span class="main">=</span> <span class="main">(</span><span class="operator">rule</span> Frame'_matchdollar Frame'_end Frame'_match Frame'_nomatchempty Frame'_nomatch<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sep_conj_assoc<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  
<span class="keyword1"><span class="command">method</span></span> frame_inference_cleanup <span class="main">=</span> <span class="main">(</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sep_conj_ac sep_conj_empty' sep_conj_empty<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main"><span class="keyword3">;</span></span> <span class="operator">rule</span> cnv_I<span class="main">)</span>
  
  
<span class="keyword1"><span class="command">method</span></span> frame_inference <span class="main">=</span> <span class="main">(</span><span class="operator">frame_inference_init</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">frame_inference_solve</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span><span class="main"><span class="keyword3">,</span></span> <span class="main">(</span><span class="operator">frame_inference_cleanup</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span><span class="main">)</span>
<span class="keyword1"><span class="command">method</span></span> frame_inference_debug <span class="main">=</span> <span class="main">(</span><span class="operator">frame_inference_init</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">frame_inference_solve</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹tests›</span></span>  
      
<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">"Frame <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v1</span> <span class="main">∧*</span> <span class="free">y</span> <span class="main">↪</span> <span class="free">v2</span><span class="main">)</span>  <span class="main">(</span><span class="free">y</span> <span class="main">↪</span> <span class="var">?v</span><span class="main">)</span> <span class="var">?F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">frame_inference</span>
    
<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">"Frame <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v1</span> <span class="main">**</span> <span class="free">P</span> <span class="main">**</span> <span class="main">□</span> <span class="main">**</span> <span class="free">y</span> <span class="main">↪</span> <span class="free">v2</span> <span class="main">∧*</span> <span class="free">z</span> <span class="main">↪</span> <span class="free">v2</span> <span class="main">**</span> <span class="free">Q</span><span class="main">)</span>  <span class="main">(</span><span class="free">z</span> <span class="main">↪</span> <span class="var">?v</span> <span class="main">**</span> <span class="free">y</span> <span class="main">↪</span> <span class="var">?v2</span><span class="main">)</span> <span class="var">?F</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">frame_inference</span>
          
<span class="comment1">(* with dollar *)</span>

<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">" <span class="main">1</span> <span class="main">≤</span> <span class="free">v</span> <span class="main">⟹</span> Frame <span class="main">(</span><span class="main">$</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">∧*</span> <span class="inner_quoted">''x''</span> <span class="main">↪</span> int <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="main">$</span> <span class="main">1</span> <span class="main">∧*</span> <span class="inner_quoted">''x''</span> <span class="main">↪</span> <span class="var">?d</span><span class="main">)</span> <span class="var">?F</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Frame'I<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sep_conj_assoc<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span>  Frame'_matchdollar Frame'_end Frame'_match Frame'_nomatchempty Frame'_nomatch<span class="main"><span class="keyword3">;</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sep_conj_assoc<span class="main">)</span><span class="main"><span class="keyword3">?</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sep_conj_ac sep_conj_empty' sep_conj_empty<span class="main">)</span><span class="main"><span class="keyword3">?</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> cnv_I<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
    
    
<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">" <span class="main">0</span> <span class="main">&lt;</span> <span class="free">v</span> <span class="main">⟹</span> Frame <span class="main">(</span><span class="main">$</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">v</span><span class="main">)</span> <span class="main">∧*</span> <span class="inner_quoted">''x''</span> <span class="main">↪</span> int <span class="free">v</span><span class="main">)</span> <span class="main">(</span><span class="main">$</span> <span class="main">1</span> <span class="main">∧*</span> <span class="inner_quoted">''x''</span> <span class="main">↪</span> <span class="var">?d</span><span class="main">)</span> <span class="var">?F</span>"</span></span>    
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">frame_inference</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Expression evaluation›</span></span>
      
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">symeval</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">symeval</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> paval' <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">symevalb</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">symevalb</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> pbval' <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="bound">s</span> <span class="main">=</span> Some <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>      
      
<span class="keyword1" id="Big_StepT_Partial-symeval_c"><span class="command">lemma</span></span> symeval_c<span class="main">:</span> <span class="quoted"><span class="quoted">"symeval <span class="free">P</span> <span class="main">(</span>N <span class="free">v</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symeval_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      
    
<span class="keyword1" id="Big_StepT_Partial-symeval_v"><span class="command">lemma</span></span> symeval_v<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"Frame <span class="free">P</span> <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v</span><span class="main">)</span> <span class="free">F</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symeval <span class="free">P</span> <span class="main">(</span>V <span class="free">x</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symeval_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span> FrameD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> assms<span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def pointsto_def  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_fun_conv<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="Big_StepT_Partial-symeval_plus"><span class="command">lemma</span></span> symeval_plus<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symeval <span class="free">P</span> <span class="free">e1</span> <span class="free">v1</span>"</span></span> <span class="quoted"><span class="quoted">"symeval <span class="free">P</span> <span class="free">e2</span> <span class="free">v2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symeval <span class="free">P</span> <span class="main">(</span>Plus <span class="free">e1</span> <span class="free">e2</span><span class="main">)</span> <span class="main">(</span><span class="free">v1</span><span class="main">+</span><span class="free">v2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> symeval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
    
<span class="keyword1" id="Big_StepT_Partial-symevalb_c"><span class="command">lemma</span></span> symevalb_c<span class="main">:</span> <span class="quoted"><span class="quoted">"symevalb <span class="free">P</span> <span class="main">(</span>Bc <span class="free">v</span><span class="main">)</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> symevalb_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          
<span class="keyword1" id="Big_StepT_Partial-symevalb_and"><span class="command">lemma</span></span> symevalb_and<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symevalb <span class="free">P</span> <span class="free">e1</span> <span class="free">v1</span>"</span></span> <span class="quoted"><span class="quoted">"symevalb <span class="free">P</span> <span class="free">e2</span> <span class="free">v2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symevalb <span class="free">P</span> <span class="main">(</span>And <span class="free">e1</span> <span class="free">e2</span><span class="main">)</span> <span class="main">(</span><span class="free">v1</span> <span class="main">∧</span> <span class="free">v2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> symevalb_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Big_StepT_Partial-symevalb_not"><span class="command">lemma</span></span> symevalb_not<span class="main">:</span>  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symevalb <span class="free">P</span> <span class="free">e</span> <span class="free">v</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symevalb <span class="free">P</span> <span class="main">(</span>Not <span class="free">e</span><span class="main">)</span> <span class="main">(</span><span class="main">¬</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> symevalb_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="Big_StepT_Partial-symevalb_less"><span class="command">lemma</span></span> symevalb_less<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"symeval <span class="free">P</span> <span class="free">e1</span> <span class="free">v1</span>"</span></span> <span class="quoted"><span class="quoted">"symeval <span class="free">P</span> <span class="free">e2</span> <span class="free">v2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"symevalb <span class="free">P</span> <span class="main">(</span>Less <span class="free">e1</span> <span class="free">e2</span><span class="main">)</span> <span class="main">(</span><span class="free">v1</span> <span class="main">&lt;</span> <span class="free">v2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> symevalb_def symeval_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1"><span class="command">lemmas</span></span> symeval <span class="main">=</span> symeval_c symeval_v symeval_plus symevalb_c symevalb_and symevalb_not symevalb_less
   
<span class="keyword1"><span class="command">schematic_goal</span></span> <span class="quoted"><span class="quoted">"symevalb <span class="main">(</span> <span class="main">(</span><span class="free">x</span> <span class="main">↪</span> <span class="free">v1</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span><span class="free">y</span> <span class="main">↪</span> <span class="free">v2</span><span class="main">)</span> <span class="main">)</span> <span class="main">(</span>Less <span class="main">(</span>Plus <span class="main">(</span>V <span class="free">x</span><span class="main">)</span> <span class="main">(</span>V <span class="free">y</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>N <span class="numeral">5</span><span class="main">)</span><span class="main">)</span> <span class="var">?g</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> symeval <span class="main"><span class="keyword3">|</span></span> <span class="operator">frame_inference</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SepLog_Hoare">
<div class="head">
<h1>Theory SepLog_Hoare</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Hoare Logic based on Separation Logic and Time Credits"</span></span> 
<span class="keyword1"><span class="command">theory</span></span> SepLog_Hoare
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Big_StepT_Partial.html">Big_StepT_Partial</a>    <span class="quoted">"<a href="Sep_Algebra_Add.html">SepLogAdd/Sep_Algebra_Add</a>"</span>                                           
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Definition of Validity"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hoare3_valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn2 <span class="main">⇒</span> com <span class="main">⇒</span> assn2 <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span> <span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>  <span class="main">⟷</span>  
     <span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>
     <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span><span class="main">)</span>
           <span class="main">∧</span> <span class="bound">n</span><span class="main">≥</span><span class="bound">m</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">n</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span>  <span class="main">)</span>"</span></span>
 
<span class="keyword1" id="SepLog_Hoare-alternative"><span class="command">lemma</span></span> alternative<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>  <span class="main">⟷</span>  
     <span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>
     <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">t</span> <span class="bound">n'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">t</span> <span class="main">⇓</span> <span class="bound">ps'</span><span class="main">)</span>
             <span class="main">∧</span> <span class="bound">n</span><span class="main">=</span><span class="bound">n'</span><span class="main">+</span><span class="bound">t</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">n'</span><span class="main">)</span><span class="main">)</span>  <span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">rule</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span><span class="main">≥</span><span class="bound">m</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">n</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span>  <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def<span class="keyword1"><span class="command">.</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> P <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> Z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="skolem">m</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">n</span><span class="main">-</span><span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">-</span><span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Z <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span> "</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
<span class="keyword1"><span class="command">qed</span></span>
       

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Hoare Rules"</span></span>    
     
<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hoareT3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn2 <span class="main">⇒</span> com <span class="main">⇒</span> assn2 <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span> <span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>

Skip<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> SKIP <span class="main"><span class="free">{</span></span> <span class="main">$</span><span class="main">0</span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

Assign<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span>lmaps_to_expr_x <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> dom <span class="bound">s</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">↪</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> True <span class="bound">s</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span><span class="main">;</span>
       <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span>  <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> False <span class="bound">s</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>   <span class="main">|</span>

Frame<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>    <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="free">}</span></span> "</span></span>  <span class="main">|</span>

Seq<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span> <span class="main">;</span>  <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span>  <span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main"><span class="free">}</span></span> "</span></span>  <span class="main">|</span>

While<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> True <span class="bound">s</span><span class="main">)</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span>  <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main"><span class="free">}</span></span>  <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>  vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span>  <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> False <span class="bound">s</span> <span class="main"><span class="free">}</span></span> "</span></span>  <span class="main">|</span>
  
conseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="bound">s</span> <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>   <span class="main">|</span>

normalize<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>    <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">**</span> <span class="main">$</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main">**</span> <span class="main">$</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">**</span> <span class="main">$</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span> "</span></span>   <span class="main">|</span>

constancy<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>    <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="main">⋀</span><span class="bound">ps</span> <span class="bound">ps'</span><span class="main">.</span> <span class="bound">ps</span> <span class="main">=</span> <span class="bound">ps'</span> <span class="keyword1">on</span> UNIV <span class="main">-</span> lvars <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">ps</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">ps'</span>  <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">ps</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="bound">ps</span> <span class="main"><span class="free">}</span></span> "</span></span> <span class="main">|</span>

Assign'''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span>  <span class="main">$</span><span class="main">1</span> <span class="main">**</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">↪</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main"><span class="free">{</span></span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">↪</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

Assign''''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  symeval <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

Assign4<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">∈</span>dom <span class="bound">ps</span> <span class="main">∧</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">ps</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">↦</span><span class="main">(</span>paval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">ps</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

False<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span>  <span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> False <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span>  <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

pureI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟹</span>  <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span><span class="main">)</span> <span class="main">⟹</span>  <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">↑</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
   

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Derived Rules›</span></span>

  
<span class="keyword1" id="SepLog_Hoare-Frame_R"><span class="command">lemma</span></span> Frame_R<span class="main">:</span>  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span>  <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"Frame <span class="free">P'</span> <span class="free">P</span> <span class="free">F</span>"</span></span>
             <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="free">P'</span> <span class="main">}</span> <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">**</span> <span class="free">F</span> <span class="main">}</span> "</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Frame<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Frame_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="SepLog_Hoare-strengthen_post"><span class="command">lemma</span></span> strengthen_post<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">Q'</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            
  
        
<span class="keyword1" id="SepLog_Hoare-weakenpre"><span class="command">lemma</span></span> weakenpre<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">s</span>  <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conseq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness Proof›</span></span>
   
    
       
<span class="keyword1" id="SepLog_Hoare-exec_preserves_disj"><span class="command">lemma</span></span> exec_preserves_disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="free">t</span> <span class="main">⇓</span> <span class="free">ps'</span> <span class="main">⟹</span> <span class="free">ps''</span> <span class="main">##</span> <span class="free">ps</span> <span class="main">⟹</span> <span class="free">ps''</span> <span class="main">##</span> <span class="free">ps'</span>"</span></span> 
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> big_step_t3_post_dom_conv<span class="main">)</span>  
  <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_fun_def domain_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="SepLog_Hoare-FrameRuleSound"><span class="command">lemma</span></span> FrameRuleSound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="free">P</span>  <span class="main">}</span> <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span>  <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">**</span> <span class="free">F</span> <span class="main">}</span> <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">**</span> <span class="free">F</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">P</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pP</span></span> <span class="skolem"><span class="skolem">nP</span></span> <span class="skolem"><span class="skolem">pF</span></span> <span class="skolem"><span class="skolem">nF</span></span> <span class="keyword2"><span class="keyword">where</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pP</span><span class="main">,</span> <span class="skolem">nP</span><span class="main">)</span> <span class="main">##</span> <span class="main">(</span><span class="skolem">pF</span><span class="main">,</span> <span class="skolem">nF</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">pP</span><span class="main">,</span> <span class="skolem">nP</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">pF</span><span class="main">,</span> <span class="skolem">nF</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">pP</span><span class="main">,</span> <span class="skolem">nP</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="skolem">pF</span><span class="main">,</span> <span class="skolem">nF</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="operator">unfolded</span> hoare3_valid_def<span class="main">]</span> P
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pP'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> ex<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="skolem">pP</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">pP'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">nP</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">pP'</span><span class="main">,</span> <span class="skolem">nP</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
    <span class="keyword1"><span class="command">have</span></span> exF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">pP'</span> <span class="main">+</span> <span class="skolem">pF</span>"</span></span>  
       <span class="keyword1"><span class="command">using</span></span> Framer2 ex orth add <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> QF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pP'</span> <span class="main">+</span> <span class="skolem">pF</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pP'</span><span class="main">,</span><span class="skolem">nP</span><span class="main">-</span><span class="skolem">m</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">pF</span><span class="main">,</span><span class="skolem">nF</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> orth exec_preserves_disj<span class="main">[</span><span class="operator">OF</span> ex<span class="main">]</span> add m F Q <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_add_ac<span class="main">)</span> 
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">pP'</span><span class="main">+</span><span class="skolem">pF</span> <span class="main">∧</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">pP'</span><span class="main">+</span><span class="skolem">pF</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>  
      <span class="keyword1"><span class="command">using</span></span> QF exF add m <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free">C</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">-</span> <span class="bound">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hoare3_sound<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span>  <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms        
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoareT3.induct<span class="main">)</span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>False <span class="skolem">c</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hoare3_valid_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Skip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hoare3_valid_def dollar_def<span class="main">)</span>   
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign4 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def sep_conj_def hoare3_valid_def <span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ps b y
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">(</span><span class="skolem">x</span> <span class="main">↦</span> paval <span class="skolem">a</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">v</span><span class="main">)</span>   
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def <span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> separate_othogonal<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> exI conjI<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> big_step_t_part.Assign<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pointsto_def<span class="main">)</span>  <span class="keyword1"><span class="command">unfolding</span></span>  sep_conj_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">%</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span><span class="main">=</span><span class="skolem">x</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> <span class="skolem">ps</span> <span class="bound">y</span><span class="main">)</span> <span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">%</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">then</span> Some <span class="main">(</span>paval <span class="skolem">a</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_prod_def sep_disj_fun_def plus_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> domIff domain_conv<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domI insertE option.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> domIff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3_valid_def<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">⟹</span> pbval <span class="skolem">b</span> <span class="bound">ps</span>
     <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">n</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3_valid_def<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">⟹</span> <span class="main">¬</span> pbval <span class="skolem">b</span> <span class="bound">ps</span>
     <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">n</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def<span class="main">)</span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ps</span> <span class="skolem">n</span><span class="main">)</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pbval <span class="skolem">b</span> <span class="skolem">ps</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> T<span class="main">[</span><span class="operator">OF</span> P dom<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">-</span><span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> big_step_t3_post_dom_conv<span class="main">[</span><span class="operator">OF</span> d<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> klong<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="skolem">ps'</span> <span class="main">=</span> dom <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>   
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> big_step_t_part.IfTrue<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> dom<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> True<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> d<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command">using</span></span> m1 Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
           <span class="keyword1"><span class="command">using</span></span> Q Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>          
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> F<span class="main">[</span><span class="operator">OF</span> P dom<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> 
            <span class="keyword2"><span class="keyword">and</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">-</span><span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> big_step_t3_post_dom_conv<span class="main">[</span><span class="operator">OF</span> d<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom <span class="skolem">ps'</span> <span class="main">=</span> dom <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> big_step_t_part.IfFalse<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> False<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> d<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> m1 Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
           <span class="keyword1"><span class="command">using</span></span> Q Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>    
       <span class="keyword1"><span class="command">qed</span></span>   
     <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">next</span></span>     
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Frame <span class="skolem">P</span> <span class="skolem">C</span> <span class="skolem">Q</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> FrameRuleSound <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">P</span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">R</span><span class="main">)</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ps</span> <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> Seq<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> C1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> Seq<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">ps'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m'</span> <span class="main">⇓</span> <span class="skolem">ps''</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">≤</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">(</span><span class="skolem">ps''</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span> <span class="main">-</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">m'</span> <span class="main">⇓</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> big_step_t_part.Seq<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">have</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">+</span> <span class="skolem">m'</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m' m <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">(</span><span class="skolem">ps''</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="skolem">m'</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> R <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps''</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="skolem">m'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> a b c <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def<span class="main">)</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ps</span> <span class="skolem">n</span><span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span> <span class="skolem">ps3</span><span class="main">)</span> 
          
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pbval <span class="skolem">b</span> <span class="skolem">ps3</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="comment1">― ‹prepare premise to obtain ...›</span>
        <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps3</span><span class="main">,</span> <span class="skolem">x'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="skolem">ps3</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Suc <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">from</span></span> P dom True <span class="keyword1"><span class="command">have</span></span> 
           g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="skolem">b</span> True <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps3</span><span class="main">,</span> <span class="skolem">x'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> dollar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
        <span class="comment1">― ‹... the loop body from the outer IH›</span>
        <span class="keyword1"><span class="command">from</span></span> While<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3_valid_def<span class="main">]</span> g <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps3'</span></span> <span class="skolem"><span class="skolem">x''</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps3</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">x''</span> <span class="main">⇓</span> <span class="skolem">ps3'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x''</span> <span class="main">≤</span> <span class="skolem">x'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps3'</span><span class="main">,</span> <span class="skolem">x'</span> <span class="main">-</span> <span class="skolem">x''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> P''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps3'</span><span class="main">,</span> <span class="skolem">x'''</span><span class="main">)</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> Suc''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x'</span> <span class="main">-</span> <span class="skolem">x''</span> <span class="main">=</span> Suc <span class="skolem">x'''</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
              
        <span class="keyword1"><span class="command">from</span></span> C big_step_t3_post_dom_conv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom <span class="skolem">ps3</span> <span class="main">=</span> dom <span class="skolem">ps3'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">with</span></span> dom <span class="keyword1"><span class="command">have</span></span> dom'<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="skolem">ps3'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              
        <span class="comment1">― ‹prepare premises to ...›</span>
        <span class="keyword1"><span class="command">from</span></span> C big_step_t3_gt0 <span class="keyword1"><span class="command">have</span></span> gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x''</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps3'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x''</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x''</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="bound">m</span><span class="main">)</span> <span class="main">∧</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps'</span> <span class="main">∧</span> <span class="main">¬</span> pbval <span class="skolem">b</span> <span class="bound">ps'</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> less<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> gt0 x Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">using</span></span> dom' Suc P' <span class="keyword1"><span class="command">unfolding</span></span> dollar_def sep_conj_def  
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
        <span class="comment1">― ‹... obtain the tail of the While loop from the inner IH›</span>
        <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps3''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps3'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps3''</span><span class="main">)</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> m''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x''</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps3''</span><span class="main">,</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x''</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>
                    <span class="keyword2"><span class="keyword">and</span></span> dom''<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="skolem">ps3''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pbval <span class="skolem">b</span> <span class="skolem">ps3''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
        <span class="comment1">― ‹combine body and tail to one loop unrolling:›</span>
        <span class="comment1">― ‹- the Bigstep Semantic›</span>
        <span class="keyword1"><span class="command">have</span></span> BigStep<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps3</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">x''</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps3''</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> big_step_t_part.WhileTrue<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> True<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> dom<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> C<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> w<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>            
        <span class="comment1">― ‹- the TimeBound›</span> 
        <span class="keyword1"><span class="command">have</span></span> TimeBound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x''</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> m'' Suc'' Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>            
        <span class="comment1">― ‹- the invariantPreservation›</span> 
        <span class="keyword1"><span class="command">have</span></span> invariantPreservation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps3''</span><span class="main">,</span> <span class="skolem">x</span> <span class="main">-</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">x''</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> P'' m'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
            
            
        <span class="comment1">― ‹finally combine BigStep Semantic, TimeBound, invariantPreservation›</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps3''</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">x''</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command">using</span></span> BigStep TimeBound invariantPreservation dom'' b'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>                 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps3</span><span class="main">,</span> <span class="skolem">x'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="skolem">ps3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Suc <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps3</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> big_step_t_part.WhileFalse<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> dom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command">using</span></span> Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> P Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">using</span></span> dom <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>    
      <span class="keyword1"><span class="command">qed</span></span>         
    <span class="keyword1"><span class="command">qed</span></span>       
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>       
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>conseq <span class="skolem">P</span> <span class="skolem">c</span> <span class="skolem">Q</span> <span class="skolem">P'</span> <span class="skolem">Q'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>normalize <span class="skolem">P</span> <span class="skolem">m</span> <span class="skolem">C</span> <span class="skolem">Q</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ps</span> <span class="skolem">N</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stardiff<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stardiff<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
    <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">∧*</span> <span class="main">$</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps</span><span class="main">,</span><span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="skolem">m</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_prod_def sep_disj_nat_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">=</span>  <span class="skolem">N</span> <span class="main">+</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> normalize<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        
    <span class="keyword1"><span class="command">from</span></span> P 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m'</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m'</span> <span class="main">≤</span> <span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">-</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">have</span></span> Q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">-</span> <span class="skolem">m'</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stardiff<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> nm2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">≤</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">-</span> <span class="skolem">m'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stardiff<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> 
        <span class="keyword1"><span class="command">using</span></span> Q2
        <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">+</span> <span class="skolem">n</span>›</span></span> m' nm2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">linarith</span>
        <span class="keyword1"><span class="command">using</span></span> Q2 <span class="quoted"><span class="quoted">‹<span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">N</span> <span class="main">+</span> <span class="skolem">n</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>          
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>constancy <span class="skolem">P</span> <span class="skolem">C</span> <span class="skolem">Q</span> <span class="skolem">R</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> constancy<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ps</span> <span class="skolem">n</span><span class="main">)</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> C big_step_t3_same <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">ps'</span> <span class="keyword1">on</span> UNIV <span class="main">-</span> lvars <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> constancy<span class="main">(</span>2<span class="main">)</span> 1<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign''' <span class="skolem">x</span> <span class="skolem">ds</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ps n <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">(</span><span class="skolem">x</span><span class="main">↦</span><span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> big_step_t_part.Assign<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> separate_othogonal_commuted'<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def pointsto_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> separate_othogonal_commuted'<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def pointsto_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> separate_othogonal_commuted'<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def pointsto_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
         
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign'''' <span class="skolem">P</span> <span class="skolem">a</span> <span class="skolem">v</span> <span class="skolem">x</span> <span class="skolem">Q'</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
           
  <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ps</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> Assign''''<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">m</span></span>
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">::=</span> N <span class="skolem">v</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">)</span> Assign''''<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> symeval_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a</span> <span class="skolem">ps</span> <span class="main">=</span> Some <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> avalDirekt3_correct<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pureI <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">c</span> <span class="skolem">R</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span> 
  
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Completeness›</span></span>
    
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wp3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> assn2 <span class="main">⇒</span> assn2"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">wp<span class="hidden">⇩</span><sub>3</sub></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">n</span><span class="main">≥</span><span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">n</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    
         
<span class="keyword1" id="SepLog_Hoare-wp3_SKIP"><span class="command">lemma</span></span> wp3_SKIP<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> SKIP <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp3_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def sep_disj_prod_def sep_disj_nat_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> t n <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> big_step_t_part.Skip <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
<span class="keyword1" id="SepLog_Hoare-wp3_Assign"><span class="command">lemma</span></span> wp3_Assign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> vars <span class="free">e</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">(</span><span class="free">x</span> <span class="main">↦</span> paval <span class="free">e</span> <span class="bound">ps</span><span class="main">)</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp3_def <span class="main">)</span>  
  <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_prod_def sep_disj_nat_def dollar_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
 
<span class="keyword1" id="SepLog_Hoare-wpt_Seq"><span class="command">lemma</span></span> wpt_Seq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp3_def fun_eq_iff <span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b t m1 s2 m2  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">s2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s m t' m1 t m2
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m1</span><span class="main">+</span><span class="skolem">m2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> big_step_t_part.Seq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SepLog_Hoare-wp3_If"><span class="command">lemma</span></span> wp3_If<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">ELSE</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp3_def fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_prod_def sep_disj_nat_def dollar_def<span class="main">)</span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a ba t x <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ba</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a ba t x <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ba</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a ba t m
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pbval <span class="free">b</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> big_step_t_part.IfTrue<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> big_step_t3_post_dom_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> big_step_t_part.IfFalse<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> big_step_t3_post_dom_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
         
<span class="keyword1" id="SepLog_Hoare-sFTrue"><span class="command">lemma</span></span> sFTrue<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pbval <span class="free">b</span> <span class="free">ps</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wp</span> <span class="main">=</span> <span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> wp3_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> tn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tt</span> <span class="main">⇓</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps''</span><span class="main">,</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">tt</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="keyword2"><span class="keyword">where</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">ps'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">t'</span> <span class="main">⇓</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> tt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">=</span><span class="main">1</span><span class="main">+</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> tn <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span><span class="skolem">tt</span><span class="main">+</span><span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_Suc_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
      
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def  wp3_def  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">+</span><span class="skolem">t'</span><span class="main">+</span><span class="skolem">k</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> n tt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps''</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> w2 Q n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dollar_def sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>  
        <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  t'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">ps'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">t'</span> <span class="main">⇓</span> <span class="skolem">ps''</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps''</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wp3_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
      
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wp</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp3_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps''</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">+</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">t'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> t t' n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> c w assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Q t t' n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>      
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="SepLog_Hoare-sFFalse"><span class="command">lemma</span></span> sFFalse<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> pbval <span class="free">b</span> <span class="free">ps</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wp</span> <span class="main">=</span> <span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> wp3_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> tn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⇓</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> w1 w2 big_step_t_determ2 <span class="keyword1"><span class="command">have</span></span> t1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">=</span><span class="skolem">ps'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def <span class="keyword1"><span class="command">using</span></span> t1 tn Q pps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dollar_def sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⇓</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wp</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp3_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">ps</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Q w2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>
    
<span class="keyword1" id="SepLog_Hoare-sF'"><span class="command">lemma</span></span> sF'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>   
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="free">ps</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pbval <span class="free">b</span> <span class="free">ps</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> sFTrue sFFalse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dollar_def wp3_def sep_conj_def<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="SepLog_Hoare-sF"><span class="command">lemma</span></span> sF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="free">s</span>"</span></span>   
 <span class="keyword1"><span class="command">using</span></span> sF'
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> prod.case_eq_if prod.collapse sep_conj_impl1<span class="main">)</span> 
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Q</span><span class="main">.</span> <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">c</span> <span class="bound">Q</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="bound">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> WhileWpisPre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
    c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free">b</span> True <span class="bound">s</span><span class="main">)</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="skolem">I</span>  <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span>             
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> c<span class="main">)</span>              
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  <span class="keyword1"><span class="command">unfolding</span></span> I_def   <span class="keyword1"><span class="command">using</span></span> sF <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     
  <span class="keyword1"><span class="command">from</span></span> hoareT3.While<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">I</span>"</span></span><span class="main">]</span> c' <span class="keyword1"><span class="command">have</span></span>
    w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>  vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">{</span>  <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free">b</span> False <span class="bound">s</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>       
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span>      
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> w<span class="main">)</span>           
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> sF I_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Pair_inject R case_prodE case_prodI2<span class="main">)</span>      
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
 
  
<span class="keyword1" id="SepLog_Hoare-wp3_is_pre"><span class="command">lemma</span></span> wp3_is_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">c</span> <span class="free">Q</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> SKIP
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">using</span></span> Frame<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">$</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">$</span><span class="main">1</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> Skip<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep.add_ac<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Assign4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>               
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> hoareT3.Seq<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">x1</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpre<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hoareT3.If<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P1<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">x1</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">c1</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">Q</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="skolem">c2</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">Q</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> vars <span class="skolem">x1</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">x1</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">x1</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> vars <span class="skolem">x1</span> <span class="main">⊆</span> dom <span class="bound">ps</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"pbval <span class="skolem">x1</span> <span class="improper">aa</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> <span class="comment1">(* strange! *)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> WhileWpisPre <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>  
  
  
<span class="keyword1"><span class="command">theorem</span></span> hoare3_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>  
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wp3_is_pre<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">Q</span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hoare3_valid_def wp3_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>     
  
  
<span class="keyword1"><span class="command">theorem</span></span> hoare3_sound_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">⟷</span> <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>  
 <span class="keyword1"><span class="command">using</span></span> hoare3_complete hoare3_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  
  
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"What about garbage collection?"</span></span>
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">F</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">ps1'</span> <span class="bound">ps2'</span> <span class="bound">m</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps1'</span> <span class="main">+</span> <span class="bound">ps2'</span> <span class="main">∧</span>  <span class="bound">ps1'</span> <span class="main">##</span> <span class="bound">ps2'</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">e1</span> <span class="main">+</span> <span class="bound">e2</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">ps1'</span><span class="main">,</span><span class="bound">e1</span><span class="main">)</span> <span class="main">)</span>"</span></span>  
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub></span> <span class="free">C</span> <span class="main">(</span><span class="free">Q</span><span class="main">**</span><span class="main">(</span><span class="main">%</span><span class="main"><span class="bound">_</span></span><span class="main">.</span>True<span class="main">)</span><span class="main">)</span> <span class="main">=</span> F <span class="free">C</span> <span class="free">Q</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
  <span class="keyword1"><span class="command">unfolding</span></span> wp3_def sep_conj_def 
  <span class="keyword1"><span class="command">unfolding</span></span> F_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b m aaa ba ab bb <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">aaa</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ab</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ba</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">bb</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a ps1' ps2' m e1 e2
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps1'</span><span class="main">+</span><span class="skolem">ps2'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

                
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hoareT3_validGC</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn2 <span class="main">⇒</span> com <span class="main">⇒</span> assn2 <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>G</sub></span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span> <span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">⊨<span class="hidden">⇩</span><sub>G</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>  <span class="main">⟷</span> <span class="main">⊨<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">}</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">{</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">**</span> <span class="main">(</span><span class="main">%</span><span class="main"><span class="bound">_</span></span><span class="main">.</span>True<span class="main">)</span> <span class="main">}</span>"</span></span>                                                                                                  
  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SepLog_Examples">
<div class="head">
<h1>Theory SepLog_Examples</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Examples"</span></span>
<span class="keyword1"><span class="command">theory</span></span> SepLog_Examples
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SepLog_Hoare.html">SepLog_Hoare</a>
<span class="keyword2"><span class="keyword">begin</span></span>


      
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹nice example›</span></span>
  
     
<span class="keyword1"><span class="command">lemmas</span></span> strongAssign <span class="main">=</span> Assign''''<span class="main">[</span><span class="operator">OF</span> _ strengthen_post<span class="main">,</span> <span class="operator">OF</span> _ Frame_R<span class="main">,</span> <span class="operator">OF</span> _ Assign'''<span class="main">]</span>  
    
<span class="keyword1" id="SepLog_Examples-myrule"><span class="command">lemma</span></span> myrule<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> <span class="free">s</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="main">$</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">∧*</span> <span class="inner_quoted">''x''</span> <span class="main">↪</span> int <span class="free">x</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr' <span class="main">(</span>Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> True <span class="bound">s</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"symevalb <span class="main">(</span><span class="main">$</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">**</span> <span class="inner_quoted">''x''</span> <span class="main">↪</span> int <span class="free">x</span><span class="main">)</span> <span class="main">(</span>Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span><span class="main">)</span> <span class="free">v</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">↑</span><span class="main">(</span><span class="free">v</span><span class="main">=</span>True<span class="main">)</span> <span class="main">**</span> <span class="main">$</span> <span class="main">(</span><span class="numeral">2</span> <span class="main">*</span> <span class="free">x</span><span class="main">)</span> <span class="main">**</span> <span class="inner_quoted">''x''</span> <span class="main">↪</span> int <span class="free">x</span><span class="main">)</span> <span class="free">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">unfolding</span></span> symevalb_def lmaps_to_axpr'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sum</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"int <span class="main">⇒</span> int"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">sum</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">≤</span> <span class="main">0</span> <span class="keyword1">then</span> <span class="main">0</span> <span class="keyword1">else</span> <span class="free">sum</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">i</span></span></span> <span class="main">-</span> <span class="main">1</span><span class="main">)</span> <span class="main">+</span> <span class="free"><span class="bound"><span class="entity">i</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">wsum</span> <span class="main">==</span>
  <span class="keyword1">WHILE</span> Less <span class="main">(</span>N <span class="main">0</span><span class="main">)</span> <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span>
  <span class="keyword1">DO</span> <span class="main">(</span> 
      <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
  
  
  
<span class="keyword1" id="SepLog_Examples-E4_R"><span class="command">lemma</span></span> E4_R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span><span class="main">↑</span><span class="main">(</span><span class="free">v</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">v</span><span class="main">)</span> <span class="main">**</span> pointsto <span class="inner_quoted">''x''</span> <span class="main">(</span>int <span class="free">v</span><span class="main">)</span> <span class="main">}</span> 
            <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>
           <span class="main">{</span><span class="main">↑</span><span class="main">(</span><span class="free">v</span><span class="main">&gt;</span><span class="main">0</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">(</span><span class="numeral">2</span><span class="main">*</span><span class="free">v</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">**</span> pointsto <span class="inner_quoted">''x''</span> <span class="main">(</span>int <span class="free">v</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> pureI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strongAssign<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> symeval <span class="main"><span class="keyword3">|</span></span> <span class="operator">frame_inference</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>   
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>  sep_reorder_dollar <span class="main">)</span> 
     
  
  
<span class="keyword1" id="SepLog_Examples-prod_0"><span class="command">lemma</span></span> prod_0<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">::</span>char list <span class="main">⇒</span> int option<span class="main">,</span> <span class="bound">c</span><span class="main">::</span>nat<span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> Map.empty <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="free">h</span> <span class="main">⟹</span> <span class="free">h</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> zero_prod_def zero_fun_def<span class="main">)</span>
 
 

<span class="keyword1" id="SepLog_Examples-example2"><span class="command">lemma</span></span> example2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> <span class="main">(</span>pointsto <span class="inner_quoted">''x''</span> <span class="free">n</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span>pointsto <span class="inner_quoted">''y''</span> <span class="free">n</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main">}</span> <span class="inner_quoted">''x''</span> <span class="main">::=</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">{</span> <span class="main">(</span>pointsto <span class="inner_quoted">''x''</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span>pointsto <span class="inner_quoted">''y''</span> <span class="free">n</span><span class="main">)</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main">)</span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Frame<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>pointsto <span class="inner_quoted">''y''</span> <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"lmaps_to_expr_x <span class="inner_quoted">''x''</span> <span class="main">(</span> Plus <span class="main">(</span>V <span class="inner_quoted">''x''</span><span class="main">)</span> <span class="main">(</span>N <span class="main">(</span><span class="main">-</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> Assign<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_conj_assoc<span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sep_conj_impl<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s h <span class="keyword1"><span class="command">unfolding</span></span> pointsto_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>    
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_conj_commute<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> sep_conj_impl<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def
      <span class="keyword1"><span class="command">using</span></span> prod_0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>   
    

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="SepLogK_Hoare">
<div class="head">
<h1>Theory SepLogK_Hoare</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Hoare Logic based on Separation Logic and Time Credits (big-O style)"</span></span> 
<span class="keyword1"><span class="command">theory</span></span> SepLogK_Hoare
  <span class="keyword2"><span class="keyword">imports</span></span> <a href="Big_StepT.html">Big_StepT</a>  <a href="Partial_Evaluation.html">Partial_Evaluation</a>  <a href="Big_StepT_Partial.html">Big_StepT_Partial</a>
<span class="keyword2"><span class="keyword">begin</span></span>


   
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Definition of Validity›</span></span>
          
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">hoare3o_valid</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn2 <span class="main">⇒</span> com <span class="main">⇒</span> assn2 <span class="main">⇒</span> bool"</span></span>
  <span class="main">(</span><span class="quoted">"<span class="keyword1">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub>'</span> <span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span> <span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span>"</span> 50<span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>  <span class="main">⟷</span>
    <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>
 <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span><span class="main">)</span> 
     <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span>
     <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
 
 


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Hoare Rules"</span></span>
     
<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hoare3a</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn2 <span class="main">⇒</span> com <span class="main">⇒</span> assn2 <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span> <span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>

Skip<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> SKIP <span class="main"><span class="free">{</span></span> <span class="main">$</span><span class="main">0</span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

Assign4<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">∈</span>dom <span class="bound">ps</span> <span class="main">∧</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">ps</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">↦</span><span class="main">(</span>paval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">ps</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> True <span class="bound">s</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span><span class="main">;</span>
       <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span>  <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> False <span class="bound">s</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>   <span class="main">|</span>

Frame<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>    <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="free">}</span></span> "</span></span>  <span class="main">|</span>

Seq<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span> <span class="main">;</span>  <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span>  <span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main"><span class="free">}</span></span> "</span></span>  <span class="main">|</span>

While<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> True <span class="bound">s</span><span class="main">)</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>  vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span>  <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main"><span class="free">}</span></span>  <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>  vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span>  <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> False <span class="bound">s</span> <span class="main"><span class="free">}</span></span> "</span></span>  <span class="main">|</span>
   
conseqS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> 
           <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>   
  
<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hoare3b</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn2 <span class="main">⇒</span> com <span class="main">⇒</span> assn2 <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>b</sub></span> <span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span> <span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>

import<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">}</span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main">{</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">}</span> <span class="main">⟹</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>b</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>


conseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>b</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">*</span><span class="bound">n</span><span class="main">)</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> 
           <span class="keyword1"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>b</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>   

  
  
<span class="keyword1"><span class="command">inductive</span></span>
  <span class="entity">hoare3'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"assn2 <span class="main">⇒</span> com <span class="main">⇒</span> assn2 <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub>'</span> <span class="keyword3">(</span><span class="keyword1">{</span><span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">/ </span><span class="keyword3">(</span>_<span class="keyword3">)</span><span class="keyword3">/ </span><span class="keyword1">{</span> <span class="keyword3">(1</span>_<span class="keyword3">)</span><span class="keyword1">}</span><span class="keyword3">)</span>"</span> 50<span class="main">)</span>
<span class="keyword2"><span class="keyword">where</span></span>

Skip<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> SKIP <span class="main"><span class="free">{</span></span> <span class="main">$</span><span class="main">0</span><span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>


Assign<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span>lmaps_to_expr_x <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> dom <span class="bound">s</span> <span class="main">=</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">}</span> <span class="main">∧</span> <span class="bound">c</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">↪</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>

Assign'<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span>pointsto <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">**</span> <span class="main">(</span> pointsto <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">⟶*</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>  <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span> N <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>


Assign2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> pointsto <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">v'</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span> pointsto <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">v</span> <span class="main">⟶*</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>  <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span>
                 <span class="keyword1">and</span> sep_true <span class="main">**</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> paval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">ps</span> <span class="main">=</span> <span class="bound">v</span>  <span class="main">)</span> <span class="main">)</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span>  <span class="main">|</span>



If<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> True <span class="bound">s</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span><span class="main">;</span>
       <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span>  <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> False <span class="bound">s</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
  <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> <span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">c<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>   <span class="main">|</span>

Frame<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>    <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">F</span></span></span> <span class="main"><span class="free">}</span></span> "</span></span>  <span class="main">|</span>

Seq<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span> <span class="main">;</span>  <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span>  <span class="main"><span class="free">}</span></span> <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span> <span class="main"><span class="free">}</span></span> "</span></span>  <span class="main">|</span>

While<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> True <span class="bound">s</span><span class="main">)</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>  vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span>  <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main"><span class="free">}</span></span>  <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>  vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main"><span class="free">}</span></span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span>  <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> False <span class="bound">s</span> <span class="main"><span class="free">}</span></span> "</span></span>  <span class="main">|</span>
   
conseq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">*</span><span class="bound">n</span><span class="main">)</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">)</span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">k</span></span></span><span class="main">&gt;</span><span class="main">0</span> <span class="main">⟧</span> <span class="main">⟹</span> 
           <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P'</span></span></span><span class="main"><span class="free">}</span></span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>   <span class="main">|</span>

normalize<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>    <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">**</span> <span class="main">$</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main">**</span> <span class="main">$</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main"><span class="free">}</span></span><span class="main">;</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">≤</span><span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">⟧</span>
             <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">**</span> <span class="main">$</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">-</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span> "</span></span>   <span class="main">|</span> 

Assign'''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span>  <span class="main">$</span><span class="main">1</span> <span class="main">**</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">↪</span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main"><span class="free">{</span></span>  <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">↪</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

Assign''''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>  symeval <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">;</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="main">(</span>N <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>  <span class="main">⟧</span> <span class="main">⟹</span> <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span><span class="free"><span class="bound"><span class="entity">Q'</span></span></span><span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

Assign4<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">∈</span>dom <span class="bound">ps</span> <span class="main">∧</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">ps</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">↦</span><span class="main">(</span>paval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">ps</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">::=</span><span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

False<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span>  <span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> False <span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span>  <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main"><span class="free">}</span></span>"</span></span> <span class="main">|</span>

pureI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">⟹</span>  <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span><span class="main">)</span> <span class="main">⟹</span>  <span class="main"><span class="free">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="main"><span class="free">{</span></span><span class="main">↑</span><span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main"><span class="free">}</span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="main"><span class="free">{</span></span> <span class="free"><span class="bound"><span class="entity">R</span></span></span><span class="main"><span class="free">}</span></span>"</span></span>
   

<span class="comment1">(* which is more general Assign4 or Assign2 ? *)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">A4</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vname <span class="main">⇒</span> aexp <span class="main">⇒</span> assn2 <span class="main">⇒</span> assn2"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">A4</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">∈</span>dom <span class="bound">ps</span> <span class="main">∧</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">ps</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">↦</span><span class="main">(</span>paval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">ps</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">A2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"vname <span class="main">⇒</span> aexp <span class="main">⇒</span> assn2 <span class="main">⇒</span> assn2"</span></span> 
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">A2</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound">v</span> <span class="main">.</span> <span class="main">(</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span><span class="bound">v'</span><span class="main">.</span> pointsto <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">v'</span><span class="main">)</span> <span class="main">**</span> <span class="main">(</span> pointsto <span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="bound">v</span> <span class="main">⟶*</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>  <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span>
                 <span class="keyword1">and</span> sep_true <span class="main">**</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> paval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">ps</span> <span class="main">=</span> <span class="bound">v</span>  <span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>

    
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"A4 <span class="free">x</span> <span class="free">a</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> A2 <span class="free">x</span> <span class="free">a</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> A4_def A2_def sep_conj_def dollar_def sep_impl_def pointsto_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"paval <span class="free">a</span> <span class="free">ps</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> n v
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">[</span><span class="free">x</span> <span class="main">↦</span> <span class="skolem">v</span><span class="main">]</span><span class="main">::</span>partstate"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">(</span><span class="free">x</span><span class="main">:=</span>None<span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_fun_def domain_conv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command">unfolding</span></span> plus_fun_conv <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_add_upd_left map_upd_triv<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> n v
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">n</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">ps</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
          
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"A2 <span class="free">x</span> <span class="free">a</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> A4 <span class="free">x</span> <span class="free">a</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> A4_def A2_def sep_conj_def dollar_def sep_impl_def pointsto_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_commute<span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> aa ba ab ac bc xa bd <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">bd</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_add_ac  domain_conv sep_disj_fun_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  <span class="keyword2"><span class="keyword">for</span></span> aa ba ab ac bc xa bd <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">bd</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_add_ac<span class="main">)</span>      
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>   domain_conv sep_disj_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fun_upd_same none_def plus_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domD map_add_dom_app_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_fun_conv subsetCE<span class="main">)</span>      
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ab</span> <span class="main">+</span> <span class="main">[</span><span class="free">x</span> <span class="main">↦</span> <span class="skolem">xa</span><span class="main">]</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">+</span> <span class="skolem">ac</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">=</span> <span class="skolem">aa</span> <span class="main">+</span> <span class="skolem">ac</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">aa</span> <span class="main">##</span> <span class="skolem">ac</span>"</span></span>
      <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> b'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span> <span class="main">=</span> <span class="skolem">ac</span> <span class="main">+</span> <span class="skolem">aa</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_add_ac<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> vars<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="free">a</span> <span class="main">⊆</span> dom <span class="skolem">ac</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> pa<span class="main">:</span> <span class="quoted"><span class="quoted">"paval <span class="free">a</span> <span class="free">ps</span> <span class="main">=</span> paval <span class="free">a</span> <span class="skolem">ac</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> b' 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> paval_extend<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> o vars <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_add_ac<span class="main">)</span>
        
      <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> <span class="main">(</span><span class="skolem">ab</span> <span class="main">+</span> <span class="main">[</span><span class="free">x</span> <span class="main">↦</span> <span class="skolem">xa</span><span class="main">]</span><span class="main">)</span><span class="main">(</span><span class="free">x</span> <span class="main">↦</span> <span class="bound">f</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ab</span> <span class="main">+</span> <span class="main">[</span><span class="free">x</span> <span class="main">↦</span> <span class="bound">f</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_fun_conv<span class="main">)</span> 
          
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ab</span> <span class="main">+</span> <span class="main">[</span><span class="free">x</span> <span class="main">↦</span> paval <span class="free">a</span> <span class="skolem">ac</span><span class="main">]</span><span class="main">,</span> <span class="skolem">bd</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="main">(</span><span class="skolem">aa</span> <span class="main">+</span> <span class="skolem">ac</span><span class="main">)</span><span class="main">(</span><span class="free">x</span> <span class="main">↦</span> paval <span class="free">a</span> <span class="main">(</span><span class="skolem">aa</span> <span class="main">+</span> <span class="skolem">ac</span><span class="main">)</span><span class="main">)</span><span class="main">,</span> <span class="skolem">bd</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> b<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> pa
        <span class="keyword1"><span class="command">unfolding</span></span> b a<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> pa f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="SepLogK_Hoare-E_extendsR"><span class="command">lemma</span></span> E_extendsR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">F</span> <span class="main">}</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">F</span> <span class="main">}</span>"</span></span>      
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoare3a.induct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> hoare3'.Skip<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> hoare3'.Assign4<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> hoare3'.If <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> hoare3'.Frame <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> hoare3'.Seq <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> hoare3'.While <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> hoare3'.conseq<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
<span class="keyword1" id="SepLogK_Hoare-E_extendsS"><span class="command">lemma</span></span> E_extendsS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>b</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">F</span> <span class="main">}</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">F</span> <span class="main">}</span>"</span></span>      
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoare3b.induct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> E_extendsR<span class="main">)</span> 
    <span class="keyword1"><span class="command">using</span></span> hoare3'.conseq  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 
      


<span class="keyword1" id="SepLogK_Hoare-Skip'"><span class="command">lemma</span></span> Skip'<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="main">(</span><span class="free">F</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> SKIP <span class="main">{</span> <span class="free">F</span> <span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Frame<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">F</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Skip<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>
 
  
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">"experiments with explicit and implicit GarbageCollection"</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>
 <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span><span class="main">)</span> 
     <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span>  <span class="bound">n</span> <span class="main">=</span>  <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span>
     <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
  <span class="main">⟷</span>   <span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span> <span class="bound">e</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span><span class="main">)</span>   <span class="main">∧</span>  <span class="bound">n</span> <span class="main">=</span> <span class="bound">e</span>  <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span> <span class="main">∧</span> <span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span>"</span></span>   <span class="keyword1"><span class="command">unfolding</span></span>   sep_conj_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">+</span><span class="skolem">e'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> C   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span> <span class="bound">e</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span><span class="main">)</span>   <span class="main">∧</span>  <span class="bound">n</span> <span class="main">=</span> <span class="bound">e</span>  <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span><span class="main">)</span>   <span class="main">∧</span>  <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">e</span>  <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Q <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> Q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span><span class="skolem">e1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span><span class="main">=</span><span class="skolem">ps1</span><span class="main">+</span><span class="skolem">ps2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span><span class="main">##</span><span class="skolem">ps2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">=</span><span class="skolem">e1</span><span class="main">+</span><span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> C Q' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
       
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Soundness›</span></span>

<span class="keyword1"><span class="command">theorem</span></span> hoareT_sound2_part<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span>  <span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms        
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span>  <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoare3'.induct<span class="main">)</span> 
   <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>conseq <span class="skolem">P</span> <span class="skolem">c</span> <span class="skolem">Q</span> <span class="skolem">P'</span> <span class="skolem">k1</span> <span class="skolem">Q'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span><span class="main">)</span>  <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
      
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>    <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">*</span><span class="skolem">k1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command">using</span></span> gt0 conseq<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P'</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> conseq<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">k1</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> p <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> pB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">*</span><span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                 
    <span class="keyword1"><span class="command">from</span></span> Q conseq<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> Q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span> <span class="keyword1">div</span> <span class="skolem">k1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">*</span><span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">*</span><span class="main">(</span><span class="skolem">k1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="keyword1">div</span> <span class="skolem">k1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e</span> <span class="keyword1">mod</span> <span class="skolem">k1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> mod_mult_div_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">*</span><span class="skolem">k1</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span> <span class="keyword1">div</span> <span class="skolem">k1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="main">(</span><span class="skolem">e</span> <span class="keyword1">mod</span> <span class="skolem">k1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc distrib_left mult.assoc<span class="main">)</span> 
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="keyword1">div</span> <span class="skolem">k1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="keyword1">mod</span> <span class="skolem">k1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e'</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      
        
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">Q'</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps''</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="keyword1">div</span> <span class="skolem">k1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="keyword1">mod</span> <span class="skolem">k1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>  
<span class="keyword1"><span class="command">next</span></span>     
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Frame <span class="skolem">P</span> <span class="skolem">c</span> <span class="skolem">Q</span> <span class="skolem">F</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Frame<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3o_valid_def<span class="main">]</span>  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> hyp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span><span class="main">)</span>  <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">∧*</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="keyword2"><span class="keyword">where</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span> <span class="main">##</span> <span class="skolem">ps2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ps1</span> <span class="main">+</span> <span class="skolem">ps2</span>"</span></span>
                  <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="skolem">ps1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="skolem">ps2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> hyp P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="skolem">c</span><span class="main">,</span>fst <span class="skolem">ps1</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span><span class="main">)</span>  <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> snd <span class="skolem">ps1</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> fst <span class="skolem">ps1</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> orth2<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> snd <span class="skolem">ps1</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>                                                      
   
    <span class="keyword1"><span class="command">from</span></span> big_step_t3_post_dom_conv<span class="main">[</span><span class="operator">OF</span> a<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span><span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span><span class="main">)</span> <span class="main">=</span> dom <span class="main">(</span>fst <span class="skolem">ps1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>         
        
        
    <span class="keyword1"><span class="command">from</span></span> add <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">=</span> fst <span class="skolem">ps1</span> <span class="main">+</span> fst <span class="skolem">ps2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> h<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> snd <span class="skolem">ps1</span> <span class="main">+</span> snd <span class="skolem">ps2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_prod_def<span class="main">)</span>  
      
    <span class="keyword1"><span class="command">from</span></span> orth <span class="keyword1"><span class="command">have</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="skolem">ps2</span> <span class="main">##</span> <span class="skolem">ps'</span>"</span></span> <span class="quoted"><span class="quoted">"fst <span class="skolem">ps2</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> dom map_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> orth2 sep_disj_addD1 sep_disj_commuteI sep_disj_fun_def sep_disj_prod_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom map_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> orth orth2 sep_add_commute sep_disj_addD1 sep_disj_commuteI sep_disj_fun_def sep_disj_prod_def<span class="main">)</span>
        
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> fst <span class="skolem">ps2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_fun_def <span class="keyword1"><span class="command">using</span></span> dom   <span class="keyword1"><span class="command">unfolding</span></span> domain_conv  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        
    <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">+</span>fst <span class="skolem">ps2</span><span class="main">,</span> <span class="skolem">e</span><span class="main">+</span>snd <span class="skolem">ps2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  <span class="keyword1"><span class="command">using</span></span> orth  <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_prod_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_nat_def<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> e<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>             
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> plus_prod_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e'</span><span class="main">.</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps'</span><span class="main">+</span>fst <span class="skolem">ps2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps''</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> fst <span class="skolem">ps2</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Framer2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ _ g<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> a<span class="main">)</span>
         <span class="keyword1"><span class="command">using</span></span> orth <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_prod_def<span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">ps2</span> <span class="main">##</span> <span class="skolem">ps''</span>›</span></span> <span class="quoted"><span class="quoted">‹fst <span class="skolem">ps2</span> <span class="main">##</span> <span class="skolem">ps'</span>›</span></span> orth2 sep_add_assoc sep_add_commute sep_disj_commuteI<span class="main">)</span>   
     <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">+</span> fst <span class="skolem">ps2</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom map_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> orth orth2 sep_add_disjI1 sep_disj_fun_def sep_disj_prod_def<span class="main">)</span>
     <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e'</span><span class="main">.</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="skolem">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps'</span> <span class="main">+</span> fst <span class="skolem">ps2</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">+</span>snd <span class="skolem">ps2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">e'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> snd <span class="skolem">ps1</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> snd <span class="skolem">ps2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> h <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> distrib_left<span class="main">)</span>  
           <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span>  <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k</span><span class="main">*</span> snd <span class="skolem">ps2</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
           <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">+</span> snd <span class="skolem">ps2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
         <span class="keyword1"><span class="command">qed</span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     <span class="keyword1"><span class="command">qed</span></span> 
   <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>False <span class="skolem">c</span> <span class="skolem">Q</span><span class="main">)</span>    
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hoare3o_valid_def<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign2 <span class="skolem">x</span> <span class="skolem">Q</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span> <span class="skolem">v</span>
      <span class="keyword3"><span class="command">assume</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">∃</span><span class="bound">xa</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">↪</span> <span class="bound">xa</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">↪</span> <span class="skolem">v</span> <span class="main">⟶*</span> <span class="skolem">Q</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">assume</span></span> B<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="skolem">a</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> paval <span class="skolem">a</span> <span class="bound">ps</span> <span class="main">=</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
        
        
      <span class="keyword1"><span class="command">from</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span> <span class="main">##</span> <span class="skolem">ps2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> add1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">ps1</span> <span class="main">+</span> <span class="skolem">ps2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">n1</span> <span class="main">+</span> <span class="skolem">n2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
         1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">xaa</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">↪</span> <span class="bound">xaa</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="skolem">x</span> <span class="main">↪</span> <span class="skolem">v</span> <span class="main">⟶*</span> <span class="skolem">Q</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps2</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          
      <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps2a</span></span> <span class="skolem"><span class="skolem">ps2b</span></span> <span class="skolem"><span class="skolem">n2a</span></span> <span class="skolem"><span class="skolem">n2b</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps2a</span> <span class="main">##</span> <span class="skolem">ps2b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> add2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps2</span> <span class="main">=</span> <span class="skolem">ps2a</span> <span class="main">+</span> <span class="skolem">ps2b</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n2</span> <span class="main">=</span> <span class="skolem">n2a</span> <span class="main">+</span> <span class="skolem">n2b</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">↪</span> <span class="skolem">v</span> <span class="main">⟶*</span> <span class="skolem">Q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps2a</span><span class="main">,</span><span class="skolem">n2a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ps2b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps2b</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n2b<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n2b</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dollar_def sep_conj_def
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          
        
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">v'</span></span> <span class="keyword2"><span class="keyword">where</span></span> n1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n1</span><span class="main">=</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v'</span><span class="main">]</span><span class="main">::</span>partstate<span class="main">)</span>"</span></span> 
          <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">:</span> dom <span class="skolem">ps1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pointsto_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> x add1 <span class="keyword1"><span class="command">have</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">:</span> dom <span class="skolem">ps</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_fun_conv subset_iff<span class="main">)</span> 
           
      <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v'</span><span class="main">]</span> <span class="main">+</span> <span class="skolem">ps2a</span><span class="main">)</span><span class="main">(</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ps2a</span> <span class="main">+</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v</span><span class="main">]</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> <span class="quoted"><span class="quoted">‹<span class="main">⋀</span><span class="bound">thesis</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">v'</span><span class="main">.</span> <span class="main">⟦</span><span class="skolem">n1</span> <span class="main">=</span> <span class="main">0</span><span class="main">;</span> <span class="skolem">ps1</span> <span class="main">=</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="bound">v'</span><span class="main">]</span><span class="main">;</span> <span class="skolem">x</span> <span class="main">∈</span> dom <span class="skolem">ps1</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="bound">thesis</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">thesis</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ps1</span> <span class="main">##</span> <span class="skolem">ps2</span>›</span></span> add2 disjoint_iff_not_equal dom_fun_upd domain_conv fun_upd_upd map_add_upd_left option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_fun_conv ps2b sep_add_commute sep_add_zero sep_disj_fun_def<span class="main">)</span> 
        
          
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?n'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">n2a</span> <span class="main">+</span> <span class="skolem">n1</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> n n2 n2b <span class="keyword1"><span class="command">have</span></span> n'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="main">1</span><span class="main">+</span><span class="var">?n'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> Q'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">(</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v</span><span class="main">)</span><span class="main">,</span> <span class="var">?n'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q n1 <span class="keyword1"><span class="command">unfolding</span></span> sep_impl_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">unfolding</span></span> pointsto_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="quoted"><span class="quoted">‹<span class="skolem">ps1</span> <span class="main">##</span> <span class="skolem">ps2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ps2</span> <span class="main">=</span> <span class="skolem">ps2a</span> <span class="main">+</span> <span class="skolem">ps2b</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">ps2b</span> <span class="main">=</span> <span class="main">0</span>›</span></span> dom_fun_upd domain_conv option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> p sep_add_zero sep_disj_commute sep_disj_fun_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> add1 p add2 ps2b
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> f<span class="main">)</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
            
      <span class="keyword1"><span class="command">from</span></span> B <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span> <span class="main">##</span> <span class="skolem">ps2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> add<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">ps2</span> <span class="main">+</span> <span class="skolem">ps1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">n1</span><span class="main">+</span><span class="skolem">n2</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> vars<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">a</span> <span class="main">⊆</span> dom <span class="skolem">ps2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"paval <span class="skolem">a</span> <span class="skolem">ps2</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_add_ac<span class="main">)</span>
          
      <span class="keyword1"><span class="command">from</span></span> vars add <span class="keyword1"><span class="command">have</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">a</span> <span class="main">⊆</span> dom <span class="skolem">ps</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_fun_conv subset_iff<span class="main">)</span>          
          
      <span class="keyword1"><span class="command">from</span></span> a x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"vars <span class="skolem">a</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">⊆</span> dom <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"paval <span class="skolem">a</span> <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> add <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> paval_extend<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> orth vars v <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_commute<span class="main">)</span>
          
        
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">::=</span> <span class="skolem">a</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">e'</span><span class="main">.</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">(</span><span class="skolem">x</span><span class="main">↦</span><span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> big_step_t_part.Assign<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?n'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> n' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">using</span></span> Q' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> Skip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> hoare3o_valid_def dollar_def<span class="main">)</span>   
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign4 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def sep_conj_def  hoare3o_valid_def <span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ps b y
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">(</span><span class="skolem">x</span> <span class="main">↦</span> paval <span class="skolem">a</span> <span class="skolem">ps</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">b</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign' <span class="skolem">x</span> <span class="skolem">v'</span> <span class="skolem">v</span> <span class="skolem">Q</span> <span class="main">)</span>
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">aa</span><span class="main">.</span> <span class="bound">aa</span> <span class="main">##</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v'</span><span class="main">]</span> <span class="main">⟹</span>
       <span class="main">¬</span> <span class="bound">aa</span> <span class="main">##</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v</span><span class="main">]</span> <span class="main">⟹</span> False"</span></span>   <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_fun_def domain_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Collect_conj_eq Collect_empty_eq<span class="main">)</span> 
  <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v'</span><span class="main">.</span> domain <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="bound">v'</span><span class="main">]</span> <span class="main">=</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> domain_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span>
    <span class="keyword3"><span class="command">assume</span></span> u<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span> <span class="main">##</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v'</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v'</span><span class="main">]</span> <span class="main">+</span> <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">ps</span> <span class="main">+</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v'</span><span class="main">]</span>"</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v</span><span class="main">]</span> <span class="main">+</span> <span class="skolem">ps</span> <span class="main">=</span> <span class="skolem">ps</span> <span class="main">+</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v</span><span class="main">]</span>"</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sep_add_commute<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_add_ac<span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> sep_add_commute<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> u <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_add_ac<span class="main">)</span>
             <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_fun_def f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">::=</span> N <span class="skolem">v</span><span class="main">,</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v'</span><span class="main">]</span> <span class="main">+</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> Suc <span class="main">0</span> <span class="main">⇓</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v</span><span class="main">]</span> <span class="main">+</span> <span class="skolem">ps</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Framer<span class="main"><span class="main">[</span></span><span class="operator">OF</span> big_step_t_part.Assign<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span> <span class="keyword1"><span class="command">using</span></span> u  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_add_ac<span class="main">)</span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">::=</span> N <span class="skolem">v</span><span class="main">,</span> <span class="skolem">ps</span> <span class="main">+</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v'</span><span class="main">]</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> Suc <span class="main">0</span> <span class="main">⇓</span> <span class="skolem">ps</span> <span class="main">+</span> <span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v</span><span class="main">]</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> 2<span class="main">)</span>  
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> f2 <span class="main">=</span> this
      
  <span class="keyword1"><span class="command">from</span></span> Assign' <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def sep_conj_def pointsto_def sep_impl_def hoare3o_valid_def <span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_add_ac<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_disj_fun_def f <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ps n
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">+</span><span class="main">[</span><span class="skolem">x</span> <span class="main">↦</span> <span class="skolem">v</span><span class="main">]</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">v</span><span class="main">)</span>   
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def <span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ps n
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> separate_othogonal<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">(</span><span class="skolem">x</span><span class="main">:=</span>Some <span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pointsto_def<span class="main">)</span>  <span class="keyword1"><span class="command">unfolding</span></span>  sep_conj_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">%</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span><span class="main">=</span><span class="skolem">x</span> <span class="keyword1">then</span> None <span class="keyword1">else</span> <span class="skolem">ps</span> <span class="bound">y</span><span class="main">)</span> <span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">%</span><span class="bound">y</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">y</span> <span class="main">=</span> <span class="skolem">x</span> <span class="keyword1">then</span> Some <span class="main">(</span>paval <span class="skolem">a</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">else</span> None<span class="main">)</span><span class="main">,</span><span class="main">0</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_prod_def sep_disj_fun_def plus_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">smt</span> domIff domain_conv<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> domI insertE option.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> domIff <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3o_valid_def<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="keyword2"><span class="keyword">where</span></span> T<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">⟹</span> pbval <span class="skolem">b</span> <span class="bound">ps</span>
     <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> k1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3o_valid_def<span class="main">]</span>
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">⟹</span> <span class="main">¬</span> pbval <span class="skolem">b</span> <span class="bound">ps</span>
     <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> k2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def<span class="main">)</span>   
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> k1 k2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ps</span> <span class="skolem">n</span><span class="main">)</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n'</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="skolem">ps</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> Suc <span class="skolem">n'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pbval <span class="skolem">b</span> <span class="skolem">ps</span>"</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> True
      <span class="keyword1"><span class="command">with</span></span> T<span class="main">[</span><span class="operator">OF</span> P dom<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m1<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> big_step_t3_post_dom_conv<span class="main">[</span><span class="operator">OF</span> d<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> klong<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span><span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span><span class="main">)</span> <span class="main">=</span> dom <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 
      <span class="keyword1"><span class="command">from</span></span> k1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">=</span> Suc <span class="skolem">k1'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">from</span></span> k2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">=</span> Suc <span class="skolem">k2'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e1</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k2'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">k1'</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps''</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>   
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> big_step_t_part.IfTrue<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> dom<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> True<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> d<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?e1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k1</span><span class="main">*</span><span class="skolem">n'</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Suc  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">*</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">k2'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k2'
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">k2'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">k1'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k1' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span><span class="skolem">k2</span><span class="main">*</span><span class="skolem">e</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k2'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">k1'</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>  
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="var">?e1</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>  <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>   
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>          
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> False
      <span class="keyword1"><span class="command">with</span></span> F<span class="main">[</span><span class="operator">OF</span> P dom<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> d<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m2<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">n'</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> big_step_t3_post_dom_conv<span class="main">[</span><span class="operator">OF</span> d<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> klong<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span><span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span><span class="main">)</span> <span class="main">=</span> dom <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">.</span></span> 
      <span class="keyword1"><span class="command">from</span></span> k1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">=</span> Suc <span class="skolem">k1'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">from</span></span> k2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">=</span> Suc <span class="skolem">k2'</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?e2</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k1'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">k2'</span><span class="main">)</span>"</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps''</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">+</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>   
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> big_step_t_part.IfFalse<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> dom<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> False<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> d<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?e2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k2</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k2</span><span class="main">*</span><span class="skolem">n'</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Suc  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> m2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">k1</span><span class="main">*</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">k1'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k1'
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">k1'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">k2'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span><span class="skolem">k2</span><span class="main">*</span><span class="skolem">e</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k1'</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">k2'</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m</span><span class="main">+</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>  
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="var">?e2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">qed</span></span>  <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>   
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">P</span> <span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">R</span><span class="main">)</span> 
    
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3o_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> k10<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>4<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3o_valid_def<span class="main">]</span>  <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    2<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">R</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> k20<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
  <span class="keyword1"><span class="command">from</span></span> k10 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">=</span> Suc <span class="skolem">k1'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
  <span class="keyword1"><span class="command">from</span></span> k20 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">=</span> Suc <span class="skolem">k2'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">k2</span><span class="main">*</span><span class="skolem">k1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>        
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>      
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      
    <span class="keyword1"><span class="command">with</span></span> 1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1'</span></span> <span class="skolem"><span class="skolem">ps1''</span></span> <span class="skolem"><span class="skolem">m1</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m1</span> <span class="main">⇓</span> <span class="skolem">ps1'</span> <span class="main">+</span> <span class="skolem">ps1''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1'</span> <span class="main">##</span> <span class="skolem">ps1''</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="main">+</span> <span class="skolem">e1'</span> <span class="main">+</span> <span class="skolem">m1</span>"</span></span><span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps1'</span><span class="main">,</span> <span class="skolem">e1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
    <span class="keyword1"><span class="command">from</span></span> Q <span class="keyword2"><span class="keyword">and</span></span> 2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps2'</span></span> <span class="skolem"><span class="skolem">ps2''</span></span> <span class="skolem"><span class="skolem">m2</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="skolem"><span class="skolem">e2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">ps1'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m2</span> <span class="main">⇓</span> <span class="skolem">ps2'</span> <span class="main">+</span> <span class="skolem">ps2''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> orth2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps2'</span> <span class="main">##</span> <span class="skolem">ps2''</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e2</span> <span class="main">+</span> <span class="skolem">e2'</span> <span class="main">+</span> <span class="skolem">m2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">R</span> <span class="main">(</span><span class="skolem">ps2'</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?ee</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">k1</span> <span class="main">*</span><span class="skolem">e2'</span>  <span class="main">+</span> <span class="skolem">k2</span><span class="main">*</span><span class="skolem">e1'</span> <span class="main">+</span><span class="skolem">k2'</span><span class="main">*</span><span class="skolem">m1</span><span class="main">+</span> <span class="skolem">k1'</span><span class="main">*</span><span class="skolem">m2</span><span class="main">)</span>"</span></span>
      
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">R</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps2'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps2''</span> <span class="main">+</span> <span class="skolem">ps1''</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m1</span><span class="main">+</span><span class="skolem">m2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="var">?ee</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command">have</span></span> C2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">ps1'</span> <span class="main">+</span> <span class="skolem">ps1''</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m2</span> <span class="main">⇓</span> <span class="skolem">ps2'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">ps2''</span> <span class="main">+</span> <span class="skolem">ps1''</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Framer2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> C2<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">ps1''</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">using</span></span> sep_add_assoc
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C2 big_step_t3_post_dom_conv map_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> orth orth2 sep_add_commute sep_disj_addD1 sep_disj_commuteI sep_disj_fun_def<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span> <span class="skolem">C<span class="hidden">⇩</span><sub>2</sub></span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span> <span class="main">⇓</span> <span class="skolem">ps2'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">ps2''</span> <span class="main">+</span> <span class="skolem">ps1''</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> C1 C2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps2'</span> <span class="main">##</span> <span class="skolem">ps2''</span> <span class="main">+</span> <span class="skolem">ps1''</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> C2 big_step_t3_post_dom_conv map_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> orth orth2 sep_disj_addI3 sep_disj_fun_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="main">+</span> <span class="skolem">e1'</span> <span class="main">+</span> <span class="skolem">m1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e1</span> <span class="main">+</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e1'</span> <span class="main">+</span> <span class="skolem">m1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">e2</span> <span class="main">+</span> <span class="skolem">e2'</span> <span class="main">+</span> <span class="skolem">m2</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e1'</span> <span class="main">+</span> <span class="skolem">m1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">*</span><span class="skolem">e2'</span>  <span class="main">+</span> <span class="skolem">k2</span><span class="main">*</span><span class="skolem">e1'</span> <span class="main">+</span><span class="skolem">k2</span><span class="main">*</span><span class="skolem">m1</span><span class="main">+</span> <span class="skolem">k1</span><span class="main">*</span><span class="skolem">m2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">algebra</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">*</span><span class="skolem">e2'</span>  <span class="main">+</span> <span class="skolem">k2</span><span class="main">*</span><span class="skolem">e1'</span> <span class="main">+</span><span class="skolem">k2'</span><span class="main">*</span><span class="skolem">m1</span><span class="main">+</span><span class="skolem">m1</span><span class="main">+</span> <span class="skolem">k1'</span><span class="main">*</span><span class="skolem">m2</span><span class="main">+</span><span class="skolem">m2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> k1' k2' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e2</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">k1</span> <span class="main">*</span><span class="skolem">e2'</span>  <span class="main">+</span> <span class="skolem">k2</span><span class="main">*</span><span class="skolem">e1'</span> <span class="main">+</span><span class="skolem">k2'</span><span class="main">*</span><span class="skolem">m1</span><span class="main">+</span> <span class="skolem">k1'</span><span class="main">*</span><span class="skolem">m2</span><span class="main">)</span><span class="main">+</span><span class="main">(</span><span class="skolem">m1</span><span class="main">+</span><span class="skolem">m2</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k2</span> <span class="main">*</span> <span class="skolem">k1</span> <span class="main">*</span> <span class="skolem">e2</span> <span class="main">+</span> <span class="var">?ee</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">m1</span> <span class="main">+</span> <span class="skolem">m2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span> <span class="operator">fact</span> 
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> k10 k20<span class="main">)</span>     
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span> 
     
   <span class="keyword1"><span class="command">{</span></span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="skolem">b</span> True <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span>  While2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="skolem">b</span> True <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         
  <span class="keyword1"><span class="command">from</span></span> k <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k'</span></span> <span class="keyword2"><span class="keyword">where</span></span> k'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">=</span> Suc <span class="skolem">k'</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> gr0_implies_Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span>
                 <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span>
                     <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span>
                     <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="skolem">b</span> False <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="comment1">(* 
    have "∃k&gt;0. ∀ps n. ((λ(s, n). P (s, n) ∧ vars b ⊆ dom s) ∧* $ 1) (ps, n) ⟶ (∃ps' m. (WHILE b DO C, ps) ⇒<span class="hidden">⇩</span><sub>A</sub> m ⇓ ps' ∧ m ≤ k * n ∧ (case (ps', n - m) of (s, n) ⇒ P (s, n) ∧ lmaps_to_axpr b False s))"
   *)</span>   <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">ps</span> <span class="skolem">n</span><span class="main">)</span>  
    <span class="keyword1"><span class="command">from</span></span> 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="skolem">n</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">ps</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>less <span class="skolem">x</span> <span class="skolem">ps3</span><span class="main">)</span> 
          
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pbval <span class="skolem">b</span> <span class="skolem">ps3</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps3</span><span class="main">,</span> <span class="skolem">x'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="skolem">ps3</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Suc <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
        <span class="keyword1"><span class="command">from</span></span> P dom True <span class="keyword1"><span class="command">have</span></span> 
           g<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="skolem">b</span> True <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps3</span><span class="main">,</span> <span class="skolem">x'</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command">unfolding</span></span> dollar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
          <span class="keyword1"><span class="command">from</span></span> While2 g <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps3'</span></span> <span class="skolem"><span class="skolem">ps3''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps3</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps3'</span> <span class="main">+</span> <span class="skolem">ps3''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps3'</span> <span class="main">##</span> <span class="skolem">ps3''</span>"</span></span>
                <span class="keyword2"><span class="keyword">and</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">x'</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps3'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'''</span></span> <span class="keyword2"><span class="keyword">where</span></span> P''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps3'</span><span class="main">,</span> <span class="skolem">x'''</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> domb<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="skolem">ps3'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Suc''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> Suc <span class="skolem">x'''</span>"</span></span>
              <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
              
          <span class="keyword1"><span class="command">from</span></span> C big_step_t3_post_dom_conv <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom <span class="skolem">ps3</span> <span class="main">=</span> dom <span class="main">(</span><span class="skolem">ps3'</span> <span class="main">+</span> <span class="skolem">ps3''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">with</span></span> dom <span class="keyword1"><span class="command">have</span></span> dom'<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="main">(</span><span class="skolem">ps3'</span> <span class="main">+</span> <span class="skolem">ps3''</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              
          <span class="keyword1"><span class="command">from</span></span> C big_step_t3_gt0 <span class="keyword1"><span class="command">have</span></span> gt0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">&lt;</span> <span class="skolem">x</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  x Suc gt0
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> k le_add1 le_less_trans less_SucI less_add_same_cancel1 nat_mult_less_cancel1<span class="main">)</span>   
 
          <span class="comment1">(*have "∃ps' m. (WHILE b DO C, ps3') ⇒<span class="hidden">⇩</span><sub>A</sub> m ⇓ ps' ∧ m ≤ k * (x - (1 + m)) ∧ P (ps', (x - (1 + m)) - m) ∧ vars b ⊆ dom ps' ∧ ¬ pbval b ps'"
           *)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e2</span> <span class="bound">e2'</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps3'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e2</span> <span class="main">+</span> <span class="bound">e2'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="skolem">b</span> False <span class="bound">ps'</span>"</span></span> 
                 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> less<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
              
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps4'</span></span> <span class="skolem"><span class="skolem">ps4''</span></span> <span class="skolem"><span class="skolem">mt</span></span> <span class="skolem"><span class="skolem">et</span></span> <span class="skolem"><span class="skolem">et'</span></span> <span class="keyword2"><span class="keyword">where</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps3'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mt</span> <span class="main">⇓</span> <span class="skolem">ps4'</span> <span class="main">+</span> <span class="skolem">ps4''</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> ortho<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps4'</span> <span class="main">##</span> <span class="skolem">ps4''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">et</span> <span class="main">+</span> <span class="skolem">et'</span> <span class="main">+</span> <span class="skolem">mt</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> P''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps4'</span><span class="main">,</span> <span class="skolem">et</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dom''<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="skolem">ps4'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> b''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> pbval <span class="skolem">b</span> <span class="skolem">ps4'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
                 
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps4''</span> <span class="main">##</span> <span class="skolem">ps3''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps4'</span> <span class="main">##</span> <span class="skolem">ps3''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> big_step_t3_post_dom_conv domain_conv orth ortho sep_add_disjD sep_disj_fun_def w<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>  
              
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps4'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps4''</span> <span class="main">+</span>  <span class="skolem">ps3''</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">mt</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">et</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">" <span class="skolem">et'</span>  <span class="main">+</span> <span class="skolem">k'</span> <span class="main">+</span> <span class="skolem">e'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps3'</span> <span class="main">+</span> <span class="skolem">ps3''</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">mt</span> <span class="main">⇓</span> <span class="skolem">ps4'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">ps4''</span> <span class="main">+</span>  <span class="skolem">ps3''</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Framer2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> w<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="skolem">ps3''</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> sep_add_assoc<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="skolem">b</span> <span class="keyword1">DO</span> <span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps3</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">mt</span> <span class="main">⇓</span> <span class="skolem">ps4'</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">ps4''</span> <span class="main">+</span>  <span class="skolem">ps3''</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> WhileTrue<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> C<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps4'</span> <span class="main">##</span> <span class="skolem">ps4''</span> <span class="main">+</span> <span class="skolem">ps3''</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> big_step_t3_post_dom_conv domain_conv orth ortho sep_disj_addI3 sep_disj_fun_def w<span class="main">)</span>   
          <span class="keyword1"><span class="command">next</span></span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">x'</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> Suc <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> x <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">et</span> <span class="main">+</span> <span class="skolem">et'</span> <span class="main">+</span> <span class="skolem">mt</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m'' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">et</span> <span class="main">+</span> <span class="skolem">et'</span> <span class="main">+</span> <span class="skolem">mt</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="main">1</span> <span class="main">+</span> <span class="skolem">k'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">et</span> <span class="main">+</span> <span class="main">(</span> <span class="skolem">et'</span>  <span class="main">+</span> <span class="skolem">k'</span> <span class="main">+</span> <span class="skolem">e'</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">mt</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k' <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">et</span> <span class="main">+</span> <span class="main">(</span> <span class="skolem">et'</span>  <span class="main">+</span> <span class="skolem">k'</span> <span class="main">+</span> <span class="skolem">e'</span><span class="main">)</span> <span class="main">+</span> <span class="main">(</span><span class="main">1</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">mt</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps4'</span><span class="main">,</span> <span class="skolem">et</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"lmaps_to_axpr <span class="skolem">b</span> False <span class="skolem">ps4'</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> dom'' b'' <span class="keyword1"><span class="command">..</span></span> 
          <span class="keyword1"><span class="command">qed</span></span>                   
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
        <span class="keyword1"><span class="command">from</span></span> less<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x'</span></span> <span class="keyword2"><span class="keyword">where</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps3</span><span class="main">,</span> <span class="skolem">x'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="skolem">ps3</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Suc<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> Suc <span class="skolem">x'</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dollar_def sep_conj_def
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps3</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">x'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">k'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> big_step_t_part.WhileFalse<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> dom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> Suc k k' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">using</span></span> P Suc <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">using</span></span> dom <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>    
      <span class="keyword1"><span class="command">qed</span></span> 
        
      <span class="keyword1"><span class="command">qed</span></span>
       
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">fact</span><span class="main">)</span>
      
      
<span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">with</span></span> While<span class="main">(</span>2<span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span> 
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign''' <span class="skolem">x</span> <span class="skolem">ds</span> <span class="skolem">v</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  
    <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ps n <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">(</span><span class="skolem">x</span><span class="main">↦</span><span class="skolem">v</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> big_step_t_part.Assign<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> separate_othogonal_commuted'<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def pointsto_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> separate_othogonal_commuted'<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar_def pointsto_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>          
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign'''' <span class="skolem">P</span> <span class="skolem">a</span> <span class="skolem">v</span> <span class="skolem">x</span> <span class="skolem">Q'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Assign''''<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3o_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
   A<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">::=</span> N <span class="skolem">v</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">Q'</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   
    <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ps</span> <span class="skolem">n</span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> A <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> 
        <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">" <span class="main">(</span><span class="skolem">x</span> <span class="main">::=</span> N <span class="skolem">v</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q'</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> Assign''''<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> symeval_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"paval' <span class="skolem">a</span> <span class="skolem">ps</span> <span class="main">=</span> Some <span class="skolem">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps''</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> avalDirekt3_correct<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">e</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">e'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>  
    <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>pureI <span class="skolem">P</span> <span class="skolem">Q</span> <span class="skolem">c</span> <span class="skolem">R</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">with</span></span> pureI<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">unfolded</span> hoare3o_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
     thing<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="skolem">c</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="skolem">R</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">using</span></span> thing <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">qed</span></span> 
      <span class="keyword1"><span class="command">next</span></span>
<span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>normalize <span class="skolem">P</span> <span class="skolem">m</span> <span class="skolem">C</span> <span class="skolem">Q</span> <span class="skolem">n</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> k <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">ps</span> <span class="skolem">N</span><span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> Q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stardiff<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> mn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span> <span class="main">≤</span> <span class="skolem">N</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stardiff<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
    <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">∧*</span> <span class="main">$</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps</span><span class="main">,</span><span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span><span class="skolem">m</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_prod_def sep_disj_nat_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command">have</span></span> N<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="skolem">N</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">m</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span> <span class="main">=</span>  <span class="skolem">N</span> <span class="main">+</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> normalize<span class="main">(</span>2<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> mn <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> P N <span class="keyword1"><span class="command">have</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">∧*</span> <span class="main">$</span> <span class="skolem">m</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">N</span> <span class="main">+</span><span class="skolem">n</span><span class="main">)</span>"</span></span>    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
    <span class="keyword1"><span class="command">from</span></span> P' 1<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m'</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m'</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> m'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">+</span><span class="skolem">n</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="main">$</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        
    <span class="keyword1"><span class="command">have</span></span> Q2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> stardiff<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
    
    <span class="keyword1"><span class="command">have</span></span> en<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">≥</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q
      <span class="keyword1"><span class="command">using</span></span> stardiff<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>     
        
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps''</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">-</span> <span class="skolem">n</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">C</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m'</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">N</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span> <span class="main">(</span><span class="skolem">N</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span><span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span><span class="main">*</span><span class="main">(</span><span class="skolem">N</span> <span class="main">+</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">*</span><span class="skolem">n</span>"</span></span>  <span class="keyword1"><span class="command">using</span></span> right_diff_distrib' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m'</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">*</span><span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> m' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">-</span> <span class="skolem">k</span><span class="main">*</span><span class="skolem">n</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> en
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Nat.add_diff_assoc2 ab_semigroup_add_class.add_ac<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> distrib_left le_add1 le_add_diff_inverse<span class="main">)</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span><span class="main">-</span><span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> diff_mult_distrib2<span class="main">)</span>   
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">N</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span> <span class="main">-</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">qed</span></span>     
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
    
    
    
<span class="keyword1"><span class="command">thm</span></span> hoareT_sound2_part E_extendsR
  
<span class="keyword1" id="SepLogK_Hoare-hoareT_sound2_partR"><span class="command">lemma</span></span> hoareT_sound2_partR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hoareT_sound2_part E_extendsR <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹nice example›</span></span>
  
<span class="keyword1" id="SepLogK_Hoare-Frame_R"><span class="command">lemma</span></span> Frame_R<span class="main">:</span>  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span>  <span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"Frame <span class="free">P'</span> <span class="free">P</span> <span class="free">F</span>"</span></span>
             <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P'</span> <span class="main">}</span> <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">**</span> <span class="free">F</span> <span class="main">}</span> "</span></span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Frame<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">unfolding</span></span> Frame_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
<span class="keyword1" id="SepLogK_Hoare-strengthen_post"><span class="command">lemma</span></span> strengthen_post<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">Q'</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseq<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
           
<span class="keyword1"><span class="command">lemmas</span></span> strongAssign <span class="main">=</span> Assign''''<span class="main">[</span><span class="operator">OF</span> _ strengthen_post<span class="main">,</span> <span class="operator">OF</span> _ Frame_R<span class="main">,</span> <span class="operator">OF</span> _ Assign'''<span class="main">]</span>   
  
        
<span class="keyword1" id="SepLogK_Hoare-weakenpre"><span class="command">lemma</span></span> weakenpre<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">s</span>  <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conseq<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">1</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
<span class="keyword1" id="SepLogK_Hoare-weakenpreR"><span class="command">lemma</span></span> weakenpreR<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span> <span class="main">;</span> <span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">s</span>  <span class="main">⟧</span> <span class="main">⟹</span>
           <span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hoare3a.conseqS <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
    
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">"Completeness"</span></span>
    
    
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">wp3'</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"com <span class="main">⇒</span> assn2 <span class="main">⇒</span> assn2"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub>'</span>"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">where</span></span> 
<span class="quoted"><span class="quoted">"<span class="keyword1"><span class="free">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span>  <span class="main">=</span>  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span><span class="bound">t</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">n</span><span class="main">≥</span><span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span><span class="bound">n</span><span class="main">-</span><span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> 
    
<span class="keyword1" id="SepLogK_Hoare-wp3Skip"><span class="command">lemma</span></span> wp3Skip<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> SKIP <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp3'_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def sep_disj_prod_def sep_disj_nat_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> t n <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> big_step_t_part.Skip <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
<span class="keyword1" id="SepLogK_Hoare-wp3Assign"><span class="command">lemma</span></span> wp3Assign<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="free">x</span> <span class="main">::=</span> <span class="free">e</span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> vars <span class="free">e</span> <span class="main">∪</span> <span class="main">{</span><span class="free">x</span><span class="main">}</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">(</span><span class="free">x</span> <span class="main">↦</span> paval <span class="free">e</span> <span class="bound">ps</span><span class="main">)</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">!</span></span><span class="main"><span class="main">:</span></span> ext <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp3'_def <span class="main">)</span>  
  <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_prod_def sep_disj_nat_def dollar_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>  

<span class="keyword1" id="SepLogK_Hoare-wpt_Seq"><span class="command">lemma</span></span> wpt_Seq<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="free">c<span class="hidden">⇩</span><sub>1</sub></span><span class="main">;;</span><span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="free">Q</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp3'_def fun_eq_iff <span class="main">)</span> 
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b t m1 s2 m2  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">s2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s m t' m1 t m2
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m1</span><span class="main">+</span><span class="skolem">m2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> big_step_t_part.Seq<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SepLogK_Hoare-wp3If"><span class="command">lemma</span></span> wp3If<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
 <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free">b</span> <span class="keyword1">THEN</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">ELSE</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="free">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="keyword1">else</span> <span class="free">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wp3'_def fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_prod_def sep_disj_nat_def dollar_def<span class="main">)</span>    
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a ba t x <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ba</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a ba t x <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ba</span> <span class="main">-</span> <span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">x</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a ba t m
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">t</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Suc <span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pbval <span class="free">b</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> big_step_t_part.IfTrue<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> big_step_t3_post_dom_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> big_step_t_part.IfFalse<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> big_step_t3_post_dom_conv <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
             
    
<span class="keyword1" id="SepLogK_Hoare-sFTrue"><span class="command">lemma</span></span> sFTrue<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"pbval <span class="free">b</span> <span class="free">ps</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wp</span> <span class="main">=</span> <span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> wp3'_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">tt</span></span> <span class="keyword2"><span class="keyword">where</span></span> tn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">tt</span> <span class="main">⇓</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps''</span><span class="main">,</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">tt</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="keyword2"><span class="keyword">where</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">ps'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">t'</span> <span class="main">⇓</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> tt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">tt</span><span class="main">=</span><span class="main">1</span><span class="main">+</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">t'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">from</span></span> tn <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">=</span><span class="skolem">tt</span><span class="main">+</span><span class="skolem">k</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> le_Suc_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
      
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def  wp3'_def  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">+</span><span class="skolem">t'</span><span class="main">+</span><span class="skolem">k</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> n tt <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> c <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps''</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">t'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> w2 Q n <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dollar_def sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">t'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="keyword2"><span class="keyword">where</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≤</span> <span class="free">n</span> <span class="main">-</span> <span class="main">1</span>"</span></span>  
        <span class="keyword2"><span class="keyword">and</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>  t'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t'</span> <span class="main">≤</span> <span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="skolem">ps'</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">t'</span> <span class="main">⇓</span> <span class="skolem">ps''</span>"</span></span> 
        <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps''</span><span class="main">,</span> <span class="main">(</span><span class="main">(</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">t'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> wp3'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wp</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp3'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps''</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span><span class="main">+</span><span class="skolem">t</span><span class="main">+</span><span class="skolem">t'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> t t' n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> c w assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Q t t' n <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>      
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SepLogK_Hoare-sFFalse"><span class="command">lemma</span></span> sFFalse<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">~</span> pbval <span class="free">b</span> <span class="free">ps</span>"</span></span> <span class="quoted"><span class="quoted">"vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="free">ps</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wp</span> <span class="main">=</span> <span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">_</span>"</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">proof</span></span> 
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> wp3'_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> tn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span> <span class="main">≤</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> w1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">t</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">t</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>      
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⇓</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> w1 w2 big_step_t_determ2 <span class="keyword1"><span class="command">have</span></span> t1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">t</span><span class="main">=</span><span class="main">1</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">ps</span><span class="main">=</span><span class="skolem">ps'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def <span class="keyword1"><span class="command">using</span></span> t1 tn Q pps <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">-</span><span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span><span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">-</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">n</span><span class="main">≥</span><span class="main">1</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> dollar_def sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> w2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">,</span> <span class="free">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="main">1</span> <span class="main">⇓</span> <span class="free">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?wp</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> wp3'_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="free">ps</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Q w2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SepLogK_Hoare-sF'"><span class="command">lemma</span></span> sF'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="free">ps</span><span class="main">,</span><span class="free">n</span><span class="main">)</span>"</span></span>   
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="free">ps</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"pbval <span class="free">b</span> <span class="free">ps</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> sFTrue sFFalse <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> dollar_def wp3'_def sep_conj_def<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
<span class="keyword1" id="SepLogK_Hoare-sF"><span class="command">lemma</span></span> sF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span> <span class="free">s</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="free">s</span>"</span></span>   
 <span class="keyword1"><span class="command">using</span></span> sF'
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> prod.case_eq_if prod.collapse sep_conj_impl1<span class="main">)</span> 
    
    
    
<span class="keyword1" id="SepLogK_Hoare-strengthen_postR"><span class="command">lemma</span></span> strengthen_postR<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span><span class="free">Q</span><span class="main">}</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="free">Q'</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span><span class="free">c</span><span class="main">{</span> <span class="free">Q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare3a.conseqS<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>  
    
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Q</span><span class="main">.</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="bound">Q</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="bound">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> WhileWpisPre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">define</span></span> <span class="skolem"><span class="skolem">I'</span></span> <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="skolem">I'</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">have</span></span> I'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">I</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="skolem">I'</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def I'_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   
  <span class="keyword1"><span class="command">from</span></span> assms<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
    c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="main">(</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">have</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free">b</span> True <span class="bound">s</span><span class="main">)</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="skolem">I</span>  <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare3a.conseqS<span class="main">)</span>             
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> c<span class="main">)</span>              
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>            
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  <span class="keyword1"><span class="command">unfolding</span></span> I_def   <span class="keyword1"><span class="command">using</span></span> sF <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      
  <span class="keyword1"><span class="command">have</span></span> c''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free">b</span> True <span class="bound">s</span><span class="main">)</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span>  <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> strengthen_postR<span class="main"><span class="main">[</span></span><span class="operator">OF</span> c'<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> I'
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> R case_prod_beta prod.sel<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> prod.sel<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>  
   
    <span class="keyword1"><span class="command">have</span></span> ka<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">I</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> <span class="keyword1"><span class="command">unfolding</span></span> I' <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
  <span class="keyword1"><span class="command">from</span></span> hoare3a.While<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">I</span>"</span></span><span class="main">]</span> c'' <span class="keyword1"><span class="command">have</span></span>
    w<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span>  vars <span class="free">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span> <span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">{</span>  <span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free">b</span> False <span class="bound">s</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span><span class="main">)</span> <span class="free">Q</span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free">b</span> <span class="keyword1">DO</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>       
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare3a.conseqS<span class="main">)</span>      
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> w<span class="main">)</span>           
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> ka <span class="keyword1"><span class="command">using</span></span> sF I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> I_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>
     

<span class="keyword1" id="SepLogK_Hoare-wpT_is_pre"><span class="command">lemma</span></span> wpT_is_pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="free">Q</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">c</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> SKIP
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">using</span></span> hoare3a.Frame<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> F<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">Q</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">$</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">$</span><span class="main">1</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> hoare3a.Skip<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep.add_ac<span class="main">)</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> hoare3a.Assign4 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
<span class="keyword1"><span class="command">next</span></span>               
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> hoare3a.Seq<span class="main"><span class="main">[</span></span><span class="operator">rotated</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">x1</span> <span class="skolem">c1</span> <span class="skolem">c2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> weakenpreR<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hoare3a.If<span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P1<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">x1</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare3a.conseqS<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="skolem">c1</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">Q</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare3a.conseqS<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="skolem">c2</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">Q</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> vars <span class="skolem">x1</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">x1</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">x1</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="skolem">c1</span> <span class="keyword1">else</span> <span class="skolem">c2</span><span class="main">)</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span> <span class="main">∧</span> vars <span class="skolem">x1</span> <span class="main">⊆</span> dom <span class="bound">ps</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"pbval <span class="skolem">x1</span> <span class="improper">aa</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> <span class="comment1">(* strange! *)</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">with</span></span> WhileWpisPre <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">.</span></span>
<span class="keyword1"><span class="command">qed</span></span>  
   
<span class="keyword1" id="SepLogK_Hoare-hoare3o_valid_alt"><span class="command">lemma</span></span> hoare3o_valid_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>  <span class="main">⟹</span>
    <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span>
 <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span><span class="main">)</span> 
     <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span>
     <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">unfolded</span> hoare3o_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k0<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
     P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> P <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k0
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e''</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">e''</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> le_Suc_ex <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">e''</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> e   <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e'</span><span class="main">+</span><span class="skolem">e''</span><span class="main">)</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span>  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">e</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Q k0 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> 1     
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>         
              
  
<span class="keyword1" id="SepLogK_Hoare-valid_alternative_with_GC"><span class="command">lemma</span></span> valid_alternative_with_GC<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>
 <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span><span class="main">)</span> 
     <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span>
     <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>    
 <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span>  <span class="bound">m</span> <span class="bound">e</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span>  <span class="main">)</span> 
      <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
  <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
  <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
     ps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span> <span class="bound">e</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">∧</span> <span class="skolem">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e</span><span class="main">+</span><span class="skolem">e'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
      <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">e</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps''</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">e'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>
     
    
<span class="keyword1" id="SepLogK_Hoare-hoare3o_valid_GC"><span class="command">lemma</span></span> hoare3o_valid_GC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span> <span class="main">⟹</span> <span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> P <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span><span class="quoted"><span class="quoted">" <span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span> "</span></span><span class="quoted"><span class="quoted">" <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span> "</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="free">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span>"</span></span>    
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps''</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">e</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">e'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="SepLogK_Hoare-hoare3a_sound_GC"><span class="command">lemma</span></span> hoare3a_sound_GC<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hoare3o_valid_GC hoareT_sound2_partR <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>  
  
<span class="keyword1" id="SepLogK_Hoare-valid_wp"><span class="command">lemma</span></span> valid_wp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?QG</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span>
 <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span><span class="main">)</span> 
     <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span>
     <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> hoare3o_valid_alt <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>  
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?P</span> <span class="skolem">k</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>
 <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span><span class="main">)</span> 
     <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span>
     <span class="main">∧</span> <span class="var">?Q</span> <span class="skolem">k</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="var">?P</span> <span class="skolem">k</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span>  <span class="bound">m</span> <span class="bound">e</span> <span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span>  <span class="main">)</span> 
      <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="main">(</span><span class="var">?Q</span> <span class="skolem">k</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span><span class="bound">e</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> valid_alternative_with_GC<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
      
  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">unfolding</span></span> wp3'_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span><span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="skolem">n</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">with</span></span> f <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">c</span><span class="main">,</span><span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span>  <span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="var">?Q</span> <span class="skolem">k</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> z <span class="keyword1"><span class="command">have</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">-</span><span class="skolem">m</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> Q<span class="main">[</span><span class="operator">unfolded</span> e sep_conj_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span> <span class="main">##</span> <span class="skolem">ps2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps'</span> <span class="main">=</span> <span class="skolem">ps1</span> <span class="main">+</span><span class="skolem">ps2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span> <span class="main">=</span> <span class="skolem">e1</span> <span class="main">+</span>  <span class="skolem">e2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">e1</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?f</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span> <span class="main">+</span> <span class="skolem">e2</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">k</span> <span class="main">-</span> <span class="main">(</span><span class="skolem">e1</span> <span class="keyword1">div</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e2</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">have</span></span> kl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span> <span class="main">+</span> <span class="skolem">e2</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">k</span> <span class="main">≥</span> <span class="main">(</span><span class="skolem">e1</span> <span class="keyword1">div</span> <span class="skolem">k</span> <span class="main">+</span> <span class="main">(</span><span class="skolem">e2</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k
      <span class="keyword1"><span class="command">using</span></span> div_add1_eq le_iff_add <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>                        
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">∧</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">t</span><span class="main">,</span> <span class="main">(</span><span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">-</span> <span class="bound">m</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span>"</span></span>   
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">m</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command">using</span></span> z <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command">unfolding</span></span> e <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span><span class="skolem">e1</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps2</span><span class="main">,</span><span class="skolem">e2</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">+</span><span class="var">?f</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> eq <span class="keyword1"><span class="command">using</span></span> kl 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span> <span class="keyword1"><span class="command">using</span></span> Q <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">qed</span></span>
    
    
<span class="keyword1"><span class="command">theorem</span></span> completeness<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>b</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?P</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?Q</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?QG</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> valid_wp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      
  <span class="keyword1"><span class="command">from</span></span> wpT_is_pre  <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="var">?QG</span> <span class="skolem">k</span><span class="main">)</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="var">?QG</span> <span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>b</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">}</span>"</span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> hoare3b.conseq<span class="main"><span class="main">[</span></span><span class="operator">OF</span> hoare3b.import<span class="main"><span class="main">[</span></span><span class="operator">OF</span> R<span class="main"><span class="main">]</span></span><span class="main"><span class="main">,</span></span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> s n  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> P<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> k<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1"><span class="command">thm</span></span> E_extendsR completeness
  
<span class="keyword1" id="SepLogK_Hoare-completenessR"><span class="command">lemma</span></span> completenessR<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">}</span>"</span></span>  
  <span class="keyword1"><span class="command">using</span></span> E_extendsS completeness <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SepLogK_VCG">
<div class="head">
<h1>Theory SepLogK_VCG</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SepLogK_VCG 
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SepLogK_Hoare.html">SepLogK_Hoare</a>
<span class="keyword2"><span class="keyword">begin</span></span>
  
<span class="keyword1"><span class="command">lemmas</span></span> conseqS <span class="main">=</span> conseq<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> k<span class="main"><span class="main">=</span></span><span class="quoted"><span class="main">1</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span>

<span class="keyword1"><span class="command">datatype</span></span> acom <span class="main">=</span>
  Askip                  <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">SKIP</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span><span class="main">)</span> <span class="main">|</span>
  Aassign <span class="quoted">vname</span> <span class="quoted">aexp</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_ <span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">::=</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> <span class="main">[</span>1000<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Aseq   <span class="quoted">acom</span> <span class="quoted">acom</span>       <span class="main">(</span><span class="quoted">"_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">;;</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_"</span>  <span class="main">[</span>60<span class="main">,</span> 61<span class="main">]</span> 60<span class="main">)</span> <span class="main">|</span> 
  Aif <span class="quoted">bexp</span> <span class="quoted">acom</span> <span class="quoted">acom</span>     <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">IF</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">THEN</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">ELSE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> <span class="main">|</span>
  Awhile <span class="quoted">assn2</span> <span class="quoted">bexp</span> <span class="quoted">acom</span>  <span class="main">(</span><span class="quoted">"<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">(</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">{</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>_<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">}</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">WHILE</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">/ </span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">DO</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span> _<span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3"><span class="keyword3">)</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span>  <span class="main">[</span>0<span class="main">,</span> 0<span class="main">,</span> 61<span class="main">]</span> 61<span class="main">)</span> 
    
<span class="keyword1"><span class="command">notation</span></span> com.SKIP <span class="main">(</span><span class="quoted">"<span class="keyword1">SKIP</span>"</span><span class="main">)</span>
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">strip</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> com"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="keyword1">SKIP</span> <span class="main">=</span> <span class="keyword1">SKIP</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">strip</span> <span class="main">(</span><span class="main">{</span><span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free">strip</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>"</span></span>  


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">pre</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> assn2 <span class="main">⇒</span> assn2"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">$</span><span class="main">1</span> <span class="main">**</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">∈</span>dom <span class="bound">ps</span> <span class="main">∧</span> vars <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">ps</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span><span class="main">↦</span><span class="main">(</span>paval <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="bound">ps</span><span class="main">)</span><span class="main">)</span><span class="main">,</span><span class="bound">t</span><span class="main">)</span> <span class="main">)</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span><span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span><span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span>
   <span class="main">$</span><span class="main">1</span> <span class="main">**</span>  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>  <span class="keyword1">else</span> <span class="free">pre</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">pre</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span>"</span></span>  
  
  
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">vc</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"acom <span class="main">⇒</span> assn2 <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="keyword1">SKIP</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">x</span></span></span> <span class="main">::=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">;;</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="main">(</span>pre <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span> <span class="main">)</span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="keyword1">IF</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">THEN</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="keyword1">ELSE</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>1</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">∧</span> <span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C<span class="hidden">⇩</span><sub>2</sub></span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>  
<span class="quoted"><span class="quoted">"<span class="free">vc</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">I</span></span></span><span class="main">}</span> <span class="keyword1">WHILE</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">DO</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="main">=</span>  <span class="main">(</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> vars <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">⊆</span> dom <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> True <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">**</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>
         <span class="main">∧</span> <span class="main">(</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">I</span></span></span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="free"><span class="bound"><span class="entity">b</span></span></span> False <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="free">vc</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">I</span></span></span>  <span class="main">**</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span> 

 
<span class="keyword1" id="SepLogK_VCG-dollar0_left"><span class="command">lemma</span></span> dollar0_left<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span> <span class="main">0</span> <span class="main">∧*</span> <span class="free">Q</span><span class="main">)</span> <span class="main">=</span> <span class="free">Q</span>"</span></span>  
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> <span class="keyword1"><span class="command">unfolding</span></span> dollar_def sep_conj_def  
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  
<span class="keyword1" id="SepLogK_VCG-vc_sound"><span class="command">lemma</span></span> vc_sound<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">Q</span> <span class="main">⟹</span>  <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>pre <span class="free">C</span> <span class="free">Q</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Askip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseqS<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Frame<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Skip<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> dollar0_left<span class="main">)</span>  
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aassign <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseqS<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Assign4<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aseq <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> Seq<span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">b</span> <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Aif1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>pre <span class="skolem">C1</span> <span class="skolem">Q</span><span class="main">}</span> strip <span class="skolem">C1</span> <span class="main">{</span><span class="skolem">Q</span><span class="main">}</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> Aif2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">}</span> strip <span class="skolem">C2</span> <span class="main">{</span><span class="skolem">Q</span><span class="main">}</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conseqS<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> If<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span>  <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> Q<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">Q</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conseqS<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> Aif1<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> conseqS<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> Aif2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span> 
    <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">I</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span>
       dom <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="bound">s</span> <span class="main">⟶</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span>  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="skolem">b</span> True <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">**</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span>  <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="skolem">b</span> False <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="bound">s</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> C<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>pre <span class="skolem">C</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">**</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span><span class="main">}</span> strip <span class="skolem">C</span> <span class="main">{</span><span class="skolem">I</span> <span class="main">**</span> <span class="main">$</span> <span class="main">1</span><span class="main">}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span><span class="main"><span class="keyword3">+</span></span>
    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseqS<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> While<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">I</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conseqS<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> C<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> i <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> dom <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> dom <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> ii <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>  
  
<span class="keyword1" id="SepLogK_VCG-vc2valid"><span class="command">lemma</span></span> vc2valid<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> hoareT_sound2_part weakenpre vc_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

<span class="keyword1" id="SepLogK_VCG-pre_mono"><span class="command">lemma</span></span> pre_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> pre <span class="free">C</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟹</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">s</span>"</span></span>   
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Askip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_def dollar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aassign <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_def dollar_def<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aseq <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">b</span> <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_def dollar_def<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ps n
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">0</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="main">1</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">ps</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">x1</span> <span class="skolem">x2</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>
  
<span class="keyword1" id="SepLogK_VCG-vc_mono"><span class="command">lemma</span></span> vc_mono<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="free">Q</span> <span class="bound">s</span>"</span></span> <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">P</span> <span class="main">⟹</span> vc <span class="free">C</span> <span class="free">Q</span>"</span></span>        
<span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Askip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aassign <span class="skolem">x1</span> <span class="skolem">x2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aseq <span class="skolem">C1</span> <span class="skolem">C2</span> <span class="skolem">P</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">P</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">P</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span>  pre_mono<span class="main">[</span><span class="operator">OF</span> <span class="main">]</span> Aseq<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> pre <span class="skolem">C2</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">using</span></span> Aseq<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> i  iii<span class="main">]</span> Aseq<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> ii Aseq<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">x1</span> <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">I</span> <span class="skolem">b</span> <span class="skolem">C</span> <span class="skolem">P</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="SepLogK_VCG-vc_sound'"><span class="command">lemma</span></span> vc_sound'<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="free">C</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P'</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="free">k</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">s</span> <span class="bound">n</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">Q'</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="free">k</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">0</span> <span class="main">&lt;</span> <span class="free">k</span> <span class="main">⟹</span> <span class="main">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P'</span><span class="main">}</span> strip <span class="free">C</span> <span class="main">{</span> <span class="free">Q'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> conseq vc_mono vc_sound <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


  
  
        
<span class="keyword1" id="SepLogK_VCG-pre_Frame"><span class="command">lemma</span></span> pre_Frame<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="free">C</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> vc <span class="free">C</span> <span class="free">Q</span>
     <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">C'</span><span class="main">.</span> strip <span class="free">C</span> <span class="main">=</span> strip <span class="bound">C'</span> <span class="main">∧</span>  vc <span class="bound">C'</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="bound">C'</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">)</span>"</span></span>  
<span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">C</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">P</span></span> <span class="quoted"><span class="free">Q</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Askip
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Askip"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> A<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span><span class="main">##</span><span class="skolem">ps2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">=</span><span class="skolem">ps1</span><span class="main">+</span><span class="skolem">ps2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">b</span><span class="main">=</span><span class="skolem">n1</span><span class="main">+</span><span class="skolem">n2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="skolem">ps2</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> P Askip <span class="keyword1"><span class="command">have</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">∧*</span> <span class="skolem">Q</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> p A F
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">∧*</span> <span class="skolem">Q</span><span class="main">)</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sep_conj_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pre <span class="keyword1">SKIP</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aassign <span class="skolem">x</span> <span class="skolem">a</span><span class="main">)</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> 
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Aassign <span class="skolem">x</span> <span class="skolem">a</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span><span class="main">##</span><span class="skolem">ps2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span><span class="skolem">ps1</span><span class="main">+</span><span class="skolem">ps2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">n1</span><span class="main">+</span><span class="skolem">n2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="skolem">ps2</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> P Aassign<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">.</span> <span class="skolem">x</span> <span class="main">∈</span> dom <span class="bound">ps</span> <span class="main">∧</span> vars <span class="skolem">a</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">(</span><span class="skolem">x</span> <span class="main">↦</span> paval <span class="skolem">a</span> <span class="bound">ps</span><span class="main">)</span><span class="main">,</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span>
                                     <span class="main">∧*</span> <span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
    <span class="keyword1"><span class="command">with</span></span> o F <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" pre <span class="main">(</span><span class="skolem">x</span> <span class="main">::=</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>  
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> add_update_distrib dom_fun_upd domain_conv insert_dom option.simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> paval_extend sep_disj_fun_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aseq <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> Aseq<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span> <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Aseq<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> vc1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc2<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Aseq<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> pre vc1<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1'</span></span> <span class="keyword2"><span class="keyword">where</span></span> S1<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C1</span> <span class="main">=</span> strip <span class="skolem">C1'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> vc1'<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1'</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> I1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C1'</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Aseq<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"pre <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span> <span class="quoted"><span class="skolem">Q</span></span><span class="main">,</span> <span class="operator">OF</span> _ vc2<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2'</span></span> <span class="keyword2"><span class="keyword">where</span></span> S2<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C2</span> <span class="main">=</span> strip <span class="skolem">C2'</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> vc2'<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2'</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> I2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C2'</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Aseq <span class="skolem">C1'</span> <span class="skolem">C2'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>    
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> S1 S2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> vc_mono<span class="main">[</span><span class="operator">OF</span> I2 vc1'<span class="main">]</span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> vc2'<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> I1 I2 pre_mono
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Aif <span class="skolem">b</span> <span class="skolem">C1</span> <span class="skolem">C2</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Aif<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">⟶</span>
          <span class="main">(</span><span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">∧*</span>
           <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
           <span class="bound">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
  <span class="keyword1"><span class="command">from</span></span> Aif<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> vc1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> vc2<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword1"><span class="command">from</span></span> Aif<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"pre <span class="skolem">C1</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">Q</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> _ vc1<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    s1<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C1</span> <span class="main">=</span> strip <span class="skolem">C1'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1'</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> p1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C1'</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Aif<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"pre <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> Q<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">Q</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> _ vc2<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2'</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    s2<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C2</span> <span class="main">=</span> strip <span class="skolem">C2'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v2<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2'</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span>"</span></span> 
    <span class="keyword2"><span class="keyword">and</span></span> p2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C2'</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Aif <span class="skolem">b</span> <span class="skolem">C1'</span> <span class="skolem">C2'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">safe</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">P</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span><span class="main">##</span><span class="skolem">ps2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span><span class="skolem">ps1</span><span class="main">+</span><span class="skolem">ps2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">n1</span><span class="main">+</span><span class="skolem">n2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">P</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">(</span><span class="skolem">ps2</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> P i <span class="keyword1"><span class="command">have</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">∧*</span>
         <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
         <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> PF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span> <span class="main">∧*</span>
         <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">**</span> <span class="free">F</span><span class="main">)</span>
         <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span><span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> sep_conj_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps2</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> F P' o <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">simplified</span> sep_conj_assoc<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps1</span></span> <span class="skolem"><span class="skolem">ps2</span></span> <span class="skolem"><span class="skolem">n1</span></span> <span class="skolem"><span class="skolem">n2</span></span> <span class="keyword2"><span class="keyword">where</span></span> o<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps1</span><span class="main">##</span><span class="skolem">ps2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">ps</span><span class="main">=</span><span class="skolem">ps1</span><span class="main">+</span><span class="skolem">ps2</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">=</span><span class="skolem">n1</span><span class="main">+</span><span class="skolem">n2</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span><span class="skolem">n1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps2</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="main">(</span>pre <span class="skolem">C1</span> <span class="skolem">Q</span>  <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>pre <span class="skolem">C2</span> <span class="skolem">Q</span>  <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps2</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span>"</span></span>    
      <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> contra_subsetD domD map_add_dom_app_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_fun_conv sep_add_commute<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> pbval_extend <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>                                                     
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> contra_subsetD domD map_add_dom_app_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> plus_fun_conv sep_add_commute<span class="main">)</span> 
      <span class="keyword1"><span class="command">using</span></span> pbval_extend <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">if</span> pbval <span class="skolem">b</span> <span class="bound">ps</span> <span class="keyword1">then</span> <span class="main">(</span>pre <span class="skolem">C1'</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main">(</span>pre <span class="skolem">C2'</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps2</span><span class="main">,</span><span class="skolem">n2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> p1 p2  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> o P 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"pre <span class="main">(</span><span class="keyword1">IF</span> <span class="skolem">b</span> <span class="keyword1">THEN</span> <span class="skolem">C1'</span> <span class="keyword1">ELSE</span> <span class="skolem">C2'</span><span class="main">)</span> <span class="main">(</span><span class="skolem">Q</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sep_conj_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> s1 s2 v1 v2<span class="main">)</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Awhile <span class="skolem">I</span> <span class="skolem">b</span> <span class="skolem">C</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Awhile<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">⟶</span>  <span class="main">(</span><span class="skolem">I</span> <span class="main">**</span> <span class="main">$</span><span class="main">1</span><span class="main">)</span> <span class="bound">s</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Awhile<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> 
    dom<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span>"</span></span> 
  <span class="keyword2"><span class="keyword">and</span></span>  tB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">s</span> <span class="main">∧</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> pbval <span class="skolem">b</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span> pre <span class="skolem">C</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>  fB<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">ps</span> <span class="main">∧</span> <span class="main">¬</span> pbval <span class="skolem">b</span> <span class="bound">ps</span> <span class="main">⟶</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> vcB<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">∧*</span> <span class="main">$</span><span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">from</span></span> Awhile<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> tB vcB<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> st<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C</span> <span class="main">=</span> strip <span class="skolem">C'</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> vc'<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C'</span> <span class="main">(</span><span class="main">(</span><span class="skolem">I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> pre'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">a</span><span class="main">.</span> <span class="skolem">I</span> <span class="bound">a</span> <span class="main">∧</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="main">(</span>fst <span class="bound">a</span><span class="main">)</span> <span class="main">∧</span> pbval <span class="skolem">b</span> <span class="main">(</span>fst <span class="bound">a</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span> <span class="main">⟶</span>
            pre <span class="skolem">C'</span> <span class="main">(</span><span class="main">(</span><span class="skolem">I</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">(</span>Suc <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">∧*</span> <span class="free">F</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Awhile <span class="main">(</span><span class="skolem">I</span><span class="main">**</span><span class="free">F</span><span class="main">)</span> <span class="skolem">b</span> <span class="skolem">C'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> st <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> dom <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domD sep_substate_disj_add subState subsetCE<span class="main">)</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>  <span class="keyword1"><span class="command">using</span></span> pre' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span>  sep_conj_def<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> <span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span>  sep_conj_def<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> dom pbval_extend sep_add_commute sep_disj_commuteI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> fB <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">using</span></span> dom pbval_extend <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> vc' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_conj_ac<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command">using</span></span> pre <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> semiring_normalization_rules<span class="main"><span class="main">(</span></span>23<span class="main"><span class="main">)</span></span> sep_add_assoc sep_add_commute sep_add_disjD sep_add_disjI1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

  
  
        
        
        
<span class="keyword1" id="SepLogK_VCG-vc_complete"><span class="command">lemma</span></span> vc_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">C</span><span class="main">.</span> vc <span class="bound">C</span> <span class="free">Q</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="bound">C</span> <span class="free">Q</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> strip <span class="bound">C</span> <span class="main">=</span> <span class="free">c</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induct</span>   <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> hoare3a.induct<span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> Skip
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Askip"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Assign4 <span class="skolem">x</span> <span class="skolem">a</span> <span class="skolem">Q</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Aassign <span class="skolem">x</span> <span class="skolem">a</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>If <span class="skolem">P</span> <span class="skolem">b</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="skolem">Q</span>"</span></span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C1</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="skolem">b</span> True <span class="bound">ps</span><span class="main">)</span> <span class="main">⟶</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> If<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> B1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">Q</span>"</span></span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C2</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> B2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="skolem">b</span> False <span class="bound">ps</span><span class="main">)</span> <span class="main">⟶</span> pre <span class="skolem">C2</span> <span class="skolem">Q</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Aif <span class="skolem">b</span> <span class="skolem">C1</span> <span class="skolem">C2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> A1 B1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> ps n
      <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def dollar_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">1</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">ps</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> A2 B2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Frame <span class="skolem">P</span> <span class="skolem">C</span> <span class="skolem">Q</span> <span class="skolem">F</span><span class="main">)</span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> vc<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C'</span> <span class="skolem">Q</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C'</span> <span class="skolem">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> strip<span class="main">:</span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C'</span> <span class="main">=</span> <span class="skolem">C</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> pre_Frame<span class="main">[</span><span class="operator">OF</span> pre vc<span class="main">]</span> strip <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Seq <span class="skolem">P</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span> <span class="skolem">Q</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span> <span class="skolem">R</span><span class="main">)</span>
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C1</span></span> <span class="keyword2"><span class="keyword">where</span></span> A1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C1</span> <span class="skolem">Q</span>"</span></span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C1</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>1</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    A2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C1</span> <span class="skolem">Q</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">from</span></span> Seq<span class="main">(</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C2</span></span> <span class="keyword2"><span class="keyword">where</span></span> B1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C2</span> <span class="skolem">R</span>"</span></span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C2</span> <span class="main">=</span> <span class="skolem">c<span class="hidden">⇩</span><sub>2</sub></span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
    B2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">Q</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C2</span> <span class="skolem">R</span> <span class="bound">s</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Aseq <span class="skolem">C1</span> <span class="skolem">C2</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> B1 A1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> vc_mono B2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> pre_mono<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> P<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">Q</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="keyword1"><span class="command">using</span></span>  B2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">using</span></span> A2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>While <span class="skolem">I</span> <span class="skolem">b</span> <span class="skolem">c</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C</span></span> <span class="keyword2"><span class="keyword">where</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span>"</span></span>
          <span class="quoted"><span class="quoted">"strip <span class="skolem">C</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span>
         <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="skolem">I</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> lmaps_to_axpr <span class="skolem">b</span> True <span class="bound">ps</span><span class="main">)</span> <span class="main">⟶</span>
              pre <span class="skolem">C</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="main">∧*</span> <span class="main">$</span> <span class="main">1</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"Awhile <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="skolem">I</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">∧</span> vars <span class="skolem">b</span> <span class="main">⊆</span> dom <span class="bound">s</span><span class="main">)</span> <span class="skolem">b</span> <span class="skolem">C</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> 1 2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>conseqS <span class="skolem">P</span> <span class="skolem">c</span> <span class="skolem">Q</span> <span class="skolem">P'</span> <span class="skolem">Q'</span><span class="main">)</span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">C'</span></span> <span class="keyword2"><span class="keyword">where</span></span> C'<span class="main">:</span> <span class="quoted"><span class="quoted">"vc <span class="skolem">C'</span> <span class="skolem">Q</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">s</span> <span class="main">⟶</span> pre <span class="skolem">C'</span> <span class="skolem">Q</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"strip <span class="skolem">C'</span> <span class="main">=</span> <span class="skolem">c</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">C'</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> C' conseqS<span class="main">(</span>3<span class="main">,</span>4<span class="main">)</span> pre_mono vc_mono <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
<span class="keyword1"><span class="command">qed</span></span> 
           
   
  
  
<span class="keyword1"><span class="command">theorem</span></span> vc_completeness<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">C</span> <span class="bound">k</span><span class="main">.</span> vc <span class="bound">C</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">)</span>
          <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟶</span> pre <span class="bound">C</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">k</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>
          <span class="main">∧</span> strip <span class="bound">C</span> <span class="main">=</span> <span class="free">c</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
  <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?QG</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">λ</span><span class="bound">k</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span> <span class="keyword1">div</span> <span class="bound">k</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">**</span> sep_true<span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">using</span></span> valid_wp <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
      
  <span class="keyword1"><span class="command">from</span></span> wpT_is_pre  <span class="keyword1"><span class="command">have</span></span> R<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">⊢<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>a</sub></span> <span class="main">{</span><span class="keyword1">wp<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="free">c</span> <span class="main">(</span><span class="var">?QG</span> <span class="skolem">k</span><span class="main">)</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="var">?QG</span> <span class="skolem">k</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">)</span></span> case_prod_conv k neq0_conv nonzero_mult_div_cancel_left old.prod.exhaust<span class="main">)</span>
  
     
  <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span>"</span></span>   
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> ps1 n1 ps2 n2 <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">note</span></span> o <span class="main">=</span> this
    <span class="keyword1"><span class="command">from</span></span> o<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> nn1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">n</span><span class="main">≥</span><span class="skolem">n1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> add_leE div_le_dividend<span class="main">)</span> 
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps1</span><span class="main">,</span> <span class="skolem">n1</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">ps2</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">n1</span><span class="main">)</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> o nn1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> z'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span>fst <span class="bound">s</span><span class="main">,</span> <span class="main">(</span>snd <span class="bound">s</span><span class="main">)</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> prod.collapse<span class="main">)</span>   
      
  <span class="keyword1"><span class="command">from</span></span> vc_complete<span class="main">[</span><span class="operator">OF</span> R<span class="main">]</span>   <span class="keyword1"><span class="command"><span class="improper"><span class="command">guess</span></span></span></span> C <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">note</span></span> o <span class="main">=</span> this
    
  <span class="keyword1"><span class="command">have</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span>  pre <span class="skolem">C</span> <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">Q</span> <span class="main">∧*</span> <span class="main">(</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> True<span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span> <span class="keyword1">div</span> <span class="skolem">k</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> o p <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span> 
    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">C</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> vc_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> _ o<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> z  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> y <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> o <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Discussion">
<div class="head">
<h1>Theory Discussion</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Discussion"</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relation between the explicit Hoare logics›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Discussion
<span class="keyword2"><span class="keyword">imports</span></span> <a href="Quant_Hoare.html">Quant_Hoare</a> <a href="SepLog_Hoare.html">SepLog_Hoare</a>
<span class="keyword2"><span class="keyword">begin</span></span>
 
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Relation SepLogic to quantHoare›</span></span>
     
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">em</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">em</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P'</span></span></span> <span class="main">(</span>emb <span class="bound">ps</span> <span class="main">(</span><span class="main">%</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> enat <span class="bound">n</span> <span class="main">)</span>"</span></span>  <span class="comment1">(* with equality next lemma also works *)</span>
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub></span> <span class="main">{</span> em <span class="free">P'</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> em <span class="free">Q'</span> <span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub></span> <span class="main">{</span> <span class="free">P'</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q'</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword1"><span class="command">have</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> em <span class="free">P'</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">n</span> <span class="main">∧</span> em <span class="free">Q'</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">n</span> <span class="main">-</span> <span class="bound">m</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3_valid_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P'</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P'</span> <span class="skolem">s</span> <span class="main">=</span> enat <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> P' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"em <span class="free">P'</span> <span class="main">(</span>part <span class="skolem">s</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> em_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">with</span></span> s' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> part <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q'<span class="main">:</span> <span class="quoted"><span class="quoted">"em <span class="free">Q'</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        
    <span class="keyword1"><span class="command">from</span></span> Q' <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q'</span> <span class="main">(</span>emb <span class="skolem">ps'</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> enat <span class="main">(</span> <span class="skolem">n</span> <span class="main">-</span> <span class="skolem">m</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> em_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
        
    <span class="keyword1"><span class="command">thm</span></span> full_to_part  part_to_full
    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">m</span> <span class="main">⇓</span> emb <span class="skolem">ps'</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  part_to_full'<span class="main">[</span><span class="operator">OF</span> c<span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span> 
                
        
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">m</span> <span class="main">+</span> <span class="free">Q'</span> <span class="main">(</span>emb <span class="skolem">ps'</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> <span class="free">P'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span>  n <span class="keyword1"><span class="command">using</span></span> q m
      <span class="keyword1"><span class="command">using</span></span> enat_ile <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 
      
    <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> <span class="free">Q'</span> <span class="bound">t</span> <span class="main">≤</span> <span class="free">P'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">then</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare2_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span> 
  

<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="DiscussionO">
<div class="head">
<h1>Theory DiscussionO</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Relation between the Hoare logics in big-O style›</span></span>
<span class="keyword1"><span class="command">theory</span></span> DiscussionO
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SepLogK_Hoare.html">SepLogK_Hoare</a> <a href="QuantK_Hoare.html">QuantK_Hoare</a> <a href="Nielson_Hoare.html">Nielson_Hoare</a> 
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(* here we compare quantitative Hoare logic with constant with Nielson's Hoare logic *)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Relation Nielson to quantHoare›</span></span>
  
  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">emN</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"qassn <span class="main">⇒</span> Nielson_Hoare.assn2"</span></span>  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">emN</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="main">∞</span><span class="main">)</span>"</span></span>  
 
<span class="comment1">(* quanthoare can be simulated by Nielson  *)</span>  
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> emN <span class="free">P'</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span>  <span class="main">%</span><span class="bound">s</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">e</span><span class="main">.</span> enat <span class="bound">e</span> <span class="main">=</span> <span class="free">P'</span> <span class="bound">s</span> <span class="main">-</span> <span class="free">Q'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">(</span><span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">)</span> <span class="main">)</span><span class="main">)</span> <span class="main">⇓</span> emN <span class="free">Q'</span> <span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> <span class="var">?P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="var">?e</span> <span class="main">⇓</span> <span class="var">?Q</span> <span class="main">}</span>"</span></span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> quantNielson<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P'</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q'</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">s</span><span class="main">.</span> emN <span class="free">P'</span> <span class="bound">l</span> <span class="bound">s</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="var">?e</span> <span class="bound">s</span> <span class="main">∧</span> emN <span class="free">Q'</span> <span class="bound">l</span> <span class="bound">t</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> hoare1_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> QuantK_Hoare.hoare2o_valid_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P'</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>emN <span class="free">P'</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span>  emN_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> qd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="var">?e</span> <span class="skolem">s</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"emN <span class="free">Q'</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="skolem">t</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bigstepT_the_state<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
      
    <span class="keyword1"><span class="command">from</span></span> P' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">pre</span></span> <span class="keyword2"><span class="keyword">where</span></span> pre<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P'</span> <span class="skolem">s</span> <span class="main">=</span> enat <span class="skolem">pre</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> e <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q'</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> emN_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">post</span></span> <span class="keyword2"><span class="keyword">where</span></span> post<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q'</span> <span class="skolem">t</span> <span class="main">=</span> enat <span class="skolem">post</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> i bigstep_progress <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>     
      
    <span class="keyword1"><span class="command">thm</span></span> enat.inject idiff_enat_enat the_equality
    <span class="keyword1"><span class="command">have</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">THE</span> <span class="bound">e</span><span class="main">.</span> enat <span class="bound">e</span> <span class="main">=</span> <span class="free">P'</span> <span class="skolem">s</span> <span class="main">-</span> <span class="free">Q'</span> <span class="main">(</span><span class="keyword1">THE</span> <span class="bound">t</span><span class="main">.</span> <span class="main">∃</span><span class="bound">n</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">n</span> <span class="main">⇓</span> <span class="bound">t</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">pre</span> <span class="main">-</span> <span class="skolem">post</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> t pre post <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> the_equality<span class="main">)</span>   
       <span class="keyword1"><span class="command">using</span></span> idiff_enat_enat <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> ieq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="skolem">pre</span> <span class="main">-</span> <span class="skolem">post</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">post</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">pre</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">p</span><span class="main">&gt;</span><span class="main">0</span>›</span></span>
      <span class="keyword1"><span class="command">using</span></span> diff_mult_distrib2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">then</span></span> 
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q'</span> <span class="skolem">t</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">P'</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> post pre <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>                           
    <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q'</span> <span class="bound">t</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">P'</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> 
<span class="keyword1"><span class="command">qed</span></span>
 
  
  
<span class="comment1">(* Nielson can be simulated by quanthoare *)</span>  
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="main">%</span><span class="bound">s</span> <span class="main">.</span> emb <span class="main">(</span><span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">+</span> enat <span class="main">(</span><span class="free">e</span> <span class="bound">s</span><span class="main">)</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="main">%</span><span class="bound">s</span><span class="main">.</span> emb <span class="main">(</span><span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">s</span><span class="main">)</span> <span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="var">?P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="var">?Q</span> <span class="main">}</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span> sP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">t</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="bound">t</span>"</span></span> <span class="comment1">(* "support P = {}" *)</span>
    <span class="keyword2"><span class="keyword">and</span></span> sQ<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">l</span> <span class="bound">t</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">t</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">l</span> <span class="bound">t</span>"</span></span> <span class="comment1">(* "support Q = {}" *)</span>
  <span class="keyword2"><span class="keyword">shows</span></span>  NielsonQuant<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">e</span> <span class="main">⇓</span> <span class="free">Q</span> <span class="main">}</span>"</span></span> 
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> qd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="var">?P</span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="var">?Q</span> <span class="bound">t</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="var">?P</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> QuantK_Hoare.hoare2o_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare1_valid_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">l</span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> P'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">l</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> aP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="free">P</span> <span class="bound">l</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sP  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?P</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> qd <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="keyword2"><span class="keyword">where</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> p<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="var">?Q</span> <span class="skolem">t</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="var">?P</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">↓<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> bigstepT_the_state<span class="main">[</span><span class="operator">OF</span> i<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
       
    <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">l</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> p k
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> emb.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> enat_ord_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> imult_is_infinity infinity_ileE not_less_zero plus_enat_simps<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">)</span>      
    <span class="keyword1"><span class="command">with</span></span> sQ <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">l</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">l</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?Q</span> <span class="skolem">t</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> p <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="var">?P</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> aP <span class="keyword1"><span class="command">have</span></span> p'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">e</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
    <span class="keyword1"><span class="command">from</span></span> i Q p' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> <span class="bound">p</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">e</span> <span class="skolem">s</span> <span class="main">∧</span> <span class="free">Q</span> <span class="skolem">l</span> <span class="bound">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>     
  <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword1"><span class="command">qed</span></span>



 
<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Relation SepLogic to quantHoare›</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">em</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"qassn <span class="main">⇒</span> <span class="main">(</span>pstate_t <span class="main">⇒</span> bool<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">em</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">ex</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>Partial_Evaluation.emb <span class="bound">ps</span> <span class="bound">ex</span><span class="main">)</span> <span class="main">≤</span> enat <span class="bound">n</span><span class="main">)</span> <span class="main">)</span>"</span></span>  <span class="comment1">(* with equality next lemma also works *)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> em <span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> em <span class="free">Q</span> <span class="main">}</span>"</span></span>
<span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">0</span><span class="main">&lt;</span><span class="skolem">k</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> em <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span><span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> em <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">{</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> 
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">n</span></span> <span class="keyword2"><span class="keyword">where</span></span> n<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span> <span class="main">=</span> enat <span class="skolem">n</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> P <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"em <span class="free">P</span> <span class="main">(</span>part <span class="skolem">s</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> em_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    <span class="keyword1"><span class="command">with</span></span> s' <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> part <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Q<span class="main">:</span> <span class="quoted"><span class="quoted">"em <span class="free">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        
    <span class="keyword1"><span class="command">from</span></span> Q <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span>Partial_Evaluation.emb <span class="skolem">ps'</span> <span class="main">(</span>Partial_Evaluation.emb <span class="skolem">ps''</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> enat <span class="main">(</span><span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> em_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
    <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>Partial_Evaluation.emb <span class="skolem">ps'</span> <span class="main">(</span>Partial_Evaluation.emb <span class="skolem">ps''</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps'</span><span class="main">+</span><span class="skolem">ps''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> Partial_Evaluation.emb_def  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> plus_fun_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> ext<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> v <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="skolem">v</span>"</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">using</span></span> orth    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> sep_disj_fun_def domain_conv<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword1"><span class="command">from</span></span> q z <span class="keyword1"><span class="command">have</span></span> q<span class="main">:</span>  <span class="quoted"><span class="quoted">"enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="main">(</span>Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps'</span><span class="main">+</span><span class="skolem">ps''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> enat <span class="skolem">e</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> i0_lb mult_left_mono<span class="main">)</span> 

    <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="main">(</span>Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps'</span><span class="main">+</span><span class="skolem">ps''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span>  part_to_full'<span class="main">[</span><span class="operator">OF</span> c<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>   
                
        
    <span class="keyword1"><span class="command">have</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">m</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="main">(</span>Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps'</span><span class="main">+</span><span class="skolem">ps''</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span>  n <span class="keyword1"><span class="command">using</span></span> q m
      <span class="keyword1"><span class="command">using</span></span> enat_ile <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      
    <span class="keyword1"><span class="command">from</span></span> i ii <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">Q</span> <span class="bound">t</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="free">P</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> B<span class="main">=</span>this
  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> QuantK_Hoare.hoare2o_valid_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span> B<span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command">qed</span></span> 

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">embe</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>pstate_t <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> qassn"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">embe</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> Inf <span class="main">{</span>enat <span class="bound">n</span><span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>part <span class="bound">s</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span> <span class="main">)</span>"</span></span>
 
<span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span> embe <span class="free">P</span> <span class="main">}</span> <span class="free">c</span> <span class="main">{</span> embe <span class="free">Q</span> <span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> full<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ps</span> <span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span> <span class="main">⟹</span> dom <span class="bound">ps</span> <span class="main">=</span> UNIV"</span></span>            
  <span class="keyword2"><span class="keyword">shows</span></span>  <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>  <span class="free">P</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="free">Q</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> s <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> embe <span class="free">P</span> <span class="bound">s</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> embe <span class="free">Q</span> <span class="bound">t</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> embe <span class="free">P</span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> QuantK_Hoare.hoare2o_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">n</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?s</span></span></span> <span class="main">=</span><span class="quoted"><span class="quoted">" <span class="main">(</span>Partial_Evaluation.emb <span class="skolem">ps</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">with</span></span> full <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"dom <span class="skolem">ps</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> ps<span class="main">:</span> <span class="quoted"><span class="quoted">"part <span class="var">?s</span> <span class="main">=</span> <span class="skolem">ps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> P <span class="keyword1"><span class="command">have</span></span> l'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span>enat <span class="bound">n</span> <span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span>  False "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">have</span></span> t<span class="main">:</span> <span class="quoted"><span class="quoted">"embe <span class="free">P</span> <span class="var">?s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> embe_def Inf_enat_def ps l'
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> l' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Least_le infinity_ileE<span class="main">)</span>  
    <span class="keyword1"><span class="command">with</span></span> s <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">p</span></span> <span class="keyword2"><span class="keyword">where</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="var">?s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">p</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ineq<span class="main">:</span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> embe <span class="free">Q</span> <span class="skolem">t</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> embe <span class="free">P</span> <span class="var">?s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> t <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">z</span></span> <span class="keyword2"><span class="keyword">where</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"embe <span class="free">P</span> <span class="var">?s</span> <span class="main">=</span> enat <span class="skolem">z</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> less_infinityE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
    <span class="keyword1"><span class="command">with</span></span> ineq <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">y</span></span> <span class="keyword2"><span class="keyword">where</span></span> y<span class="main">:</span> <span class="quoted"><span class="quoted">"embe <span class="free">Q</span> <span class="skolem">t</span> <span class="main">=</span> enat <span class="skolem">y</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> k <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>   
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> l<span class="main">:</span> <span class="quoted"><span class="quoted">"embe <span class="free">Q</span> <span class="skolem">t</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> zz<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span>enat <span class="bound">n</span><span class="main">|</span><span class="bound">n</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span>part <span class="skolem">t</span><span class="main">,</span> <span class="bound">n</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> embe_def Inf_enat_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">safe</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
    <span class="keyword1"><span class="command">from</span></span> y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span>part <span class="skolem">t</span><span class="main">,</span> <span class="skolem">y</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">unfolding</span></span> embe_def zz Inf_enat_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
       <span class="keyword1"><span class="command">using</span></span> zz <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">smt</span> Collect_empty_eq LeastI enat.inject<span class="main">)</span>
    
    <span class="keyword1"><span class="command">from</span></span> full_to_part<span class="main">[</span><span class="operator">OF</span> c<span class="main">]</span> ps <span class="keyword1"><span class="command">have</span></span> c'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">p</span> <span class="main">⇓</span> part <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">P</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">P</span> <span class="main">(</span><span class="bound">n</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="keyword1">LEAST</span> <span class="bound">n</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">n</span><span class="main">)</span> <span class="main">≤</span> <span class="bound">n</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Least_le<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> z P <span class="keyword1"><span class="command">have</span></span> zn<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">z</span> <span class="main">≤</span> <span class="skolem">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> embe_def ps <span class="keyword1"><span class="command">unfolding</span></span> embe_def Inf_enat_def l'
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Least_le enat_ord_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>        

    <span class="keyword1"><span class="command">from</span></span> ineq z y <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span>"</span></span>   <span class="keyword1"><span class="command">using</span></span> zn k <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">y</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">p</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> add.assoc add.commute le_iff_add<span class="main">)</span>    

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"part <span class="skolem">t</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">p</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">y</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">e'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span> 
  <span class="keyword1"><span class="command">}</span></span>

  <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fact</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹A General Validity Predicate with Time›</span></span>

  
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">valid</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>  

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">validk</span>  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">validk</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="free"><span class="bound"><span class="entity">c</span></span></span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">c</span></span></span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="bound">k</span> <span class="main">*</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">Q</span></span></span> <span class="bound">s'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"validk <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> valid <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">k</span><span class="main">*</span><span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> valid_def validk_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Relation between valid predicate and Quantitative Hoare Logic›</span></span>
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span>  emb <span class="main">(</span><span class="free">P</span> <span class="bound">s</span><span class="main">)</span>  <span class="main">+</span> enat <span class="free">n</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span>  emb <span class="main">(</span><span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>  <span class="main">}</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> valid <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">k</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">+</span> enat <span class="free">n</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span><span class="main">λ</span><span class="bound">s</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">s</span><span class="main">)</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> val<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="main">↑</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">+</span> enat <span class="free">n</span> <span class="main">&lt;</span> <span class="main">∞</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∃</span><span class="bound">t</span> <span class="bound">p</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">p</span> <span class="main">⇓</span> <span class="bound">t</span> <span class="main">∧</span> enat <span class="bound">p</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">↑</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">t</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">↑</span> <span class="main">(</span><span class="free">P</span> <span class="bound">s</span><span class="main">)</span> <span class="main">+</span> enat <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> QuantK_Hoare.hoare2o_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> Ps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">" <span class="main">↑</span> <span class="main">(</span><span class="free">P</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> enat <span class="free">n</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">with</span></span> val <span class="keyword3"><span class="command">obtain</span></span>  <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">↑</span> <span class="main">(</span><span class="free">Q</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">↑</span> <span class="main">(</span><span class="free">P</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> enat <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">Q</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> k
      <span class="keyword1"><span class="command">using</span></span> Ps add.commute add.right_neutral emb.simps<span class="main">(</span>1<span class="main">)</span> emb.simps<span class="main">(</span>2<span class="main">)</span> enat_ord_simps<span class="main">(</span>1<span class="main">)</span> infinity_ileE plus_enat_simps<span class="main">(</span>3<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> mult_zero_right not_gr_zero times_enat_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> times_enat_simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
        
    <span class="keyword1"><span class="command">with</span></span>     c      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">s'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span>  <span class="skolem">k</span> <span class="main">*</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">s'</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> bla<span class="main">=</span>this 
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> valid <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">k</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> valid_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> bla k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  
 
<span class="keyword1" id="DiscussionO-valid_quantHoare"><span class="command">lemma</span></span> valid_quantHoare<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> valid <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">k</span><span class="main">*</span><span class="free">n</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> emb <span class="main">(</span><span class="free">P</span> <span class="bound">s</span><span class="main">)</span>  <span class="main">+</span> enat <span class="free">n</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> emb <span class="main">(</span><span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>  <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">k</span></span><span class="main">&gt;</span><span class="main">0</span><span class="main">.</span> valid <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="main">(</span><span class="bound">k</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">"valid <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="main">(</span><span class="skolem">k</span><span class="main">*</span><span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span> 
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span> emb <span class="main">(</span><span class="free">P</span> <span class="bound">s</span><span class="main">)</span>  <span class="main">+</span> enat <span class="free">n</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">&lt;</span> <span class="main">∞</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> Ps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> emb.elims enat.distinct<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> enat.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span> enat_defs<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">with</span></span> valid<span class="main">[</span><span class="operator">unfolded</span> valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">t</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        c<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">t</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">n</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">t</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>    
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"enat <span class="skolem">m</span> <span class="main">+</span>  <span class="skolem">k</span> <span class="main">*</span> <span class="main">↑</span> <span class="main">(</span><span class="free">Q</span> <span class="skolem">t</span><span class="main">)</span> <span class="main">≤</span>  <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">↑</span> <span class="main">(</span><span class="free">P</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> enat <span class="free">n</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Ps <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span>     c      
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">s'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">s'</span> <span class="main">∧</span> enat <span class="bound">m</span> <span class="main">+</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">↑</span> <span class="main">(</span><span class="free">Q</span> <span class="bound">s'</span><span class="main">)</span> <span class="main">≤</span> enat <span class="skolem">k</span> <span class="main">*</span> <span class="main">(</span><span class="main">↑</span> <span class="main">(</span><span class="free">P</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">+</span> enat <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> funk<span class="main">=</span>this
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>2</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span><span class="main">%</span><span class="bound">s</span><span class="main">.</span>  emb <span class="main">(</span><span class="free">P</span> <span class="bound">s</span><span class="main">)</span>  <span class="main">+</span> enat <span class="free">n</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span> <span class="main">λ</span><span class="bound">s</span><span class="main">.</span> emb <span class="main">(</span><span class="free">Q</span> <span class="bound">s</span><span class="main">)</span>  <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> QuantK_Hoare.hoare2o_valid_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="skolem">k</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">using</span></span> funk k <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>  



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Relation between valid predicate and Hoare Logic based on Separation Logic›</span></span>
    
  
  

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">embP2</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">s</span><span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>Partial_Evaluation.emb <span class="bound">ps</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">embP3</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">%</span><span class="main">(</span><span class="bound">ps</span><span class="main">,</span><span class="bound">n</span><span class="main">)</span><span class="main">.</span> dom <span class="bound">ps</span> <span class="main">=</span> UNIV <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span>  <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span>Partial_Evaluation.emb <span class="bound">ps</span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span>"</span></span>
  
    
<span class="keyword1" id="DiscussionO-emp"><span class="command">lemma</span></span> emp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">+</span> Map.empty <span class="main">=</span> <span class="free">a</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> plus_fun_conv<span class="main">)</span> 
  
<span class="keyword1" id="DiscussionO-oneway"><span class="command">lemma</span></span> oneway<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>embP3 <span class="free">P</span> <span class="main">**</span> <span class="main">$</span><span class="free">n</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span>embP2 <span class="free">Q</span><span class="main">}</span> <span class="main">⟹</span> validk <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> partial_true<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>embP3 <span class="free">P</span> <span class="main">**</span> <span class="main">$</span><span class="free">n</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span>embP2 <span class="free">Q</span><span class="main">}</span>"</span></span> 
  <span class="keyword1"><span class="command">from</span></span> partial_true<span class="main">[</span><span class="operator">unfolded</span> hoare3o_valid_def<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
   q <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ps</span> <span class="bound">na</span><span class="main">.</span> <span class="main">(</span>embP3 <span class="free">P</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="bound">ps</span><span class="main">,</span> <span class="bound">na</span><span class="main">)</span> <span class="main">⟶</span>
                <span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">na</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> embP2 <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span> "</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">s</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="skolem">s</span>"</span></span>
    <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> g<span class="main">:</span> <span class="quoted"><span class="quoted">" <span class="main">(</span>embP3 <span class="free">P</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span>part <span class="skolem">s</span><span class="main">,</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> embP3_def dollar_def sep_conj_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> q  g
    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">ps'</span></span> <span class="skolem"><span class="skolem">ps''</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="skolem"><span class="skolem">e'</span></span> <span class="keyword2"><span class="keyword">where</span></span> pbig<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> part <span class="skolem">s</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> orth<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">ps'</span> <span class="main">##</span> <span class="skolem">ps''</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="free">n</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">e</span> <span class="main">+</span> <span class="skolem">e'</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> erg<span class="main">:</span> <span class="quoted"><span class="quoted">"embP2 <span class="free">Q</span> <span class="main">(</span><span class="skolem">ps'</span><span class="main">,</span> <span class="skolem">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    <span class="keyword1"><span class="command">have</span></span> ii'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ii <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>    
        
    <span class="keyword1"><span class="command">from</span></span> part_to_full'<span class="main">[</span><span class="operator">OF</span> pbig<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span> <span class="main">)</span> <span class="main">⇒</span> <span class="skolem">m</span> <span class="main">⇓</span> Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span><span class="main">)</span> <span class="skolem">s</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
    <span class="keyword1"><span class="command">from</span></span> erg <span class="keyword1"><span class="command">have</span></span> z2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">Q</span> <span class="main">(</span>Partial_Evaluation.emb <span class="skolem">ps'</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> embP2_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>   
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps''</span> <span class="main">+</span> <span class="skolem">ps'</span><span class="main">)</span> <span class="skolem">s</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> orth  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sep_add_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps''</span> <span class="main">+</span> <span class="skolem">ps'</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps'</span><span class="main">)</span> <span class="main">(</span>Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps''</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span> 
      <span class="keyword1"><span class="command">unfolding</span></span> emb_def plus_fun_conv map_add_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> option.case_eq_if option.simps<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span> 
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> z<span class="main">:</span> <span class="quoted"><span class="quoted">"Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span><span class="main">)</span> <span class="skolem">s</span> <span class="main">=</span> Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps'</span><span class="main">)</span> <span class="main">(</span>Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps''</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="main">(</span>Partial_Evaluation.emb <span class="main">(</span><span class="skolem">ps'</span> <span class="main">+</span> <span class="skolem">ps''</span><span class="main">)</span> <span class="skolem">s</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> z <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">fact</span><span class="main">)</span> <span class="keyword1"><span class="command">.</span></span> 
        
    <span class="keyword1"><span class="command">from</span></span> i ii' iii
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">s'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> k <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"validk <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> validk_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
   
  
<span class="keyword1" id="DiscussionO-theother"><span class="command">lemma</span></span> theother<span class="main">:</span> <span class="quoted"><span class="quoted">"validk <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="free">n</span> <span class="main">⟹</span> <span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>embP3 <span class="free">P</span> <span class="main">**</span> <span class="main">$</span><span class="free">n</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span>embP2 <span class="free">Q</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">"validk <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="free">n</span>"</span></span> 
  <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">k</span></span> <span class="keyword2"><span class="keyword">where</span></span> k <span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span><span class="main">&gt;</span><span class="main">0</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> v<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="bound">s</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">s'</span> <span class="bound">m</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">s'</span> <span class="main">∧</span> <span class="bound">m</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">n</span> <span class="main">∧</span> <span class="free">Q</span> <span class="bound">s'</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> validk_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ps</span> <span class="skolem">na</span>
    <span class="keyword3"><span class="command">assume</span></span> an<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>embP3 <span class="free">P</span> <span class="main">∧*</span> <span class="main">$</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="skolem">ps</span><span class="main">,</span> <span class="skolem">na</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">have</span></span> dom<span class="main">:</span> <span class="quoted"><span class="quoted">"dom <span class="skolem">ps</span> <span class="main">=</span> UNIV"</span></span> <span class="keyword2"><span class="keyword">and</span></span> Pps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">s</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>Partial_Evaluation.emb <span class="skolem">ps</span> <span class="bound">s</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> nan<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">na</span> <span class="main">=</span> <span class="free">n</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> an <span class="keyword1"><span class="command">unfolding</span></span> sep_conj_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> embP3_def dollar_def<span class="main">)</span>
        
    <span class="keyword1"><span class="command">from</span></span> v Pps
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">s'</span></span> <span class="skolem"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword">where</span></span> big<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="main">(</span>Partial_Evaluation.emb <span class="skolem">ps</span> <span class="main">(</span><span class="main">%</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="skolem">m</span> <span class="main">⇓</span> <span class="skolem">s'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ii<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">≤</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">n</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> erg<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Q</span> <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
                    
          
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"part <span class="main">(</span>Partial_Evaluation.emb <span class="skolem">ps</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">ps</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> dom <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">with</span></span> full_to_part<span class="main">[</span><span class="operator">OF</span> big<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> i<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="skolem">m</span> <span class="main">⇓</span> part <span class="skolem">s'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
    
       
    <span class="keyword1"><span class="command">have</span></span> iii<span class="main">:</span> <span class="quoted"><span class="quoted">"embP2 <span class="free">Q</span> <span class="main">(</span>part <span class="skolem">s'</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> embP2_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span> 
         
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="skolem">na</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">m</span> <span class="main">+</span> <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ii k nan <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>  
        
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">ps'</span> <span class="bound">ps''</span> <span class="bound">m</span> <span class="bound">e</span> <span class="bound">e'</span><span class="main">.</span> <span class="main">(</span><span class="free">c</span><span class="main">,</span> <span class="skolem">ps</span><span class="main">)</span> <span class="keyword1">⇒<span class="hidden">⇩</span><sub>A</sub></span> <span class="bound">m</span> <span class="main">⇓</span> <span class="bound">ps'</span> <span class="main">+</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="bound">ps'</span> <span class="main">##</span> <span class="bound">ps''</span> <span class="main">∧</span> <span class="skolem">k</span> <span class="main">*</span> <span class="skolem">na</span> <span class="main">=</span> <span class="skolem">k</span> <span class="main">*</span> <span class="bound">e</span> <span class="main">+</span> <span class="bound">e'</span> <span class="main">+</span> <span class="bound">m</span> <span class="main">∧</span> embP2 <span class="free">Q</span> <span class="main">(</span><span class="bound">ps'</span><span class="main">,</span> <span class="bound">e</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"part <span class="skolem">s'</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="main">0</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">"<span class="skolem">k</span> <span class="main">*</span> <span class="free">n</span> <span class="main">-</span> <span class="skolem">m</span>"</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fact</span><span class="main"><span class="keyword3">+</span></span>         
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">with</span></span> k <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>embP3 <span class="free">P</span> <span class="main">**</span> <span class="main">$</span><span class="free">n</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span>embP2 <span class="free">Q</span> <span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> hoare3o_valid_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>
  
  
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"validk <span class="free">P</span> <span class="free">c</span> <span class="free">Q</span> <span class="free">n</span> <span class="main">⟷</span> <span class="main">⊨<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>'</sub></span> <span class="main">{</span>embP3 <span class="free">P</span> <span class="main">**</span> <span class="main">$</span><span class="free">n</span><span class="main">}</span> <span class="free">c</span> <span class="main">{</span>embP2 <span class="free">Q</span> <span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> oneway <span class="keyword2"><span class="keyword">and</span></span> theother <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>



<span class="keyword2"><span class="keyword">end</span></span></pre>
</div><div id="Hoare_Time">
<div class="head">
<h1>Theory Hoare_Time</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Hoare_Time <span class="keyword2"><span class="keyword">imports</span></span>

  <span class="comment1">(* Interesting theories.
     In Isabelle/jEdit ctrl+click on them to browse them,
     Use green arrow at top bar to navigate back *)</span>

  <span class="comment1">(* Nielson System *)</span>
  <a href="Nielson_Hoare.html">Nielson_Hoare</a>         <span class="comment1">(* formalizes the Hoare logic *)</span>
  <a href="Nielson_VCG.html">Nielson_VCG</a>           <span class="comment1">(* the VCG for Nielson system *)</span>
  <a href="Nielson_VCGi.html">Nielson_VCGi</a>          <span class="comment1">(* the improved VCG for Nielson system *)</span>
  <a href="Nielson_VCGi_complete.html">Nielson_VCGi_complete</a> <span class="comment1">(* completeness of improved VCG*)</span>
  <a href="Nielson_Examples.html">Nielson_Examples</a>      <span class="comment1">(* some small examples *)</span>
  <a href="Nielson_Sqrt.html">Nielson_Sqrt</a>          <span class="comment1">(* Example proving logarithmic time bound for 
                            an Algorithm for Discrete Square Root by Binary Search *)</span>

  <span class="comment1">(* simple quantitative Hoare logic *)</span>
  <a href="Quant_Hoare.html">Quant_Hoare</a>           <span class="comment1">(* formalizes the simple quantitative Hoare logic *)</span>
  <a href="Quant_VCG.html">Quant_VCG</a>             <span class="comment1">(* the VCG for that system *)</span>
  <a href="Quant_Examples.html">Quant_Examples</a>        <span class="comment1">(* some examples *)</span>

  <span class="comment1">(* "bigO-style" quantitative Hoare logic *)</span>
  <a href="QuantK_Hoare.html">QuantK_Hoare</a>          <span class="comment1">(* formalizes the "big-O style" quantitative Hoare logic *)</span> 
  <a href="QuantK_VCG.html">QuantK_VCG</a>            <span class="comment1">(* the VCG for that system *)</span>
  <a href="QuantK_Examples.html">QuantK_Examples</a>       <span class="comment1">(* some examples *)</span>
  <a href="QuantK_Sqrt.html">QuantK_Sqrt</a>

  <span class="comment1">(* Separation Logic with Time Credits *)</span>
  <a href="SepLog_Hoare.html">SepLog_Hoare</a>          <span class="comment1">(* formalizes the Hoare logic based on Separation Logic and
                            Time Credits *)</span>
  <a href="SepLog_Examples.html">SepLog_Examples</a>        <span class="comment1">(* some examples *)</span>
  <a href="SepLogK_Hoare.html">SepLogK_Hoare</a>         <span class="comment1">(* big-O style Hoare logic using Separation Logic ... *)</span>
  <a href="SepLogK_VCG.html">SepLogK_VCG</a>           <span class="comment1">(* ... and its VCGen *)</span>

  <span class="comment1">(* Discussion *)</span>
  <a href="Discussion.html">Discussion</a>           <span class="comment1">(* Discussion and Reduction Proofs for exact style *)</span>
  <a href="DiscussionO.html">DiscussionO</a>            <span class="comment1">(* Discussion and Reduction Proofs for big-O style *)</span>

<span class="keyword2"><span class="keyword">begin</span></span> <span class="keyword2"><span class="keyword">end</span></span></pre>
</div>