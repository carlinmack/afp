<div id="ML_GraphViz">
<div class="head">
<h1>Theory ML_GraphViz</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ML_GraphViz
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="comment1">(*should we open a pdf viewer to display the generated graph?*)</span>
<span class="keyword1"><span class="keyword">datatype</span></span> <span class="entity">open_viewer</span> <span class="main">=</span> <span class="entity">DoNothing</span> <span class="main">|</span> <span class="entity">OpenImmediately</span> <span class="main">|</span> <span class="entity">AskTimeouted</span> <span class="keyword2"><span class="keyword">of</span></span> real

<span class="keyword1"><span class="keyword">signature</span></span> <span class="entity">GRAPHVIZ</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">sig</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> open_viewer<span class="main">:</span> <span class="entity">open_viewer</span> Unsynchronized.ref

  <span class="comment1">(*function to modify the printing of a node name*)</span>
  <span class="keyword1"><span class="keyword">val</span></span> default_tune_node_format<span class="main">:</span> term <span class="main">-&gt;</span> string <span class="main">-&gt;</span> string

  <span class="comment1">(* edges is a term of type ('a × 'a) list *)</span>
  
  <span class="comment1">(* @{context} default_tune_node_format (edges_format × edges)list*)</span>
  <span class="keyword1"><span class="keyword">val</span></span> visualize_graph<span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> <span class="main">(</span>term <span class="main">-&gt;</span> string <span class="main">-&gt;</span> string<span class="main">)</span> <span class="main">-&gt;</span> term <span class="main">-&gt;</span> unit

  <span class="comment1">(* @{context} default_tune_node_format (edges_format × edges)list graphviz_header*)</span>
  <span class="keyword1"><span class="keyword">val</span></span> visualize_graph_pretty<span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> <span class="main">(</span>term <span class="main">-&gt;</span> string <span class="main">-&gt;</span> string<span class="main">)</span> <span class="main">-&gt;</span> <span class="main">(</span>string * term<span class="main">)</span> list <span class="main">-&gt;</span> string<span class="main">-&gt;</span> unit

  <span class="comment1">(* helper function.
     @{context} tune_node_format node *)</span>
  <span class="keyword1"><span class="keyword">val</span></span> node_to_string<span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span> <span class="main">(</span>term <span class="main">-&gt;</span> string <span class="main">-&gt;</span> string<span class="main">)</span> <span class="main">-&gt;</span>  term <span class="main">-&gt;</span> string
  <span class="keyword1"><span class="keyword">val</span></span> term_to_string<span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span>  term <span class="main">-&gt;</span> string<span class="main">;</span>
  <span class="keyword1"><span class="keyword">val</span></span> term_to_string_safe<span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span>  term <span class="main">-&gt;</span> string<span class="main">;</span>
  <span class="keyword1"><span class="keyword">val</span></span> term_to_string_html<span class="main">:</span> <span class="entity">Proof.context</span> <span class="main">-&gt;</span>  term <span class="main">-&gt;</span> string<span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">structure</span></span> <span class="entity">Graphviz</span><span class="main">:</span> <span class="entity">GRAPHVIZ</span> <span class="main">=</span>
<span class="keyword2"><span class="keyword">struct</span></span>

<span class="comment1">(*if set to `DoNothing`, graphviz will not be run and not pdf will be opened. Include ML_GraphViz_Disable.thy to run in batch mode.*)</span>
<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">open_viewer</span> <span class="main">=</span> <span class="comment1">(* FIXME avoid mutable state *)</span>
  Unsynchronized.ref <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> getenv <span class="inner_quoted">"ISABELLE_DOT"</span> <span class="main">=</span> <span class="inner_quoted">""</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">DoNothing</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">OpenImmediately</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">default_tune_node_format</span><span class="main">:</span> term <span class="main">-&gt;</span> string <span class="main">-&gt;</span> string <span class="main">=</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> I<span class="main">)</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">evaluate_term</span> <span class="main">(</span><span class="entity">ctxt</span><span class="main">:</span> <span class="entity">Proof.context</span><span class="main">)</span> <span class="entity">edges</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">Code_Evaluation.dynamic_value</span> <span class="entity">ctxt</span> <span class="entity">edges</span> <span class="keyword2"><span class="keyword">of</span></span>
    SOME <span class="entity">x</span> <span class="main">=&gt;</span> <span class="entity">x</span>
  <span class="main">|</span> NONE <span class="main">=&gt;</span> error <span class="inner_quoted">"ML_GraphViz: failed to evaluate term"</span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">is_valid_char</span> <span class="entity">c</span> <span class="main">=</span>
  <span class="main">(</span><span class="entity">c</span> &lt;= <span class="inner_quoted">#"z"</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">c</span> &gt;= <span class="inner_quoted">#"a"</span><span class="main">)</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="main">(</span><span class="entity">c</span> &lt;= <span class="inner_quoted">#"Z"</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">c</span> &gt;= <span class="inner_quoted">#"A"</span><span class="main">)</span> <span class="keyword1"><span class="keyword">orelse</span></span>
  <span class="main">(</span><span class="entity">c</span> &lt;= <span class="inner_quoted">#"9"</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">c</span> &gt;= <span class="inner_quoted">#"0"</span><span class="main">)</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sanitize_string</span> <span class="main">=</span>
  String.map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">c</span> <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">is_valid_char</span> <span class="entity">c</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">c</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="inner_quoted">#"_"</span><span class="main">)</span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">term_to_string</span> <span class="entity">ctxt</span> <span class="entity">t</span> <span class="main">=</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ctxt'</span> <span class="main">=</span> Config.put show_markup false <span class="entity">ctxt</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span> Print_Mode.setmp <span class="main">[</span><span class="main">]</span> <span class="main">(</span>Syntax.string_of_term <span class="entity">ctxt'</span><span class="main">)</span> <span class="entity">t</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">term_to_string_safe</span> <span class="entity">ctxt</span> <span class="entity">t</span> <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">str</span> <span class="main">=</span> <span class="entity">term_to_string</span> <span class="entity">ctxt</span> <span class="entity">t</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">sanitize_string</span> <span class="entity">str</span> &lt;&gt; <span class="entity">str</span>
    <span class="keyword2"><span class="keyword">then</span></span> <span class="main">(</span>warning <span class="main">(</span><span class="inner_quoted">"String  "</span>^<span class="entity">str</span>^<span class="inner_quoted">" contains invalid characters!"</span><span class="main">)</span><span class="main">;</span> <span class="entity">sanitize_string</span> <span class="entity">str</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">str</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">sanitize_string_html</span> <span class="main">=</span>
    String.map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">c</span> <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span><span class="entity">is_valid_char</span> <span class="entity">c</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">c</span> <span class="main">=</span> <span class="inner_quoted">#" "</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="main">(</span><span class="entity">c</span> &lt;= <span class="inner_quoted">#"/"</span> <span class="keyword1"><span class="keyword">andalso</span></span> <span class="entity">c</span> &gt;= <span class="inner_quoted">#"("</span><span class="main">)</span>
                            <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">c</span> <span class="main">=</span> <span class="inner_quoted">#"|"</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">c</span> <span class="main">=</span> <span class="inner_quoted">#"="</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">c</span> <span class="main">=</span> <span class="inner_quoted">#"?"</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">c</span> <span class="main">=</span> <span class="inner_quoted">#"!"</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">c</span> <span class="main">=</span> <span class="inner_quoted">#"_"</span>
                            <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">c</span> <span class="main">=</span> <span class="inner_quoted">#"["</span> <span class="keyword1"><span class="keyword">orelse</span></span> <span class="entity">c</span> <span class="main">=</span> <span class="inner_quoted">#"]"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">c</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="inner_quoted">#"_"</span><span class="main">)</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">term_to_string_html</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">n</span><span class="main">:</span> term<span class="main">)</span> <span class="main">:</span> string <span class="main">=</span> 
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">str</span> <span class="main">=</span> <span class="entity">term_to_string</span> <span class="entity">ctxt</span> <span class="entity">n</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">sanitize_string_html</span> <span class="entity">str</span> &lt;&gt; <span class="entity">str</span>
      <span class="keyword2"><span class="keyword">then</span></span> <span class="main">(</span>warning <span class="main">(</span><span class="inner_quoted">"String  "</span>^<span class="entity">str</span>^<span class="inner_quoted">" contains invalid characters!"</span><span class="main">)</span><span class="main">;</span> <span class="entity">sanitize_string_html</span> <span class="entity">str</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">str</span> <span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">node_to_string</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">tune_node_format</span><span class="main">:</span> term <span class="main">-&gt;</span> string <span class="main">-&gt;</span> string<span class="main">)</span> <span class="main">(</span><span class="entity">n</span><span class="main">:</span> term<span class="main">)</span> <span class="main">:</span> string <span class="main">=</span> 
  <span class="entity">n</span> |&gt; <span class="entity">term_to_string</span> <span class="entity">ctxt</span> |&gt; <span class="entity">tune_node_format</span> <span class="entity">n</span>
  <span class="keyword3"><span class="keyword">handle</span></span> Subscript <span class="main">=&gt;</span>
    error <span class="main">(</span><span class="inner_quoted">"Subscript Exception in node_to_string for string "</span> ^
           <span class="main">(</span>Pretty.string_of <span class="main">(</span>Syntax.pretty_term <span class="entity">ctxt</span> <span class="entity">n</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">display_graph</span> <span class="entity">graph</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">if</span></span> getenv <span class="inner_quoted">"ISABELLE_DOT"</span> <span class="main">=</span> <span class="inner_quoted">""</span> <span class="keyword2"><span class="keyword">then</span></span>
      error <span class="inner_quoted">"Missing $ISABELLE_DOT settings variable (Graphviz \"dot\" executable)"</span>
    <span class="keyword2"><span class="keyword">else</span></span>
      <span class="entity">Isabelle_System.with_tmp_file</span> <span class="inner_quoted">"graphviz"</span> <span class="inner_quoted">"dot"</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">graph_file</span> <span class="main">=&gt;</span>
        <span class="keyword2"><span class="keyword">let</span></span>
          <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> File.write <span class="entity">graph_file</span> <span class="entity">graph</span><span class="main">;</span>
          <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">pdf_file</span> <span class="main">=</span> Path.explode <span class="inner_quoted">"$ISABELLE_HOME_USER/graphviz.pdf"</span><span class="main">;</span>
          <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span>
            <span class="main">(</span><span class="entity">Isabelle_System.bash</span> o cat_lines<span class="main">)</span>
             <span class="main">[</span><span class="inner_quoted">"set -e"</span><span class="main">,</span>
              <span class="inner_quoted">"cd "</span> ^ File.bash_path <span class="main">(</span>Path.dir <span class="entity">graph_file</span><span class="main">)</span><span class="main">,</span>
              <span class="inner_quoted">"\"$ISABELLE_DOT\" -o "</span> ^ Bash.string <span class="main">(</span>File.platform_path <span class="entity">pdf_file</span><span class="main">)</span> ^
                <span class="inner_quoted">" -Tpdf "</span> ^ Bash.string <span class="main">(</span>File.platform_path <span class="entity">graph_file</span><span class="main">)</span><span class="main">,</span>
              <span class="inner_quoted">"\"$PDF_VIEWER\" "</span> ^ File.bash_path <span class="entity">pdf_file</span> ^ <span class="inner_quoted">" &amp;"</span><span class="main">]</span><span class="main">;</span>
        <span class="keyword2"><span class="keyword">in</span></span> <span class="main">(</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">format_dot_edges</span> <span class="entity">ctxt</span> <span class="entity">tune_node_format</span> <span class="entity">trm</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">format_node</span> <span class="entity">t</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">str</span> <span class="main">=</span> <span class="entity">node_to_string</span> <span class="entity">ctxt</span> <span class="entity">tune_node_format</span> <span class="entity">t</span> <span class="keyword2"><span class="keyword">in</span></span>
                              <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">sanitize_string</span> <span class="entity">str</span> &lt;&gt; <span class="entity">str</span> <span class="keyword2"><span class="keyword">then</span></span>
                                <span class="main">(</span>warning <span class="main">(</span><span class="inner_quoted">"Node "</span>^<span class="entity">str</span>^<span class="inner_quoted">" contains invalid characters!"</span><span class="main">)</span><span class="main">;</span> <span class="entity">sanitize_string</span> <span class="entity">str</span><span class="main">)</span>
                              <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">str</span>
                            <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">format_dot_edge</span> <span class="main">(</span><span class="entity">t1</span><span class="main">,</span> <span class="entity">t2</span><span class="main">)</span> <span class="main">=</span> <span class="entity">format_node</span> <span class="entity">t1</span> ^ <span class="inner_quoted">" -&gt; "</span> ^ <span class="entity">format_node</span> <span class="entity">t2</span> ^ <span class="inner_quoted">";\n"</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      map <span class="entity">format_dot_edge</span> <span class="entity">trm</span>
    <span class="keyword2"><span class="keyword">end</span></span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">apply_dot_header</span> <span class="entity">header</span> <span class="entity">edges</span> <span class="main">=</span>
    <span class="inner_quoted">"digraph graphname {\n#header\n"</span> ^ <span class="entity">header</span> ^<span class="inner_quoted">"\n#edges\n\n"</span>^ implode <span class="entity">edges</span> ^ <span class="inner_quoted">"}"</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">visualize_graph_pretty</span> <span class="entity">ctxt</span> <span class="entity">tune_node_format</span> <span class="entity">Es</span> <span class="main">(</span><span class="entity">header</span><span class="main">:</span> string<span class="main">)</span> <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span> 
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">evaluated_edges</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">str</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">str</span><span class="main">,</span> <span class="entity">evaluate_term</span> <span class="entity">ctxt</span> <span class="entity">t</span><span class="main">)</span><span class="main">)</span> <span class="entity">Es</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">edge_to_string</span> <span class="main">=</span> <span class="entity">HOLogic.dest_list</span> #&gt; map <span class="entity">HOLogic.dest_prod</span> #&gt; <span class="entity">format_dot_edges</span> <span class="entity">ctxt</span> <span class="entity">tune_node_format</span> #&gt; implode<span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">formatted_edges</span> <span class="main">=</span> map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">str</span><span class="main">,</span> <span class="entity">t</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="entity">str</span> ^ <span class="inner_quoted">"\n"</span> ^ <span class="entity">edge_to_string</span> <span class="entity">t</span><span class="main">)</span> <span class="entity">evaluated_edges</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">execute_command</span> <span class="main">(</span><span class="main">)</span> <span class="main">=</span> <span class="entity">display_graph</span> <span class="main">(</span><span class="entity">apply_dot_header</span> <span class="entity">header</span> <span class="entity">formatted_edges</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      <span class="keyword2"><span class="keyword">case</span></span> !<span class="entity">open_viewer</span> <span class="keyword2"><span class="keyword">of</span></span>
          <span class="entity">DoNothing</span> <span class="main">=&gt;</span> writeln <span class="inner_quoted">"visualization disabled (Graphviz.open_viewer)"</span>
        <span class="main">|</span> <span class="entity">OpenImmediately</span> <span class="main">=&gt;</span> <span class="entity">execute_command</span> <span class="main">(</span><span class="main">)</span>
        <span class="main">|</span> <span class="entity">AskTimeouted</span> <span class="entity">wait_seconds</span> <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">text</span><span class="main">,</span> <span class="entity">promise</span><span class="main">)</span> <span class="main">=</span> Active.dialog_text <span class="main">(</span><span class="main">)</span><span class="main">;</span>
            <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> writeln <span class="main">(</span><span class="inner_quoted">"Run Grpahviz and display pdf? "</span> ^ <span class="entity">text</span> <span class="inner_quoted">"yes"</span> ^ <span class="inner_quoted">"/"</span> ^ <span class="entity">text</span> <span class="inner_quoted">"no"</span> ^ <span class="inner_quoted">" (execution paused)"</span><span class="main">)</span>
            <span class="keyword2"><span class="keyword">in</span></span>
              Timeout.apply <span class="main">(</span>seconds <span class="entity">wait_seconds</span><span class="main">)</span> <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> 
                <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">m</span> <span class="main">=</span> <span class="main">(</span>Future.join <span class="entity">promise</span><span class="main">)</span> <span class="keyword2"><span class="keyword">in</span></span>
                <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">m</span> <span class="main">=</span> <span class="inner_quoted">"yes"</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="entity">execute_command</span> <span class="main">(</span><span class="main">)</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span>writeln <span class="inner_quoted">"no"</span><span class="main">)</span><span class="main">)</span>
                <span class="keyword2"><span class="keyword">end</span></span>
              <span class="main">)</span> <span class="main">(</span><span class="main">)</span>
             <span class="keyword2"><span class="keyword">end</span></span> <span class="keyword3"><span class="keyword">handle</span></span> Timeout.TIMEOUT <span class="main">_</span> <span class="main">=&gt;</span>
                  <span class="main">(</span>writeln <span class="main">(</span><span class="inner_quoted">"Timeouted. You did not klick yes/no. Killed to continue. "</span> ^
                            <span class="inner_quoted">"If you want to see the pdf, just re-run this and klick yes."</span><span class="main">)</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">end</span></span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">visualize_graph</span> <span class="entity">ctxt</span> <span class="entity">tune_node_format</span> <span class="entity">edges</span> <span class="main">=</span>
  <span class="entity">visualize_graph_pretty</span> <span class="entity">ctxt</span> <span class="entity">tune_node_format</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">""</span><span class="main">,</span> <span class="entity">edges</span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">"#TODO add header here"</span>

<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
›</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="ML_GraphViz_Disable">
<div class="head">
<h1>Theory ML_GraphViz_Disable</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> ML_GraphViz_Disable
<span class="keyword2"><span class="keyword">imports</span></span> <a href="ML_GraphViz.html">ML_GraphViz</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">Graphviz.open_viewer</span> := <span class="entity">DoNothing</span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FiniteGraph">
<div class="head">
<h1>Theory FiniteGraph</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> FiniteGraph
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> 
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*Lots of this theory is based on a work by Benedikt Nordhoff and Peter Lammich*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Specification of a finite directed graph›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A graph <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>G=(V,E)›</span></span></span></span> consits of a set of vertices <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>V›</span></span></span></span>, also called nodes, 
       and a set of edges <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>E›</span></span></span></span>. The edges are tuples of vertices. Both, 
       the set of vertices and edges is finite.›</span></span>

<span class="comment1">(* Inspired by
Title: Dijkstra's Shortest Path Algorithm
Author: Benedikt Nordhoff and Peter Lammich
http://isa-afp.org/entries/Dijkstra_Shortest_Path.shtml
*)</span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Graph›</span></span>
<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Definitions›</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A graph is represented by a record.›</span></span>
  <span class="keyword1"><span class="command">record</span></span> <span class="tfree">'v</span> graph <span class="main">=</span>
    nodes <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
    edges <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span><span class="tfree">'v</span><span class="main">)</span> set"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In a well-formed graph, edges only go from nodes to nodes.›</span></span>
  <span class="keyword1"><span class="command">locale</span></span> wf_graph <span class="main">=</span> 
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph"</span></span>
    <span class="comment1">― ‹Edges only reference to existing nodes›</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> E_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>"</span></span>
                     <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> finiteE<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span> <span class="comment1">(*implied by finiteV*)</span>
    <span class="keyword2"><span class="keyword">and</span></span> finiteV<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">V</span> <span class="main">≡</span> <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">abbreviation</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">≡</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span>

    <span class="keyword1" id="FiniteGraph-E_wfD"><span class="command">lemma</span></span> E_wfD<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> E"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> V"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> V"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E_wf<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E_wf<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword1" id="FiniteGraph-E_wfD2"><span class="command">lemma</span></span> E_wfD2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> E<span class="main">.</span> fst <span class="bound">e</span> <span class="main">∈</span> V <span class="main">∧</span> snd <span class="bound">e</span> <span class="main">∈</span> V"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> E_wfD<span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Basic operations on Graphs›</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The empty graph.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">empty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">empty</span> <span class="main">≡</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="main">{}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Adds a node to a graph.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_node</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">add_node</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="main">(</span><span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">,</span> edges<span class="main">=</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Deletes a node from a graph. Also deletes all adjacent edges.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">delete_node</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">delete_node</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">⦇</span> 
      nodes <span class="main">=</span> <span class="main">(</span>nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span><span class="main">,</span>   
      edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> <span class="bound">e2</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>
    <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Adds an edge to a graph.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_edge</span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">add_edge</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∪</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Deletes an edge from a graph.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">delete_edge</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">delete_edge</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>
      nodes <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> 
      edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span><span class="main">}</span>
    <span class="main">⦈</span>"</span></span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">delete_edges</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'v</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">delete_edges</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">es</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>
      nodes <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> 
      edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">}</span>
    <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">delete_edges_list</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'v</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">delete_edges_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span><span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">delete_edges_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">delete_edges_list</span> <span class="main">(</span>delete_edge <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">fully_connected</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">fully_connected</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> edges <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">×</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⦈</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Extended graph operations›</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Reflexive transitive successors of a node. Or: All reachable nodes for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v›</span></span></span></span> including <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v›</span></span></span></span>.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">succ_rtran</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">succ_rtran</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Transitive successors of a node. Or: All reachable nodes for <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v›</span></span></span></span>.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">succ_tran</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">succ_tran</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span>"</span></span>

  <span class="comment1">― ‹succ_tran is always finite›</span>
  <span class="keyword1" id="FiniteGraph-succ_tran_finite"><span class="command">lemma</span></span> succ_tran_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> finite <span class="main">(</span>succ_tran <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> wf_graph.finiteE<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> finite_trancl<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"edges <span class="free">G</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>snd <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_imageI<span class="main">)</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∧</span> <span class="bound">e1</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∧</span> <span class="bound">e1</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span> <span class="main">⊆</span> snd <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">∧</span> <span class="bound">e1</span> <span class="main">=</span> <span class="free">v</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span> <span class="main">⊆</span> snd <span class="main">`</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this finite <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">{</span><span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_subset<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>succ_tran <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> succ_tran_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If there is no edge leaving from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v›</span></span></span></span>, then <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v›</span></span></span></span> has no successors›</span></span>
  <span class="keyword1" id="FiniteGraph-succ_tran_empty"><span class="command">lemma</span></span> succ_tran_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span><span class="main">;</span> <span class="free">v</span> <span class="main">∉</span> <span class="main">(</span>fst <span class="main">`</span> edges <span class="free">G</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> succ_tran <span class="free">G</span> <span class="free">v</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> succ_tran_def <span class="keyword1"><span class="command">using</span></span> image_iff tranclD <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> succ_tran<span class="antiquote"><span class="antiquote">}</span></span></span></span> is subset of nodes›</span></span>
  <span class="keyword1" id="FiniteGraph-succ_tran_subseteq_nodes"><span class="command">lemma</span></span> succ_tran_subseteq_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> succ_tran <span class="free">G</span> <span class="free">v</span> <span class="main">⊆</span> nodes <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> succ_tran_def <span class="keyword1"><span class="command">using</span></span> tranclD2 wf_graph.E_wfD<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The number of reachable nodes from <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>v›</span></span></span></span>›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">num_reachable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">num_reachable</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> card <span class="main">(</span>succ_tran <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">num_reachable_norefl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">num_reachable_norefl</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> card <span class="main">(</span>succ_tran <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> card<span class="antiquote"><span class="antiquote">}</span></span></span></span> returns <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">0</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for infinite sets.
        Here, for a well-formed graph, if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> num_reachable<span class="antiquote"><span class="antiquote">}</span></span></span></span> is zero, there are actually no nodes reachable.›</span></span>
  <span class="keyword1" id="FiniteGraph-num_reachable_zero"><span class="command">lemma</span></span> num_reachable_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_graph <span class="free">G</span><span class="main">;</span> num_reachable <span class="free">G</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span><span class="main">⟧</span> <span class="main">⟹</span> succ_tran <span class="free">G</span> <span class="free">v</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> num_reachable_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>succ_tran <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> succ_tran_finite<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1" id="FiniteGraph-num_succtran_zero"><span class="command">lemma</span></span> num_succtran_zero<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>succ_tran <span class="free">G</span> <span class="free">v</span> <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> num_reachable <span class="free">G</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> num_reachable_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1" id="FiniteGraph-num_reachable_zero_iff"><span class="command">lemma</span></span> num_reachable_zero_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>wf_graph <span class="free">G</span><span class="main">⟧</span> <span class="main">⟹</span> <span class="main">(</span>num_reachable <span class="free">G</span> <span class="free">v</span> <span class="main">=</span> <span class="main">0</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span>succ_tran <span class="free">G</span> <span class="free">v</span> <span class="main">=</span> <span class="main">{}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> num_succtran_zero num_reachable_zero<span class="main">)</span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Undirected Graph›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹undirected graph simulation›</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Create undirected graph from directed graph by adding backward links›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">backflows</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">backflows</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">}</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">undirected</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> graph"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">undirected</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span><span class="bound">a</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">}</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Graph Lemmas›</span></span>

  <span class="keyword1" id="FiniteGraph-graph_eq_intro"><span class="command">lemma</span></span> graph_eq_intro<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nodes <span class="main">(</span><span class="free">G</span><span class="main">::</span><span class="tfree">'a</span> graph<span class="main">)</span> <span class="main">=</span> nodes <span class="free">G'</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span>edges <span class="free">G</span> <span class="main">=</span> edges <span class="free">G'</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">G</span> <span class="main">=</span> <span class="free">G'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="comment1">― ‹finite›</span>
  <span class="keyword1" id="FiniteGraph-wf_graph_finite_filterE"><span class="command">lemma</span></span> wf_graph_finite_filterE<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> finite <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph.finiteE split_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-wf_graph_finite_filterV"><span class="command">lemma</span></span> wf_graph_finite_filterV<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> finite <span class="main">{</span><span class="bound">n</span><span class="main">.</span> <span class="bound">n</span> <span class="main">∈</span> nodes <span class="free">G</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">n</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph.finiteV<span class="main">)</span>

  <span class="comment1">― ‹empty›</span>
  <span class="keyword1" id="FiniteGraph-empty_wf"><span class="command">lemma</span></span> empty_wf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph empty"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> empty_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span> <span class="operator">auto</span>
  <span class="keyword1" id="FiniteGraph-nodes_empty"><span class="command">lemma</span></span> nodes_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"nodes empty <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> empty_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1" id="FiniteGraph-edges_empty"><span class="command">lemma</span></span> edges_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"edges empty <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> empty_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="comment1">― ‹add node›</span>
  <span class="keyword1" id="FiniteGraph-add_node_wf"><span class="command">lemma</span></span> add_node_wf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">g</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>add_node <span class="free">v</span> <span class="free">g</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> add_node_def wf_graph_def <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="FiniteGraph-delete_node_wf"><span class="command">lemma</span></span> delete_node_wf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>delete_node <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_node_def wf_graph_def wf_graph_finite_filterE<span class="main">)</span>

  <span class="comment1">― ‹add edgde›</span>
  <span class="keyword1" id="FiniteGraph-add_edge_wf"><span class="command">lemma</span></span> add_edge_wf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_edge_def add_node_def wf_graph_def<span class="main">)</span>

  <span class="comment1">― ‹delete edge›</span>
  <span class="keyword1" id="FiniteGraph-delete_edge_wf"><span class="command">lemma</span></span> delete_edge_wf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>delete_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edge_def add_node_def wf_graph_def split_def<span class="main">)</span>
 
  <span class="comment1">― ‹delte edges›</span>
  <span class="keyword1" id="FiniteGraph-delete_edges_list_wf"><span class="command">lemma</span></span> delete_edges_list_wf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>delete_edges_list <span class="free">G</span> <span class="free">E</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">E</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-delete_edges_wf"><span class="command">lemma</span></span> delete_edges_wf<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">E</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_def add_node_def wf_graph_def split_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-delete_edges_list_set"><span class="command">lemma</span></span> delete_edges_list_set<span class="main">:</span> <span class="quoted"><span class="quoted">"delete_edges_list <span class="free">G</span> <span class="free">E</span> <span class="main">=</span> delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="free">E</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">E</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">E</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">e</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edge_def delete_edges_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1" id="FiniteGraph-delete_edges_list_union"><span class="command">lemma</span></span> delete_edges_list_union<span class="main">:</span> <span class="quoted"><span class="quoted">"delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="free">ff</span> <span class="main">@</span> <span class="free">keeps</span><span class="main">)</span> <span class="main">=</span> delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="free">ff</span> <span class="main">∪</span> set <span class="free">keeps</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_list_set<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-add_edge_delete_edges_list"><span class="command">lemma</span></span> add_edge_delete_edges_list<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>add_edge <span class="main">(</span>fst <span class="free">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">a</span><span class="main">)</span> <span class="main">(</span>delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">ff</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>add_edge <span class="main">(</span>fst <span class="free">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="free">a</span><span class="main">)</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="free">ff</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_list_set delete_edges_def add_edge_def add_node_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-delete_edges_empty"><span class="command">lemma</span></span> delete_edges_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"delete_edges <span class="free">G</span> <span class="main">{}</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-delete_edges_simp2"><span class="command">lemma</span></span> delete_edges_simp2<span class="main">:</span> <span class="quoted"><span class="quoted">"delete_edges <span class="free">G</span> <span class="free">E</span> <span class="main">=</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="free">E</span><span class="main">⦈</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-delete_edges_set_nodes"><span class="command">lemma</span></span> delete_edges_set_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">E</span><span class="main">)</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-delete_edges_edges_mono"><span class="command">lemma</span></span> delete_edges_edges_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> edges <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">E</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">E'</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-delete_edges_edges_empty"><span class="command">lemma</span></span> delete_edges_edges_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span><span class="main">⦇</span>edges <span class="main">:=</span> <span class="main">{}</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>

 <span class="comment1">― ‹add delete›</span>
  <span class="keyword1" id="FiniteGraph-add_delete_edge"><span class="command">lemma</span></span> add_delete_edge<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">(</span><span class="free">G</span><span class="main">::</span><span class="tfree">'a</span> graph<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">⟹</span> add_edge <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>delete_edge <span class="free">a</span> <span class="free">b</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edge_def add_edge_def wf_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> graph_eq_intro<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteGraph-add_delete_edges"><span class="command">lemma</span></span> add_delete_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">(</span><span class="free">G</span><span class="main">::</span><span class="tfree">'v</span> graph<span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="free">a</span><span class="main">,</span><span class="free">b</span><span class="main">)</span> <span class="main">∉</span> <span class="free">fs</span> <span class="main">⟹</span>
    add_edge <span class="free">a</span> <span class="free">b</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>insert <span class="main">(</span><span class="free">a</span><span class="main">,</span> <span class="free">b</span><span class="main">)</span> <span class="free">fs</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">fs</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 add_edge_def wf_graph_def<span class="main">)</span>


 <span class="comment1">― ‹fully_connected›</span>
  <span class="keyword1" id="FiniteGraph-fully_connected_simp"><span class="command">lemma</span></span> fully_connected_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"fully_connected <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">ignore</span> <span class="main">⦈</span><span class="main">≡</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">N</span> <span class="main">×</span> <span class="free">N</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fully_connected_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-fully_connected_wf"><span class="command">lemma</span></span> fully_connected_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>fully_connected <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fully_connected_def wf_graph_def<span class="main">)</span>

 <span class="comment1">― ‹succ_tran›</span>
 <span class="keyword1" id="FiniteGraph-succ_tran_mono"><span class="command">lemma</span></span> succ_tran_mono<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">N</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E</span><span class="main">⦈</span> <span class="main">⟹</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> succ_tran <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">N</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E'</span><span class="main">⦈</span> <span class="free">v</span> <span class="main">⊆</span> succ_tran <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">N</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E</span><span class="main">⦈</span> <span class="free">v</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> wf_graph.finiteE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">E'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> rev_finite_subset<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> num_reachable_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> full_types<span class="main"><span class="main">)</span></span> Collect_mono trancl_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="comment1">― ‹num_reachable›</span>
  <span class="keyword1" id="FiniteGraph-num_reachable_mono"><span class="command">lemma</span></span> num_reachable_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">N</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E</span><span class="main">⦈</span> <span class="main">⟹</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> num_reachable <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">N</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E'</span><span class="main">⦈</span> <span class="free">v</span> <span class="main">≤</span> num_reachable <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">N</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E</span><span class="main">⦈</span> <span class="free">v</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> num_reachable_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> E'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">E'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> succ_tran_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> succ_tran_finite<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> card_mono<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="comment1">― ‹num_reachable_norefl›</span>
  <span class="keyword1" id="FiniteGraph-num_reachable_norefl_mono"><span class="command">lemma</span></span> num_reachable_norefl_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">N</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E</span><span class="main">⦈</span> <span class="main">⟹</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> num_reachable_norefl <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">N</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E'</span><span class="main">⦈</span> <span class="free">v</span> <span class="main">≤</span> num_reachable_norefl <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">N</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E</span><span class="main">⦈</span> <span class="free">v</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> num_reachable_norefl_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> E'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">E'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> succ_tran_mono<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> succ_tran_finite<span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> card_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_mono finite_Diff subset_refl<span class="main">)</span>

  <span class="comment1">― ‹backflows›</span>
  <span class="keyword1" id="FiniteGraph-backflows_wf"><span class="command">lemma</span></span> backflows_wf<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">N</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E</span><span class="main">⦈</span> <span class="main">⟹</span> wf_graph <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">N</span><span class="main">,</span> edges<span class="main">=</span>backflows <span class="free">E</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_Collect<span class="main">]</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def backflows_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-undirected_backflows"><span class="command">lemma</span></span> undirected_backflows<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"undirected <span class="free">G</span> <span class="main">=</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def undirected_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-backflows_id"><span class="command">lemma</span></span> backflows_id<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"backflows <span class="main">(</span>backflows <span class="free">E</span><span class="main">)</span> <span class="main">=</span> <span class="free">E</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-backflows_finite"><span class="command">lemma</span></span> backflows_finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">E</span> <span class="main">⟹</span> finite <span class="main">(</span>backflows <span class="free">E</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_Collect<span class="main">]</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span> 
  <span class="keyword1" id="FiniteGraph-backflows_minus_backflows"><span class="command">lemma</span></span> backflows_minus_backflows<span class="main">:</span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> backflows <span class="free">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>backflows <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-backflows_subseteq"><span class="command">lemma</span></span> backflows_subseteq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span> <span class="main">⟷</span> backflows <span class="free">X</span> <span class="main">⊆</span> backflows <span class="free">Y</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-backflows_un"><span class="command">lemma</span></span> backflows_un<span class="main">:</span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span><span class="free">A</span> <span class="main">∪</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>backflows <span class="free">A</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>backflows <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-backflows_inter"><span class="command">lemma</span></span> backflows_inter<span class="main">:</span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span><span class="free">A</span> <span class="main">∩</span> <span class="free">B</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>backflows <span class="free">A</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>backflows <span class="free">B</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span>
  <span class="keyword1" id="FiniteGraph-backflows_alt_fstsnd"><span class="command">lemma</span></span> backflows_alt_fstsnd<span class="main">:</span> <span class="quoted"><span class="quoted">"backflows <span class="free">E</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="main">(</span>snd <span class="bound">e</span><span class="main">,</span> fst <span class="bound">e</span><span class="main">)</span><span class="main">)</span> <span class="main">`</span> <span class="free">E</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">force</span><span class="main">)</span>


<span class="keyword1"><span class="command">lemmas</span></span> graph_ops<span class="main">=</span>add_node_def delete_node_def add_edge_def delete_edge_def delete_edges_simp2


  <span class="comment1">― ‹wf_graph›</span>
  <span class="keyword1" id="FiniteGraph-wf_graph_remove_edges"><span class="command">lemma</span></span> wf_graph_remove_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">⟹</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E</span> <span class="main">-</span> <span class="free">X</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> delete_edges_simp2 delete_edges_wf select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1" id="FiniteGraph-wf_graph_remove_edges_union"><span class="command">lemma</span></span> wf_graph_remove_edges_union<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> <span class="free">E'</span> <span class="main">⦈</span> <span class="main">⟹</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>

  <span class="keyword1" id="FiniteGraph-wf_graph_union_edges"><span class="command">lemma</span></span> wf_graph_union_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E'</span><span class="main">⦈</span> <span class="main">⟧</span> <span class="main">⟹</span>
     wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges<span class="main">=</span><span class="free">E</span> <span class="main">∪</span> <span class="free">E'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>

  <span class="keyword1" id="FiniteGraph-wf_graph_add_subset_edges"><span class="command">lemma</span></span> wf_graph_add_subset_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟧</span> <span class="main">⟹</span>
     wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges<span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> <span class="free">E'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> rev_finite_subset<span class="main">)</span>


<span class="comment1">(*Inspired by 
Benedikt Nordhoff and Peter Lammich
Dijkstra's Shortest Path Algorithm
http://isa-afp.org/entries/Dijkstra_Shortest_Path.shtml*)</span>
<span class="comment1">(*more a literal copy of http://isa-afp.org/browser_info/current/AFP/Dijkstra_Shortest_Path/Graph.html*)</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Successors of a node.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">succ</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> set"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">succ</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="bound">v'</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="bound">v'</span><span class="main">)</span><span class="main">∈</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">}</span>"</span></span>


  <span class="keyword1" id="FiniteGraph-succ_finite"><span class="command">lemma</span></span> succ_finite<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> finite <span class="main">(</span>succ <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> succ_def
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> finite_subset<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"snd<span class="main"><span class="main"><span class="main">`</span></span></span>edges <span class="free"><span class="free"><span class="free">G</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

  <span class="keyword1" id="FiniteGraph-succ_empty"><span class="command">lemma</span></span> succ_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"succ empty <span class="free">v</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> empty_def succ_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_graph<span class="main">)</span> succ_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"succ <span class="free">G</span> <span class="free">v</span> <span class="main">⊆</span> V"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> succ_def <span class="keyword1"><span class="command">using</span></span> E_wf
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span><span class="main">)</span>


<span class="keyword2"><span class="keyword">end</span></span>

</pre>
</div><div id="FiniteListGraph">
<div class="head">
<h1>Theory FiniteListGraph</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> FiniteListGraph
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="FiniteGraph.html">FiniteGraph</a>
  <span class="quoted">"<a href="../Transitive-Closure/Transitive_Closure_List_Impl.html">Transitive-Closure.Transitive_Closure_List_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Specification of a finite graph, implemented by lists›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A graph <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>G=(V,E)›</span></span></span></span> consits of a list of vertices <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">V</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, also called nodes, 
       and a list of edges <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">E</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. The edges are tuples of vertices.
       Using lists instead of sets, code can be easily created.›</span></span>

  <span class="keyword1"><span class="command">record</span></span> <span class="tfree">'v</span> list_graph <span class="main">=</span>
    nodesL <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list"</span></span>
    edgesL <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span><span class="tfree">'v</span><span class="main">)</span> list"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Correspondence the FiniteGraph›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">list_graph_to_graph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">list_graph_to_graph</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">⦇</span> nodes <span class="main">=</span> set <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">,</span> edges <span class="main">=</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">⦈</span>"</span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_list_graph_axioms</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wf_list_graph_axioms</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⟷</span> fst<span class="main">`</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∧</span> snd<span class="main">`</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>


  <span class="keyword1" id="FiniteListGraph-wf_list_graph_iff_wf_graph"><span class="command">lemma</span></span> wf_list_graph_iff_wf_graph<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span> wf_list_graph_axioms <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_graph_to_graph_def wf_graph_def wf_list_graph_axioms_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We say a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'v</span></span> list_graph"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is valid if it fulfills the graph axioms and its lists are distinct›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_list_graph</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">)</span> list_graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
   <span class="quoted"><span class="quoted">"<span class="free">wf_list_graph</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span>distinct <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∧</span> distinct <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∧</span> wf_list_graph_axioms <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹FiniteListGraph operations›</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Adds a node to a graph.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_node</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">add_node</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∈</span> set <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="keyword1">then</span> nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">#</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">,</span> edgesL<span class="main">=</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Adds an edge to a graph.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">add_edge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">add_edge</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span>add_node <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>add_node <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="keyword1">then</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span><span class="main">#</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Deletes a node from a graph. Also deletes all adjacent edges.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">delete_node</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">delete_node</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">⦇</span> 
    nodesL <span class="main">=</span> remove1 <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">←</span> <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∧</span> <span class="bound">e2</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span>
    <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Deletes an edge from a graph.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">delete_edge</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">delete_edge</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">⦇</span>nodesL <span class="main">=</span> nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">∨</span> <span class="bound">e2</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">]</span> <span class="main">⦈</span>"</span></span>

  
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">delete_edges</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'v</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
    <span class="quoted"><span class="quoted">"<span class="free">delete_edges</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span><span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">delete_edges</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">delete_edges</span> <span class="main">(</span>delete_edge <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span>"</span></span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹extended graph operations›</span></span>
   <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Reflexive transitive successors of a node. Or: All reachable nodes for v including v.›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">succ_rtran</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">succ_rtran</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> rtrancl_list_impl <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span>"</span></span>

   <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Transitive successors of a node. Or: All reachable nodes for v.›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">succ_tran</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">succ_tran</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> trancl_list_impl <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">[</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span>"</span></span>
  
   <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The number of reachable nodes from v›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">num_reachable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">num_reachable</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> length <span class="main">(</span>succ_tran <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>


    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">num_reachable_norefl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> nat"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">num_reachable_norefl</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> length <span class="main">(</span><span class="main">[</span> <span class="bound">x</span> <span class="main">←</span> succ_tran <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">.</span> <span class="bound">x</span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">]</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹undirected graph simulation›</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Create undirected graph from directed graph by adding backward links›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">backlinks</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">backlinks</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">backlinks</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e2</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">e1</span></span></span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="free">backlinks</span> <span class="free"><span class="bound"><span class="entity">es</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">undirected</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> list_graph"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">undirected</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> edgesL <span class="main">=</span> remdups <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">@</span> backlinks <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Correctness lemmata›</span></span>

  <span class="comment1">― ‹add node›</span>
  <span class="keyword1" id="FiniteListGraph-add_node_wf"><span class="command">lemma</span></span> add_node_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> wf_list_graph <span class="main">(</span>add_node <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_list_graph_def wf_list_graph_axioms_def add_node_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-add_node_set_nodes"><span class="command">lemma</span></span> add_node_set_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>nodesL <span class="main">(</span>add_node <span class="free">v</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> add_node_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-add_node_set_edges"><span class="command">lemma</span></span> add_node_set_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>add_node <span class="free">v</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> add_node_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-add_node_correct"><span class="command">lemma</span></span> add_node_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"FiniteGraph.add_node <span class="free">v</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">=</span> list_graph_to_graph <span class="main">(</span>add_node <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FiniteGraph.add_node_def list_graph_to_graph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_node_set_edges add_node_set_nodes<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-add_node_wf2"><span class="command">lemma</span></span> add_node_wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>list_graph_to_graph <span class="main">(</span>add_node <span class="free">v</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_node_correct<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

  <span class="comment1">― ‹add edge›</span>
  <span class="keyword1" id="FiniteListGraph-add_edge_wf"><span class="command">lemma</span></span> add_edge_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> wf_list_graph <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_list_graph_def add_edge_def add_node_def wf_list_graph_axioms_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-add_edge_set_nodes"><span class="command">lemma</span></span> add_edge_set_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>nodesL <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> add_edge_def add_node_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-add_edge_set_edges"><span class="command">lemma</span></span> add_edge_set_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> add_edge_def add_node_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-add_edge_correct"><span class="command">lemma</span></span> add_edge_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"FiniteGraph.add_edge <span class="free">v</span> <span class="free">v'</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">=</span> list_graph_to_graph <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FiniteGraph.add_edge_def add_edge_def list_graph_to_graph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> add_node_set_nodes<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-add_edge_wf2"><span class="command">lemma</span></span> add_edge_wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>list_graph_to_graph <span class="main">(</span>add_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> add_edge_correct<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

  <span class="comment1">― ‹delete node›</span>
  <span class="keyword1" id="FiniteListGraph-delete_node_wf"><span class="command">lemma</span></span> delete_node_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> wf_list_graph <span class="main">(</span>delete_node <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_list_graph_def delete_node_def wf_list_graph_axioms_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-delete_node_set_edges"><span class="command">lemma</span></span> delete_node_set_edges<span class="main">:</span>
    <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>delete_node <span class="free">v</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">≠</span> <span class="free">v</span> <span class="main">∧</span> <span class="bound">b</span> <span class="main">≠</span> <span class="free">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_node_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-delete_node_correct"><span class="command">lemma</span></span> delete_node_correct<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"FiniteGraph.delete_node <span class="free">v</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">=</span> list_graph_to_graph <span class="main">(</span>delete_node <span class="free">v</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> FiniteGraph.delete_node_def delete_node_def list_graph_to_graph_def wf_list_graph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="comment1">― ‹delete edge›</span>
  <span class="keyword1" id="FiniteListGraph-delete_edge_set_nodes"><span class="command">lemma</span></span> delete_edge_set_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>nodesL <span class="main">(</span>delete_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_edge_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="FiniteListGraph-delete_edge_set_edges"><span class="command">lemma</span></span> delete_edge_set_edges<span class="main">:</span>
    <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>delete_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">≠</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_edge_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-delete_edge_set_edges2"><span class="command">lemma</span></span> delete_edge_set_edges2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>delete_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span>delete_edge_set_edges<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-delete_edge_wf"><span class="command">lemma</span></span> delete_edge_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> wf_list_graph <span class="main">(</span>delete_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_list_graph_def delete_edge_def wf_list_graph_axioms_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
  <span class="keyword1" id="FiniteListGraph-delete_edge_length"><span class="command">lemma</span></span> delete_edge_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>edgesL <span class="main">(</span>delete_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_edge_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="FiniteListGraph-delete_edge_commute"><span class="command">lemma</span></span> delete_edge_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"delete_edge <span class="free">a1</span> <span class="free">a2</span> <span class="main">(</span>delete_edge <span class="free">b1</span> <span class="free">b2</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> delete_edge <span class="free">b1</span> <span class="free">b2</span> <span class="main">(</span>delete_edge <span class="free">a1</span> <span class="free">a2</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> delete_edge_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span> <span class="operator">metis</span> <span class="comment1">(* auto doesn't seem to like filter_cong *)</span>

  <span class="keyword1" id="FiniteListGraph-delete_edge_correct"><span class="command">lemma</span></span> delete_edge_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"FiniteGraph.delete_edge <span class="free">v</span> <span class="free">v'</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">=</span> list_graph_to_graph <span class="main">(</span>delete_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FiniteGraph.delete_edge_def delete_edge_def list_graph_to_graph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-delete_edge_wf2"><span class="command">lemma</span></span> delete_edge_wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>list_graph_to_graph <span class="main">(</span>delete_edge <span class="free">v</span> <span class="free">v'</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> delete_edge_correct<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

  <span class="comment1">― ‹delete edges›</span>
  <span class="keyword1" id="FiniteListGraph-delete_edges_wf"><span class="command">lemma</span></span> delete_edges_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> wf_list_graph <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">E</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> delete_edge_wf<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-delete_edges_set_nodes"><span class="command">lemma</span></span> delete_edges_set_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>nodesL <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">E</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">E</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> delete_edge_set_nodes<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-delete_edges_nodes"><span class="command">lemma</span></span> delete_edges_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"nodesL <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">es</span><span class="main">)</span> <span class="main">=</span> nodesL <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> delete_edge_def<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-delete_edges_set_edges"><span class="command">lemma</span></span> delete_edges_set_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">E</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">-</span> set <span class="free">E</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">E</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> delete_edge_def delete_edge_set_nodes<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-delete_edges_set_edges2"><span class="command">lemma</span></span> delete_edges_set_edges2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">E</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span><span class="main">,</span><span class="bound">b</span><span class="main">)</span> <span class="main">∉</span> set <span class="free">E</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> delete_edges_set_edges<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-delete_edges_length"><span class="command">lemma</span></span> delete_edges_length<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>edgesL <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">≤</span> length <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">f</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">G</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">f</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">f</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">hypsubst</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> delete_edges.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> delete_edge_length le_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="FiniteListGraph-delete_edges_chain"><span class="command">lemma</span></span> delete_edges_chain<span class="main">:</span> <span class="quoted"><span class="quoted">"delete_edges <span class="free">G</span> <span class="main">(</span><span class="free">as</span> <span class="main">@</span> <span class="free">bs</span><span class="main">)</span> <span class="main">=</span> delete_edges <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">as</span><span class="main">)</span> <span class="free">bs</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">f</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">)</span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="FiniteListGraph-delete_edges_delete_edge_commute"><span class="command">lemma</span></span> delete_edges_delete_edge_commute<span class="main">:</span>
    <span class="quoted"><span class="quoted">"delete_edges <span class="main">(</span>delete_edge <span class="free">a1</span> <span class="free">a2</span> <span class="free">G</span><span class="main">)</span> <span class="free">as</span> <span class="main">=</span> delete_edge <span class="free">a1</span> <span class="free">a2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">as</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">a1</span></span> <span class="quoted"><span class="free">a2</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">f</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edge_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="FiniteListGraph-delete_edges_commute"><span class="command">lemma</span></span> delete_edges_commute<span class="main">:</span>
    <span class="quoted"><span class="quoted">"delete_edges <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">as</span><span class="main">)</span> <span class="free">bs</span> <span class="main">=</span> delete_edges <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">bs</span><span class="main">)</span> <span class="free">as</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">f</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_delete_edge_commute<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="FiniteListGraph-delete_edges_as_filter"><span class="command">lemma</span></span> delete_edges_as_filter<span class="main">:</span>
    <span class="quoted"><span class="quoted">"delete_edges <span class="free">G</span> <span class="free">l</span> <span class="main">=</span> <span class="main">⦇</span> nodesL <span class="main">=</span> nodesL <span class="free">G</span><span class="main">,</span>  edgesL <span class="main">=</span> <span class="main">[</span><span class="bound">x</span> <span class="main">←</span> edgesL <span class="free">G</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> set <span class="free">l</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">f</span> <span class="skolem">fs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">f</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_delete_edge_commute<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edge_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> full_types<span class="main"><span class="main">)</span></span> prod.exhaust case_prodI split_conv<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">declare</span></span> delete_edges.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword"><span class="quasi_keyword">del</span></span><span class="main">]</span> <span class="comment1">(*do not automatically expand definition*)</span>

  <span class="keyword1" id="FiniteListGraph-delete_edges_correct"><span class="command">lemma</span></span> delete_edges_correct<span class="main">:</span>
    <span class="quoted"><span class="quoted">"FiniteGraph.delete_edges <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>set <span class="free">E</span><span class="main">)</span> <span class="main">=</span> list_graph_to_graph <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_graph_to_graph_def FiniteGraph.delete_edges_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_as_filter <span class="main">)</span>
  
  <span class="keyword1" id="FiniteListGraph-delete_edges_wf2"><span class="command">lemma</span></span> delete_edges_wf2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wf_graph <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>list_graph_to_graph <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">E</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">subst</span> delete_edges_correct<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="operator">simp</span>

  <span class="comment1">― ‹helper about reflexive transitive closure impl›</span>
  <span class="keyword1" id="FiniteListGraph-distinct_relpow_impl"><span class="command">lemma</span></span> distinct_relpow_impl<span class="main">:</span>
    <span class="quoted"><span class="quoted">"distinct <span class="free">L</span> <span class="main">⟹</span> distinct <span class="free">new</span> <span class="main">⟹</span> distinct <span class="free">have</span> <span class="main">⟹</span> distinct <span class="main">(</span><span class="free">new</span><span class="main">@</span><span class="free">have</span><span class="main">)</span> <span class="main">⟹</span> 
     distinct <span class="main">(</span>relpow_impl <span class="main">(</span><span class="main">λ</span><span class="bound">as</span><span class="main">.</span> remdups <span class="main">(</span>map snd <span class="main">[</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">←</span><span class="free">L</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="bound">as</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">xs</span> <span class="bound">ys</span><span class="main">.</span> <span class="main">[</span><span class="bound">x</span><span class="main">←</span><span class="bound">xs</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> set <span class="bound">ys</span><span class="main">]</span> <span class="main">@</span> <span class="bound">ys</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="bound">x</span> <span class="bound">xs</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="bound">xs</span><span class="main">)</span> <span class="free">new</span> <span class="free">have</span> <span class="free">M</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">"<span class="free">new</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">have</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Suc
    <span class="keyword1"><span class="command">hence</span></span>
      <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="main">[</span><span class="bound">x</span><span class="main">←</span><span class="skolem">new</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> set <span class="skolem">have</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">have</span><span class="main">)</span>"</span></span>
      <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="main">[</span><span class="bound">n</span><span class="main">←</span>remdups <span class="main">(</span>map snd <span class="main">[</span><span class="main">(</span><span class="bound">a</span><span class="main">,</span> <span class="bound">b</span><span class="main">)</span><span class="main">←</span><span class="free">L</span> <span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="skolem">new</span><span class="main">]</span><span class="main">)</span> <span class="main">.</span> <span class="main">(</span><span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">new</span> <span class="main">⟶</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="skolem">have</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">n</span> <span class="main">∉</span> set <span class="skolem">have</span><span class="main">]</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span><span class="main">[</span><span class="bound">x</span><span class="main">←</span><span class="skolem">new</span> <span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> set <span class="skolem">have</span><span class="main">]</span> <span class="main">@</span> <span class="skolem">have</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">with</span></span> Suc <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-distinct_rtrancl_list_impl"><span class="command">lemma</span></span> distinct_rtrancl_list_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">L</span> <span class="main">⟹</span> distinct <span class="free">ls</span> <span class="main">⟹</span> distinct <span class="main">(</span>rtrancl_list_impl <span class="free">L</span> <span class="free">ls</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> rtrancl_list_impl_def rtrancl_impl_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>distinct_relpow_impl<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-distinct_trancl_list_impl"><span class="command">lemma</span></span> distinct_trancl_list_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">L</span> <span class="main">⟹</span> distinct <span class="free">ls</span> <span class="main">⟹</span> distinct <span class="main">(</span>trancl_list_impl <span class="free">L</span> <span class="free">ls</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> trancl_list_impl_def trancl_impl_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>distinct_relpow_impl<span class="main">)</span>

  <span class="comment1">― ‹succ rtran›</span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"succ_rtran <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="main">1</span>"</span></span>

  <span class="keyword1" id="FiniteListGraph-succ_rtran_correct"><span class="command">lemma</span></span> succ_rtran_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"FiniteGraph.succ_rtran <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> set <span class="main">(</span>succ_rtran <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FiniteGraph.succ_rtran_def succ_rtran_def list_graph_to_graph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtrancl_list_impl<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-distinct_succ_rtran"><span class="command">lemma</span></span> distinct_succ_rtran<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> distinct <span class="main">(</span>succ_rtran <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> succ_rtran_def wf_list_graph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> distinct_rtrancl_list_impl<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-succ_rtran_set"><span class="command">lemma</span></span> succ_rtran_set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>succ_rtran <span class="free">G</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>*</sup></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> succ_rtran_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rtrancl_list_impl<span class="main">)</span>

  <span class="comment1">― ‹succ tran›</span>
  <span class="keyword1" id="FiniteListGraph-distinct_succ_tran"><span class="command">lemma</span></span> distinct_succ_tran<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> distinct <span class="main">(</span>succ_tran <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> succ_tran_def wf_list_graph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> distinct_trancl_list_impl<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-succ_tran_set"><span class="command">lemma</span></span> succ_tran_set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>succ_tran <span class="free">G</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> succ_tran_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> trancl_list_impl<span class="main">)</span>

  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"succ_tran <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="main">1</span>"</span></span>

  <span class="keyword1" id="FiniteListGraph-succ_tran_correct"><span class="command">lemma</span></span> succ_tran_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"FiniteGraph.succ_tran <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> set <span class="main">(</span>succ_tran <span class="free">G</span> <span class="free">v</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FiniteGraph.succ_tran_def succ_tran_def list_graph_to_graph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>trancl_list_impl<span class="main">)</span>
  
  <span class="comment1">― ‹num_reachable›</span>
  <span class="keyword1" id="FiniteListGraph-num_reachable_correct"><span class="command">lemma</span></span> num_reachable_correct<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> FiniteGraph.num_reachable <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> num_reachable <span class="free">G</span> <span class="free">v</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> num_reachable_def FiniteGraph.num_reachable_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.distinct_card distinct_succ_tran succ_tran_correct<span class="main">)</span>

  <span class="comment1">― ‹num_reachable_norefl›</span>
  <span class="keyword1" id="FiniteListGraph-num_reachable_norefl_correct"><span class="command">lemma</span></span> num_reachable_norefl_correct<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> 
     FiniteGraph.num_reachable_norefl <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">v</span> <span class="main">=</span> num_reachable_norefl <span class="free">G</span> <span class="free">v</span>"</span></span>
 <span class="keyword1"><span class="command">unfolding</span></span> num_reachable_norefl_def FiniteGraph.num_reachable_norefl_def
 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> List.distinct_card distinct_filter distinct_succ_tran set_minus_filter_out succ_tran_correct<span class="main">)</span>

  <span class="comment1">― ‹backlinks, i.e. backflows in formal def›</span>
  <span class="keyword1" id="FiniteListGraph-backlinks_alt"><span class="command">lemma</span></span> backlinks_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"backlinks <span class="free">E</span> <span class="main">=</span> <span class="main">[</span><span class="main">(</span>snd <span class="bound">e</span><span class="main">,</span> fst <span class="bound">e</span><span class="main">)</span><span class="main">.</span> e <span class="main">←</span> <span class="free">E</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">E</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-backlinks_set"><span class="command">lemma</span></span> backlinks_set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>backlinks <span class="free">E</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">e2</span><span class="main">,</span> <span class="bound">e1</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">E</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">E</span></span><span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1" id="FiniteListGraph-undirected_nodes_set"><span class="command">lemma</span></span> undirected_nodes_set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>undirected <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">e2</span><span class="main">,</span> <span class="bound">e1</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> undirected_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_set<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-undirected_succ_tran_set"><span class="command">lemma</span></span> undirected_succ_tran_set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>succ_tran <span class="main">(</span>undirected <span class="free">G</span><span class="main">)</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>edgesL <span class="main">(</span>undirected <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> succ_tran_set<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-backlinks_in_nodes_G"><span class="command">lemma</span></span> backlinks_in_nodes_G<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> fst <span class="main">`</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span><span class="main">;</span> snd <span class="main">`</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    fst<span class="main">`</span> set <span class="main">(</span>edgesL <span class="main">(</span>undirected <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL <span class="main">(</span>undirected <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> snd<span class="main">`</span> set <span class="main">(</span>edgesL <span class="main">(</span>undirected <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL <span class="main">(</span>undirected <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> undirected_def
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> backlinks_set<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-backlinks_distinct"><span class="command">lemma</span></span> backlinks_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">E</span> <span class="main">⟹</span> distinct <span class="main">(</span>backlinks <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">E</span></span><span class="main">)</span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> backlinks_alt<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-backlinks_subset"><span class="command">lemma</span></span> backlinks_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>backlinks <span class="free">X</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>backlinks <span class="free">Y</span><span class="main">)</span> <span class="main">⟷</span> set <span class="free">X</span> <span class="main">⊆</span> set <span class="free">Y</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> backlinks_set<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-backlinks_correct"><span class="command">lemma</span></span> backlinks_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"FiniteGraph.backflows <span class="main">(</span>set <span class="free">E</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>backlinks <span class="free">E</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> backflows_def
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_set<span class="main">)</span>

  <span class="comment1">― ‹undirected›</span>
  <span class="keyword1" id="FiniteListGraph-undirected_wf"><span class="command">lemma</span></span> undirected_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> wf_list_graph <span class="main">(</span>undirected <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> wf_list_graph_def wf_list_graph_axioms_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>backlinks_in_nodes_G<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> undirected_def<span class="main">)</span>

  <span class="keyword1" id="FiniteListGraph-undirected_correct"><span class="command">lemma</span></span> undirected_correct<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"FiniteGraph.undirected <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">=</span> list_graph_to_graph <span class="main">(</span>undirected <span class="free">G</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> FiniteGraph.undirected_def undirected_def list_graph_to_graph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_set<span class="main">)</span>
      
<span class="keyword1"><span class="command">lemmas</span></span> wf_list_graph_wf <span class="main">=</span>
  add_node_wf
  add_edge_wf
  delete_node_wf
  delete_edge_wf
  delete_edges_wf
  undirected_wf

<span class="keyword1"><span class="command">lemmas</span></span> list_graph_correct <span class="main">=</span>
  add_node_correct
  add_edge_correct
  delete_node_correct
  delete_edge_correct
  delete_edges_correct
  succ_rtran_correct
  succ_tran_correct
  num_reachable_correct
  undirected_correct


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Util">
<div class="head">
<h1>Theory TopoS_Util</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Util
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1" id="TopoS_Util-finite_ne_subset_induct"><span class="command">lemma</span></span> finite_ne_subset_induct <span class="main">[</span><span class="operator">case_names</span> singleton insert<span class="main">,</span> <span class="operator">consumes</span> 2<span class="main">]</span><span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> <span class="free">A</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="free">P</span> <span class="main">{</span><span class="bound">x</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x</span> <span class="bound">F</span><span class="main">.</span> finite <span class="bound">F</span> <span class="main">⟹</span> <span class="bound">F</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∉</span> <span class="bound">F</span> <span class="main">⟹</span> <span class="free">P</span> <span class="bound">F</span>  <span class="main">⟹</span> <span class="free">P</span> <span class="main">(</span>insert <span class="bound">x</span> <span class="bound">F</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="free">F</span>"</span></span>
<span class="keyword1"><span class="command">using</span></span> assms
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">induct</span>
  <span class="keyword3"><span class="command">case</span></span> empty <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>insert <span class="skolem">x</span> <span class="skolem">F</span><span class="main">)</span> <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">cases</span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(*lemma from afp collections Misc*)</span>
<span class="keyword1" id="TopoS_Util-set_union_code"><span class="command">lemma</span></span> set_union_code<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="free">xs</span> <span class="main">∪</span> set <span class="free">ys</span> <span class="main">=</span> set <span class="main">(</span><span class="free">xs</span> <span class="main">@</span> <span class="free">ys</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Efficient_Distinct">
<div class="head">
<h1>Theory Efficient_Distinct</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Efficient_Distinct
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="../Automatic_Refinement/Misc.html">Automatic_Refinement.Misc</a> <span class="comment1">(*mergesort*)</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/List_Lexorder.html">HOL-Library.List_Lexorder</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Product_Lexorder.html">HOL-Library.Product_Lexorder</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Char_ord.html">HOL-Library.Char_ord</a>"</span>
  <a href="TopoS_Util.html">TopoS_Util</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹efficient distinct code›</span></span>

  <span class="keyword1" id="Efficient_Distinct-list_length_iff_distinct"><span class="command">lemma</span></span> list_length_iff_distinct<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span>set <span class="free">xs</span> <span class="main">=</span> set <span class="free">ys</span><span class="main">;</span> distinct <span class="free">ys</span><span class="main">⟧</span> <span class="main">⟹</span> distinct <span class="free">xs</span> <span class="main">⟷</span> length <span class="free">xs</span> <span class="main">=</span> length <span class="free">ys</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> distinct_card card_distinct<span class="main">)</span>

  <span class="keyword1" id="Efficient_Distinct-distinct_by_mergesort"><span class="command">lemma</span></span> distinct_by_mergesort<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>length <span class="main">(</span>mergesort_remdups <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span><span class="main">)</span> <span class="main">⟷</span> distinct <span class="free">xs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list_length_iff_distinct mergesort_remdups_correct<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">xs</span> <span class="main">=</span> <span class="main">(</span>length <span class="main">(</span>mergesort_remdups <span class="free">xs</span><span class="main">)</span> <span class="main">=</span> length <span class="free">xs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fact</span> distinct_by_mergesort<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹providing tail recursive versions of certain functions›</span></span>
  <span class="comment1">(*otherwise scala code generated with this code always produces a StackOverflowException for large inputs*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> List.map<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">map_tailrec</span> <span class="main">::</span>  <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'b</span> list <span class="main">⇒</span> <span class="tfree">'b</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">map_tailrec</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">accs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">accs</span></span></span>"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">map_tailrec</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">accs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free">map_tailrec</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="Efficient_Distinct-map_tailrec_is_listmap"><span class="command">lemma</span></span> map_tailrec_is_listmap<span class="main">:</span> <span class="quoted"><span class="quoted">"rev <span class="main">(</span>map_tailrec <span class="free">f</span> <span class="free">l</span> <span class="free">accs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rev <span class="free">accs</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>List.map <span class="free">f</span> <span class="free">l</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span> <span class="quoted"><span class="free">accs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> map_tailrec.induct<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">efficient_map</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'b</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">efficient_map</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">≡</span> rev <span class="main">(</span>map_tailrec <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">l</span></span></span> <span class="main">[]</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"List.map <span class="free">f</span> <span class="free">l</span> <span class="main">=</span> efficient_map <span class="free">f</span> <span class="free">l</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> efficient_map_def map_tailrec_is_listmap<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> merge<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

 <span class="comment1">(*inefficient version*)</span>
 <span class="keyword1"><span class="command">fun</span></span> <span class="entity">merge_tailrec_inefficient</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">merge_tailrec_inefficient</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">accs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>
      <span class="keyword1">then</span> <span class="free">merge_tailrec_inefficient</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">@</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free">merge_tailrec_inefficient</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">@</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">]</span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="free">merge_tailrec_inefficient</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">@</span><span class="main">[</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">merge_tailrec_inefficient</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">=</span> <span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">merge_tailrec_inefficient</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">accs</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">as</span></span></span>"</span></span>

  <span class="keyword1" id="Efficient_Distinct-merge_tailrec_inefficient_prepend"><span class="command">lemma</span></span> merge_tailrec_inefficient_prepend<span class="main">:</span>
  <span class="quoted"><span class="quoted">"merge_tailrec_inefficient <span class="free">as</span> <span class="free">bs</span> <span class="main">(</span><span class="free">a</span> <span class="main">#</span> <span class="free">accs</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span> <span class="main">#</span> merge_tailrec_inefficient <span class="free">as</span> <span class="free">bs</span> <span class="free">accs</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">accs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> merge_tailrec_inefficient.induct<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1" id="Efficient_Distinct-merge_as_tailrec_inefficient"><span class="command">lemma</span></span> merge_as_tailrec_inefficient<span class="main">:</span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="main">=</span> merge_tailrec_inefficient <span class="free">as</span> <span class="free">bs</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> merge.induct<span class="main">)</span>  <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> merge_tailrec_inefficient_prepend<span class="main">)</span>

 <span class="keyword1"><span class="command">fun</span></span> <span class="entity">merge_tailrec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">merge_tailrec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">accs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span>
      <span class="keyword1">then</span> <span class="free">merge_tailrec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> <span class="free">merge_tailrec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">)</span>
      <span class="keyword1">else</span> <span class="free">merge_tailrec</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">merge_tailrec</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">=</span> <span class="main">(</span>rev <span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">)</span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span>"</span></span>
  <span class="main">|</span> <span class="quoted"><span class="quoted">"<span class="free">merge_tailrec</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">accs</span></span></span> <span class="main">=</span> <span class="main">(</span>rev <span class="free"><span class="bound"><span class="entity">accs</span></span></span><span class="main">)</span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">as</span></span></span>"</span></span>

  <span class="keyword1" id="Efficient_Distinct-merge_tailrec_listappend"><span class="command">lemma</span></span> merge_tailrec_listappend<span class="main">:</span>
    <span class="quoted"><span class="quoted">"merge_tailrec <span class="free">as</span> <span class="free">bs</span> <span class="main">(</span><span class="free">accs1</span><span class="main">@</span><span class="free">accs2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rev <span class="free">accs2</span><span class="main">)</span><span class="main">@</span><span class="main">(</span>merge_tailrec <span class="free">as</span> <span class="free">bs</span> <span class="free">accs1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="quoted">"<span class="free">accs1</span><span class="main">@</span><span class="free">accs2</span>"</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">accs1</span></span> <span class="quoted"><span class="free">accs2</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> merge_tailrec.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">as</span> <span class="skolem">b</span> <span class="skolem">bs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> append_Cons merge_tailrec.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1" id="Efficient_Distinct-merge_tailrec_acc_append"><span class="command">lemma</span></span> merge_tailrec_acc_append<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"merge_tailrec <span class="free">as</span> <span class="free">bs</span> <span class="main">(</span><span class="free">accs</span><span class="main">@</span><span class="main">[</span><span class="free">a</span><span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="free">a</span><span class="main">#</span><span class="main">(</span>merge_tailrec <span class="free">as</span> <span class="free">bs</span> <span class="main">(</span><span class="free">accs</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">accs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> merge_tailrec.induct<span class="main">)</span> <span class="operator">auto</span>

  <span class="keyword1" id="Efficient_Distinct-merge_inefficient_as_efficient"><span class="command">lemma</span></span> merge_inefficient_as_efficient<span class="main">:</span>
    <span class="quoted"><span class="quoted">"merge_tailrec_inefficient <span class="free">as</span> <span class="free">bs</span> <span class="main">(</span>rev <span class="free">accs</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>merge_tailrec <span class="free">as</span> <span class="free">bs</span> <span class="free">accs</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">as</span></span> <span class="quoted"><span class="free">bs</span></span> <span class="quoted"><span class="free">accs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">accs</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> merge_tailrec_inefficient.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">a</span> <span class="skolem">as</span> <span class="skolem">b</span> <span class="skolem">bs</span><span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> linorder_cases<span class="main">)</span> <span class="main">(</span><span class="operator">metis</span> merge_tailrec.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> merge_tailrec_inefficient.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> rev.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command">qed</span></span> <span class="operator">auto</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"merge <span class="free">as</span> <span class="free">bs</span> <span class="main">=</span> merge_tailrec <span class="free">as</span> <span class="free">bs</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> merge_as_tailrec_inefficient<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> merge_inefficient_as_efficient<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> accs <span class="main"><span class="main"><span class="main">=</span></span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main"><span class="main">,</span></span> <span class="operator">unfolded</span> rev.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*import scala.annotation.tailrec*)</span>
  <span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">distinct</span></span> <span class="keyword2"><span class="keyword">checking</span></span> Scala


  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="main">(</span><span class="keyword1">CHR</span> <span class="inner_quoted">''A''</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="inner_quoted">''a''</span><span class="main">,</span> <span class="inner_quoted">''b''</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''a''</span><span class="main">,</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">]</span>"</span></span> 
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>map fst <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''a''</span><span class="main">,</span> <span class="inner_quoted">''b''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''a''</span><span class="main">,</span> <span class="inner_quoted">''c''</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="FiniteListGraph_Impl">
<div class="head">
<h1>Theory FiniteListGraph_Impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> FiniteListGraph_Impl
<span class="keyword2"><span class="keyword">imports</span></span> 
  <a href="FiniteListGraph.html">FiniteListGraph</a>
  <span class="comment1">(*"../../Collections/ICF/impl/RBTSetImpl" (*red black trees*)*)</span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/RBT_Impl.html">HOL-Library.RBT_Impl</a>"</span>
    <span class="quoted">"<a href="../../HOL/HOL-Library/RBT.html">HOL-Library.RBT</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Product_Lexorder.html">HOL-Library.Product_Lexorder</a>"</span>
  <span class="comment1">(*maybe import the following only at the end*)</span>
  <a href="Efficient_Distinct.html">Efficient_Distinct</a>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Nat.html">HOL-Library.Code_Target_Nat</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A graph's well-formed-ness can be tested with an executable function.›</span></span>  
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wf_list_graph_impl</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wf_list_graph_impl</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wf_list_graph_impl</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> <span class="free">wf_list_graph_impl</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span>"</span></span>


  <span class="keyword1" id="FiniteListGraph_Impl-wf_list_graph_impl_axioms_locale_props"><span class="command">lemma</span></span> wf_list_graph_impl_axioms_locale_props<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"wf_list_graph_impl <span class="free">V</span> <span class="free">E</span> <span class="main">⟷</span> fst<span class="main">`</span> set <span class="free">E</span> <span class="main">⊆</span> set <span class="free">V</span> <span class="main">∧</span> snd<span class="main">`</span> set <span class="free">E</span> <span class="main">⊆</span> set <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">E</span></span><span class="main">)</span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">rbt_fromlist</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span><span class="main">::</span>linorder<span class="main">,</span> unit<span class="main">)</span> RBT.rbt"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">rbt_fromlist</span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span> <span class="main">≡</span> RBT.bulkload <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="bound">l</span><span class="main">.</span> <span class="main">(</span><span class="bound">l</span><span class="main">,</span> <span class="main">()</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">ls</span></span></span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">rbt_contains</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">rbt</span></span></span> <span class="main">≡</span> RBT.lookup <span class="free"><span class="bound"><span class="entity">rbt</span></span></span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≠</span> None"</span></span>

<span class="keyword1" id="FiniteListGraph_Impl-rbt_contains"><span class="command">lemma</span></span> rbt_contains<span class="main">:</span> <span class="quoted"><span class="quoted">"rbt_contains <span class="free">a</span> <span class="main">(</span>rbt_fromlist <span class="free">V</span><span class="main">)</span> <span class="main">⟷</span> <span class="free">a</span> <span class="main">∈</span> set <span class="free">V</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rbt_contains_def rbt_fromlist_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">V</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>

  <span class="comment1">(*making the ∈ more efficient*)</span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">wf_list_graph_impl_rs</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>linorder<span class="main">,</span>unit<span class="main">)</span> RBT.rbt <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">wf_list_graph_impl_rs</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">[]</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">wf_list_graph_impl_rs</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>rbt_contains <span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> rbt_contains <span class="free"><span class="bound"><span class="entity">v2</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">∧</span> <span class="free">wf_list_graph_impl_rs</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span>"</span></span>

    
 <span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph_impl <span class="free">V</span> <span class="free">E</span> <span class="main">=</span> wf_list_graph_impl_rs <span class="main">(</span>rbt_fromlist <span class="free">V</span><span class="main">)</span> <span class="free">E</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">E</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> e Es<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">e</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> rbt_contains<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"FiniteListGraph.wf_list_graph_axioms <span class="free">G</span> <span class="main">=</span> wf_list_graph_impl <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span> <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FiniteListGraph.wf_list_graph_axioms_def wf_list_graph_impl_axioms_locale_props<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The list implementation matches the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"wf_graph"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> definition›</span></span>
  <span class="keyword1"><span class="command">theorem</span></span> wf_list_graph_iff_wf_graph<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"wf_graph <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span> wf_list_graph_axioms <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> list_graph_to_graph_def wf_graph_def wf_list_graph_axioms_def wf_list_graph_impl_axioms_locale_props<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">corollary</span></span> wf_list_graph_iff_wf_graph_simplified<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> set <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span><span class="main">,</span> edges <span class="main">=</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">⦈</span> <span class="main">⟷</span> wf_list_graph_axioms <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_list_graph_iff_wf_graph<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> list_graph_to_graph_def<span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


 
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Code examples.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_graph_example</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_graph_example</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">6</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"wf_list_graph wf_graph_example"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">wf_graph_impl_example</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">wf_graph_impl_example</span> <span class="main">≡</span> wf_list_graph wf_graph_example"</span></span>


  <span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">wf_list_graph</span></span> <span class="quoted"><span class="quoted">empty</span></span> <span class="quoted"><span class="quoted">add_node</span></span> <span class="quoted"><span class="quoted">delete_node</span></span> <span class="quoted"><span class="quoted">add_edge</span></span> <span class="quoted"><span class="quoted">delete_edge</span></span> <span class="keyword2"><span class="keyword">checking</span></span> Scala


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Vertices">
<div class="head">
<h1>Theory TopoS_Vertices</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Vertices
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> 
<span class="quoted">"<a href="../../HOL/HOL-Library/Char_ord.html">HOL-Library.Char_ord</a>"</span> <span class="comment1">(*order on char*)</span>
<span class="quoted">"<a href="../../HOL/HOL-Library/List_Lexorder.html">HOL-Library.List_Lexorder</a>"</span> <span class="comment1">(*order on strings*)</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹A type for vertices›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
This theory makes extensive use of graphs.
We define a typeclass <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vertex›</span></span></span></span> for the vertices we will use in our theory.
The vertices will correspond to network or policy entities.

Later, we will conduct some proves by providing counterexamples.
Therefore, we say that the type of a vertex has at least three pairwise distinct members.

For example, the types <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"string"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">nat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"bool <span class="main"><span class="main">×</span></span> bool"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and many other fulfill this assumption. 
The type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"bool"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> alone does not fulfill this assumption, because it only has two elements.

This is only a constraint over the type, of course, a policy with less than three entities can also be verified.

TL;DR: We define <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>vertex›</span></span></span></span>, which is as good as <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>


<span class="comment1">― ‹We need at least some vertices available for a graph ...›</span>
<span class="keyword1"><span class="command">class</span></span> vertex <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">vertex_1</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">vertex_2</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free"><span class="free"><span class="free">vertex_3</span></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> distinct_vertices<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">[</span><span class="free">vertex_1</span><span class="main">,</span> <span class="free">vertex_2</span><span class="main">,</span> <span class="free">vertex_3</span><span class="main">]</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1" id="TopoS_Vertices-distinct_vertices12"><span class="command">lemma</span></span> distinct_vertices12<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vertex_1 <span class="main">≠</span> vertex_2"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_vertices <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1" id="TopoS_Vertices-distinct_vertices13"><span class="command">lemma</span></span> distinct_vertices13<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vertex_1 <span class="main">≠</span> vertex_3"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_vertices <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1" id="TopoS_Vertices-distinct_vertices23"><span class="command">lemma</span></span> distinct_vertices23<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"vertex_2 <span class="main">≠</span> vertex_3"</span></span> <span class="keyword1"><span class="command">using</span></span> distinct_vertices <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  
  <span class="keyword1"><span class="command">lemmas</span></span> distinct_vertices_sym <span class="main">=</span> distinct_vertices12<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> distinct_vertices13<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
          distinct_vertices23<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span>
  <span class="keyword1"><span class="command">declare</span></span> distinct_vertices_sym<span class="main">[</span><span class="operator">simp</span><span class="main">]</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Numbers, chars and strings are good candidates for vertices.›</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> nat<span class="main">::</span><span class="quoted">vertex</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_1_nat</span></span>"</span> <span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_1 <span class="main">≡</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_2_nat</span></span>"</span> <span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_2 <span class="main">≡</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_3_nat</span></span>"</span> <span class="main">::</span><span class="quoted">nat</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_3 <span class="main">≡</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vertex_1_nat_def vertex_2_nat_def vertex_3_nat_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vertex_1<span class="main">::</span>nat"</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> int<span class="main">::</span><span class="quoted">vertex</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_1_int</span></span>"</span> <span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_1 <span class="main">≡</span> <span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_2_int</span></span>"</span> <span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_2 <span class="main">≡</span> <span class="main">(</span><span class="numeral">2</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_3_int</span></span>"</span> <span class="main">::</span><span class="quoted">int</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_3 <span class="main">≡</span> <span class="main">(</span><span class="numeral">3</span><span class="main">::</span>int<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vertex_1_int_def vertex_2_int_def vertex_3_int_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">instantiation</span></span> char<span class="main">::</span><span class="quoted">vertex</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_1_char</span></span>"</span> <span class="main">::</span><span class="quoted">char</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_1 <span class="main">≡</span> <span class="keyword1">CHR</span> <span class="inner_quoted">''A''</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_2_char</span></span>"</span> <span class="main">::</span><span class="quoted">char</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_2 <span class="main">≡</span> <span class="keyword1">CHR</span> <span class="inner_quoted">''B''</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_3_char</span></span>"</span> <span class="main">::</span><span class="quoted">char</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_3 <span class="main">≡</span> <span class="keyword1">CHR</span> <span class="inner_quoted">''C''</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span> <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vertex_1_char_def  vertex_2_char_def vertex_3_char_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"vertex_1<span class="main">::</span>char"</span></span>


<span class="keyword1"><span class="command">instantiation</span></span> list <span class="main">::</span> <span class="main">(</span><span class="quoted"><span class="quoted">"vertex"</span></span><span class="main">)</span> <span class="quoted">vertex</span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_1_list</span></span>"</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_1 <span class="main">≡</span> <span class="main">[]</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_2_list</span></span>"</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_2 <span class="main">≡</span> <span class="main">[</span>vertex_1<span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted">"<span class="entity"><span class="class_parameter">vertex_3_list</span></span>"</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"vertex_3 <span class="main">≡</span> <span class="main">[</span>vertex_1<span class="main">,</span> vertex_1<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">instance</span></span> <span class="keyword1"><span class="command">proof</span></span> <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> vertex_1_list_def vertex_2_list_def vertex_3_list_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">― ‹for the ML graphviz visualizer›</span>
<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">tune_string_vertex_format</span> <span class="main">(</span><span class="entity">t</span><span class="main">:</span> term<span class="main">)</span> <span class="main">(</span><span class="entity">s</span><span class="main">:</span> string<span class="main">)</span> <span class="main">:</span> string <span class="main">=</span> 
    <span class="keyword2"><span class="keyword">if</span></span> fastype_of <span class="entity">t</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">string</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span>
      <span class="keyword2"><span class="keyword">if</span></span> String.isPrefix <span class="inner_quoted">"''"</span> <span class="entity">s</span> <span class="keyword2"><span class="keyword">then</span></span>
        String.substring <span class="main">(</span><span class="entity">s</span><span class="main">,</span> <span class="main">(</span>size <span class="inner_quoted">"''"</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span>size <span class="entity">s</span> - <span class="main">(</span>size <span class="inner_quoted">"''''"</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> writeln <span class="main">(</span><span class="inner_quoted">"no tune_string_vertex_format for \""</span>^<span class="entity">s</span>^<span class="inner_quoted">"\""</span><span class="main">)</span> <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">s</span> <span class="keyword2"><span class="keyword">end</span></span>
    <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">s</span>
    <span class="keyword3"><span class="keyword">handle</span></span> Subscript <span class="main">=&gt;</span> <span class="keyword2"><span class="keyword">let</span></span> <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> writeln <span class="main">(</span><span class="inner_quoted">"tune_string_vertex_format Subscript excpetion"</span><span class="main">)</span> <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">s</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
›</span>


  
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Interface">
<div class="head">
<h1>Theory TopoS_Interface</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Interface
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="FiniteGraph.html">Lib/FiniteGraph</a>"</span> <a href="TopoS_Vertices.html">TopoS_Vertices</a> <span class="quoted">"<a href="TopoS_Util.html">Lib/TopoS_Util</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>



<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹Security Invariants›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    A good documentation of this formalization is available in \cite{diekmann2014forte}. 
›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    We define security invariants over a graph.
    The graph corresponds to the network's access control structure.
›</span></span>

  <span class="comment1">(*TODO: make datatype!*)</span>
  <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"<span class="tfree">'v</span>"</span><span class="antiquote">}</span></span> is the type of the nodes in the graph (hosts in the network). 
     <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"<span class="tfree">'a</span>"</span><span class="antiquote">}</span></span> is the type of the host attributes.›</span>
  <span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'v</span><span class="main">::</span><span class="quoted">vertex</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_Params <span class="main">=</span>
    node_properties <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span><span class="main">::</span>vertex <span class="main">⇒</span> <span class="tfree">'a</span> option"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
A Security Invariant is defined as locale.

We successively define more and more locales with more and more assumptions.
This clearly depicts which assumptions are necessary to use certain features of a Security Invariant.
In addition, it makes instance proofs of Security Invariants easier, since the lemmas obtained by an (easy, few assumptions) instance proof 
can be used for the complicated (more assumptions) instance proofs.

A security Invariant consists of one function: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sinvar›</span></span></span></span>.
Essentially, it is a predicate over the policy (depicted as graph <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>G›</span></span></span></span> and a host attribute mapping (<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>nP›</span></span></span></span>)).
›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A Security Invariant where the offending flows (flows that invalidate the policy) can be defined and calculated.
No assumptions are necessary for this step.
›</span></span>  
  <span class="keyword1"><span class="command">locale</span></span> SecurityInvariant_withOffendingFlows <span class="main">=</span> 
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">sinvar</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="comment1">― ‹policy <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"⇒"</span><span class="antiquote">}</span></span> host attribute mapping <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"⇒"</span><span class="antiquote">}</span></span> bool›</span>
   <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="comment1">― ‹Offending Flows definitions:›</span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_offending_flows</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">is_offending_flows</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">≡</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">∧</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span>"</span></span>
    
    <span class="comment1">― ‹Above definition is not minimal:›</span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">is_offending_flows_min_set</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set <span class="main">⇒</span> <span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">is_offending_flows_min_set</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">≡</span> is_offending_flows <span class="free"><span class="bound"><span class="entity">f</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">∧</span> 
        <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span><span class="main">)</span>"</span></span>

    <span class="comment1">― ‹The set of all offending flows.›</span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">set_offending_flows</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">set_offending_flows</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>  <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="main">(</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∧</span> is_offending_flows_min_set <span class="bound">F</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span><span class="main">}</span>"</span></span>
  

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Some of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> set_offending_flows<span class="antiquote"><span class="antiquote">}</span></span></span></span> definition›</span></span>
    <span class="keyword1" id="TopoS_Interface-offending_not_empty"><span class="command">lemma</span></span> offending_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">F</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_def is_offending_flows_min_set_def<span class="main">)</span>
    <span class="keyword1" id="TopoS_Interface-empty_offending_contra"><span class="command">lemma</span></span> empty_offending_contra<span class="main">:</span>
       <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">F</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span><span class="main">;</span> <span class="free">F</span> <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> False"</span></span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_def is_offending_flows_min_set_def<span class="main">)</span>
    <span class="keyword1" id="TopoS_Interface-offending_notevalD"><span class="command">lemma</span></span> offending_notevalD<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_def is_offending_flows_min_set_def<span class="main">)</span>
    <span class="keyword1" id="TopoS_Interface-sinvar_no_offending"><span class="command">lemma</span></span> sinvar_no_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_def is_offending_flows_min_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command">theorem</span></span> removing_offending_flows_makes_invariant_hold<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">F</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">case</span></span> True
        <span class="keyword1"><span class="command">hence</span></span> no_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sinvar_no_offending <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>set_offending_flows <span class="free">G</span> <span class="free">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">F</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> empty_iff <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>set_offending_flows <span class="free">G</span> <span class="free">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">F</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_def is_offending_flows_min_set_def graph_ops<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">corollary</span></span> valid_without_offending_flows<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="free">F</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">F</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> removing_offending_flows_makes_invariant_hold<span class="main">)</span>

  <span class="keyword1" id="TopoS_Interface-set_offending_flows_simp"><span class="command">lemma</span></span> set_offending_flows_simp<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span>
      set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">∧</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="bound">F</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="bound">F</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>edges <span class="free">G</span> <span class="main">-</span> <span class="bound">F</span><span class="main">)</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_min_set_def 
      is_offending_flows_def delete_edges_simp2 add_edge_def graph.select_convs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">F</span> <span class="main">⟹</span> nodes <span class="free">G</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">}</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fst_conv imageI in_mono insert_absorb snd_conv<span class="main">)</span>

   <span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">print_locale</span></span><span class="main">!</span> SecurityInvariant_withOffendingFlows


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The locale <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SecurityInvariant_withOffendingFlows›</span></span></span></span> has no assumptions about the security invariant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sinvar›</span></span></span></span>.
Undesirable things may happen:
The offending flows can be empty, even for a violated invariant.

We provide an example, the security invariant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">λ</span></span><span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span> <span class="main"><span class="bound"><span class="main"><span class="bound">_</span></span></span></span><span class="main"><span class="main">.</span></span> False<span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
As host attributes, we simply use the identity function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> id<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="main">{</span><span class="inner_quoted">''v1''</span><span class="main">}</span><span class="main">,</span> edges<span class="main">=</span><span class="main">{}</span> <span class="main">⦈</span> id <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">%</span>invisible <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def 
  SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span> 
  <span class="main">⦇</span> nodes <span class="main">=</span> <span class="main">{</span><span class="inner_quoted">''v1''</span><span class="main">,</span> <span class="inner_quoted">''v2''</span><span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''v1''</span><span class="main">,</span> <span class="inner_quoted">''v2''</span><span class="main">)</span><span class="main">}</span> <span class="main">⦈</span> id <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">%</span>invisible <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def 
  SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹In general, there exists a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">sinvar</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> such that the invariant does not hold and no offending flows exits.›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">sinvar</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">∧</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="bound">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
    SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> False<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Thus, we introduce usefulness properties that prohibits such useless invariants.›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We summarize them in an invariant.
It requires the following: 
\begin{enumerate}
  \item The offending flows are always defined.
  \item The invariant is monotonic, i.e. prohibiting more is more secure.
  \item And, the (non-minimal) offending flows are monotonic, i.e. prohibiting more solves more security issues.
\end{enumerate}

Later, we will show that is suffices to show that the invariant is monotonic. The other two properties can be derived.
›</span></span>

  <span class="keyword1"><span class="command">locale</span></span> SecurityInvariant_preliminaries <span class="main">=</span> SecurityInvariant_withOffendingFlows <span class="quoted"><span class="free">sinvar</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">sinvar</span>
    <span class="main">+</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> 
      defined_offending<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span><span class="main">;</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
      mono_sinvar<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">;</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span> 
        <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> mono_offending<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span><span class="main">;</span> is_offending_flows <span class="free">ff</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span> is_offending_flows <span class="main">(</span><span class="free">ff</span> <span class="main">∪</span> <span class="free">f'</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
  <span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹
    \begin{small}
    To instantiate a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SecurityInvariant_preliminaries<span class="antiquote"><span class="antiquote">}</span></span></span></span>, here are some hints: 
    Have a look at the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>TopoS_withOffendingFlows.thy›</span></span></span></span> file.
    There is a definition of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">sinvar_mono</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. It impplies <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">mono_sinvar</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">mono_offending</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
    <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>apply(fact SecurityInvariant_withOffendingFlows.sinvar_mono_imp_sinvar_mono[OF sinvar_mono])
    apply(fact SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono[OF sinvar_mono])›</span></span></span></span>
  
    In addition, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty[OF sinvar_mono]›</span></span></span></span> gives a nice proof rule for
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">defined_offending</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  
    Basically, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sinvar_mono.›</span></span></span></span> implies almost all assumptions here and is equal to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">prop</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">mono_sinvar</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
    \end{small}
›</span></span>
  <span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Security Invariants with secure auto-completion of host attribute mappings›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
We will now add a new artifact to the Security Invariant.
It is a secure default host attribute, we will use the symbol <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊥›</span></span></span></span>.

The newly introduced Boolean <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>receiver_violation›</span></span></span></span> tells whether a security violation happens at the sender's or the receiver's side.

The details can be looked up in \cite{diekmann2014forte}. 
›</span></span>

  <span class="comment1">― ‹Some notes about the notation:
          <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"fst <span class="main">`</span> <span class="free">F</span>"</span><span class="antiquote">}</span></span> means to apply the function <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> "fst"<span class="antiquote">}</span></span> to the set <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">F</span>"</span><span class="antiquote">}</span></span> element-wise.
          Example: If <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">F</span>"</span><span class="antiquote">}</span></span> is a set of directed edges, 
          <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span><span class="antiquote">}</span></span>, then <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"fst <span class="main">`</span> <span class="free">F</span>"</span><span class="antiquote">}</span></span>
          is the set of senders and <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"snd <span class="main">`</span> <span class="free">f</span>"</span><span class="antiquote">}</span></span> the set of receivers.›</span>

  <span class="keyword1"><span class="command">locale</span></span> SecurityInvariant <span class="main">=</span> SecurityInvariant_preliminaries <span class="quoted"><span class="free">sinvar</span></span>
    <span class="keyword2"><span class="keyword">for</span></span> <span class="free">sinvar</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
    <span class="main">+</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1">⊥</span></span></span>"</span><span class="main">)</span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> 
      <span class="comment1">― ‹default value can never fix a security violation.›</span>
      <span class="comment1">― ‹Idea: Assume there is a violation, then there is some offending flow. 
        <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">receiver_violation</span><span class="antiquote">}</span></span> defines whether the violation happens at the sender's or the receiver's side. 
        We call the place of the violation the \emph{offending host}. 
        We replace the host attribute of the offending host with the default attribute. 
        Giving an offending host, a \emph{secure} default attribute does not change whether the invariant holds.
        I.e.\ this reconfiguration does not remove information, thus preserves all security critical information.
        Thought experiment preliminaries: Can a default configuration ever solve an existing security violation? NO!
        Thought experiment 1: admin forgot to configure host, hence it is handled by default configuration value ...
        Thought experiment 2: new node (attacker) is added to the network. What is its default configuration value ...›</span>
      default_secure<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span><span class="main">;</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span><span class="main">;</span> <span class="free">F</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span>
        <span class="main">(</span><span class="main">¬</span> <span class="free">receiver_violation</span> <span class="main">⟶</span> <span class="free">i</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">F</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
        <span class="main">(</span><span class="free">receiver_violation</span> <span class="main">⟶</span> <span class="free">i</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="free">F</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>
      default_unique<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span> <span class="main">⟹</span> 
        <span class="main">∃</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> graph<span class="main">)</span> <span class="bound">nP</span> <span class="bound">i</span> <span class="bound">F</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">F</span> <span class="main">∈</span> set_offending_flows <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> 
         <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">F</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">∧</span>
         <span class="main">(</span><span class="main">¬</span> <span class="free">receiver_violation</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="bound">F</span> <span class="main">∧</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="free">receiver_violation</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="bound">F</span> <span class="main">∧</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> "</span></span>
   <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="comment1">― ‹Removes option type, replaces with default host attribute›</span>
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">node_props</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_Params <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">node_props_formaldef</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_Params <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">node_props_formaldef</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span>
    <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">i</span> <span class="main">∈</span> dom <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="keyword1">then</span> the <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">i</span><span class="main">)</span> <span class="keyword1">else</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1" id="TopoS_Interface-node_props_eq_node_props_formaldef"><span class="command">lemma</span></span> node_props_eq_node_props_formaldef<span class="main">:</span> <span class="quoted"><span class="quoted">"node_props_formaldef <span class="main">=</span> node_props"</span></span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff node_props_formaldef_def option.case_eq_if domIff<span class="main">)</span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
      Checking whether a security invariant holds.
      \begin{enumerate}
        \item check that the policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is syntactically valid
        \item check the security invariant <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">sinvar</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
      \end{enumerate}
›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">eval</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_Params <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> wf_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>node_props <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span>"</span></span>


    <span class="keyword1" id="TopoS_Interface-unique_common_math_notation"><span class="command">lemma</span></span> unique_common_math_notation<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span> <span class="bound">nP</span> <span class="bound">i</span> <span class="bound">F</span><span class="main">.</span> wf_graph <span class="main">(</span><span class="bound">G</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> graph<span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">F</span> <span class="main">∈</span> set_offending_flows <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> 
         <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">F</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">∧</span> 
         <span class="main">(</span><span class="main">¬</span> <span class="free">receiver_violation</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
         <span class="main">(</span><span class="free">receiver_violation</span> <span class="main">⟶</span> <span class="bound">i</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="bound">F</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">=</span> <span class="main"><span class="free">⊥</span></span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> default_unique<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">print_locale</span></span><span class="main">!</span> SecurityInvariant



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Information Flow Security and Access Control›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹

<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">receiver_violation</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> defines the offending host. Thus, it defines when the violation happens. 

We found that this coincides with the invariant's security strategy. 

\begin{description}
\item[ACS] If the violation happens at the sender, we have an access control strategy (\emph{ACS}). 
I.e.\ the sender does not have the appropriate rights to initiate the connection.

\item[IFS] If the violation happens at the receiver, we have an information flow security strategy (\emph{IFS})
I.e.\ the receiver lacks the appropriate security level to retrieve the (confidential) information. 
The violations happens only when the receiver reads the data.
\end{description}

We refine our <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">SecurityInvariant</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> locale.
›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Information Flow Security Strategy (IFS)›</span></span>
  <span class="keyword1"><span class="command">locale</span></span> SecurityInvariant_IFS <span class="main">=</span> SecurityInvariant_preliminaries <span class="quoted"><span class="free">sinvar</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="free">sinvar</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
      <span class="main">+</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span> 
      <span class="keyword2"><span class="keyword">assumes</span></span>  default_secure_IFS<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span><span class="main">;</span> <span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span>
          <span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> snd<span class="main">`</span> <span class="free">f</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>
      <span class="comment1">― ‹If some otherbot fulfills <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">default_secure</span><span class="antiquote">}</span></span>, it must be <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main"><span class="free">⊥</span></span>"</span><span class="antiquote">}</span></span> 
             Hence, <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main"><span class="free">⊥</span></span>"</span><span class="antiquote">}</span></span> is uniquely defined›</span>
      default_unique_IFS<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">G</span> <span class="bound">f</span> <span class="bound">nP</span> <span class="bound">i</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> set_offending_flows <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">∈</span> snd<span class="main">`</span> <span class="bound">f</span> 
                <span class="main">⟶</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">otherbot</span> <span class="main">=</span> <span class="main"><span class="free">⊥</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">begin</span></span>
        <span class="keyword1" id="TopoS_Interface-default_unique_EX_notation"><span class="command">lemma</span></span> default_unique_EX_notation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span> <span class="main">⟹</span> 
          <span class="main">∃</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="bound">i</span> <span class="bound">f</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> set_offending_flows <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> 
           <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">f</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">i</span> <span class="main">∈</span> snd<span class="main">`</span> <span class="bound">f</span> <span class="main">∧</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_pp<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> default_unique_IFS SecurityInvariant_withOffendingFlows.valid_without_offending_flows offending_notevalD
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword2"><span class="keyword">end</span></span>
  
  <span class="keyword1"><span class="command">sublocale</span></span> SecurityInvariant_IFS <span class="main">⊆</span> SecurityInvariant <span class="keyword2"><span class="keyword">where</span></span> receiver_violation<span class="main">=</span><span class="quoted">True</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> default_secure_IFS<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> HOL.simp_thms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> default_unique_EX_notation<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="comment1">(*other direction*)</span>
  <span class="keyword1"><span class="command">locale</span></span> SecurityInvariant_IFS_otherDirectrion <span class="main">=</span> SecurityInvariant <span class="keyword2"><span class="keyword">where</span></span> receiver_violation<span class="main">=</span><span class="quoted">True</span>
  <span class="keyword1"><span class="command">sublocale</span></span> SecurityInvariant_IFS_otherDirectrion <span class="main">⊆</span> SecurityInvariant_IFS
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> default_secure offending_notevalD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_pp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> default_unique<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  

<span class="keyword1" id="TopoS_Interface-default_uniqueness_by_counterexample_IFS"><span class="command">lemma</span></span> default_uniqueness_by_counterexample_IFS<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">G</span> <span class="bound">F</span> <span class="bound">nP</span> <span class="bound">i</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="bound">F</span> <span class="main">∈</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">∈</span> snd<span class="main">`</span> <span class="bound">F</span> 
                <span class="main">⟶</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">≠</span> <span class="free">default_value</span> <span class="main">⟹</span>
    <span class="main">∃</span><span class="bound">G</span> <span class="bound">nP</span> <span class="bound">i</span> <span class="bound">F</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">F</span> <span class="main">∈</span> <span class="main">(</span>SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">)</span> <span class="main">∧</span>
       <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">F</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">∧</span>
        <span class="bound">i</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="bound">F</span> <span class="main">∧</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span> "</span></span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">=</span> <span class="free">default_value</span>"</span></span>
   <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Access Control Strategy (ACS)›</span></span>
  <span class="keyword1"><span class="command">locale</span></span> SecurityInvariant_ACS <span class="main">=</span> SecurityInvariant_preliminaries <span class="quoted"><span class="free">sinvar</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="free">sinvar</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
      <span class="main">+</span>
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span> 
      <span class="keyword2"><span class="keyword">assumes</span></span>  default_secure_ACS<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span><span class="main">;</span> <span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span>
          <span class="main">∀</span><span class="bound">i</span> <span class="main">∈</span> fst<span class="main">`</span> <span class="free">f</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>
      default_unique_ACS<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">G</span> <span class="bound">f</span> <span class="bound">nP</span> <span class="bound">i</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> set_offending_flows <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">∈</span> fst<span class="main">`</span> <span class="bound">f</span> 
                <span class="main">⟶</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">otherbot</span> <span class="main">=</span> <span class="main"><span class="free">⊥</span></span>"</span></span>
      <span class="keyword2"><span class="keyword">begin</span></span>
        <span class="keyword1" id="TopoS_Interface-default_unique_EX_notation"><span class="command">lemma</span></span> default_unique_EX_notation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span> <span class="main">⟹</span> 
          <span class="main">∃</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="bound">i</span> <span class="bound">f</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> set_offending_flows <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> 
           <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">f</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">∧</span>
           <span class="main">(</span><span class="bound">i</span> <span class="main">∈</span> fst<span class="main">`</span> <span class="bound">f</span> <span class="main">∧</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_pp<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> default_unique_ACS SecurityInvariant_withOffendingFlows.valid_without_offending_flows offending_notevalD
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword2"><span class="keyword">end</span></span>
  
  <span class="keyword1"><span class="command">sublocale</span></span> SecurityInvariant_ACS <span class="main">⊆</span> SecurityInvariant <span class="keyword2"><span class="keyword">where</span></span> receiver_violation<span class="main">=</span><span class="quoted">False</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> default_secure_ACS<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> HOL.simp_thms<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> default_unique_EX_notation<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="comment1">(*other direction*)</span>
  <span class="keyword1"><span class="command">locale</span></span> SecurityInvariant_ACS_otherDirectrion <span class="main">=</span> SecurityInvariant <span class="keyword2"><span class="keyword">where</span></span> receiver_violation<span class="main">=</span><span class="quoted">False</span>
  <span class="keyword1"><span class="command">sublocale</span></span> SecurityInvariant_ACS_otherDirectrion <span class="main">⊆</span> SecurityInvariant_ACS
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> default_secure offending_notevalD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> contrapos_pp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> default_unique<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="TopoS_Interface-default_uniqueness_by_counterexample_ACS"><span class="command">lemma</span></span> default_uniqueness_by_counterexample_ACS<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">G</span> <span class="bound">F</span> <span class="bound">nP</span> <span class="bound">i</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="bound">F</span> <span class="main">∈</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="bound">F</span> 
                <span class="main">⟶</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">≠</span> <span class="free">default_value</span> <span class="main">⟹</span>
    <span class="main">∃</span><span class="bound">G</span> <span class="bound">nP</span> <span class="bound">i</span> <span class="bound">F</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">F</span> <span class="main">∈</span> <span class="main">(</span>SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">)</span> <span class="main">∧</span>
       <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">F</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">∧</span>
        <span class="bound">i</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="bound">F</span> <span class="main">∧</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">=</span> <span class="free">default_value</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The sublocale relationships tell that the simplified <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SecurityInvariant_ACS<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SecurityInvariant_IFS<span class="antiquote"><span class="antiquote">}</span></span></span></span> 
  assumptions suffice to do tho generic SecurityInvariant assumptions.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_withOffendingFlows">
<div class="head">
<h1>Theory TopoS_withOffendingFlows</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_withOffendingFlows
<span class="keyword2"><span class="keyword">imports</span></span> <a href="TopoS_Interface.html">TopoS_Interface</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">SecurityInvariant</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> Instantiation Helpers›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  The security invariant locales are set up hierarchically to ease instantiation proofs.
  The first locale, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">SecurityInvariant_withOffendingFlows</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has no assumptions, thus instantiations is for free. 
  The first step focuses on monotonicity,
›</span></span>



<span class="keyword1"><span class="command">context</span></span> SecurityInvariant_withOffendingFlows
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define the monotonicity of <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sinvar›</span></span></span></span>:
  
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="main"><span class="main">⋀</span></span> <span class="bound"><span class="bound">nP</span></span> <span class="bound"><span class="bound">N</span></span> <span class="bound"><span class="bound">E'</span></span> <span class="bound"><span class="bound">E</span></span><span class="main"><span class="main">.</span></span> wf_graph <span class="main"><span class="main">⦇</span></span> nodes <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">N</span></span><span class="main"><span class="main">,</span></span> edges <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">E</span></span> <span class="main"><span class="main">⦈</span></span>  <span class="main"><span class="main">⟹</span></span> <span class="bound"><span class="bound">E'</span></span> <span class="main"><span class="main">⊆</span></span> <span class="bound"><span class="bound">E</span></span> <span class="main"><span class="main">⟹</span></span> <span class="free"><span class="free">sinvar</span></span> <span class="main"><span class="main">⦇</span></span> nodes <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">N</span></span><span class="main"><span class="main">,</span></span> edges <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">E</span></span> <span class="main"><span class="main">⦈</span></span> <span class="bound"><span class="bound">nP</span></span> <span class="main"><span class="main">⟹</span></span> <span class="free"><span class="free">sinvar</span></span> <span class="main"><span class="main">⦇</span></span> nodes <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">N</span></span><span class="main"><span class="main">,</span></span> edges <span class="main"><span class="main">=</span></span> <span class="bound"><span class="bound">E'</span></span> <span class="main"><span class="main">⦈</span></span> <span class="bound"><span class="bound">nP</span></span> <span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
  
  Having a valid invariant, removing edges retains the validity. I.e.\ prohibiting more, is more or equally secure.
›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">sinvar_mono</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sinvar_mono</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">nP</span> <span class="bound">N</span> <span class="bound">E'</span> <span class="bound">E</span><span class="main">.</span> 
      wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span> <span class="main">⦈</span> <span class="main">∧</span> 
      <span class="bound">E'</span> <span class="main">⊆</span> <span class="bound">E</span> <span class="main">∧</span> 
      <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span> <span class="main">⦈</span> <span class="bound">nP</span> <span class="main">⟶</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E'</span> <span class="main">⦈</span> <span class="bound">nP</span> <span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    If one can show <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> sinvar_mono<span class="antiquote"><span class="antiquote">}</span></span></span></span>, then the instantiation of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">SecurityInvariant_preliminaries</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> locale is tremendously simplified. 
›</span></span>

  <span class="keyword1" id="TopoS_withOffendingFlows-sinvar_mono_I_proofrule_simple"><span class="command">lemma</span></span> sinvar_mono_I_proofrule_simple<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">nP</span><span class="main">)</span> <span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> sinvar_mono"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="TopoS_withOffendingFlows-sinvar_mono_I_proofrule"><span class="command">lemma</span></span> sinvar_mono_I_proofrule<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">nP</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span> <span class="tfree">'v</span> graph<span class="main">)</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">nP</span> <span class="bound">G</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span> 
    <span class="main">(</span><span class="main">∀</span> <span class="bound">nP</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">N</span> <span class="bound">E'</span> <span class="bound">E</span><span class="main">.</span> 
      wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span> <span class="main">⦈</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">E</span> <span class="main">∧</span> 
      <span class="bound">E'</span> <span class="main">⊆</span> <span class="bound">E</span> <span class="main">∧</span> 
      <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">nP</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span><span class="main">⦈</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">nP</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E'</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> sinvar_mono"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sinvar_mono_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nP</span> <span class="skolem">N</span> <span class="skolem">E'</span> <span class="skolem">E</span>
    <span class="keyword3"><span class="command">assume</span></span> AllForm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="bound">nP</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span> <span class="tfree">'v</span> graph<span class="main">)</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">nP</span> <span class="bound">G</span><span class="main">)</span> <span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> Pmono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nP</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">N</span> <span class="bound">E'</span> <span class="bound">E</span><span class="main">.</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span> <span class="main">⦈</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">E</span> <span class="main">∧</span> <span class="bound">E'</span> <span class="main">⊆</span> <span class="bound">E</span> <span class="main">∧</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">nP</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span><span class="main">⦈</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">nP</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E'</span><span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> E'subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> evalE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="skolem">nP</span>"</span></span>
    
    <span class="keyword1"><span class="command">from</span></span> Pmono <span class="keyword1"><span class="command">have</span></span> Pmono1<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">nP</span> <span class="bound">N</span> <span class="bound">E'</span> <span class="bound">E</span><span class="main">.</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span> <span class="main">⦈</span> <span class="main">⟹</span> <span class="bound">E'</span> <span class="main">⊆</span> <span class="bound">E</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">E</span><span class="main">.</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">nP</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span><span class="main">⦈</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">nP</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E'</span><span class="main">⦈</span><span class="main">)</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> AllForm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="skolem">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">E</span><span class="main">.</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="skolem">nP</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> this evalE <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">E</span><span class="main">.</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="skolem">nP</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> Pmono1<span class="main">[</span><span class="operator">OF</span> wfG E'subset<span class="main">,</span> <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">nP</span>"</span></span><span class="main">]</span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">E</span><span class="main">.</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="skolem">nP</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this E'subset <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">E'</span><span class="main">.</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="skolem">nP</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="skolem">nP</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this AllForm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span> <span class="skolem">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
 

   <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Invariant violations do not disappear if we add more flows.›</span></span>
   <span class="keyword1" id="TopoS_withOffendingFlows-sinvar_mono_imp_negative_mono"><span class="command">lemma</span></span> sinvar_mono_imp_negative_mono<span class="main">:</span>
   <span class="quoted"><span class="quoted">"sinvar_mono <span class="main">⟹</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">⟹</span>  <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span>
   <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span> <span class="main">⦈</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> sinvar_mono_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>

  <span class="keyword1"><span class="command">corollary</span></span> sinvar_mono_imp_negative_delete_edge_mono<span class="main">:</span>
   <span class="quoted"><span class="quoted">"sinvar_mono <span class="main">⟹</span> wf_graph <span class="free">G</span> <span class="main">⟹</span> <span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">Y</span><span class="main">)</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">X</span><span class="main">)</span> <span class="free">nP</span> "</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword3"><span class="command">assume</span></span> <span class="quoted">sinvar_mono</span>
   <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">Y</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
   <span class="keyword1"><span class="command">from</span></span> delete_edges_wf<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹wf_graph <span class="free">G</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> valid_G_delete<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="free">X</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G</span> <span class="main">-</span> <span class="free">Y</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">-</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹sinvar_mono›</span></span> sinvar_mono_def valid_G_delete <span class="keyword1"><span class="command">have</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="free">X</span><span class="main">⦈</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="free">Y</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">X</span><span class="main">)</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">Y</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>
   <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">Y</span><span class="main">)</span> <span class="free">nP</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="comment1">(*lemma mono_offending_flows_min_set:
  assumes mono_isoffending: "(∀ ff f' G nP. is_offending_flows ff G nP ⟶ is_offending_flows (f' ∪ ff) G nP)"
  and offending: "is_offending_flows_min_set As G nP"
  shows "sinvar (delete_edges G (As ∪ Bs)) nP"
  proof -
    from offending have "is_offending_flows As G nP" using is_offending_flows_min_set_def by simp
    from mono_isoffending this have "is_offending_flows (Bs ∪ As) G nP" by simp
    hence "is_offending_flows (As ∪ Bs) G nP" by (metis Un_commute)
    from this is_offending_flows_def show ?thesis by simp
  qed*)</span>


  <span class="comment1">(*use this to show locale preliminaries from mono*)</span>
  <span class="keyword1" id="TopoS_withOffendingFlows-sinvar_mono_imp_is_offending_flows_mono"><span class="command">lemma</span></span> sinvar_mono_imp_is_offending_flows_mono<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_mono"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_offending_flows <span class="free">FF</span> <span class="free">G</span> <span class="free">nP</span>  <span class="main">⟹</span> is_offending_flows <span class="main">(</span><span class="free">FF</span> <span class="main">∪</span> <span class="free">F</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> wfG <span class="keyword1"><span class="command">have</span></span> wfG'<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> <span class="free">FF</span><span class="main">}</span><span class="main">⦈</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> delete_edges_def delete_edges_wf<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> mono <span class="keyword1"><span class="command">have</span></span> sinvarE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span> <span class="bound">nP</span> <span class="bound">N</span> <span class="bound">E'</span> <span class="bound">E</span><span class="main">.</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span> <span class="main">⦈</span> <span class="main">⟹</span> <span class="bound">E'</span> <span class="main">⊆</span> <span class="bound">E</span> <span class="main">⟹</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span> <span class="main">⦈</span> <span class="bound">nP</span> <span class="main">⟹</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E'</span> <span class="main">⦈</span> <span class="bound">nP</span> <span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sinvar_mono_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="bound">FF</span> <span class="bound">F</span><span class="main">.</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="bound">G</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">FF</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">F</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="bound">G</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">FF</span><span class="main">}</span> "</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> Collect_mono<span class="main">)</span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> sinvarE<span class="main">[</span><span class="operator">OF</span> wfG' this<span class="main">]</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"is_offending_flows <span class="free">FF</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> is_offending_flows <span class="main">(</span><span class="free">FF</span> <span class="main">∪</span> <span class="free">F</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_offending_flows_def delete_edges_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">(*use this to show locale sinvar_mono*)</span>
  <span class="keyword1" id="TopoS_withOffendingFlows-sinvar_mono_imp_sinvar_mono"><span class="command">lemma</span></span> sinvar_mono_imp_sinvar_mono<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"sinvar_mono <span class="main">⟹</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">⟹</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">nP</span> <span class="main">⟹</span> 
        <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Offending Flows Not Empty Helper Lemmata›</span></span>
<span class="keyword1"><span class="command">context</span></span> SecurityInvariant_withOffendingFlows
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Give an over-approximation of offending flows (e.g. all edges) and get back a
          minimal set›</span></span>
  <span class="comment1">(*offending_overapproximation keepingInOffendingApproximation G nP*)</span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">minimalize_offending_overapprox</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> 
  <span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minimalize_offending_overapprox</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">minimalize_offending_overapprox</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges_list <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">keep</span></span></span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="free">minimalize_offending_overapprox</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> 
    <span class="keyword1">else</span>
      <span class="free">minimalize_offending_overapprox</span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">keep</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span>
    <span class="main">)</span>"</span></span>



  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The graph we check in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> minimalize_offending_overapprox<span class="antiquote"><span class="antiquote">}</span></span></span></span>,
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">G</span></span> minus <span class="main"><span class="main">(</span></span><span class="free"><span class="free">fs</span></span> <span class="main"><span class="main">∪</span></span> <span class="free"><span class="free">keep</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is the graph from the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>offending_flows_min_set›</span></span></span></span> condition.
  We add <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">f</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and remove it.›</span></span>
 

  <span class="comment1">(*lemma minimalize_offending_overapprox_not_in: 
  "f ∉ set fs ⟹ f ∉ set keep ⟹ f ∉ set (minimalize_offending_overapprox fs keep G nP)"
   apply(induction fs arbitrary: keep)
    by(simp_all)*)</span>




  <span class="comment1">(*lemma offending_min_set_ab_in_fs: "wf_graph (G::'v graph) ⟹ (a,b) ∈ edges G ⟹
       is_offending_flows_min_set ({(a, b)} ∪ fs) G nP ⟹
       sinvar (delete_edges G fs) nP ⟹
       (a,b) ∈ fs"
  apply(rule ccontr)
  apply(simp add: is_offending_flows_min_set_def)
  apply(clarify)
  apply(simp add: add_delete_edges)
  done*)</span>


  <span class="keyword1" id="TopoS_withOffendingFlows-minimalize_offending_overapprox_subset"><span class="command">lemma</span></span> minimalize_offending_overapprox_subset<span class="main">:</span>
  <span class="quoted"><span class="quoted">"set <span class="main">(</span>minimalize_offending_overapprox <span class="free">ff</span> <span class="free">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">ff</span> <span class="main">∪</span> set <span class="free">keeps</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ff</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">keeps</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> Nil
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ff</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword1"><span class="command">have</span></span> case1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">sinvar</span> <span class="main">(</span>delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="skolem">ff</span> <span class="main">@</span> <span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span> <span class="main">⟹</span>
     set <span class="main">(</span>minimalize_offending_overapprox <span class="skolem">ff</span> <span class="skolem">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">ff</span> <span class="main">∪</span> set <span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword1"><span class="command">have</span></span> case2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="skolem">ff</span> <span class="main">@</span> <span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span> <span class="main">⟹</span>
     set <span class="main">(</span>minimalize_offending_overapprox <span class="skolem">ff</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">keeps</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">ff</span> <span class="main">∪</span> set <span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> case1 case2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">qed</span></span>



  <span class="keyword1" id="TopoS_withOffendingFlows-not_model_mono_imp_addedge_mono"><span class="command">lemma</span></span> not_model_mono_imp_addedge_mono<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_mono"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span> vG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">a1</span><span class="main">,</span><span class="free">a2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> xy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">Y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="free">a1</span> <span class="free">a2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span><span class="free">Y</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span>  
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="free">a1</span> <span class="free">a2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> wf_graph_add_delete_edge_simp<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Y</span><span class="main">.</span> add_edge <span class="free">a1</span> <span class="free">a2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">Y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span><span class="bound">Y</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">a1</span><span class="main">,</span><span class="free">a2</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 add_edge_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command">using</span></span> ain <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb vG wf_graph.E_wfD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wf_graph.E_wfD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ain<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">from</span></span> this ns <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span><span class="free">Y</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">a1</span><span class="main">,</span> <span class="free">a2</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">a1</span><span class="main">,</span> <span class="free">a2</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="free">Y</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">a1</span><span class="main">,</span> <span class="free">a2</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_mono subset_refl xy<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> sinvar_mono_imp_negative_delete_edge_mono<span class="main">[</span><span class="operator">OF</span> mono<span class="main">]</span> vG <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">Y</span><span class="main">)</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">X</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">OF</span> 2 1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="main">(</span><span class="free">a1</span><span class="main">,</span> <span class="free">a2</span><span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this wf_graph_add_delete_edge_simp<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">theorem</span></span> is_offending_flows_min_set_minimalize_offending_overapprox<span class="main">:</span>
      <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_mono"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> vG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> iO<span class="main">:</span> <span class="quoted"><span class="quoted">"is_offending_flows <span class="main">(</span>set <span class="free">ff</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sF<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ff</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dF<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">ff</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"is_offending_flows_min_set <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="free">ff</span> <span class="main">[]</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
              <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"is_offending_flows_min_set <span class="var">?minset</span> <span class="free">G</span> <span class="free">nP</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> iO <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="free">ff</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> is_offending_flows_def<span class="main">)</span>

    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">sinvar</span>"</span><span class="antiquote">}</span></span> holds if we delete <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">ff</span>"</span><span class="antiquote">}</span></span>.
        With the following generalized statement, we show that it also holds if we delete <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"minimalize_offending_overapprox <span class="free">ff</span> <span class="main">[]</span>"</span><span class="antiquote">}</span></span>›</span>
    <span class="keyword1"><span class="command">{</span></span> 
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">keeps</span>
      <span class="comment1">― ‹Generalized for arbitrary <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">keeps</span></span><span class="antiquote">}</span></span>›</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="free">ff</span> <span class="main">∪</span> set <span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span> <span class="main">⟹</span> 
          <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="free">ff</span> <span class="skolem">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ff</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">keeps</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>delete_edges_list_union<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">}</span></span> 
    <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">keeps</span> <span class="main">=</span> <span class="main">[]</span>"</span><span class="antiquote">}</span></span>›</span>
    <span class="keyword1"><span class="command">note</span></span> minimalize_offending_overapprox_maintains_evalmodel<span class="main">=</span>this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>


    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="free">ff</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>›</span></span> minimalize_offending_overapprox_maintains_evalmodel <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="var">?minset</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_offending_flows <span class="var">?minset</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> iO is_offending_flows_def<span class="main">)</span>

    <span class="keyword1"><span class="command">txt</span></span><span class="quoted"><span class="plain_text">‹We need to show minimality of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"minimalize_offending_overapprox <span class="free"><span class="free">ff</span></span> <span class="main"><span class="main">[]</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
      Minimality means <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">∀</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">e1</span></span><span class="main"><span class="main">,</span></span> <span class="bound"><span class="bound">e2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">∈</span></span><span class="var"><span class="var">?minset</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">¬</span></span> <span class="free"><span class="free">sinvar</span></span> <span class="main"><span class="main">(</span></span>add_edge <span class="bound"><span class="bound">e1</span></span> <span class="bound"><span class="bound">e2</span></span> <span class="main"><span class="main">(</span></span>delete_edges <span class="free"><span class="free">G</span></span> <span class="var"><span class="var">?minset</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span> <span class="free"><span class="free">nP</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
      We show the following generalized fact.
›</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">ff</span> <span class="skolem">keeps</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">ff</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> set <span class="skolem">keeps</span> <span class="main">⟹</span>
        <span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> set <span class="skolem">ff</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">⟹</span>
        distinct <span class="skolem">ff</span> <span class="main">⟹</span>
        <span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span> set <span class="skolem">keeps</span><span class="main">.</span>
           <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="skolem">ff</span> <span class="skolem">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span> <span class="main">⟹</span>
        <span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="skolem">ff</span> <span class="skolem">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">.</span>
           <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="skolem">ff</span> <span class="skolem">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
       <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">ff</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">keeps</span></span><span class="main">)</span>
       <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword1"><span class="command">from</span></span> Nil <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">ff</span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> not_in_keeps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ff</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> set <span class="skolem">keeps</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> a_not_in_keeps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="skolem">keeps</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword3"><span class="command">assume</span></span> in_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ff</span><span class="main">)</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> edges <span class="free">G</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> ff_in_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">ff</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> edges <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_in_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> edges <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword3"><span class="command">assume</span></span> distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ff</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> ff_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">ff</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a_not_in_ff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="skolem">ff</span> "</span></span><span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
        <span class="keyword3"><span class="command">assume</span></span> minimal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span>set <span class="skolem">keeps</span><span class="main">.</span> 
          <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ff</span><span class="main">)</span> <span class="skolem">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
        
        
        <span class="keyword1"><span class="command">have</span></span> delete_edges_list_union_insert<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">f</span> <span class="bound">fs</span> <span class="bound">keep</span><span class="main">.</span> delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="bound">f</span><span class="main">#</span><span class="bound">fs</span><span class="main">@</span><span class="bound">keep</span><span class="main">)</span> <span class="main">=</span> delete_edges <span class="free">G</span> <span class="main">(</span><span class="main">{</span><span class="bound">f</span><span class="main">}</span> <span class="main">∪</span> set <span class="bound">fs</span> <span class="main">∪</span> set <span class="bound">keep</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> graph_ops delete_edges_list_set<span class="main">)</span>

        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="var">?case</span>"</span></span> <span class="comment1">― ‹we show this by case distinction›</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="skolem">ff</span><span class="main">@</span><span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> True 
          <span class="keyword1"><span class="command">from</span></span> True <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="skolem">ff</span><span class="main">@</span><span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">from</span></span> this Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword1"><span class="command">using</span></span> delete_edges_list_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> False
          <span class="comment1">(*MONO=Cons.prems(1)"*)</span>
           <span class="keyword1"><span class="command">{</span></span> <span class="comment1">― ‹a lemma we only need once here›</span>
              <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">ff</span> <span class="skolem">keeps</span>
              <span class="keyword3"><span class="command">assume</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_mono"</span></span> <span class="keyword2"><span class="keyword">and</span></span> ankeeps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="skolem">keeps</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> anff<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> set <span class="skolem">ff</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> aE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> edges <span class="free">G</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> nsinvar<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="skolem">ff</span> <span class="main">@</span> <span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ff</span><span class="main">)</span> <span class="skolem">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F</span> <span class="skolem">Fs</span> <span class="skolem">keep</span>
                  <span class="keyword1"><span class="command">from</span></span> vG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∉</span> set <span class="skolem">Fs</span> <span class="main">⟹</span> <span class="skolem">F</span> <span class="main">∉</span> set <span class="skolem">keep</span> <span class="main">⟹</span>
                    <span class="main">(</span>add_edge <span class="main">(</span>fst <span class="skolem">F</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">F</span><span class="main">)</span> <span class="main">(</span>delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="skolem">F</span><span class="main">#</span><span class="skolem">Fs</span><span class="main">@</span><span class="skolem">keep</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="skolem">Fs</span><span class="main">@</span><span class="skolem">keep</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>delete_edges_list_union delete_edges_list_union_insert<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> graph_ops<span class="main">)</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
                   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
                   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
                  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> delete_edges_list_add_add_iff<span class="main">=</span>this
                <span class="keyword1"><span class="command">from</span></span> aE <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>fst <span class="skolem">a</span><span class="main">,</span> snd <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">from</span></span> delete_edges_list_add_add_iff<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">a</span></span> <span class="quoted"><span class="skolem">ff</span></span> <span class="quoted"><span class="skolem">keeps</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
                  <span class="quoted"><span class="quoted">"delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="skolem">ff</span> <span class="main">@</span> <span class="skolem">keeps</span><span class="main">)</span> <span class="main">=</span> add_edge <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ff</span> <span class="main">@</span> <span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span>"</span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> aE anff ankeeps<span class="main">)</span>
                <span class="keyword1"><span class="command">from</span></span> this nsinvar <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>delete_edges_list <span class="free">G</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ff</span> <span class="main">@</span> <span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                <span class="keyword1"><span class="command">from</span></span> this delete_edges_list_union_insert <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span>
                  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">ff</span> <span class="main">∪</span> set <span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_is_Un sup_assoc<span class="main">)</span>
            
                <span class="keyword1"><span class="command">from</span></span> minimalize_offending_overapprox_subset<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">ff</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span><span class="main">#</span><span class="skolem">keeps</span>"</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">nP</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
                  <span class="quoted"><span class="quoted">"set <span class="main">(</span>minimalize_offending_overapprox <span class="skolem">ff</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">keeps</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">ff</span> <span class="main">∪</span> set <span class="skolem">keeps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            
                <span class="keyword1"><span class="command">from</span></span> not_model_mono_imp_addedge_mono<span class="main">[</span><span class="operator">OF</span> mono vG <span class="quoted"><span class="quoted">‹<span class="main">(</span>fst <span class="skolem">a</span><span class="main">,</span> snd <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span>›</span></span> this 1<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
                  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> minimalize_offending_overapprox.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> nsinvar<span class="main">)</span>
              <span class="keyword1"><span class="command">qed</span></span>
           <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> not_model_mono_imp_addedge_mono_minimalize_offending_overapprox<span class="main">=</span>this
    
          <span class="keyword1"><span class="command">from</span></span> not_model_mono_imp_addedge_mono_minimalize_offending_overapprox<span class="main">[</span><span class="operator">OF</span> mono a_not_in_keeps a_not_in_ff a_in_edges False<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a_minimal<span class="main">:</span> <span class="quoted"><span class="quoted">"
          <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="main">(</span>fst <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">)</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ff</span><span class="main">)</span> <span class="skolem">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> minimal a_minimal
          <span class="keyword1"><span class="command">have</span></span> a_keeps_minimal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">keeps</span><span class="main">)</span><span class="main">.</span> 
          <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="skolem">ff</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">keeps</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> 
            <span class="keyword1"><span class="command">using</span></span> False <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> a_not_in_keeps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span>set <span class="skolem">ff</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∉</span> set <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">keeps</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
          <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> a_not_in_keeps ff_in_edges ff_distinct a_keeps_minimal<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="skolem">ff</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">keeps</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">.</span>
           <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="skolem">ff</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">keeps</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          
          <span class="keyword1"><span class="command">from</span></span> False <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>set <span class="skolem">ff</span> <span class="main">∪</span> set <span class="skolem">keeps</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span> "</span></span> <span class="keyword1"><span class="command">using</span></span> delete_edges_list_union <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>minimalize_offending_overapprox <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">ff</span><span class="main">)</span> <span class="skolem">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span> <span class="main">=</span> 
            set <span class="main">(</span>minimalize_offending_overapprox <span class="skolem">ff</span> <span class="main">(</span><span class="skolem">a</span><span class="main">#</span><span class="skolem">keeps</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_list_union<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this IH <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?goal</span></span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> mono_imp_minimalize_offending_overapprox_minimal<span class="main">=</span>this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="free">ff</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span>

    <span class="keyword1"><span class="command">from</span></span> mono_imp_minimalize_offending_overapprox_minimal<span class="main">[</span><span class="operator">OF</span> _ _ dF<span class="main">]</span> sF <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="var">?minset</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="var">?minset</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_offending_flows_def is_offending_flows_min_set_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">corollary</span></span> mono_imp_set_offending_flows_not_empty<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> mono_sinvar<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_mono"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> vG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> iO<span class="main">:</span> <span class="quoted"><span class="quoted">"is_offending_flows <span class="main">(</span>set <span class="free">ff</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> sS<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">ff</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> dF<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="free">ff</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> iO SecurityInvariant_withOffendingFlows.is_offending_flows_def <span class="keyword1"><span class="command">have</span></span> nS<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> sinvar_mono_imp_negative_delete_edge_mono<span class="main">[</span><span class="operator">OF</span> mono_sinvar<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> negative_delete_edge_mono<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="main">(</span><span class="bound">Y</span><span class="main">)</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">X</span><span class="main">)</span> <span class="bound">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      
    <span class="keyword1"><span class="command">from</span></span> is_offending_flows_min_set_minimalize_offending_overapprox<span class="main">[</span><span class="operator">OF</span> mono_sinvar vG iO sS dF<span class="main">]</span> 
     <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_offending_flows_min_set <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="free">ff</span> <span class="main">[]</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this set_offending_flows_def sS <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="free">ff</span> <span class="main">[]</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> minimalize_offending_overapprox_subset<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> keeps<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
   <span class="keyword1"><span class="command">qed</span></span>


   <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   To show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> set_offending_flows<span class="antiquote"><span class="antiquote">}</span></span></span></span> is not empty, the previous corollary <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> mono_imp_set_offending_flows_not_empty<span class="antiquote"><span class="antiquote">}</span></span></span></span> is very useful.
   Just select <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"set <span class="free"><span class="free">ff</span></span> <span class="main"><span class="main">=</span></span> edges <span class="free"><span class="free">G</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>



   <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
   If there exists a security violations,
   there a means to fix it if and only if the network in which nobody communicates with anyone fulfills the security requirement
›</span></span>
   <span class="keyword1"><span class="command">theorem</span></span> valid_empty_edges_iff_exists_offending_flows<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_mono"</span></span> <span class="keyword2"><span class="keyword">and</span></span> wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> noteval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span> <span class="main">⦈</span> <span class="free">nP</span> <span class="main">⟷</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> 
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
  
      <span class="keyword1"><span class="command">from</span></span> finite_distinct_list<span class="main">[</span><span class="operator">OF</span> wf_graph.finiteE<span class="main">]</span> wfG
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">list_edges</span></span> <span class="keyword2"><span class="keyword">where</span></span> list_edges_props<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">list_edges</span> <span class="main">=</span> edges <span class="free">G</span> <span class="main">∧</span> distinct <span class="skolem">list_edges</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> listedges_subseteq_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">list_edges</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
      <span class="keyword1"><span class="command">have</span></span> empty_edge_graph_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> graph_ops<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> a is_offending_flows_def noteval list_edges_props empty_edge_graph_simp 
        <span class="keyword1"><span class="command">have</span></span> overapprox<span class="main">:</span> <span class="quoted"><span class="quoted">"is_offending_flows <span class="main">(</span>set <span class="skolem">list_edges</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
      <span class="keyword1"><span class="command">from</span></span> mono_imp_set_offending_flows_not_empty<span class="main">[</span><span class="operator">OF</span> mono wfG overapprox listedges_subseteq_edges<span class="main">]</span> list_edges_props 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  
      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">f</span></span> <span class="keyword2"><span class="keyword">where</span></span> f_props<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">∧</span> is_offending_flows_min_set <span class="skolem">f</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_offending_flows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  
      <span class="keyword1"><span class="command">from</span></span> f_props <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> is_offending_flows_min_set_def is_offending_flows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">hence</span></span> evalGf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">f</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> delete_edges_wf<span class="main">[</span><span class="operator">OF</span> wfG<span class="main">,</span> <span class="operator">unfolded</span> delete_edges_def<span class="main">]</span> 
        <span class="keyword1"><span class="command">have</span></span> wfGf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">f</span><span class="main">}</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> emptyseqGf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">⊆</span>  <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> <span class="skolem">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
      <span class="keyword1"><span class="command">from</span></span> mono<span class="main">[</span><span class="operator">unfolded</span> sinvar_mono_def<span class="main">]</span> evalGf wfGf emptyseqGf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>



  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> minimalize_offending_overapprox<span class="antiquote"><span class="antiquote">}</span></span></span></span> not only computes a set where <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> is_offending_flows_min_set<span class="antiquote"><span class="antiquote">}</span></span></span></span> holds, but it also returns a subset of the input.
›</span></span>
  <span class="keyword1" id="TopoS_withOffendingFlows-minimalize_offending_overapprox_keeps_keeps"><span class="command">lemma</span></span> minimalize_offending_overapprox_keeps_keeps<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">keeps</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>minimalize_offending_overapprox <span class="free">ff</span> <span class="free">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ff</span></span> <span class="quoted"><span class="free">keeps</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">nP</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> minimalize_offending_overapprox.induct<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

  <span class="keyword1" id="TopoS_withOffendingFlows-minimalize_offending_overapprox_subseteq_input"><span class="command">lemma</span></span> minimalize_offending_overapprox_subseteq_input<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>minimalize_offending_overapprox <span class="free">ff</span> <span class="free">keeps</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>set <span class="free">ff</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>set <span class="free">keeps</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">ff</span></span> <span class="quoted"><span class="free">keeps</span></span> <span class="quoted"><span class="free">G</span></span> <span class="quoted"><span class="free">nP</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> minimalize_offending_overapprox.induct<span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_list_set delete_edges_simp2<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>




<span class="keyword1"><span class="command">context</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> sinvar_mono<span class="antiquote"><span class="antiquote">}</span></span></span></span> naturally holds in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SecurityInvariant_preliminaries<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
    <span class="keyword1" id="TopoS_withOffendingFlows-sinvar_monoI"><span class="command">lemma</span></span> sinvar_monoI<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_mono"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> sinvar_mono_def <span class="keyword1"><span class="command">using</span></span> mono_sinvar <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Note: due to monotonicity, the minimality also holds for arbitrary subsets›</span></span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"is_offending_flows_min_set <span class="free">F</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">⊆</span> <span class="free">F</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="free">F</span><span class="main">)</span> <span class="main">∪</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> sinvar_mono_imp_negative_delete_edge_mono<span class="main">[</span><span class="operator">OF</span> sinvar_monoI <span class="quoted"><span class="quoted">‹wf_graph <span class="free">G</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> negative_delete_edge_mono<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span> <span class="bound">Y</span><span class="main">.</span> <span class="bound">X</span> <span class="main">⊆</span> <span class="bound">Y</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="bound">Y</span> <span class="main">⦈</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="bound">X</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> delete_edges_simp2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
      <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> is_offending_flows_min_set_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹wf_graph <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> min<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="free">F</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 add_edge_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> e1 e2<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">e1</span><span class="main">,</span> <span class="improper">e2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"insert <span class="improper">e1</span> <span class="main">(</span>insert <span class="improper">e2</span> <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> insert_absorb rev_subsetD wf_graph.E_wfD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> wf_graph.E_wfD<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> min <span class="quoted"><span class="quoted">‹<span class="free">E</span> <span class="main">⊆</span> <span class="free">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> mine<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="free">F</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">have</span></span> e1<span class="main">:</span> <span class="quoted"><span class="quoted">"edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span>edges <span class="free">G</span> <span class="main">-</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> DiffD2 <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> <span class="free">E</span>›</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">have</span></span> e2<span class="main">:</span> <span class="quoted"><span class="quoted">"edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="free">F</span><span class="main">)</span> <span class="main">∪</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> assms<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span> 
      <span class="keyword1"><span class="command">from</span></span> negative_delete_edge_mono<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Y<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">-</span> <span class="free">E</span>"</span></span><span class="main">]</span> <span class="quoted"><span class="quoted">‹<span class="skolem">e</span> <span class="main">∈</span> <span class="free">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span><span class="free">F</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> mine e1 e2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

    
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The algorithm <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> minimalize_offending_overapprox<span class="antiquote"><span class="antiquote">}</span></span></span></span> is correct›</span></span>
    <span class="keyword1" id="TopoS_withOffendingFlows-minimalize_offending_overapprox_sound"><span class="command">lemma</span></span> minimalize_offending_overapprox_sound<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span><span class="main">;</span> is_offending_flows <span class="main">(</span>set <span class="free">ff</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span><span class="main">;</span> set <span class="free">ff</span> <span class="main">⊆</span> edges <span class="free">G</span><span class="main">;</span> distinct <span class="free">ff</span> <span class="main">⟧</span>
        <span class="main">⟹</span> is_offending_flows_min_set <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="free">ff</span> <span class="main">[]</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span> "</span></span>
    <span class="keyword1"><span class="command">using</span></span> is_offending_flows_min_set_minimalize_offending_overapprox sinvar_monoI <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
      If <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">¬</span></span> <span class="free"><span class="free">sinvar</span></span> <span class="free"><span class="free">G</span></span> <span class="free"><span class="free">nP</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
      Given a list ff, (ff is distinct and a subset of G's edges)
      such that <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>sinvar (V, E - ff) nP›</span></span></span></span>
      <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> minimalize_offending_overapprox<span class="antiquote"><span class="antiquote">}</span></span></span></span> minimizes ff such that we get an offending flows
      Note: choosing ff = edges G is a good choice!
›</span></span>
    <span class="keyword1"><span class="command">theorem</span></span> minimalize_offending_overapprox_gives_back_an_offending_flow<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span><span class="main">;</span> is_offending_flows <span class="main">(</span>set <span class="free">ff</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span><span class="main">;</span> set <span class="free">ff</span> <span class="main">⊆</span> edges <span class="free">G</span><span class="main">;</span> distinct <span class="free">ff</span> <span class="main">⟧</span>
        <span class="main">⟹</span>
         <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="free">ff</span> <span class="main">[]</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> minimalize_offending_overapprox_sound<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> minimalize_offending_overapprox_subseteq_input<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> keeps<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


    <span class="comment1">(*TODO better minimality condition for keeps*)</span>
    <span class="comment1">(*lemma  minimalize_offending_overapprox_sound_fixKeep:
      "⟦ wf_graph G; is_offending_flows (set (ff @ keeps)) G nP; ∀ x ∈ set ff. x ∉ set keeps; ∀ x ∈ set ff. x ∈ edges G; distinct ff; 
        ∀(e1, e2)∈ set keeps. ¬ sinvar (add_edge e1 e2 (delete_edges G (set (minimalize_offending_overapprox ff keeps G nP)))) nP ⟧
        ⟹
         is_offending_flows_min_set (set (minimalize_offending_overapprox ff keeps G nP)) G nP ∧ set keeps ⊆ (set (minimalize_offending_overapprox ff keeps G nP))"
       apply(rule conjI)
        apply(simp only: is_offending_flows_min_set_def)
        apply(rule conjI)
         apply(simp add: is_offending_flows_def is_offending_flows_min_set_def)
         apply(simp add:minimalize_offending_overapprox_maintains_evalmodel)
        apply(rule mono_imp_minimalize_offending_overapprox_minimal)
             apply (metis sinvar_monoI sinvar_mono_imp_negative_delete_edge_mono)
            apply(simp)
           apply(simp)
          apply(simp)
         apply(simp)
        apply(simp)
          
       apply(thin_tac "?x")+
       apply(induction ff keeps G nP rule: minimalize_offending_overapprox.induct)
        apply(simp_all)
      done*)</span>

    
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A version which acts on configured security invariants.
      I.e. there is no type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="tfree"><span class="quoted"><span class="tfree">'a</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> for the host attributes in it.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">minimalize_offending_overapprox</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> graph <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> 
<span class="tfree">'v</span> graph <span class="main">⇒</span><span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">minimalize_offending_overapprox</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span>"</span></span> <span class="main">|</span>
<span class="quoted"><span class="quoted">"<span class="free">minimalize_offending_overapprox</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>delete_edges_list <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">keep</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span>
    <span class="free">minimalize_offending_overapprox</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>
  <span class="keyword1">else</span>
    <span class="free">minimalize_offending_overapprox</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">keep</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>
  <span class="main">)</span>"</span></span>

<span class="keyword1" id="TopoS_withOffendingFlows-minimalize_offending_overapprox_boundnP"><span class="command">lemma</span></span> minimalize_offending_overapprox_boundnP<span class="main">:</span>
<span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minimalize_offending_overapprox <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="free">m</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span> <span class="free">fs</span> <span class="free">keeps</span> <span class="free">G</span> <span class="main">=</span>
         SecurityInvariant_withOffendingFlows.minimalize_offending_overapprox <span class="free">m</span> <span class="free">fs</span> <span class="free">keeps</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">fs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">keeps</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.minimalize_offending_overapprox.simps<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.minimalize_offending_overapprox.simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">context</span></span> SecurityInvariant_withOffendingFlows
<span class="keyword2"><span class="keyword">begin</span></span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If there is a violation and there are no offending flows, there does not exist a possibility to fix the violation by 
          tightening the policy. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> valid_empty_edges_iff_exists_offending_flows<span class="antiquote"><span class="antiquote">}</span></span></span></span> already hints this.›</span></span>
    <span class="keyword1" id="TopoS_withOffendingFlows-mono_imp_emptyoffending_eq_nevervalid"><span class="command">lemma</span></span> mono_imp_emptyoffending_eq_nevervalid<span class="main">:</span>
       <span class="quoted"><span class="quoted">"<span class="main">⟦</span> sinvar_mono<span class="main">;</span> wf_graph <span class="free">G</span><span class="main">;</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span><span class="main">;</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">{}</span><span class="main">⟧</span> <span class="main">⟹</span> 
        <span class="main">¬</span> <span class="main">(</span><span class="main">∃</span> <span class="bound"><span class="bound">F</span></span> <span class="main">⊆</span> edges <span class="free">G</span><span class="main">.</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">F</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> mono<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_mono"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a1<span class="main">:</span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> wfG <span class="keyword1"><span class="command">have</span></span> wfG'<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_graph_def<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> a2 set_offending_flows_def <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">f</span></span> <span class="main">⊆</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> is_offending_flows_min_set <span class="bound">f</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this is_offending_flows_min_set_def is_offending_flows_def a1 <span class="keyword1"><span class="command">have</span></span> notdeleteconj<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">f</span></span> <span class="main">⊆</span> edges <span class="free">G</span><span class="main">.</span> 
          <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">f</span><span class="main">)</span> <span class="free">nP</span> <span class="main">∨</span> 
          <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="bound">f</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">f</span></span><span class="main">⊆</span>edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> this notdeleteconj <span class="keyword1"><span class="command">have</span></span> 
         <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span> <span class="free">nP</span> <span class="main">∨</span> 
          <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">next</span></span>
            <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span><span class="main">.</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> e1e2cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span><span class="skolem">e2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">f</span> <span class="main">∧</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            
            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">⊆</span> edges <span class="free">G</span>›</span></span> wfG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">f</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rev_finite_subset<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">listf</span></span> <span class="keyword2"><span class="keyword">where</span></span> listf<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">listf</span> <span class="main">=</span> <span class="skolem">f</span> <span class="main">∧</span> distinct <span class="skolem">listf</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_distinct_list<span class="main">)</span>

            <span class="keyword1"><span class="command">from</span></span> e1e2cond <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">⊆</span> edges <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> Geq<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span>add_edge <span class="skolem">e1</span> <span class="skolem">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">e1</span><span class="main">,</span><span class="skolem">e2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> graph_ops wfG'<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
               <span class="keyword1"><span class="command">using</span></span> wfG<span class="main">[</span><span class="operator">unfolded</span> wf_graph_def<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


            <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> add_edge_wf<span class="main">[</span><span class="operator">OF</span> delete_edges_wf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wfG<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> mono this  <span class="keyword1"><span class="command">have</span></span> mono''<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">E'</span><span class="main">.</span> <span class="bound">E'</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span>
                <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span> <span class="main">⟹</span> 
                <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E'</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> sinvar_mono_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            
            <span class="keyword1"><span class="command">from</span></span> e1e2cond Geq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">e1</span><span class="main">,</span><span class="skolem">e2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> this mono'' <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span> nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="skolem">f</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">hence</span></span> overapprox<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span> 
            <span class="comment1">(*Interesting, the opposite of what we want to show holds ...*)</span>

            <span class="keyword1"><span class="command">from</span></span> a1 overapprox <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"is_offending_flows <span class="skolem">f</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_offending_flows_def<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this listf <span class="keyword1"><span class="command">have</span></span> c1<span class="main">:</span> <span class="quoted"><span class="quoted">"is_offending_flows <span class="main">(</span>set <span class="skolem">listf</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_offending_flows_def<span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> listf <span class="quoted"><span class="quoted">‹<span class="skolem">f</span> <span class="main">⊆</span> edges <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> c2<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">listf</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

            <span class="keyword1"><span class="command">from</span></span> mono_imp_set_offending_flows_not_empty<span class="main">[</span><span class="operator">OF</span> mono wfG c1 c2 conjunct2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> listf<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
            <span class="keyword1"><span class="command">from</span></span> this a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="comment1">(*I knew this can't be!*)</span>

            <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="skolem">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
 

<span class="comment1">(*
text{* Old version of security invariant gave @{term "F ∈ set_offending_flows G nP"} and @{term "sinvar (delete_edges G F) nP"}
  as assumption for @{text "default_secure"}. We can conclude this from mono. *}
context SecurityInvariant_withOffendingFlows
begin
  lemma mono_exists_offending_flows:
  "⟦ sinvar_mono; wf_graph G; is_offending_flows (set ff) G nP; set ff ⊆ edges G; distinct ff ⟧ 
    ⟹ ∃F. F ∈ set_offending_flows G nP ∧ sinvar (delete_edges G F) nP"
    apply(frule mono_imp_set_offending_flows_not_empty[of G nP ff])
         apply(simp_all add:is_offending_flows_def)
    apply(simp add: set_offending_flows_def)
    apply(erule exE)
    apply(rename_tac exF)
    apply(clarify)
    apply(rule_tac x="exF" in exI)
    apply(rule conjI)
     apply(simp)
    apply(rule conjI)
     apply(simp)
    apply(simp add:is_offending_flows_min_set_def is_offending_flows_def)
  done
end
*)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Monotonicity of offending flows›</span></span>
  <span class="keyword1"><span class="command">context</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">begin</span></span>
  
    <span class="comment1">(*todo: simplify proof*)</span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If there is some <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">F'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in the offending flows of a small graph and you have a bigger graph, 
          you can extend <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">F'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> by some <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">Fadd</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and minimality in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">F</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is preserved›</span></span>
    <span class="keyword1" id="TopoS_withOffendingFlows-minimality_offending_flows_mono_edges_graph_extend"><span class="command">lemma</span></span> minimality_offending_flows_mono_edges_graph_extend<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">;</span> <span class="free">Fadd</span> <span class="main">∩</span> <span class="free">E'</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> <span class="free">F'</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span><span class="main">⦈</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span> 
            <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">F'</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="free">Fadd</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>    a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>    a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">Fadd</span> <span class="main">∩</span> <span class="free">E'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>    a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">⊆</span> <span class="free">E'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def<span class="main">)</span>

      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Eadd</span></span> <span class="keyword2"><span class="keyword">where</span></span> Eadd_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E'</span> <span class="main">∪</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="free">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">E'</span> <span class="main">∩</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> Fadd_notinE'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Fadd</span><span class="main">.</span> <span class="bound">Fadd</span> <span class="main">∩</span> <span class="free">E'</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span>  <span class="free">E'</span> <span class="main">-</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="bound">Fadd</span><span class="main">)</span> <span class="main">=</span>  <span class="free">E'</span> <span class="main">-</span> <span class="free">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="free">E'</span>›</span></span> a1<span class="main">[</span><span class="operator">simplified</span> wf_graph_def<span class="main">]</span> a2 <span class="keyword1"><span class="command">have</span></span> FinV1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="free">F'</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> FinV2<span class="main">:</span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="free">F'</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="free">E</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="free">E'</span>›</span></span> a2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="free">F'</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="free">E</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
        <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="free">E'</span>›</span></span> a2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="free">F'</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">hence</span></span> insert_e1_e2_V<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F'</span><span class="main">.</span> insert <span class="bound">e1</span> <span class="main">(</span>insert <span class="bound">e2</span> <span class="free">V</span><span class="main">)</span> <span class="main">=</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">hence</span></span> add_edge_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F'</span><span class="main">.</span> add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">⦈</span> <span class="main">=</span>  <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span><span class="free">E'</span> <span class="main">-</span> <span class="free">F'</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_edge_def<span class="main">)</span>
         
      <span class="keyword1"><span class="command">have</span></span> Fadd_notinE'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Fadd</span><span class="main">.</span> <span class="bound">Fadd</span> <span class="main">∩</span> <span class="free">E'</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span>  <span class="free">E'</span> <span class="main">-</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="bound">Fadd</span><span class="main">)</span> <span class="main">=</span>  <span class="free">E'</span> <span class="main">-</span> <span class="free">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="free">E'</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> Fadd_notinF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Fadd</span><span class="main">.</span> <span class="bound">Fadd</span> <span class="main">∩</span> <span class="free">E'</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span>  <span class="free">F'</span> <span class="main">∩</span> <span class="bound">Fadd</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
 
      <span class="keyword1"><span class="command">have</span></span> Fadd_subseteq_Eadd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">Fadd</span><span class="main">.</span> <span class="main">(</span><span class="bound">Fadd</span> <span class="main">∩</span> <span class="free">E'</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">∧</span> <span class="bound">Fadd</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="bound">Fadd</span> <span class="main">⊆</span> <span class="skolem">Eadd</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Eadd_prop a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> Eadd_prop a2 <span class="quoted"><span class="quoted">‹<span class="free">E'</span> <span class="main">∩</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
 
      <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">F'</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span> <span class="main">-</span> <span class="free">F'</span><span class="main">⦈</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_min_set_def delete_edges_simp2<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> add_edge_F <span class="keyword1"><span class="command">have</span></span> noteval_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">F'</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span><span class="free">E'</span> <span class="main">-</span> <span class="free">F'</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span> 

      <span class="comment1">(*proof rule that preserves the tuple*)</span>
      <span class="keyword1"><span class="command">have</span></span> tupleBallI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">P</span><span class="main">.</span> <span class="main">(</span><span class="main">⋀</span><span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="bound">A</span> <span class="main">⟹</span> <span class="bound">P</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="keyword1">ALL</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">:</span><span class="bound">A</span><span class="main">.</span> <span class="bound">P</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">F'</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="free">Fadd</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> tupleBallI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e1</span> <span class="skolem">e2</span>
        <span class="keyword3"><span class="command">assume</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F'</span>"</span></span>
           <span class="keyword1"><span class="command">with</span></span> a3 <span class="keyword1"><span class="command">have</span></span> gFadd1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span><span class="free">E'</span> <span class="main">-</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="free">Fadd</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> Fadd_notinE' noteval_F <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
     
           <span class="keyword1"><span class="command">from</span></span> a1 FinV1 FinV2 a3 f2 <span class="keyword1"><span class="command">have</span></span> gFadd2<span class="main">:</span> 
             <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="free">Fadd</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
             <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
           <span class="keyword1"><span class="command">from</span></span> a2 a3 f2 <span class="keyword1"><span class="command">have</span></span> gFadd3<span class="main">:</span> 
                <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E'</span> <span class="main">-</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="free">Fadd</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="free">Fadd</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
             
           <span class="keyword1"><span class="command">from</span></span> mono_sinvar<span class="main">[</span><span class="operator">OF</span> gFadd2 gFadd3<span class="main">]</span> gFadd1
           <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="free">Fadd</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
       <span class="keyword1"><span class="command">qed</span></span>
       <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 Fadd_notinE' add_edge_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> insert_e1_e2_V <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The minimality condition of the offending flows also holds if we increase the graph.›</span></span>
    <span class="keyword1"><span class="command">corollary</span></span> minimality_offending_flows_mono_edges_graph<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span> 
         <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">;</span>
         <span class="free">F</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span><span class="main">⦈</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> minimality_offending_flows_mono_edges_graph_extend<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Fadd<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{}</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>


    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹all sets in the set of offending flows are monotonic, hence, for a larger graph, they can be extended to match the smaller graph. I.e. everything is monotonic.›</span></span>
    <span class="keyword1"><span class="command">theorem</span></span> mono_extend_set_offending_flows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">;</span> <span class="free">F'</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span> <span class="main">⦈</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span>
        <span class="main">∃</span> <span class="bound">F</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">nP</span><span class="main">.</span> <span class="free">F'</span> <span class="main">⊆</span> <span class="bound">F</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">F'V</span> <span class="skolem">E</span> <span class="skolem">E'</span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>    a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>    a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>

        <span class="comment1">― ‹Idea: <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"F = F' ∪ minimize (E - E')"</span><span class="antiquote">}</span></span>›</span>
  
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> wf_graph <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="bound">f</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> delete_edges_wf<span class="main">[</span><span class="operator">OF</span> a1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
        <span class="keyword1"><span class="command">hence</span></span> wf1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">f</span><span class="main">.</span> wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">-</span><span class="bound">f</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>
  
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Eadd</span></span> <span class="keyword2"><span class="keyword">where</span></span> Eadd_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">∪</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">∩</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
        <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">E'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def<span class="main">)</span>
  
        <span class="keyword1"><span class="command">from</span></span> wf1 <span class="keyword1"><span class="command">have</span></span> wf2<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="skolem">E</span> <span class="main">-</span> <span class="free">F'</span>"</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">using</span></span> Eadd_prop <span class="quoted"><span class="quoted">‹<span class="skolem">E'</span> <span class="main">∩</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">E'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  
        <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> offending_F<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_min_set_def is_offending_flows_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this mono_sinvar<span class="main">[</span><span class="operator">OF</span> a1 a2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
          goal_noteval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
         <span class="keyword1"><span class="command">from</span></span> a4 <span class="keyword1"><span class="command">have</span></span> eval_E_minus_FEadd_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_min_set_def is_offending_flows_def delete_edges_simp2<span class="main">)</span>
        <span class="comment1">(* moreover have "E - (F' ∪ Eadd) = E' - F'"  using `E' ∩ Eadd = {}` Eadd_prop by blast
         ultimately have eval_E_minus_FEadd: "sinvar (delete_edges ⦇nodes = V, edges = E⦈ (F' ∪ Eadd)) nP"
           by(simp add: delete_edges_simp2)*)</span>
  
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">F</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span> <span class="free">nP</span><span class="main">.</span> <span class="free">F'</span> <span class="main">⊆</span> <span class="bound">F</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> assumption_new_violation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
          <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">Eadd</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> Eadd_prop wf_graph.finiteE <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Eadd_list</span></span> <span class="keyword2"><span class="keyword">where</span></span> Eadd_list_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">Eadd_list</span> <span class="main">=</span> <span class="skolem">Eadd</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">Eadd_list</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_distinct_list<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">E'</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> Eadd_prop <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E'_list</span></span> <span class="keyword2"><span class="keyword">where</span></span> E'_list_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="skolem">E'_list</span> <span class="main">=</span> <span class="skolem">E'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">E'_list</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_distinct_list<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">E'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">E'</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F'_list</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">F'_list</span> <span class="main">=</span> <span class="free">F'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="skolem">F'_list</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> finite_distinct_list rev_finite_subset<span class="main">)</span>
    
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span> <span class="main">-</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> Eadd_prop <span class="quoted"><span class="quoted">‹<span class="skolem">E'</span> <span class="main">∩</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">E'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> assumption_new_violation eval_E_minus_FEadd_simp <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"is_offending_flows <span class="main">(</span>set <span class="main">(</span><span class="skolem">Eadd_list</span><span class="main">)</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span><span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">Eadd</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Eadd_list_prop delete_edges_simp2 is_offending_flows_def<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> minimalize_offending_overapprox_sound<span class="main">[</span><span class="operator">OF</span> wf2 this _ <span class="quoted"><span class="quoted">‹distinct <span class="skolem">Eadd_list</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
            <span class="quoted"><span class="quoted">"is_offending_flows_min_set
              <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="skolem">Eadd_list</span> <span class="main">[]</span>
                 <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Eadd_list_prop<span class="main">)</span>
          <span class="keyword1"><span class="command">with</span></span> minimalize_offending_overapprox_subseteq_input<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">Eadd_list</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span><span class="main">⦈</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">nP</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> Eadd_list_prop<span class="main">]</span>
          <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">Fadd</span></span> <span class="keyword2"><span class="keyword">where</span></span> Fadd_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"is_offending_flows_min_set <span class="skolem">Fadd</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fadd</span> <span class="main">⊆</span> <span class="skolem">Eadd</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        
          <span class="keyword1"><span class="command">have</span></span> graph_edges_simp_helper<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span> <span class="main">-</span> <span class="skolem">Fadd</span> <span class="main">=</span>  <span class="skolem">E</span> <span class="main">-</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Fadd</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E'</span> <span class="main">∩</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> Eadd_prop <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">E'</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        
          <span class="keyword1"><span class="command">from</span></span> Fadd_prop graph_edges_simp_helper <span class="keyword1"><span class="command">have</span></span>
            goal_eval_Fadd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Fadd</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            pre_goal_minimal_Fadd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">Fadd</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Fadd</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_offending_flows_min_set_def is_offending_flows_def delete_edges_simp2<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E'</span> <span class="main">∩</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Fadd</span> <span class="main">⊆</span> <span class="skolem">Eadd</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">Fadd</span> <span class="main">∩</span> <span class="skolem">E'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> minimality_offending_flows_mono_edges_graph_extend<span class="main">[</span><span class="operator">OF</span> a1 <span class="quoted"><span class="quoted">‹<span class="skolem">E'</span> <span class="main">⊆</span> <span class="skolem">E</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">Fadd</span> <span class="main">∩</span> <span class="skolem">E'</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> a4<span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> mono_delete_edges_minimal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">F'</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Fadd</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    
          <span class="keyword1"><span class="command">from</span></span> mono_delete_edges_minimal pre_goal_minimal_Fadd <span class="keyword1"><span class="command">have</span></span> goal_minimal<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Fadd</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="main">(</span><span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Fadd</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
           <span class="keyword1"><span class="command">from</span></span> Eadd_prop <span class="quoted"><span class="quoted">‹<span class="skolem">Fadd</span> <span class="main">⊆</span> <span class="skolem">Eadd</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">E'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> goal_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">E</span> <span class="main">∧</span> <span class="skolem">Fadd</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">F</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span> <span class="free">nP</span><span class="main">.</span> <span class="free">F'</span> <span class="main">⊆</span> <span class="bound">F</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_min_set_def is_offending_flows_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Fadd</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> goal_noteval goal_eval_Fadd goal_minimal goal_subset<span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> assumption_no_new_violation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> this  <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">E'</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E'</span> <span class="main">∩</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="main">{}</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">-</span> <span class="free">F'</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">subst</span> Eadd_prop<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">E'</span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">∩</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
              <span class="keyword3"><span class="command">assume</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="free">F'</span> <span class="main">∪</span> <span class="skolem">Eadd</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span><span class="main">.</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">E'</span> <span class="main">-</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>1</sub></span> <span class="main">∩</span> <span class="skolem">E'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> a2 Un_Diff_Int <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">-</span> <span class="skolem">Eadd</span> <span class="main">=</span> <span class="free">F'</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">Eadd</span> <span class="main">-</span> <span class="free">F'</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">Eadd</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> Int_Diff Un_Diff_Int sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span> <span class="main">∪</span> <span class="skolem">Eadd</span> <span class="main">-</span> <span class="free">F'</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
                <span class="keyword1"><span class="command">using</span></span> a3 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_Diff sup_bot.left_neutral<span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> goal_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="free">F'</span><span class="main">)</span> <span class="free">nP</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>
  
          <span class="keyword1"><span class="command">from</span></span> Eadd_prop <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">E'</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> goal_subset<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  
          <span class="keyword1"><span class="command">from</span></span> minimality_offending_flows_mono_edges_graph<span class="main">[</span><span class="operator">OF</span> a1 a2 a4<span class="main">]</span> 
          <span class="keyword1"><span class="command">have</span></span> goal_minimal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">F'</span><span class="main">.</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span> <span class="free">F'</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
  
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">F</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span> <span class="free">nP</span><span class="main">.</span> <span class="free">F'</span> <span class="main">⊆</span> <span class="bound">F</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_min_set_def is_offending_flows_def<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">F'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> goal_noteval goal_subset goal_minimal goal_eval<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
         <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>


    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The offending flows are monotonic.›</span></span>
    <span class="keyword1"><span class="command">corollary</span></span> offending_flows_union_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      <span class="main">⋃</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span> <span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> mono_extend_set_offending_flows<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>



   <span class="comment1">(* I guess set_offending_flows = {{e}} does not hold. Consider the Dependability invariant:
      having a wf graph.
      Add an edge s.t. a dependability violation occurs.
      The offending flows now contains the new edge ans all edges on the path from the node with the violation to the end of the new edge. *)</span>
   <span class="keyword1" id="TopoS_withOffendingFlows-set_offending_flows_insert_contains_new"><span class="command">lemma</span></span> set_offending_flows_insert_contains_new<span class="main">:</span>
   <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="free">e</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span> set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">{}</span><span class="main">;</span> set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="free">e</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      <span class="main">{</span><span class="free">e</span><span class="main">}</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="free">e</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
       <span class="keyword3"><span class="command">assume</span></span> wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="free">e</span> <span class="free">E</span> <span class="main">⦈</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span>    a1<span class="main">:</span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span>    a2<span class="main">:</span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="free">e</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>

       <span class="keyword1"><span class="command">from</span></span> a1 a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">∉</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> insert_absorb<span class="main">)</span>
       
       <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> a1'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">F</span></span> <span class="main">⊆</span> <span class="free">E</span><span class="main">.</span> <span class="main">¬</span> is_offending_flows_min_set <span class="bound">F</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def<span class="main">)</span>
       <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> a2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound"><span class="bound">F</span></span> <span class="main">⊆</span> insert <span class="free">e</span> <span class="free">E</span><span class="main">.</span> is_offending_flows_min_set <span class="bound">F</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="free">e</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def<span class="main">)</span>

       <span class="keyword1"><span class="command">from</span></span> wfG <span class="keyword1"><span class="command">have</span></span> wfG'<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_graph_def<span class="main">)</span>

       <span class="keyword1"><span class="command">from</span></span> a1 defined_offending<span class="main">[</span><span class="operator">OF</span> wfG'<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> evalG<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">from</span></span> sinvar_monoI<span class="main">[</span><span class="operator">unfolded</span> sinvar_mono_def<span class="main">]</span> wfG' this
       <span class="keyword1"><span class="command">have</span></span> goal_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">{</span><span class="free">e</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset<span class="main">)</span>

       <span class="keyword1"><span class="command">from</span></span> sinvar_no_offending a2 <span class="keyword1"><span class="command">have</span></span> goal_not_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="free">e</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

       <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a</span></span> <span class="skolem"><span class="skolem">b</span></span> <span class="keyword2"><span class="keyword">where</span></span> e<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">e</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a</span><span class="main">,</span><span class="skolem">b</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">e</span></span><span class="main">)</span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">with</span></span> wfG <span class="keyword1"><span class="command">have</span></span> insert_e_V<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="main">(</span>insert <span class="skolem">b</span> <span class="free">V</span><span class="main">)</span> <span class="main">=</span> <span class="free">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>

       <span class="keyword1"><span class="command">from</span></span> a1' a2' <span class="keyword1"><span class="command">have</span></span> min_set_e<span class="main">:</span> <span class="quoted"><span class="quoted">"is_offending_flows_min_set <span class="main">{</span><span class="free">e</span><span class="main">}</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="free">e</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_offending_flows_min_set_def is_offending_flows_def add_edge_def delete_edges_simp2 goal_not_eval goal_eval<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> goal_not_eval <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e insert_e_V<span class="main">)</span>

       <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="free">e</span><span class="main">}</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="free">e</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
     
<span class="keyword2"><span class="keyword">end</span></span>

    <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Pow <span class="main">{</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">}</span> <span class="main">∪</span> <span class="main">{</span><span class="main">{</span><span class="numeral">8</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span><span class="numeral">9</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="bound">x</span><span class="main">∈</span>Pow <span class="main">{</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">}</span><span class="main">.</span> <span class="main">⋃</span> <span class="bound">y</span> <span class="main">∈</span> <span class="main">{</span><span class="main">{</span><span class="numeral">8</span><span class="main">::</span>int<span class="main">}</span><span class="main">,</span> <span class="main">{</span><span class="numeral">9</span><span class="main">}</span><span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="bound">x</span> <span class="main">∪</span> <span class="bound">y</span><span class="main">}</span>"</span></span>
    
    <span class="comment1">(*similar to ×_def*)</span>
    <span class="comment1">― ‹combines powerset of A with B›</span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">pow_combine</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'x</span> set <span class="main">⇒</span> <span class="tfree">'x</span> set set <span class="main">⇒</span> <span class="tfree">'x</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="free">pow_combine</span> <span class="free"><span class="bound"><span class="entity">A</span></span></span> <span class="free"><span class="bound"><span class="entity">B</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="main">⋃</span> <span class="bound">X</span> <span class="main">∈</span> Pow <span class="free"><span class="bound"><span class="entity">A</span></span></span><span class="main">.</span> <span class="main">⋃</span> <span class="bound">Y</span> <span class="main">∈</span> <span class="free"><span class="bound"><span class="entity">B</span></span></span><span class="main">.</span> <span class="main">{</span><span class="bound">X</span> <span class="main">∪</span> <span class="bound">Y</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> Pow <span class="free"><span class="bound"><span class="entity">A</span></span></span>"</span></span>

    <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"pow_combine <span class="main">{</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span><span class="numeral">2</span><span class="main">}</span> <span class="main">{</span><span class="main">{</span><span class="numeral">5</span><span class="main">::</span>int<span class="main">,</span> <span class="numeral">6</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span><span class="numeral">8</span><span class="main">}</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"pow_combine <span class="main">{</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span><span class="numeral">2</span><span class="main">}</span> <span class="main">{}</span>"</span></span>

    <span class="keyword1" id="TopoS_withOffendingFlows-pow_combine_mono"><span class="command">lemma</span></span> pow_combine_mono<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">S</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">X</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="free">Y</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> set"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">F</span> <span class="main">∈</span> <span class="free">S</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">F</span> <span class="main">∈</span> pow_combine <span class="free">Y</span> <span class="free">S</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">Y</span> <span class="main">∪</span> <span class="free">X</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pow_combine_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Pow_iff assms sup.coboundedI1 sup.orderE sup.orderI sup_assoc<span class="main">)</span>


    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">S</span> <span class="main">⊆</span> pow_combine <span class="free">X</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pow_combine_def<span class="main">)</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"Pow <span class="free">X</span> <span class="main">⊆</span> pow_combine <span class="free">X</span> <span class="free">S</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pow_combine_def<span class="main">)</span>

    <span class="keyword1" id="TopoS_withOffendingFlows-rule_pow_combine_fixfst"><span class="command">lemma</span></span> rule_pow_combine_fixfst<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span> <span class="main">⟹</span> pow_combine <span class="free">A</span> <span class="free">B</span> <span class="main">⊆</span> pow_combine <span class="free">A</span> <span class="free">C</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pow_combine_def<span class="main">)</span>


    <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"pow_combine <span class="main">{</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span><span class="numeral">2</span><span class="main">}</span> <span class="main">{</span><span class="main">{</span><span class="numeral">5</span><span class="main">::</span>int<span class="main">,</span> <span class="numeral">6</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span><span class="main">1</span><span class="main">}</span><span class="main">}</span> <span class="main">⊆</span> pow_combine <span class="main">{</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span><span class="numeral">2</span><span class="main">}</span> <span class="main">{</span><span class="main">{</span><span class="numeral">5</span><span class="main">::</span>int<span class="main">,</span> <span class="numeral">6</span><span class="main">}</span><span class="main">,</span> <span class="main">{</span><span class="numeral">8</span><span class="main">}</span><span class="main">}</span>"</span></span>

    <span class="keyword1" id="TopoS_withOffendingFlows-rule_pow_combine_fixfst_Union"><span class="command">lemma</span></span> rule_pow_combine_fixfst_Union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="free">B</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="free">C</span> <span class="main">⟹</span> <span class="main">⋃</span> <span class="main">(</span>pow_combine <span class="free">A</span> <span class="free">B</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>pow_combine <span class="free">A</span> <span class="free">C</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> pow_combine_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="comment1">(*does the following hold?
      (set_offending_flows ⦇nodes = V, edges = E ∪ X⦈ nP) ⊆ pow_combine X (set_offending_flows ⦇nodes = V, edges = E⦈ nP)

      I guess not:  ^D  I'm convinced this does not hold!
      Graph:   A -&gt; B -&gt; C
      E = A -&gt; B
      E ∪ X = A -&gt; B -&gt; C
      
      model is A and C are interfering

      set_offending_flows(E ∪ X) = {{(A,B)}, {B,C}}
       set_offending_flows(E) = {}
      pow_combine X set_offending_flows(E) = {{}, {C}}

      the {(A,B)} is the problem here such that subset does not hold.

      It holds if
        ∀ F ∈ (set_offending_flows ⦇nodes = V, edges = E ∪ X⦈ nP). F ⊆ X
      however, then (set_offending_flows ⦇nodes = V, edges = E⦈ nP) = {} which renders the whole statement useless
     *)</span>

  <span class="keyword1"><span class="command">context</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">begin</span></span>

    <span class="keyword1" id="TopoS_withOffendingFlows-offending_partition_subset_empty"><span class="command">lemma</span></span> offending_partition_subset_empty<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">F</span> <span class="main">∈</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> <span class="free">X</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> wfGEX<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> <span class="free">X</span><span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∩</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> c<span class="main">:</span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F'</span></span> <span class="keyword2"><span class="keyword">where</span></span> F'_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> F'_prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_offending_flows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> mono_extend_set_offending_flows<span class="main">[</span><span class="operator">OF</span> wfGEX _ F'_prop<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F</span><span class="main">∈</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> <span class="free">X</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">.</span> <span class="skolem">F'</span> <span class="main">⊆</span> <span class="bound">F</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">from</span></span> F'_prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">{}</span> <span class="main">≠</span> <span class="skolem">F'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> empty_offending_contra<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F'</span> <span class="main">⊆</span> <span class="free">E</span>›</span></span> disj <span class="quoted"><span class="quoted">‹<span class="main">{}</span> <span class="main">≠</span> <span class="skolem">F'</span>›</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">corollary</span></span> partitioned_offending_subseteq_pow_combine<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> wfGEX<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> <span class="free">X</span><span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> disj<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∩</span> <span class="free">X</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> partitioned_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">F</span> <span class="main">∈</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> <span class="free">X</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="comment1">(*offending does not contain E*)</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> <span class="free">X</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> pow_combine <span class="free">X</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> offending_partition_subset_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> partitioned_offending wfGEX disj<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> pow_combine_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> partitioned_offending <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword2"><span class="keyword">end</span></span>


  <span class="keyword1"><span class="command">context</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">begin</span></span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Knowing that the <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⋃ offending is ⊆ X›</span></span></span></span>, removing something from the graphs's edges, 
           it also disappears from the offending flows.›</span></span>
    <span class="keyword1" id="TopoS_withOffendingFlows-Un_set_offending_flows_bound_minus"><span class="command">lemma</span></span> Un_set_offending_flows_bound_minus<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     Foffending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> wfG <span class="keyword1"><span class="command">have</span></span> wfG'<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def finite_subset<span class="main">)</span>
      
      <span class="keyword1"><span class="command">from</span></span> offending_flows_union_mono<span class="main">[</span><span class="operator">OF</span> wfG<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> E'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_simp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wfG'<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Un_set_offending_flows_minus<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free">f</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> Foffending Un_set_offending_flows_minus 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    If the offending flows are bound by some <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">X</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
    the we can remove all finite <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">E'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>from the graph's edges
    and the offending flows from the smaller graph are bound by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">X</span></span> <span class="main"><span class="main">-</span></span> <span class="free"><span class="free">E'</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
    <span class="keyword1" id="TopoS_withOffendingFlows-Un_set_offending_flows_bound_minus_subseteq"><span class="command">lemma</span></span> Un_set_offending_flows_bound_minus_subseteq<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     Foffending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="free">E'</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">-</span> <span class="free">E'</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> wfG <span class="keyword1"><span class="command">have</span></span> wfG'<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="free">E'</span> <span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def finite_subset<span class="main">)</span>
      
      <span class="keyword1"><span class="command">from</span></span> offending_flows_union_mono<span class="main">[</span><span class="operator">OF</span> wfG<span class="main">,</span> <span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> E'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">-</span> <span class="free">E'</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="free">E'</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">-</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">-</span> <span class="free">E'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="free">E'</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="free">E'</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">-</span> <span class="free">E'</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_simp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wfG'<span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> Un_set_offending_flows_minus<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⋃</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="free">E'</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">-</span> <span class="free">E'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> Foffending Un_set_offending_flows_minus 
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">corollary</span></span> Un_set_offending_flows_bound_minus_subseteq'<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span>
    <span class="main">⋃</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span>
    <span class="main">⋃</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="free">E'</span> <span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">-</span> <span class="free">E'</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Un_set_offending_flows_bound_minus_subseteq<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_ENF">
<div class="head">
<h1>Theory TopoS_ENF</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_ENF
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <a href="TopoS_Interface.html">TopoS_Interface</a> <span class="quoted">"<a href="TopoS_Util.html">Lib/TopoS_Util</a>"</span> <a href="TopoS_withOffendingFlows.html">TopoS_withOffendingFlows</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Special Structures of Security Invariants›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Security Invariants may have a common structure: 
  If the function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">sinvar</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is predicate which starts with <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>∀ (v<span class="hidden">⇩</span><sub>1</sub>, v<span class="hidden">⇩</span><sub>2</sub>) ∈ edges G. …›</span></span></span></span>,
  we call this the all edges normal form (ENF).
  We found that this form has some nice properties.
  Also, locale instantiation is easier in ENF with the help of the following lemmata.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Simple Edges Normal Form (ENF)›</span></span>

<span class="keyword1"><span class="command">context</span></span> SecurityInvariant_withOffendingFlows
<span class="keyword2"><span class="keyword">begin</span></span> 

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">sinvar_all_edges_normal_form</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar_all_edges_normal_form</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹reflexivity is needed for convenience. If a security invariant is not reflexive, that means that all nodes with the default
    parameter <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>⊥›</span></span></span></span> are not allowed to communicate with each other. Non-reflexivity is possible, but requires more work.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ENF_refl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">ENF_refl</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> sinvar_all_edges_normal_form <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">p1</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="bound">p1</span> <span class="bound">p1</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="TopoS_ENF-monotonicity_sinvar_mono"><span class="command">lemma</span></span> monotonicity_sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span> <span class="main">⟹</span> sinvar_mono"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> sinvar_all_edges_normal_form_def sinvar_mono_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword2"><span class="keyword">end</span></span> 

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Offending Flows›</span></span>

<span class="keyword1"><span class="command">context</span></span> SecurityInvariant_withOffendingFlows
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The insight: for all edges in the members of the offending flows, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">¬</span></span> <span class="free"><span class="free">P</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> holds.›</span></span>
  <span class="keyword1" id="TopoS_ENF-ENF_offending_imp_not_P"><span class="command">lemma</span></span> ENF_offending_imp_not_P<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">e1</span><span class="main">,</span> <span class="free">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="free">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="free">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">unfolding</span></span> sinvar_all_edges_normal_form_def set_offending_flows_def is_offending_flows_min_set_def is_offending_flows_def
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> graph_ops<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Hence, the members of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> set_offending_flows<span class="antiquote"><span class="antiquote">}</span></span></span></span> must look as follows.›</span></span>
  <span class="keyword1" id="TopoS_ENF-ENF_offending_set_P_representation"><span class="command">lemma</span></span> ENF_offending_set_P_representation<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="var">?E</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span> <span class="skolem">b</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">a</span><span class="main">,</span> <span class="skolem">b</span><span class="main">)</span> <span class="main">∈</span> <span class="var">?E</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> set_offending_flows_def ENF_offending_imp_not_P<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">moreover</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="var">?E</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">F</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> assms
        <span class="keyword1"><span class="command">unfolding</span></span> sinvar_all_edges_normal_form_def set_offending_flows_def is_offending_flows_min_set_def
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> is_offending_flows_def graph_ops<span class="main">)</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We can show left to right of the desired representation of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> set_offending_flows<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
  <span class="keyword1" id="TopoS_ENF-ENF_offending_subseteq_lhs"><span class="command">lemma</span></span> ENF_offending_subseteq_lhs<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">⊆</span> <span class="main">{</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ENF_offending_set_P_representation<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> set_offending_flows<span class="antiquote"><span class="antiquote">}</span></span></span></span> is not empty, we have the other direction.›</span></span>
  <span class="keyword1" id="TopoS_ENF-ENF_offending_not_empty_imp_ENF_offending_subseteq_rhs"><span class="command">lemma</span></span> ENF_offending_not_empty_imp_ENF_offending_subseteq_rhs<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span>"</span></span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">{</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">e1</span></span><span class="main">,</span><span class="bound"><span class="bound">e2</span></span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span> <span class="main">⊆</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
  <span class="keyword1"><span class="command">using</span></span> assms ENF_offending_set_P_representation
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  <span class="keyword1" id="TopoS_ENF-ENF_notevalmodel_imp_offending_not_empty"><span class="command">lemma</span></span> ENF_notevalmodel_imp_offending_not_empty<span class="main">:</span>
  <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
    <span class="comment1">(*TODO get easier from monotonicity? but would require valid graph assumption ...*)</span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> enf<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> ns<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>

      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?F'</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">e1</span></span><span class="main">,</span><span class="bound"><span class="bound">e2</span></span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span><span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span>"</span></span>
        <span class="comment1">― ‹select <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="var">?F'</span>"</span><span class="antiquote">}</span></span> as the list of all edges which violate <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="free">P</span>"</span><span class="antiquote">}</span></span>›</span>

        <span class="keyword1"><span class="command">from</span></span> enf <span class="keyword1"><span class="command">have</span></span> ENF_notevalmodel_offending_imp_ex_offending_min<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">F</span><span class="main">.</span> is_offending_flows <span class="bound">F</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="bound">F</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">⟹</span>
             <span class="main">∃</span><span class="bound">F'</span><span class="main">.</span> <span class="bound">F'</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">∧</span> is_offending_flows_min_set <span class="bound">F'</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> sinvar_all_edges_normal_form_def is_offending_flows_min_set_def is_offending_flows_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">-</span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?F'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> graph_ops<span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> enf ns <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> is_offending_flows <span class="bound">F</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> sinvar_all_edges_normal_form_def is_offending_flows_def
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">-</span><span class="main">)</span> <span class="main">(</span><span class="operator">rule</span> exI<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> x<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="var"><span class="var"><span class="var">?F'</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> graph_ops<span class="main">)</span>
      
        <span class="keyword1"><span class="command">from</span></span> enf ns this ENF_notevalmodel_offending_imp_ex_offending_min <span class="keyword1"><span class="command">have</span></span> ENF_notevalmodel_imp_ex_offending_min<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">∧</span> is_offending_flows_min_set <span class="bound">F</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> ENF_notevalmodel_imp_ex_offending_min<span class="main">=</span>this

      <span class="keyword1"><span class="command">from</span></span> ENF_notevalmodel_imp_ex_offending_min <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> set_offending_flows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="TopoS_ENF-ENF_offending_case1"><span class="command">lemma</span></span> ENF_offending_case1<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> sinvar_all_edges_normal_form <span class="free">P</span><span class="main">;</span>  <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span>
    <span class="main">{</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span> <span class="main">=</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> ENF_notevalmodel_imp_offending_not_empty<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ENF_offending_not_empty_imp_ENF_offending_subseteq_rhs<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ENF_offending_subseteq_lhs<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  <span class="keyword1" id="TopoS_ENF-ENF_offending_case2"><span class="command">lemma</span></span> ENF_offending_case2<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> sinvar_all_edges_normal_form <span class="free">P</span><span class="main">;</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">⟧</span> <span class="main">⟹</span>
    <span class="main">{}</span> <span class="main">=</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> sinvar_no_offending<span class="main"><span class="main">[</span></span><span class="operator">of</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">nP</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  
  <span class="keyword1"><span class="command">theorem</span></span> ENF_offending_set<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> sinvar_all_edges_normal_form <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span>
    set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ENF_offending_case1 ENF_offending_case2<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Lemmata›</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span>  ENF_offending_members<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span><span class="main">;</span> sinvar_all_edges_normal_form <span class="free">P</span><span class="main">;</span> <span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span><span class="main">⟧</span> <span class="main">⟹</span> 
    <span class="free">f</span> <span class="main">⊆</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span> <span class="free">f</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ENF_offending_set<span class="main">)</span>
 


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Instance Helper›</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> ENF_refl_not_offedning<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span><span class="main">;</span> <span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span><span class="main">;</span> 
          ENF_refl <span class="free">P</span><span class="main">⟧</span> <span class="main">⟹</span>
          <span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword3"><span class="command">assume</span></span> a_not_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_enf_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"ENF_refl <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_offedning<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
  
    <span class="keyword1"><span class="command">from</span></span> a_enf_refl <span class="keyword1"><span class="command">have</span></span> a_enf<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ENF_refl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> a_ENF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span>  <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sinvar_all_edges_normal_form_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
    <span class="keyword1"><span class="command">from</span></span> a_enf_refl ENF_refl_def <span class="keyword1"><span class="command">have</span></span> a_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> ENF_offending_members<span class="main">[</span><span class="operator">OF</span> a_not_eval a_enf a_offedning<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this a_refl <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> ENF_default_update_fst<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="quoted">"<span class="free">default_node_properties</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> modelInv<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   ENFdef<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   secdef<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> ENFdef <span class="keyword1"><span class="command">have</span></span> ENF<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span>  <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sinvar_all_edges_normal_form_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> modelInv ENF <span class="keyword1"><span class="command">have</span></span> modelInv'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this secdef <span class="keyword1"><span class="command">have</span></span> modelInv''<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> simpUpdateI<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">X</span><span class="main">.</span> <span class="main">∃</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">.</span><span class="main">¬</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∃</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">X</span><span class="main">.</span><span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command">using</span></span> secdef <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this modelInv' modelInv'' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> 
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="quoted">"<span class="free">default_node_properties</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> sinvar_all_edges_normal_form <span class="free">P</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span>  <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
    <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span>
    <span class="main">⟹</span> <span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a2d<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊥</span></span>"</span></span>
  
    <span class="keyword1"><span class="command">from</span></span> a2d <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span>  <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sinvar_all_edges_normal_form_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">from</span></span> ENF_default_update_fst<span class="main">[</span><span class="operator">OF</span> a1 a2d<span class="main">]</span> a3 <span class="keyword1"><span class="command">have</span></span> subgoal1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nP'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
    <span class="keyword1"><span class="command">from</span></span> subgoal1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e11</span></span> <span class="skolem"><span class="skolem">e21</span></span> <span class="keyword2"><span class="keyword">where</span></span> s1cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e11</span><span class="main">,</span> <span class="skolem">e21</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e11</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e21</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
    <span class="keyword1"><span class="command">from</span></span> s1cond <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">≠</span> <span class="skolem">e11</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e11</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e21</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> s1cond <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e11</span> <span class="main">≠</span> <span class="skolem">e21</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e11</span><span class="main">)</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e21</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> a4<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> s1cond a4 fun_upd_apply <span class="keyword1"><span class="command">have</span></span> ex1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e11</span> <span class="main">≠</span> <span class="skolem">e21</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e11</span><span class="main">)</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e21</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">from</span></span> s1cond a5 <span class="keyword1"><span class="command">have</span></span> ex2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e11</span> <span class="main">=</span> <span class="skolem">e21</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e11</span><span class="main">)</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e21</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
    <span class="keyword1"><span class="command">from</span></span> ex1 ex2 s1cond <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="var">?nP'</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this a2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="comment1">(* fsts version *)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span>  ENF_fsts_refl_instance<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="quoted">"<span class="free">default_node_properties</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> a_enf_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"ENF_refl <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="comment1">(*changed ⋀ to ∀*)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_i_fsts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> a_offending <span class="keyword1"><span class="command">have</span></span> a_not_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equals0D sinvar_no_offending<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> valid_without_offending_flows<span class="main">[</span><span class="operator">OF</span> a_offending<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a_offending_rm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">from</span></span> a_enf_refl <span class="keyword1"><span class="command">have</span></span> a_enf<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ENF_refl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span>  <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sinvar_all_edges_normal_form_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">from</span></span> ENF_offending_members<span class="main">[</span><span class="operator">OF</span> a_not_eval a_enf a_offending<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a_f_3_in_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nP'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
    <span class="comment1">(* obain from f *)</span>
    <span class="keyword1"><span class="command">from</span></span> offending_not_empty<span class="main">[</span><span class="operator">OF</span> a_offending<span class="main">]</span> ENF_offending_members<span class="main">[</span><span class="operator">OF</span> a_not_eval a_enf a_offending<span class="main">]</span> a_i_fsts hd_in_set
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> e1e2cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">∧</span> <span class="skolem">e1</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  
    <span class="keyword1"><span class="command">from</span></span> conjunct1<span class="main">[</span><span class="operator">OF</span> e1e2cond<span class="main">]</span> a_f_3_in_f <span class="keyword1"><span class="command">have</span></span> e1e2notP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this a3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this e1e2notP <span class="keyword1"><span class="command">have</span></span> e1e2subgoal1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">from</span></span> ENF_refl_not_offedning<span class="main">[</span><span class="operator">OF</span> a_not_eval a_offending a_enf_refl<span class="main">]</span> conjunct1<span class="main">[</span><span class="operator">OF</span> e1e2cond<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> ENF_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">≠</span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  
    <span class="keyword1"><span class="command">from</span></span> e1e2subgoal1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">≠</span> <span class="skolem">e2</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> conjunct2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e1e2cond<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">from</span></span> this ENF_refl ENF_offending_members<span class="main">[</span><span class="operator">OF</span> a_not_eval a_enf a_offending<span class="main">]</span>  conjunct1<span class="main">[</span><span class="operator">OF</span> e1e2cond<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="var">?nP'</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this a2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">(* snds version *)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span>  ENF_snds_refl_instance<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="quoted">"<span class="free">default_node_properties</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> a_enf_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"ENF_refl <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_i_snds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> a_offending <span class="keyword1"><span class="command">have</span></span> a_not_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equals0D sinvar_no_offending<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> valid_without_offending_flows<span class="main">[</span><span class="operator">OF</span> a_offending<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a_offending_rm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> a_enf_refl <span class="keyword1"><span class="command">have</span></span> a_enf<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> ENF_refl_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span>  <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> sinvar_all_edges_normal_form_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">from</span></span> ENF_offending_members<span class="main">[</span><span class="operator">OF</span> a_not_eval a_enf a_offending<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a_f_3_in_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nP'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  
    <span class="comment1">(* obain from f *)</span>
    <span class="keyword1"><span class="command">from</span></span> offending_not_empty<span class="main">[</span><span class="operator">OF</span> a_offending<span class="main">]</span> ENF_offending_members<span class="main">[</span><span class="operator">OF</span> a_not_eval a_enf a_offending<span class="main">]</span> a_i_snds hd_in_set
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> e1e2cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  
    <span class="keyword1"><span class="command">from</span></span> conjunct1<span class="main">[</span><span class="operator">OF</span> e1e2cond<span class="main">]</span> a_f_3_in_f <span class="keyword1"><span class="command">have</span></span> e1e2notP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this a3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main"><span class="free">⊥</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">from</span></span> this e1e2notP <span class="keyword1"><span class="command">have</span></span> e1e2subgoal1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">from</span></span> ENF_refl_not_offedning<span class="main">[</span><span class="operator">OF</span> a_not_eval a_offending a_enf_refl<span class="main">]</span> e1e2cond <span class="keyword1"><span class="command">have</span></span> ENF_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">≠</span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  
    <span class="keyword1"><span class="command">from</span></span> e1e2subgoal1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">≠</span> <span class="skolem">e2</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> conjunct2<span class="main"><span class="main">[</span></span><span class="operator">OF</span> e1e2cond<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  
    <span class="keyword1"><span class="command">from</span></span> this ENF_refl e1e2cond ENF_offending_members<span class="main">[</span><span class="operator">OF</span> a_not_eval a_enf a_offending<span class="main">]</span>  conjunct1<span class="main">[</span><span class="operator">OF</span> e1e2cond<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="var">?nP'</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this a2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>





<span class="comment1">(*ENF_sr*)</span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹edges normal form ENF with sender and receiver names›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> <span class="entity">sinvar_all_edges_normal_form_sr</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sinvar_all_edges_normal_form_sr</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
  

  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> ENFsr_monotonicity_sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> sinvar_all_edges_normal_form_sr <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span>
    sinvar_mono"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_all_edges_normal_form_sr_def sinvar_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Offending Flows:›</span></span>
  
  <span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> ENFsr_offending_set<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> ENFsr<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form_sr <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span> 
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_min_set_def is_offending_flows_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">case</span></span> False
   <span class="keyword1"><span class="command">from</span></span> ENFsr <span class="keyword1"><span class="command">have</span></span> ENFsr_offending_imp_not_P<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">F</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">F</span>  <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span>"</span></span>
     <span class="keyword1"><span class="command">unfolding</span></span> sinvar_all_edges_normal_form_sr_def
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_def is_offending_flows_min_set_def graph_ops<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command">from</span></span> ENFsr <span class="keyword1"><span class="command">have</span></span>  ENFsr_offending_set_P_representation<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>  <span class="main">⟹</span> <span class="bound">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> a b<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>set_offending_flows_def<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ENFsr_offending_imp_not_P<span class="main">)</span>
      <span class="keyword1"><span class="command">unfolding</span></span> sinvar_all_edges_normal_form_sr_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>set_offending_flows_def is_offending_flows_def is_offending_flows_min_set_def graph_ops<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> a b a1 b1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  

    <span class="keyword1"><span class="command">from</span></span> ENFsr False <span class="keyword1"><span class="command">have</span></span> ENFsr_offending_flows_exist<span class="main">:</span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> set_offending_flows_def is_offending_flows_min_set_def is_offending_flows_def sinvar_all_edges_normal_form_sr_def
            delete_edges_def add_edge_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> s r<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span><span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> ENFsr <span class="keyword1"><span class="command">have</span></span> ENFsr_offenindg_not_empty_imp_ENF_offending_subseteq_rhs<span class="main">:</span>
      <span class="quoted"><span class="quoted">"set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>  <span class="main">⟹</span>
      <span class="main">{</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span><span class="main">}</span> <span class="main">}</span> <span class="main">⊆</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
      <span class="keyword1"><span class="command">using</span></span> ENFsr_offending_set_P_representation
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> ENFsr <span class="keyword1"><span class="command">have</span></span> ENFsr_offending_subseteq_lhs<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>set_offending_flows <span class="free">G</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span> <span class="main">{</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span><span class="main">}</span> <span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">rule</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ENFsr_offending_set_P_representation<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> False ENFsr_offenindg_not_empty_imp_ENF_offending_subseteq_rhs<span class="main">[</span><span class="operator">OF</span> ENFsr_offending_flows_exist<span class="main">]</span> ENFsr_offending_subseteq_lhs <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?A</span> <span class="main">=</span> <span class="var">?B</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command">qed</span></span>
  



<span class="comment1">(*ENFnrSR*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹edges normal form not refl ENFnrSR›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> <span class="entity">sinvar_all_edges_normal_form_not_refl_SR</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sinvar_all_edges_normal_form_not_refl_SR</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> 
    <span class="main">∀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span><span class="main">)</span>"</span></span>



  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹we derive everything from the ENFnrSR form›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> ENFnrSR_to_ENFsr<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form_not_refl_SR <span class="free">P</span> <span class="main">⟹</span> sinvar_all_edges_normal_form_sr <span class="main">(</span><span class="main">λ</span> <span class="bound">p1</span> <span class="bound">v1</span> <span class="bound">p2</span> <span class="bound">v2</span><span class="main">.</span> <span class="bound">v1</span> <span class="main">≠</span> <span class="bound">v2</span> <span class="main">⟶</span> <span class="free">P</span> <span class="bound">p1</span> <span class="bound">v1</span> <span class="bound">p2</span> <span class="bound">v2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_all_edges_normal_form_sr_def sinvar_all_edges_normal_form_not_refl_SR_def<span class="main">)</span>
    


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Offending Flows›</span></span>
   <span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> ENFnrSR_offending_set<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> sinvar_all_edges_normal_form_not_refl_SR <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span>
    set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="bound">e1</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="bound">e2</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> ENFnrSR_to_ENFsr <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> ENFsr_offending_set<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Instance helper›</span></span>

  <span class="comment1">(* fsts version *)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span>  ENFnrSR_fsts_weakrefl_instance<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="quoted">"<span class="free">default_node_properties</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> a_enf<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form_not_refl_SR <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_weakrefl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="bound">s</span> <span class="main"><span class="free">⊥</span></span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_botdefault<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_alltobot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main"><span class="free">⊥</span></span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_i_fsts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> fst<span class="main">`</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> a_offending <span class="keyword1"><span class="command">have</span></span> a_not_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> ex_in_conv sinvar_no_offending<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> valid_without_offending_flows<span class="main">[</span><span class="operator">OF</span> a_offending<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a_offending_rm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> a_enf <span class="keyword1"><span class="command">have</span></span> a_enf'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span>  <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span> <span class="main">(</span>edges <span class="bound">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="bound">e1</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sinvar_all_edges_normal_form_not_refl_SR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">from</span></span> ENFnrSR_offending_set<span class="main">[</span><span class="operator">OF</span> a_enf<span class="main">]</span> a_not_eval a_offending <span class="keyword1"><span class="command">have</span></span> a_f_3_in_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">f</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="bound">e1</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="bound">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> ENFnrSR_offending_set<span class="main">[</span><span class="operator">OF</span> a_enf<span class="main">]</span> a_not_eval a_offending <span class="keyword1"><span class="command">have</span></span> a_f_3_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">f</span> <span class="main">⟹</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nP'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> ENFnrSR_offending_set<span class="main">[</span><span class="operator">OF</span> a_enf<span class="main">]</span> a_not_eval a_offending a_i_fsts
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> e1e2cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">∧</span> <span class="skolem">e1</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">from</span></span> conjunct1<span class="main">[</span><span class="operator">OF</span> e1e2cond<span class="main">]</span> a_offending <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def mem_Collect_eq rev_subsetD<span class="main">)</span>
  
    <span class="keyword1"><span class="command">from</span></span> conjunct1<span class="main">[</span><span class="operator">OF</span> e1e2cond<span class="main">]</span> a_f_3_in_f <span class="keyword1"><span class="command">have</span></span> e1e2notP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span> <span class="skolem">e1</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e2</span><span class="main">)</span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> e1e2notP a_weakrefl <span class="keyword1"><span class="command">have</span></span> e1ore2neqbot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span> <span class="main">∨</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> e1e2notP a_alltobot <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">nP</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> this e1e2notP a_botdefault <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="skolem">e1</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e2</span><span class="main">)</span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this e1e2notP <span class="keyword1"><span class="command">have</span></span> e1e2subgoal1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e1</span><span class="main">)</span> <span class="skolem">e1</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e2</span><span class="main">)</span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> a_f_3_neq e1e2cond <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">≠</span> <span class="skolem">e1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
    <span class="keyword1"><span class="command">from</span></span> e1e2subgoal1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">≠</span> <span class="skolem">e2</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e1</span><span class="main">)</span> <span class="skolem">e1</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e2</span><span class="main">)</span> <span class="skolem">e2</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> e1e2cond<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">e2</span> <span class="main">≠</span> <span class="skolem">e1</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e1</span><span class="main">)</span> <span class="skolem">e1</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e2</span><span class="main">)</span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">e2</span> <span class="main">≠</span> <span class="skolem">e1</span>›</span></span> ENFnrSR_offending_set<span class="main">[</span><span class="operator">OF</span> a_enf<span class="main">]</span> a_offending <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">e2</span> <span class="main">≠</span> <span class="bound">e1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="bound">e1</span><span class="main">)</span> <span class="bound">e1</span> <span class="main">(</span><span class="var">?nP'</span> <span class="bound">e2</span><span class="main">)</span> <span class="bound">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">e2</span> <span class="main">≠</span> <span class="bound">e1</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e1</span><span class="main">)</span> <span class="bound">e1</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e2</span><span class="main">)</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this a_enf' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>



  <span class="comment1">(* snds version *)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span>  ENFnrSR_snds_weakrefl_instance<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="quoted">"<span class="free">default_node_properties</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> a_enf<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form_not_refl_SR <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_weakrefl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="bound">s</span> <span class="main"><span class="free">⊥</span></span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_botdefault<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main"><span class="free">⊥</span></span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_bottoall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_i_snds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> snd<span class="main">`</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> a_offending <span class="keyword1"><span class="command">have</span></span> a_not_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> equals0D sinvar_no_offending<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> valid_without_offending_flows<span class="main">[</span><span class="operator">OF</span> a_offending<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a_offending_rm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> a_enf <span class="keyword1"><span class="command">have</span></span> a_enf'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span>  <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>edges <span class="bound">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="bound">e1</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> sinvar_all_edges_normal_form_not_refl_SR_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">from</span></span> ENFnrSR_offending_set<span class="main">[</span><span class="operator">OF</span> a_enf<span class="main">]</span> a_not_eval a_offending <span class="keyword1"><span class="command">have</span></span> a_f_3_in_f<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">∈</span><span class="free">f</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> ENFnrSR_offending_set<span class="main">[</span><span class="operator">OF</span> a_enf<span class="main">]</span> a_not_eval a_offending <span class="keyword1"><span class="command">have</span></span> a_f_3_neq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span><span class="main">∈</span><span class="free">f</span> <span class="main">⟹</span> <span class="bound">s</span> <span class="main">≠</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?nP'</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> ENFnrSR_offending_set<span class="main">[</span><span class="operator">OF</span> a_enf<span class="main">]</span> a_not_eval a_offending a_i_snds
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e1</span></span> <span class="skolem"><span class="skolem">e2</span></span> <span class="keyword2"><span class="keyword">where</span></span> e1e2cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">f</span> <span class="main">∧</span> <span class="skolem">e2</span> <span class="main">=</span> <span class="free">i</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">from</span></span> conjunct1<span class="main">[</span><span class="operator">OF</span> e1e2cond<span class="main">]</span> a_offending <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def mem_Collect_eq rev_subsetD<span class="main">)</span>
  
    <span class="keyword1"><span class="command">from</span></span> conjunct1<span class="main">[</span><span class="operator">OF</span> e1e2cond<span class="main">]</span> a_f_3_in_f <span class="keyword1"><span class="command">have</span></span> e1e2notP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span> <span class="skolem">e1</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e2</span><span class="main">)</span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">from</span></span> e1e2notP a_weakrefl <span class="keyword1"><span class="command">have</span></span> e1ore2neqbot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span> <span class="main">∨</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> e1e2notP a_bottoall <span class="keyword1"><span class="command">have</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> this e1e2notP a_botdefault <span class="keyword1"><span class="command">have</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span> <span class="skolem">e1</span> <span class="main"><span class="free">⊥</span></span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this e1e2notP <span class="keyword1"><span class="command">have</span></span> e1e2subgoal1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span> <span class="skolem">e1</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e2</span><span class="main">)</span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> a_f_3_neq e1e2cond <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e2</span> <span class="main">≠</span> <span class="skolem">e1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
    <span class="keyword1"><span class="command">from</span></span> e1e2subgoal1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e1</span> <span class="main">≠</span> <span class="skolem">e2</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e1</span><span class="main">)</span> <span class="skolem">e1</span> <span class="main">(</span><span class="var">?nP'</span> <span class="skolem">e2</span><span class="main">)</span> <span class="skolem">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> e1e2cond<span class="main">)</span>
  
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">e2</span> <span class="main">≠</span> <span class="skolem">e1</span>›</span></span> ENFnrSR_offending_set<span class="main">[</span><span class="operator">OF</span> a_enf<span class="main">]</span> a_offending <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">e2</span> <span class="main">≠</span> <span class="bound">e1</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="var">?nP'</span> <span class="bound">e1</span><span class="main">)</span> <span class="bound">e1</span> <span class="main">(</span><span class="var">?nP'</span> <span class="bound">e2</span><span class="main">)</span> <span class="bound">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">e2</span> <span class="main">≠</span> <span class="bound">e1</span> <span class="main">⟶</span> <span class="free">P</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e1</span><span class="main">)</span> <span class="bound">e1</span> <span class="main">(</span><span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span> <span class="bound">e2</span><span class="main">)</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> this a_enf' <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>




<span class="comment1">(*ENFnr*)</span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹edges normal form not refl ENFnr›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> <span class="entity">sinvar_all_edges_normal_form_not_refl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'a</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sinvar_all_edges_normal_form_not_refl</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="bound">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹we derive everything from the ENFnrSR form›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> ENFnr_to_ENFnrSR<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form_not_refl <span class="free">P</span> <span class="main">⟹</span> sinvar_all_edges_normal_form_not_refl_SR <span class="main">(</span><span class="main">λ</span> <span class="bound">v1</span> <span class="main"><span class="bound">_</span></span> <span class="bound">v2</span> <span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="free">P</span> <span class="bound">v1</span> <span class="bound">v2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_all_edges_normal_form_not_refl_def sinvar_all_edges_normal_form_not_refl_SR_def<span class="main">)</span>

  <span class="comment1">(*most of results are now implied from previous lemma*)</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Offending Flows›</span></span>
   <span class="keyword1"><span class="command">theorem</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span> ENFnr_offending_set<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> sinvar_all_edges_normal_form_not_refl <span class="free">P</span> <span class="main">⟧</span> <span class="main">⟹</span>
    set_offending_flows <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">∧</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> ENFnr_to_ENFnrSR<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> ENFnrSR_offending_set<span class="main">)</span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Instance helper›</span></span>
  <span class="comment1">(* fsts version *)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span>  ENFnr_fsts_weakrefl_instance<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="quoted">"<span class="free">default_node_properties</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> a_enf<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form_not_refl <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_botdefault<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="bound">e2</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="bound">e2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_alltobot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e1</span><span class="main">.</span> <span class="free">P</span> <span class="bound">e1</span> <span class="main"><span class="free">⊥</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_i_fsts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> fst<span class="main">`</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> ENFnr_to_ENFnrSR<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> ENFnrSR_fsts_weakrefl_instance<span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="comment1">(* snds version *)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span>  ENFnr_snds_weakrefl_instance<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="quoted">"<span class="free">default_node_properties</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> a_enf<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form_not_refl <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_botdefault<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">e1</span> <span class="main"><span class="free">⊥</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_bottoall<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e2</span><span class="main">.</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="bound">e2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_i_snds<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> snd<span class="main">`</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> ENFnr_to_ENFnrSR<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> ENFnrSR_snds_weakrefl_instance<span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">qed</span></span>
 



  <span class="comment1">(* snds version DRAFT*)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_withOffendingFlows<span class="main">)</span>  ENF_weakrefl_instance_FALSE<span class="main">:</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="quoted">"<span class="free">default_node_properties</span>"</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> a_wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_not_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_enf<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar_all_edges_normal_form <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_weakrefl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="main"><span class="free">⊥</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_botisolated<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">e2</span><span class="main">.</span> <span class="bound">e2</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="main"><span class="free">⊥</span></span> <span class="bound">e2</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_botdefault<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="main"><span class="free">⊥</span></span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">e1</span> <span class="main"><span class="free">⊥</span></span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">∈</span> set_offending_flows <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_offending_rm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">f</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_i_fsts<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">i</span> <span class="main">∈</span> snd<span class="main">`</span> <span class="free">f</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   a_not_eval_upd<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="free">G</span> <span class="main">(</span><span class="free">nP</span><span class="main">(</span><span class="free">i</span> <span class="main">:=</span> <span class="main"><span class="free">⊥</span></span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"False"</span></span>
<span class="keyword1"><span class="command">oops</span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="vertex_example_simps">
<div class="head">
<h1>Theory vertex_example_simps</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> vertex_example_simps
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="FiniteGraph.html">Lib/FiniteGraph</a>"</span> <a href="TopoS_Vertices.html">TopoS_Vertices</a>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="comment1">(*&lt;*)</span>
<span class="comment1">― ‹The follwoing lemmata are used in the @{text "∃"}-style uniqueness proof›</span>
<span class="keyword1" id="vertex_example_simps-False_set"><span class="command">lemma</span></span> False_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> False<span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="vertex_example_simps-succ_tran_empty"><span class="command">lemma</span></span> succ_tran_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span><span class="main">⦈</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
<span class="keyword1" id="vertex_example_simps-vertex_1_vertex_2_set_simp"><span class="command">lemma</span></span> vertex_1_vertex_2_set_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">,</span> vertex_1<span class="main">,</span> vertex_2<span class="main">}</span> <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="vertex_example_simps-unique_default_example1"><span class="command">lemma</span></span> unique_default_example1<span class="main">:</span> <span class="quoted"><span class="quoted">"succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> vertex_1 <span class="main">=</span> <span class="main">{</span>vertex_2<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Collect_cong Range.intros Range_empty Range_insert mem_Collect_eq singleton_conv singleton_iff trancl.r_into_trancl trancl_range<span class="main">)</span>
<span class="keyword1" id="vertex_example_simps-unique_default_example2"><span class="command">lemma</span></span> unique_default_example2<span class="main">:</span> <span class="quoted"><span class="quoted">"succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_2<span class="main">,</span> vertex_1<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> vertex_1 <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Domain.DomainI Domain_empty Domain_insert distinct_vertices12 singleton_iff trancl_domain<span class="main">)</span>
<span class="keyword1" id="vertex_example_simps-unique_default_example3"><span class="command">lemma</span></span> unique_default_example3<span class="main">:</span> <span class="quoted"><span class="quoted">"succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_2<span class="main">,</span> vertex_1<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> vertex_2 <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Collect_cong Range.intros Range_empty Range_insert mem_Collect_eq singleton_conv singleton_iff trancl.r_into_trancl trancl_range<span class="main">)</span>
<span class="keyword1" id="vertex_example_simps-unique_default_example_simp1"><span class="command">lemma</span></span> unique_default_example_simp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">=</span> vertex_1 <span class="main">∧</span> <span class="bound">e2</span> <span class="main">=</span> vertex_2 <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">=</span> vertex_1 <span class="main">⟶</span> <span class="bound">e2</span> <span class="main">≠</span> vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="vertex_example_simps-unique_default_example_simp2"><span class="command">lemma</span></span> unique_default_example_simp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">λ</span> <span class="bound">a</span> <span class="bound">b</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> vertex_1 <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> vertex_2"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl.induct<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1" id="vertex_example_simps-unique_default_example_simp3"><span class="command">lemma</span></span> unique_default_example_simp3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">=</span> vertex_2 <span class="main">∧</span> <span class="bound">e2</span> <span class="main">=</span> vertex_1 <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">=</span> vertex_2 <span class="main">⟶</span> <span class="bound">e2</span> <span class="main">≠</span> vertex_1<span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> 
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
<span class="keyword1" id="vertex_example_simps-vertex_set_simp2"><span class="command">lemma</span></span> vertex_set_simp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span>vertex_2<span class="main">,</span> vertex_1<span class="main">,</span> vertex_2<span class="main">}</span> <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="vertex_example_simps-canAccessThis_simp1"><span class="command">lemma</span></span> canAccessThis_simp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">canAccessThis</span> <span class="main">≠</span> vertex_1 <span class="main">⟹</span> succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> <span class="free">canAccessThis</span><span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> <span class="free">canAccessThis</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span> vertex_1 <span class="main">=</span> <span class="main">{</span><span class="free">canAccessThis</span><span class="main">}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Collect_cong Range.intros Range_empty Range_insert mem_Collect_eq singleton_conv singleton_iff trancl.r_into_trancl trancl_range<span class="main">)</span>
<span class="keyword1" id="vertex_example_simps-canAccessThis_simp2"><span class="command">lemma</span></span> canAccessThis_simp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">canAccessThis</span> <span class="main">≠</span> vertex_1 <span class="main">⟹</span> succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> <span class="free">canAccessThis</span><span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> <span class="free">canAccessThis</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="free">canAccessThis</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Domain.DomainI Domain_empty Domain_insert singleton_iff trancl_domain<span class="main">)</span>
<span class="keyword1" id="vertex_example_simps-canAccessThis_simp3"><span class="command">lemma</span></span> canAccessThis_simp3<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">canAccessThis</span> <span class="main">≠</span> vertex_1 <span class="main">⟹</span> <span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">=</span> vertex_1 <span class="main">∧</span> <span class="bound">e2</span> <span class="main">=</span> <span class="free">canAccessThis</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">=</span> vertex_1 <span class="main">⟶</span> <span class="bound">e2</span> <span class="main">≠</span> <span class="free">canAccessThis</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1" id="vertex_example_simps-canAccessThis_simp4"><span class="command">lemma</span></span> canAccessThis_simp4<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="free">canAccessThis</span> <span class="main">≠</span> vertex_1 <span class="main">⟹</span> <span class="main">{</span>vertex_1<span class="main">,</span> <span class="free">canAccessThis</span><span class="main">,</span> vertex_1<span class="main">,</span> <span class="free">canAccessThis</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> <span class="free">canAccessThis</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemmas</span></span> example_simps <span class="main">=</span> unique_default_example_simp1 unique_default_example2 unique_default_example3 
    unique_default_example_simp2 unique_default_example1 succ_tran_empty vertex_1_vertex_2_set_simp
    unique_default_example_simp3 vertex_set_simp2 canAccessThis_simp1 canAccessThis_simp2 canAccessThis_simp3
    canAccessThis_simp4
<span class="comment1">(*&gt;*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Helper">
<div class="head">
<h1>Theory TopoS_Helper</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Helper
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <a href="TopoS_Interface.html">TopoS_Interface</a> 
  <a href="TopoS_ENF.html">TopoS_ENF</a>
  <a href="vertex_example_simps.html">vertex_example_simps</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_preliminaries<span class="main">)</span> sinvar_valid_remove_flattened_offending_flows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span>"</span></span> <span class="comment1">(*TODO: we could get rid of this assumption*)</span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span> <span class="main">-</span> <span class="main">⋃</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">∈</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> SecurityInvariant_withOffendingFlows.valid_without_offending_flows delete_edges_simp2 graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> graph.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">edgesG</span> <span class="main">-</span> <span class="main">⋃</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">edgesG</span> <span class="main">-</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">note</span></span> 1 2
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Diff_empty Union_empty defined_offending equals0I mono_sinvar wf_graph_remove_edges<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_preliminaries<span class="main">)</span> sinvar_valid_remove_SOME_offending_flows<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">∈</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> SecurityInvariant_withOffendingFlows.valid_without_offending_flows delete_edges_simp2 graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> graph.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">edgesG</span> <span class="main">-</span> <span class="main">⋃</span> <span class="main">(</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">edgesG</span> <span class="main">-</span> <span class="skolem">f</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">note</span></span> 1 2
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> some_in_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> SecurityInvariant_preliminaries<span class="main">)</span> sinvar_valid_remove_minimalize_offending_overapprox<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span> <span class="comment1">(*"set_offending_flows ⦇nodes = nodesG, edges = edgesG⦈ nP ≠ {}"*)</span>
      <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"set <span class="free">Es</span> <span class="main">=</span> <span class="free">edgesG</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"distinct <span class="free">Es</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span> <span class="main">-</span>
              set <span class="main">(</span>minimalize_offending_overapprox <span class="free">Es</span> <span class="main">[]</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
  <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> off_Es<span class="main">:</span> <span class="quoted"><span class="quoted">"is_offending_flows <span class="main">(</span>set <span class="free">Es</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Diff_cancel
        SecurityInvariant_withOffendingFlows.valid_empty_edges_iff_exists_offending_flows defined_offending
        delete_edges_simp2 graph.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> is_offending_flows_def sinvar_monoI<span class="main">)</span> 
  <span class="keyword1"><span class="command">from</span></span> minimalize_offending_overapprox_gives_back_an_offending_flow<span class="main">[</span><span class="operator">OF</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> off_Es _ assms<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
    in_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>minimalize_offending_overapprox <span class="free">Es</span> <span class="main">[]</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span><span class="main">)</span>
      <span class="main">∈</span> set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
     <span class="keyword1"><span class="command">using</span></span> assms<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">f</span>
    <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span><span class="main">∈</span>set_offending_flows <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
    <span class="keyword1"><span class="command">from</span></span> * <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">nodesG</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">edgesG</span> <span class="main">-</span> <span class="skolem">f</span> <span class="main">⦈</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> mono_tags<span class="main"><span class="main">)</span></span> SecurityInvariant_withOffendingFlows.valid_without_offending_flows delete_edges_simp2 graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> graph.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> 1
  <span class="keyword1"><span class="command">}</span></span>
  <span class="keyword1"><span class="command">with</span></span> in_offending <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> some_in_eq<span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Subnets2">
<div class="head">
<h1>Theory SINVAR_Subnets2</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Subnets2
<span class="keyword2"><span class="keyword">imports</span></span><span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(*EXPERIMENTAL!!*)</span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Subnets2›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Warning, This is just a test. Please look at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹SINVAR_Subnets.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
This security invariant has the following changes, compared to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹SINVAR_Subnets.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>:
A new BorderRouter' is introduced which can send to the members of its subnet.
A new InboundRouter is accessible by anyone. It can access all other routers and the outside.
›</span></span>


<span class="keyword1"><span class="command">datatype</span></span> subnets <span class="main">=</span> Subnet <span class="quoted">nat</span> <span class="main">|</span> BorderRouter <span class="quoted">nat</span> <span class="main">|</span> BorderRouter' <span class="quoted">nat</span> <span class="main">|</span> InboundRouter <span class="main">|</span> Unassigned

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"subnets"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> Unassigned"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">allowed_subnet_flow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"subnets <span class="main">⇒</span> subnets <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>Subnet <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span>Subnet <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>Subnet <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span>BorderRouter <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>Subnet <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span>BorderRouter' <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>Subnet <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>BorderRouter <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">(</span>Subnet <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>BorderRouter <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>BorderRouter' <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span>Subnet <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>BorderRouter' <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> InboundRouter <span class="main">(</span>Subnet <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> InboundRouter <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> Unassigned Unassigned  <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> Unassigned InboundRouter  <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> Unassigned <span class="main"><span class="bound"><span class="entity">_</span></span></span>  <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> subnets<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> allowed_subnet_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">=</span> False"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Only members of the same subnet or their <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> BorderRouter'<span class="antiquote"><span class="antiquote">}</span></span></span></span> can access them.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"allowed_subnet_flow <span class="free">a</span> <span class="main">(</span>Subnet <span class="free">s1</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span>BorderRouter' <span class="free">s1</span><span class="main">)</span> <span class="main">∨</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span>Subnet <span class="free">s1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>
  <span class="keyword1" id="SINVAR_Subnets2-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>




<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹ENF›</span></span>
  <span class="keyword1" id="SINVAR_Subnets2-All_to_Unassigned"><span class="command">lemma</span></span> All_to_Unassigned<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e1</span><span class="main">.</span> allowed_subnet_flow <span class="bound">e1</span> Unassigned"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">e1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_Subnets2-Unassigned_default_candidate"><span class="command">lemma</span></span> Unassigned_default_candidate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">nP</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> allowed_subnet_flow <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> allowed_subnet_flow Unassigned <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nP</span> <span class="improper">e2</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nP</span> <span class="improper">e1</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> All_to_Unassigned<span class="main">)</span>
  <span class="keyword1" id="SINVAR_Subnets2-allowed_subnet_flow_refl"><span class="command">lemma</span></span> allowed_subnet_flow_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e</span><span class="main">.</span> allowed_subnet_flow <span class="bound">e</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">e</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_Subnets2-Subnets_ENF"><span class="command">lemma</span></span> Subnets_ENF<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form sinvar allowed_subnet_flow"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1" id="SINVAR_Subnets2-Subnets_ENF_refl"><span class="command">lemma</span></span> Subnets_ENF_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.ENF_refl sinvar allowed_subnet_flow"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.ENF_refl_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Subnets_ENF<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allowed_subnet_flow_refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">Subnets_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> subnets<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Subnets_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> allowed_subnet_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="SINVAR_Subnets2-Subnets_offending_set"><span class="command">lemma</span></span> Subnets_offending_set<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> Subnets_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_eq_iff ENF_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Subnets_ENF<span class="main"><span class="main">]</span></span> Subnets_offending_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> G nP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">interpretation</span></span> Subnets<span class="main">:</span> SecurityInvariant_ACS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">SINVAR_Subnets2.default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">SINVAR_Subnets2.sinvar</span>
<span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> Subnets_offending_set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SINVAR_Subnets2.default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SecurityInvariant_withOffendingFlows.ENF_fsts_refl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Subnets_ENF_refl Unassigned_default_candidate<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">otherbot</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> mysubnetcase<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> BorderRouter <span class="improper">mysubnetcase</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> BorderRouter <span class="free">whatever</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> BorderRouter <span class="free">whatever</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> BorderRouter <span class="free">whatever</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> Subnets_offending_set<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1" id="SINVAR_Subnets2-TopoS_Subnets2"><span class="command">lemma</span></span> TopoS_Subnets2<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>


<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar_mono   
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_BLPstrict">
<div class="head">
<h1>Theory SINVAR_BLPstrict</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_BLPstrict
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Stricter Bell LaPadula SecurityInvariant›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹All unclassified data sources must be labeled, default assumption: all is secret.

Warning: This is considered here an access control strategy.
By default, everything is secret and one explicitly prohibits sending to non-secret hosts.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> security_level <span class="main">=</span> Unclassified <span class="main">|</span> Confidential <span class="main">|</span> Secret

<span class="comment1">(*total order*)</span>
<span class="keyword1"><span class="command">instantiation</span></span> security_level <span class="main">::</span> <span class="quoted">linorder</span>
  <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_security_level</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"security_level <span class="main">⇒</span> security_level <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Unclassified <span class="main">≤</span> Unclassified<span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Confidential <span class="main">≤</span> Confidential<span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Secret <span class="main">≤</span> Secret<span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Unclassified <span class="main">≤</span> Confidential<span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Confidential <span class="main">≤</span> Secret<span class="main">)</span> <span class="main">=</span> True"</span></span>  <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Unclassified <span class="main">≤</span> Secret<span class="main">)</span> <span class="main">=</span> True"</span></span>  <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Secret <span class="main">≤</span> Confidential<span class="main">)</span> <span class="main">=</span> False"</span></span>  <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Confidential <span class="main">≤</span> Unclassified<span class="main">)</span> <span class="main">=</span> False"</span></span>  <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Secret <span class="main">≤</span> Unclassified<span class="main">)</span> <span class="main">=</span> False"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_security_level</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"security_level <span class="main">⇒</span> security_level <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Unclassified <span class="main">&lt;</span> Unclassified<span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Confidential <span class="main">&lt;</span> Confidential<span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Secret <span class="main">&lt;</span> Secret<span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Unclassified <span class="main">&lt;</span> Confidential<span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Confidential <span class="main">&lt;</span> Secret<span class="main">)</span> <span class="main">=</span> True"</span></span>  <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Unclassified <span class="main">&lt;</span> Secret<span class="main">)</span> <span class="main">=</span> True"</span></span>  <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Secret <span class="main">&lt;</span> Confidential<span class="main">)</span> <span class="main">=</span> False"</span></span>  <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Confidential <span class="main">&lt;</span> Unclassified<span class="main">)</span> <span class="main">=</span> False"</span></span>  <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span>Secret <span class="main">&lt;</span> Unclassified<span class="main">)</span> <span class="main">=</span> False"</span></span>
  <span class="keyword1"><span class="command">instance</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span>  <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">y</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span>  <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper"><span class="quoted"><span class="improper">z</span></span></span></span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword2"><span class="keyword">end</span></span>
  


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"security_level"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> Secret"</span></span>



<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> security_level<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">≡</span> False"</span></span>


<span class="keyword1" id="SINVAR_BLPstrict-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
<span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹ENF›</span></span>
  <span class="keyword1" id="SINVAR_BLPstrict-secret_default_candidate"><span class="command">lemma</span></span> secret_default_candidate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> security_level<span class="main">)</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> Secret <span class="main">≤</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nP</span> <span class="improper">e1</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"<span class="improper"><span class="improper">nP</span></span> <span class="improper"><span class="improper">e2</span></span>"</span></span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1" id="SINVAR_BLPstrict-BLP_ENF"><span class="command">lemma</span></span> BLP_ENF<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form sinvar <span class="main">(≤)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1" id="SINVAR_BLPstrict-BLP_ENF_refl"><span class="command">lemma</span></span> BLP_ENF_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.ENF_refl sinvar <span class="main">(≤)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.ENF_refl_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_ENF<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLP_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> security_level<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">BLP_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="SINVAR_BLPstrict-BLP_offending_set"><span class="command">lemma</span></span> BLP_offending_set<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> BLP_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_eq_iff SecurityInvariant_withOffendingFlows.ENF_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> BLP_ENF<span class="main"><span class="main">]</span></span> BLP_offending_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> G nP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   
  <span class="keyword1"><span class="command">interpretation</span></span> BLPstrict<span class="main">:</span> SecurityInvariant_ACS <span class="quoted">sinvar</span> <span class="quoted">default_node_properties</span>
  <span class="comment1">(*TODO: why is there a where and no "rewrites" in the afp?*)</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> BLP_offending_set"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> default_node_properties_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> SecurityInvariant_withOffendingFlows.ENF_fsts_refl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> BLP_ENF_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_ENF BLP_ENF_refl<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secret_default_candidate<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span>set <span class="main">[</span>vertex_1<span class="main">,</span>vertex_2<span class="main">]</span><span class="main">,</span> edges <span class="main">=</span> set <span class="main">[</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_offending_set graph_ops wf_graph_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Secret<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Secret<span class="main">,</span> vertex_2 <span class="main">:=</span> Confidential<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_offending_set_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">otherbot</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> BLP_offending_set<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1" id="SINVAR_BLPstrict-TopoS_BLPstrict"><span class="command">lemma</span></span> TopoS_BLPstrict<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
   
<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar_mono   

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Tainting">
<div class="head">
<h1>Theory SINVAR_Tainting</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Tainting
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Tainting for IFS›</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">type_synonym</span></span> taints <span class="main">=</span> <span class="quoted"><span class="quoted">"string set"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Warning: an infinite set has cardinality 0›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span>UNIV<span class="main">::</span>taints<span class="main">)</span> <span class="main">=</span> <span class="main">0</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> infinite_UNIV_listI<span class="main">)</span> 
  
  <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"taints"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> <span class="main">{}</span>"</span></span>
  
  
  <span class="comment1">(*The definition we want to present*)</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹For all nodes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> in the graph, for all nodes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> which are reachable from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>,
        node <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">n</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> needs the appropriate tainting fields which are set by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">r</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">sinvar_tainting</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> taints<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sinvar_tainting</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">(</span>nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="main">(</span>succ_tran <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">n</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">r</span>"</span></span>
  
  
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SINVAR_Tainting-sinvar_tainting_edges_def"><span class="command">lemma</span></span> sinvar_tainting_edges_def<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span>
    sinvar_tainting <span class="free">G</span> <span class="free">nP</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">r</span> <span class="main">∈</span> <span class="main">(</span>succ_tran <span class="free">G</span> <span class="bound">v1</span><span class="main">)</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v1</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="bound">r</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> sinvar_tainting_def
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>  a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">r</span><span class="main">∈</span>succ_tran <span class="free">G</span> <span class="bound">n</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">n</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="bound">r</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> a1<span class="main">[</span><span class="operator">simplified</span> wf_graph_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> edges <span class="free">G</span> <span class="main">⊆</span> nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> f1 a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">`</span> edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">r</span><span class="main">∈</span>succ_tran <span class="free">G</span> <span class="bound">v</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">r</span><span class="main">∈</span>succ_tran <span class="free">G</span> <span class="bound">v1</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v1</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>  a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">r</span><span class="main">∈</span>succ_tran <span class="free">G</span> <span class="bound">v1</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v1</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="bound">r</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">`</span> edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">r</span><span class="main">∈</span>succ_tran <span class="free">G</span> <span class="bound">v</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">from</span></span> FiniteGraph.succ_tran_empty<span class="main">[</span><span class="operator">OF</span> a1<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="main">(</span>fst <span class="main">`</span> edges <span class="free">G</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span><span class="main">∈</span>succ_tran <span class="free">G</span> <span class="bound">v</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="bound">r</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> g1 g2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">n</span><span class="main">∈</span>nodes <span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">r</span><span class="main">∈</span>succ_tran <span class="free">G</span> <span class="bound">n</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">n</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="bound">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Alternative definition of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> sinvar_tainting<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
  
  <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> taints<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v1</span> <span class="main">⊆</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v2</span>"</span></span>
  
  
  <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1" id="SINVAR_Tainting-sinvar_preferred_def"><span class="command">lemma</span></span> sinvar_preferred_def<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> sinvar_tainting <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> sinvar <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> sinvar_tainting_edges_def sinvar_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> 2
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟹</span> <span class="free">nP</span> <span class="skolem">v</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="skolem">v'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="skolem">v'</span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> trancl_induct<span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> base <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> step <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span> wf_graph_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> edges <span class="free">G</span> <span class="main">⊆</span> nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> f1 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">`</span> edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v'</span><span class="main">∈</span>succ_tran <span class="free">G</span> <span class="bound">v</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="bound">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> succ_tran_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>
  
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Information Flow Security›</span></span>
  <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">≡</span> True"</span></span>
  
  
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SINVAR_Tainting-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def sinvar_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">G</span> <span class="skolem">nP</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_def SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">N</span> <span class="skolem">E</span> <span class="skolem">E'</span> <span class="skolem">nP</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_def<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  
  
  <span class="keyword2"><span class="keyword">private</span></span>  <span class="keyword1" id="SINVAR_Tainting-Taints_def_unique"><span class="command">lemma</span></span> Taints_def_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
      <span class="main">∃</span><span class="bound">G</span> <span class="bound">p</span> <span class="bound">i</span> <span class="bound">f</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="main">¬</span> sinvar <span class="bound">G</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> <span class="main">(</span>SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="bound">G</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span>
         sinvar <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">f</span><span class="main">)</span> <span class="bound">p</span> <span class="main">∧</span>
          <span class="bound">i</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="bound">f</span> <span class="main">∧</span> sinvar <span class="bound">G</span> <span class="main">(</span><span class="bound">p</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
        SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
        SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span>set <span class="main">[</span>vertex_1<span class="main">,</span>vertex_2<span class="main">]</span><span class="main">,</span> edges <span class="main">=</span> set <span class="main">[</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">foo</span><span class="main">.</span> <span class="bound">foo</span> <span class="main">∈</span> <span class="free">otherbot</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> foo<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">{}</span><span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> <span class="main">{</span><span class="improper">foo</span><span class="main">}</span><span class="main">,</span> vertex_2 <span class="main">:=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_2"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  
  
  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ENF›</span></span>
    <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SINVAR_Tainting-Taints_ENF"><span class="command">lemma</span></span> Taints_ENF<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form sinvar <span class="main">(⊆)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_def sinvar_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SINVAR_Tainting-Taints_ENF_refl"><span class="command">lemma</span></span> Taints_ENF_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.ENF_refl sinvar <span class="main">(⊆)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.ENF_refl_def
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Taints_ENF<span class="main">)</span>
  
    <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">Taints_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> taints<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Taints_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
        <span class="main">{}</span>
       <span class="keyword1">else</span> 
        <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1" id="SINVAR_Tainting-Taints_offending_set"><span class="command">lemma</span></span> Taints_offending_set<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> Taints_offending_set"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff
                        SecurityInvariant_withOffendingFlows.ENF_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Taints_ENF<span class="main"><span class="main">]</span></span>
                        Taints_offending_set_def<span class="main">)</span>
     
  
    <span class="keyword1"><span class="command">interpretation</span></span> Taints<span class="main">:</span> SecurityInvariant_IFS <span class="quoted">sinvar</span> <span class="quoted">default_node_properties</span>
    <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> Taints_offending_set"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def
      <span class="keyword1"><span class="command">unfolding</span></span> default_node_properties_def
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1
        <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> SecurityInvariant_withOffendingFlows.ENF_snds_refl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Taints_ENF_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Taints_ENF Taints_ENF_refl<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> default_uniqueness_by_counterexample_IFS<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">fact</span> Taints_def_unique<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="main">=</span> Taints_offending_set"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> Taints_offending_set<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
  
  
    <span class="keyword1" id="SINVAR_Tainting-TopoS_Tainting"><span class="command">lemma</span></span> TopoS_Tainting<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_BLPbasic">
<div class="head">
<h1>Theory SINVAR_BLPbasic</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_BLPbasic
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Basic Bell LaPadula›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> security_level <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"security_level"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> security_level<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹What we call a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">security_level</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is also referred to as security label
(or security clearance of subjects and classification of objects) in the literature. 
The lowest security level is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">0</span></span><span class="main"><span class="main">::</span></span>nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, which can be understood as unclassified.
Consequently, 1 = confidential, 2 = secret, 3 = topSecret, .... 
The total order of the security levels corresponds to the total order of the natural numbers <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>≤›</span></span></span></span>. 
It is important that there is smallest security level (i.e. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> default_node_properties<span class="antiquote"><span class="antiquote">}</span></span></span></span>), 
otherwise, a unique and secure default parameter could not exist. 
Hence, it is not possible to extend the security levels to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">int</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to model unlimited ``un-confidentialness''. 
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">≡</span> True"</span></span>


<span class="keyword1" id="SINVAR_BLPbasic-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
<span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="SINVAR_BLPbasic-BLP_def_unique"><span class="command">lemma</span></span> BLP_def_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">≠</span> <span class="main">0</span> <span class="main">⟹</span>
    <span class="main">∃</span><span class="bound">G</span> <span class="bound">p</span> <span class="bound">i</span> <span class="bound">f</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="main">¬</span> sinvar <span class="bound">G</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> <span class="main">(</span>SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="bound">G</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span>
       sinvar <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">f</span><span class="main">)</span> <span class="bound">p</span> <span class="main">∧</span>
        <span class="bound">i</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="bound">f</span> <span class="main">∧</span> sinvar <span class="bound">G</span> <span class="main">(</span><span class="bound">p</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span>set <span class="main">[</span>vertex_1<span class="main">,</span>vertex_2<span class="main">]</span><span class="main">,</span> edges <span class="main">=</span> set <span class="main">[</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> <span class="main">1</span><span class="main">,</span> vertex_2 <span class="main">:=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_2"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(*Test instantiation without any fancy lemmata*)</span>
<span class="comment1">(*
interpretation SecurityInvariant
where default_node_properties = default_node_properties
and sinvar = sinvar
and receiver_violation = receiver_violation
  unfolding default_node_properties_def
  unfolding receiver_violation_def
  apply unfold_locales
  
  apply(simp)
  apply (simp add: SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def)
  apply (simp add:graph_ops)
  apply (simp split: prod.split_asm prod.split add:case_prod_beta)
   apply(auto intro!:bexI)[1]
   (*apply (smt image_iff offending_in_edges prod.collapse)*)
  apply(blast intro: BLP_def_unique)
done
*)</span>
 

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ENF›</span></span>
  <span class="keyword1" id="SINVAR_BLPbasic-zero_default_candidate"><span class="command">lemma</span></span> zero_default_candidate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">nP</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(≤)</span><span class="main">::</span>security_level <span class="main">⇒</span> security_level <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(≤)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1" id="SINVAR_BLPbasic-zero_default_candidate_rule"><span class="command">lemma</span></span> zero_default_candidate_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> security_level<span class="main">)</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
  <span class="keyword1" id="SINVAR_BLPbasic-privacylevel_refl"><span class="command">lemma</span></span> privacylevel_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(≤)</span><span class="main">::</span>security_level <span class="main">⇒</span> security_level <span class="main">⇒</span> bool<span class="main">)</span> <span class="free">e</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_BLPbasic-BLP_ENF"><span class="command">lemma</span></span> BLP_ENF<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form sinvar <span class="main">(≤)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1" id="SINVAR_BLPbasic-BLP_ENF_refl"><span class="command">lemma</span></span> BLP_ENF_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.ENF_refl sinvar <span class="main">(≤)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.ENF_refl_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_ENF<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> privacylevel_refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLP_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> security_level<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">BLP_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="SINVAR_BLPbasic-BLP_offending_set"><span class="command">lemma</span></span> BLP_offending_set<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> BLP_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_eq_iff SecurityInvariant_withOffendingFlows.ENF_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> BLP_ENF<span class="main"><span class="main">]</span></span> BLP_offending_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> G nP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   

  <span class="keyword1"><span class="command">interpretation</span></span> BLPbasic<span class="main">:</span> SecurityInvariant_IFS <span class="quoted">sinvar</span> <span class="quoted">default_node_properties</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> BLP_offending_set"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def
    <span class="keyword1"><span class="command">unfolding</span></span> default_node_properties_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> SecurityInvariant_withOffendingFlows.ENF_snds_refl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> BLP_ENF_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_ENF BLP_ENF_refl<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_IFS<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> BLP_def_unique<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> BLP_offending_set<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1" id="SINVAR_BLPbasic-TopoS_BLPBasic"><span class="command">lemma</span></span> TopoS_BLPBasic<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Alternate definition of the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> sinvar<span class="antiquote"><span class="antiquote">}</span></span></span></span>:
      For all reachable nodes, the security level is higher›</span></span>
<span class="keyword1" id="SINVAR_BLPbasic-sinvar_BLPbasic_tancl"><span class="command">lemma</span></span> sinvar_BLPbasic_tancl<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> nodes <span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v'</span> <span class="main">∈</span> succ_tran <span class="free">G</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">v</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">v'</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> sinvar.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">v'</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟹</span> <span class="free">nP</span> <span class="skolem">v</span> <span class="main">≤</span> <span class="free">nP</span> <span class="skolem">v'</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="skolem">v'</span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> trancl_induct<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> base <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> step <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span> wf_graph_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> edges <span class="free">G</span> <span class="main">⊆</span> nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> f1 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">`</span> edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">v'</span><span class="main">∈</span>succ_tran <span class="free">G</span> <span class="bound">v</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">≤</span> <span class="free">nP</span> <span class="bound">v'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">unfolding</span></span> succ_tran_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command">qed</span></span>

   
<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar_mono
<span class="keyword1"><span class="command">hide_fact</span></span> BLP_def_unique zero_default_candidate zero_default_candidate_rule privacylevel_refl BLP_ENF BLP_ENF_refl

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_TaintingTrusted">
<div class="head">
<h1>Theory SINVAR_TaintingTrusted</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_TaintingTrusted
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Tainting with Untainting-Feature for IFS›</span></span>

<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">datatype</span></span> taints_raw <span class="main">=</span> TaintsUntaints_Raw <span class="main">(</span><span class="free"><span class="entity">taints_raw</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"string set"</span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="entity">untaints_raw</span></span><span class="main">:</span> <span class="quoted"><span class="quoted">"string set"</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> untaints_raw<span class="antiquote"><span class="antiquote">}</span></span></span></span> set must be a subset of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> taints_raw<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
        Otherwise, there can be entries in the untaints set, which do not affect anything.
        This is certainly undesirable.
        In addition, a unique default parameter cannot exist if we allow such dead entries.›</span></span>
  <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">typedef</span></span> taints <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound">ts</span><span class="main">::</span>taints_raw<span class="main">.</span> untaints_raw <span class="bound">ts</span> <span class="main">⊆</span> taints_raw <span class="bound">ts</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">morphisms</span></span> raw_of_taints Abs_taints
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"TaintsUntaints_Raw <span class="main">{}</span> <span class="main">{}</span> <span class="main">∈</span> <span class="main">{</span><span class="bound">ts</span><span class="main">.</span> untaints_raw <span class="bound">ts</span> <span class="main">⊆</span> taints_raw <span class="bound">ts</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">setup_lifting</span></span> type_definition_taints
  
  <span class="keyword1" id="SINVAR_TaintingTrusted-taints_eq_iff"><span class="command">lemma</span></span> taints_eq_iff<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="free">tsx</span> <span class="main">=</span> <span class="free">tsy</span> <span class="main">⟷</span> raw_of_taints <span class="free">tsx</span> <span class="main">=</span> raw_of_taints <span class="free">tsy</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> raw_of_taints_inject<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">taints</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"taints <span class="main">⇒</span> string set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">taints</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> taints_raw <span class="main">(</span>raw_of_taints <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">untaints</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"taints <span class="main">⇒</span> string set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">untaints</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">≡</span> untaints_raw <span class="main">(</span>raw_of_taints <span class="free"><span class="bound"><span class="entity">ts</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="SINVAR_TaintingTrusted-taints_wellformedness"><span class="command">lemma</span></span> taints_wellformedness<span class="main">:</span> <span class="quoted"><span class="quoted">"untaints <span class="free">ts</span> <span class="main">⊆</span> taints <span class="free">ts</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> raw_of_taints taints_def untaints_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Constructor for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"taints"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:›</span></span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">TaintsUntaints</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string set <span class="main">⇒</span> string set <span class="main">⇒</span> taints"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">TaintsUntaints</span> <span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="free"><span class="bound"><span class="entity">uts</span></span></span> <span class="main">=</span> Abs_taints <span class="main">(</span>TaintsUntaints_Raw <span class="main">(</span><span class="free"><span class="bound"><span class="entity">ts</span></span></span> <span class="main">∪</span> <span class="free"><span class="bound"><span class="entity">uts</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">uts</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="SINVAR_TaintingTrusted-raw_of_taints_TaintsUntaints"><span class="command">lemma</span></span> raw_of_taints_TaintsUntaints<span class="main">:</span>
    <span class="quoted"><span class="quoted">"raw_of_taints <span class="main">(</span>TaintsUntaints <span class="free">ts</span> <span class="free">uts</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>TaintsUntaints_Raw <span class="main">(</span><span class="free">ts</span> <span class="main">∪</span> <span class="free">uts</span><span class="main">)</span> <span class="free">uts</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TaintsUntaints_def Abs_taints_inverse<span class="main">)</span>

  <span class="keyword1" id="SINVAR_TaintingTrusted-taints_TaintsUntaints"><span class="command">lemma</span></span> taints_TaintsUntaints<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"taints <span class="main">(</span>TaintsUntaints <span class="free">ts</span> <span class="free">uts</span><span class="main">)</span> <span class="main">=</span> <span class="free">ts</span> <span class="main">∪</span> <span class="free">uts</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> taints_def raw_of_taints_TaintsUntaints<span class="main">)</span>
  <span class="keyword1" id="SINVAR_TaintingTrusted-untaints_TaintsUntaints"><span class="command">lemma</span></span> untaints_TaintsUntaints<span class="main">[</span><span class="operator">code</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"untaints <span class="main">(</span>TaintsUntaints <span class="free">ts</span> <span class="free">uts</span><span class="main">)</span> <span class="main">=</span> <span class="free">uts</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> untaints_def raw_of_taints_TaintsUntaints<span class="main">)</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The things in the first set are tainted, those in the second set are untainted.
    For example, a machine produces <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''foo''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:
      <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"TaintsUntaints <span class="main"><span class="main">{</span></span><span class="inner_quoted"><span class="inner_quoted">''foo''</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">{}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>

    For example, a machine consumes <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''foo''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''bar''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, combines them in a 
    way that they are no longer critical and outputs <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''baz''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>:
      <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"TaintsUntaints <span class="main"><span class="main">{</span></span><span class="inner_quoted"><span class="inner_quoted">''foo''</span></span><span class="main"><span class="main">,</span></span> <span class="inner_quoted"><span class="inner_quoted">''bar''</span></span><span class="main"><span class="main">,</span></span> <span class="inner_quoted"><span class="inner_quoted">''baz''</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">{</span></span><span class="inner_quoted"><span class="inner_quoted">''foo''</span></span><span class="main"><span class="main">,</span></span> <span class="inner_quoted"><span class="inner_quoted">''bar''</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
      abbreviated: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"TaintsUntaints <span class="main"><span class="main">{</span></span><span class="inner_quoted"><span class="inner_quoted">''baz''</span></span><span class="main"><span class="main">}</span></span> <span class="main"><span class="main">{</span></span><span class="inner_quoted"><span class="inner_quoted">''foo''</span></span><span class="main"><span class="main">,</span></span> <span class="inner_quoted"><span class="inner_quoted">''bar''</span></span><span class="main"><span class="main">}</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"TaintsUntaints <span class="main">{</span><span class="inner_quoted">''foo''</span><span class="main">,</span> <span class="inner_quoted">''bar''</span><span class="main">,</span> <span class="inner_quoted">''baz''</span><span class="main">}</span> <span class="main">{</span><span class="inner_quoted">''foo''</span><span class="main">,</span> <span class="inner_quoted">''bar''</span><span class="main">}</span> <span class="main">=</span> 
         TaintsUntaints <span class="main">{</span><span class="inner_quoted">''baz''</span><span class="main">}</span> <span class="main">{</span><span class="inner_quoted">''foo''</span><span class="main">,</span> <span class="inner_quoted">''bar''</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> taints_eq_iff raw_of_taints_TaintsUntaints<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  

  <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"taints"</span></span>
    <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> TaintsUntaints <span class="main">{}</span> <span class="main">{}</span>"</span></span>
  
  <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> taints<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span>
        taints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v1</span><span class="main">)</span> <span class="main">-</span> untaints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v1</span><span class="main">)</span> <span class="main">⊆</span> taints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v2</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Information Flow Security›</span></span>
  <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">≡</span> True"</span></span>
  
  
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SINVAR_TaintingTrusted-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def sinvar_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">G</span> <span class="skolem">nP</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> 1 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_def SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>2 <span class="skolem">N</span> <span class="skolem">E</span> <span class="skolem">E'</span> <span class="skolem">nP</span><span class="main">)</span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_def<span class="main">)</span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Needs the well-formedness condition that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"untaints <span class="free"><span class="free">otherbot</span></span> <span class="main"><span class="main">⊆</span></span> taints <span class="free"><span class="free">otherbot</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SINVAR_TaintingTrusted-Taints_def_unique"><span class="command">lemma</span></span> Taints_def_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">≠</span> default_node_properties <span class="main">⟹</span>
      <span class="main">∃</span><span class="bound">G</span> <span class="bound">p</span> <span class="bound">i</span> <span class="bound">f</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="main">¬</span> sinvar <span class="bound">G</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> <span class="main">(</span>SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="bound">G</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span>
         sinvar <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">f</span><span class="main">)</span> <span class="bound">p</span> <span class="main">∧</span>
          <span class="bound">i</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="bound">f</span> <span class="main">∧</span> sinvar <span class="bound">G</span> <span class="main">(</span><span class="bound">p</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span> "</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"untaints <span class="free">otherbot</span> <span class="main">⊆</span> taints <span class="free">otherbot</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> taints_wellformedness <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> default_node_properties_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
        SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
        SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span>set <span class="main">[</span>vertex_1<span class="main">,</span>vertex_2<span class="main">]</span><span class="main">,</span> edges <span class="main">=</span> set <span class="main">[</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">foo</span><span class="main">.</span> <span class="bound">foo</span> <span class="main">∈</span> taints <span class="free">otherbot</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">otherbot</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> tsraw<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"taints_raw <span class="improper">tsraw</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> tsraw
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="skolem">tsraw</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TaintsUntaints_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Abs_taints_inverse ex_in_conv taints_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> foo<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> default_node_properties<span class="main">)</span>
            <span class="main">(</span>vertex_1 <span class="main">:=</span> TaintsUntaints <span class="main">{</span><span class="improper">foo</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span> vertex_2 <span class="main">:=</span> default_node_properties<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> default_node_properties_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_def taints_TaintsUntaints untaints_TaintsUntaints<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_2"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_def taints_TaintsUntaints untaints_TaintsUntaints<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  
  
  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ENF›</span></span>
    <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SINVAR_TaintingTrusted-Taints_ENF"><span class="command">lemma</span></span> Taints_ENF<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form
        sinvar <span class="main">(</span><span class="main">λ</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> taints <span class="bound">c1</span> <span class="main">-</span> untaints <span class="bound">c1</span> <span class="main">⊆</span> taints <span class="bound">c2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_def sinvar_def
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1" id="SINVAR_TaintingTrusted-Taints_ENF_refl"><span class="command">lemma</span></span> Taints_ENF_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.ENF_refl
        sinvar <span class="main">(</span><span class="main">λ</span><span class="bound">c1</span> <span class="bound">c2</span><span class="main">.</span> taints <span class="bound">c1</span> <span class="main">-</span> untaints <span class="bound">c1</span> <span class="main">⊆</span> taints <span class="bound">c2</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.ENF_refl_def
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> Taints_ENF <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
       
  
    <span class="keyword2"><span class="keyword">qualified</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">Taints_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> taints<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Taints_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
        <span class="main">{}</span>
       <span class="keyword1">else</span> 
        <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> taints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">-</span> untaints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">⊆</span> taints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1" id="SINVAR_TaintingTrusted-Taints_offending_set"><span class="command">lemma</span></span> Taints_offending_set<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> Taints_offending_set"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff
                        SecurityInvariant_withOffendingFlows.ENF_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Taints_ENF<span class="main"><span class="main">]</span></span>
                        Taints_offending_set_def<span class="main">)</span>
     
 
    <span class="keyword1"><span class="command">interpretation</span></span> Taints<span class="main">:</span> SecurityInvariant_IFS <span class="quoted">sinvar</span> <span class="quoted">default_node_properties</span>
    <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> Taints_offending_set"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def
      <span class="keyword1"><span class="command">unfolding</span></span> default_node_properties_def
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>1 <span class="skolem">G</span> <span class="skolem">f</span> <span class="skolem">nP</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> ballI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> SecurityInvariant_withOffendingFlows.ENF_snds_refl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Taints_ENF_refl<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_def taints_TaintsUntaints untaints_TaintsUntaints<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> default_uniqueness_by_counterexample_IFS<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Taints_def_unique<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> default_node_properties_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set_offending_flows <span class="main">=</span> Taints_offending_set"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> Taints_offending_set<span class="main">)</span>
     <span class="keyword1"><span class="command">qed</span></span>
  
  
    <span class="keyword1" id="SINVAR_TaintingTrusted-TopoS_TaintingTrusted"><span class="command">lemma</span></span> TopoS_TaintingTrusted<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">code_datatype</span></span> <span class="quoted">TaintsUntaints</span>

<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"TaintsUntaints <span class="main">{</span><span class="inner_quoted">''foo''</span><span class="main">}</span> <span class="main">{</span><span class="inner_quoted">''bar''</span><span class="main">}</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"taints <span class="main">(</span>TaintsUntaints <span class="main">{</span><span class="inner_quoted">''foo''</span><span class="main">}</span> <span class="main">{</span><span class="inner_quoted">''bar''</span><span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_BLPtrusted">
<div class="head">
<h1>Theory SINVAR_BLPtrusted</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_BLPtrusted
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Basic Bell LaPadula with trusted entities›</span></span>

<span class="keyword1"><span class="command">type_synonym</span></span> security_level <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">record</span></span> node_config <span class="main">=</span> 
    security_level<span class="main">::</span><span class="quoted">security_level</span>
    trusted<span class="main">::</span><span class="quoted">bool</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node_config"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span>  bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> trusted <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span> <span class="keyword1">then</span> True <span class="keyword1">else</span> security_level <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> security_level <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A simplified version of the Bell LaPadula model was presented in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹SINVAR_BLPbasic.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
In this theory, we extend this template with a notion of trust by adding a Boolean flag <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> trusted<span class="antiquote"><span class="antiquote">}</span></span></span></span> to the host attributes. 
This is a refinement to represent real-world scenarios more accurately and analogously happened to the 
original Bell LaPadula model (see publication ``Looking Back at the Bell-La Padula Model''
A trusted host can receive information of any security level and may declassify it, 
i.e. distribute the information with its own security level. 
For example, a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"trusted <span class="main"><span class="main">(</span></span><span class="free"><span class="free">sc</span></span><span class="main"><span class="main">::</span></span>node_config<span class="main"><span class="main">)</span></span> <span class="main"><span class="main">=</span></span> True"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> host is allowed to receive any information 
and with the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">0</span></span><span class="main"><span class="main">::</span></span>security_level"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> level, it is allowed to reveal it to anyone. 
›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">≡</span> True"</span></span>


<span class="keyword1" id="SINVAR_BLPtrusted-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split prod.split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
<span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split prod.split_asm<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split prod.split_asm<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> prod.inject<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≠</span> <span class="free">b</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">∃</span> <span class="bound">x</span><span class="main">.</span> <span class="free">y</span> <span class="bound">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">¬</span> <span class="free">y</span> <span class="bound">x</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">=</span> <span class="free">b</span> <span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

<span class="keyword1" id="SINVAR_BLPtrusted-BLP_def_unique"><span class="command">lemma</span></span> BLP_def_unique<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">≠</span> default_node_properties <span class="main">⟹</span>
    <span class="main">∃</span><span class="bound">G</span> <span class="bound">p</span> <span class="bound">i</span> <span class="bound">f</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="main">¬</span> sinvar <span class="bound">G</span> <span class="bound">p</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> <span class="main">(</span>SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="bound">G</span> <span class="bound">p</span><span class="main">)</span> <span class="main">∧</span>
       sinvar <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">f</span><span class="main">)</span> <span class="bound">p</span> <span class="main">∧</span> 
         <span class="bound">i</span> <span class="main">∈</span> snd <span class="main">`</span> <span class="bound">f</span> <span class="main">∧</span> sinvar <span class="bound">G</span> <span class="main">(</span><span class="bound">p</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span> "</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>default_node_properties_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> default_node_properties<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> <span class="main">⦇</span>security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span> vertex_2 <span class="main">:=</span> <span class="main">⦇</span>security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>default_node_properties_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_2"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">otherbot</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ENF›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLP_P</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">BLP_P</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n1</span> <span class="bound">n2</span><span class="main">.</span><span class="main">(</span><span class="keyword1">if</span> trusted <span class="bound">n2</span> <span class="keyword1">then</span> True <span class="keyword1">else</span> security_level <span class="bound">n1</span> <span class="main">≤</span> security_level <span class="bound">n2</span> <span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="SINVAR_BLPtrusted-zero_default_candidate"><span class="command">lemma</span></span> zero_default_candidate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nP</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> BLP_P <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> BLP_P <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> default_node_properties"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nP</span> <span class="improper">e1</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nP</span> <span class="improper">e2</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> privacy2 trusted2 more2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_P_def default_node_properties_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1" id="SINVAR_BLPtrusted-privacylevel_refl"><span class="command">lemma</span></span> privacylevel_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"BLP_P <span class="free">e</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_P_def<span class="main">)</span>
  <span class="keyword1" id="SINVAR_BLPtrusted-BLP_ENF"><span class="command">lemma</span></span> BLP_ENF<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form sinvar BLP_P"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_def
    <span class="keyword1"><span class="command">unfolding</span></span> BLP_P_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1" id="SINVAR_BLPtrusted-BLP_ENF_refl"><span class="command">lemma</span></span> BLP_ENF_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.ENF_refl sinvar BLP_P"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.ENF_refl_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_ENF<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> privacylevel_refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLP_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">BLP_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> BLP_P <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="SINVAR_BLPtrusted-BLP_offending_set"><span class="command">lemma</span></span> BLP_offending_set<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> BLP_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_eq_iff SecurityInvariant_withOffendingFlows.ENF_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> BLP_ENF<span class="main"><span class="main">]</span></span> BLP_offending_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> G nP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   

<span class="keyword1"><span class="command">interpretation</span></span> BLPtrusted<span class="main">:</span> SecurityInvariant_IFS 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> BLP_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">f</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.ENF_snds_refl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> BLP_ENF_refl zero_default_candidate<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_IFS<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> BLP_def_unique<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> BLP_offending_set<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

 

  <span class="keyword1" id="SINVAR_BLPtrusted-TopoS_BLPtrusted"><span class="command">lemma</span></span> TopoS_BLPtrusted<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>  
 
<span class="keyword1"><span class="command">hide_type</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> node_config
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar_mono

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> BLP_P
<span class="keyword1"><span class="command">hide_fact</span></span> BLP_def_unique zero_default_candidate  privacylevel_refl BLP_ENF BLP_ENF_refl

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Analysis_Tainting">
<div class="head">
<h1>Theory Analysis_Tainting</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Analysis_Tainting
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_Tainting.html">SINVAR_Tainting</a> <a href="SINVAR_BLPbasic.html">SINVAR_BLPbasic</a>
        <a href="SINVAR_TaintingTrusted.html">SINVAR_TaintingTrusted</a> <a href="SINVAR_BLPtrusted.html">SINVAR_BLPtrusted</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">term</span></span> <span class="quoted">SINVAR_Tainting.sinvar</span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted">SINVAR_BLPbasic.sinvar</span>


<span class="keyword1" id="Analysis_Tainting-tainting_imp_blp_cutcard"><span class="command">lemma</span></span> tainting_imp_blp_cutcard<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">ts</span> <span class="main">⟶</span> finite <span class="bound">ts</span> <span class="main">⟹</span>
  SINVAR_Tainting.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> SINVAR_BLPbasic.sinvar <span class="free">G</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">ts</span><span class="main">.</span> card <span class="main">(</span><span class="bound">ts</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_Tainting.sinvar_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">nP</span> <span class="improper">a</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_Int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">nP</span> <span class="improper">b</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_Int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">using</span></span> card_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_subset_iff order_refl subset_antisym<span class="main">)</span>

<span class="keyword1" id="Analysis_Tainting-tainting_imp_blp_cutcard2"><span class="command">lemma</span></span> tainting_imp_blp_cutcard2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span> <span class="main">⟹</span>
  SINVAR_Tainting.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> SINVAR_BLPbasic.sinvar <span class="free">G</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">ts</span><span class="main">.</span> card <span class="main">(</span><span class="bound">ts</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span><span class="main">)</span> <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_Tainting.sinvar_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">nP</span> <span class="improper">a</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_Int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">nP</span> <span class="improper">b</span> <span class="main">∩</span> <span class="free">X</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite_Int <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">using</span></span> card_mono <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_subset_iff order_refl subset_antisym<span class="main">)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">ts</span> <span class="main">⟶</span> finite <span class="bound">ts</span> <span class="main">⟹</span>
  SINVAR_Tainting.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> SINVAR_BLPbasic.sinvar <span class="free">G</span> <span class="main">(</span>card <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> tainting_imp_blp_cutcard<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted">UNIV</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>


<span class="comment1">(*Stronger version*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">b</span> <span class="main">∈</span> snd <span class="main">`</span> edges <span class="free">G</span><span class="main">.</span> finite <span class="main">(</span><span class="free">nP</span> <span class="bound">b</span><span class="main">)</span> <span class="main">⟹</span>
  SINVAR_Tainting.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> SINVAR_BLPbasic.sinvar <span class="free">G</span> <span class="main">(</span>card <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_Tainting.sinvar_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="free">nP</span> <span class="improper">a</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="main"><span class="improper">[</span></span><span class="main"><span class="main">!</span></span><span class="main"><span class="improper">]</span></span> <span class="quoted"><span class="quoted"><span class="quoted">"finite <span class="main"><span class="main">(</span></span><span class="free"><span class="free">nP</span></span> <span class="improper"><span class="improper">b</span></span><span class="main"><span class="main">)</span></span>"</span></span></span><span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> card_mono <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹One tainting invariant is equal to many BLP invariants. 
     The BLP invariants are the projection of the tainting mapping for exactly one label›</span></span>
<span class="keyword1" id="Analysis_Tainting-tainting_iff_blp"><span class="command">lemma</span></span> tainting_iff_blp<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">extract</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> <span class="keyword1">if</span> <span class="bound">a</span> <span class="main">∈</span> <span class="bound">ts</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span>security_level <span class="keyword1">else</span> <span class="main">0</span><span class="main">::</span>security_level"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SINVAR_Tainting.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> SINVAR_BLPbasic.sinvar <span class="free">G</span> <span class="main">(</span><span class="free">extract</span> <span class="bound">a</span> <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span><span class="quoted"><span class="quoted">"SINVAR_Tainting.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> SINVAR_BLPbasic.sinvar <span class="free">G</span> <span class="main">(</span><span class="free">extract</span> <span class="bound">a</span> <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> extract_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_Tainting.sinvar_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> blp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">a</span><span class="main">.</span> SINVAR_BLPbasic.sinvar <span class="free">G</span> <span class="main">(</span><span class="free">extract</span> <span class="bound">a</span> <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v1</span> <span class="skolem">v2</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">a</span>
        <span class="keyword1"><span class="command">from</span></span> blp * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">nP</span> <span class="skolem">v1</span> <span class="keyword1">then</span> <span class="main">1</span><span class="main">::</span>security_level <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="keyword1">if</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">nP</span> <span class="skolem">v2</span> <span class="keyword1">then</span> <span class="main">1</span> <span class="keyword1">else</span> <span class="main">0</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> extract_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">a</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="free">nP</span> <span class="skolem">v1</span> <span class="main">⟹</span> <span class="skolem">a</span> <span class="main">∈</span> <span class="free">nP</span> <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="skolem">v1</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"SINVAR_Tainting.sinvar <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> SINVAR_Tainting.sinvar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If the labels are finite, the above can be generalized to arbitrary subsets of tainting labels.›</span></span>
<span class="keyword1" id="Analysis_Tainting-tainting_iff_blp_extended"><span class="command">lemma</span></span> tainting_iff_blp_extended<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">extract</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span> <span class="bound">ts</span><span class="main">.</span> card <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> <span class="bound">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">ts</span> <span class="main">⟶</span> finite <span class="bound">ts</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SINVAR_Tainting.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span><span class="main">.</span> SINVAR_BLPbasic.sinvar <span class="free">G</span> <span class="main">(</span><span class="free">extract</span> <span class="bound">A</span> <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"SINVAR_Tainting.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">A</span><span class="main">.</span> SINVAR_BLPbasic.sinvar <span class="free">G</span> <span class="main">(</span><span class="free">extract</span> <span class="bound">A</span> <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> extract_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_Tainting.sinvar_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> A a b<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span><span class="improper">A</span> <span class="main">∩</span> <span class="free">nP</span> <span class="improper">a</span><span class="main">)</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> finite <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> blp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">A</span><span class="main">.</span> SINVAR_BLPbasic.sinvar <span class="free">G</span> <span class="main">(</span><span class="free">extract</span> <span class="bound">A</span> <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">v1</span> <span class="skolem">v2</span>
      <span class="keyword3"><span class="command">assume</span></span> *<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span><span class="main">,</span><span class="skolem">v2</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">A</span>
        <span class="keyword1"><span class="command">from</span></span> blp * <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"card <span class="main">(</span><span class="skolem">A</span> <span class="main">∩</span> <span class="free">nP</span> <span class="skolem">v1</span><span class="main">)</span> <span class="main">≤</span> card <span class="main">(</span><span class="skolem">A</span> <span class="main">∩</span> <span class="free">nP</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> extract_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">A</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">}</span></span>
      <span class="keyword1"><span class="command">from</span></span> this finite card_seteq <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="skolem">v1</span> <span class="main">⊆</span> <span class="free">nP</span> <span class="skolem">v2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Int_absorb Int_lower1 inf.orderI<span class="main">)</span> 
    <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"SINVAR_Tainting.sinvar <span class="free">G</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> SINVAR_Tainting.sinvar_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Translated to the Bell LaPadula model with trust:
  security level is the number of tainted minus the untainted things
  We set the Trusted flag if a machine untaints things.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">ts</span> <span class="main">⟶</span> finite <span class="main">(</span>taints <span class="bound">ts</span><span class="main">)</span> <span class="main">⟹</span>
  SINVAR_TaintingTrusted.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span>
    SINVAR_BLPtrusted.sinvar <span class="free">G</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">ts</span><span class="main">.</span> <span class="main">⦇</span>security_level <span class="main">=</span> card <span class="main">(</span>taints <span class="bound">ts</span> <span class="main">-</span> untaints <span class="bound">ts</span><span class="main">)</span><span class="main">,</span> trusted <span class="main">=</span> <span class="main">(</span>untaints <span class="bound">ts</span> <span class="main">≠</span> <span class="main">{}</span><span class="main">)</span><span class="main">⦈</span> <span class="main">)</span> <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_TaintingTrusted.sinvar_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>taints <span class="main">(</span><span class="free">nP</span> <span class="improper">a</span><span class="main">)</span> <span class="main">-</span> untaints <span class="main">(</span><span class="free">nP</span> <span class="improper">a</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

<span class="keyword1" id="Analysis_Tainting-tainting_iff_blp_trusted"><span class="command">lemma</span></span> tainting_iff_blp_trusted<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">project</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">a</span> <span class="bound">ts</span><span class="main">.</span> <span class="main">⦇</span>
      security_level <span class="main">=</span>
        <span class="keyword1">if</span>
          <span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span>taints <span class="bound">ts</span> <span class="main">-</span> untaints <span class="bound">ts</span><span class="main">)</span>
        <span class="keyword1">then</span>
          <span class="main">1</span><span class="main">::</span>security_level
        <span class="keyword1">else</span>
          <span class="main">0</span><span class="main">::</span>security_level
      <span class="main">,</span> trusted <span class="main">=</span> <span class="bound">a</span> <span class="main">∈</span> untaints <span class="bound">ts</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SINVAR_TaintingTrusted.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">.</span> SINVAR_BLPtrusted.sinvar <span class="free">G</span> <span class="main">(</span><span class="free">project</span> <span class="bound">a</span> <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> project_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_TaintingTrusted.sinvar_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_TaintingTrusted.sinvar_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b taintlabel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">taintlabel</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
<span class="keyword1"><span class="command">using</span></span> taints_wellformedness <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>




<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If the labels are finite, the above can be generalized to arbitrary subsets of tainting labels.›</span></span>
<span class="keyword1" id="Analysis_Tainting-tainting_iff_blp_trusted_extended"><span class="command">lemma</span></span> tainting_iff_blp_trusted_extended<span class="main">:</span>
  <span class="keyword2"><span class="keyword">defines</span></span> <span class="quoted"><span class="quoted">"<span class="free">project</span> <span class="main">≡</span> <span class="main">λ</span><span class="bound">A</span> <span class="bound">ts</span><span class="main">.</span>
      <span class="main">⦇</span>
          security_level <span class="main">=</span> card <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> <span class="main">(</span>taints <span class="bound">ts</span> <span class="main">-</span> untaints <span class="bound">ts</span><span class="main">)</span><span class="main">)</span>
        <span class="main">,</span> trusted <span class="main">=</span> <span class="main">(</span><span class="bound">A</span> <span class="main">∩</span> untaints <span class="bound">ts</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span>
      <span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">ts</span> <span class="bound">v</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">ts</span> <span class="main">⟶</span> finite <span class="main">(</span>taints <span class="bound">ts</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SINVAR_TaintingTrusted.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">A</span><span class="main">.</span> SINVAR_BLPtrusted.sinvar <span class="free">G</span> <span class="main">(</span><span class="free">project</span> <span class="bound">A</span> <span class="main">∘</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> project_def
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_TaintingTrusted.sinvar_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> card_mono<span class="main">)</span>
  <span class="keyword1"><span class="command">using</span></span> finite <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_TaintingTrusted.sinvar_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> a b taintlabel<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="improper">taintlabel</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
 <span class="keyword1"><span class="command">using</span></span> taints_wellformedness <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">using</span></span> Diff_insert_absorb <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Interface_impl">
<div class="head">
<h1>Theory TopoS_Interface_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Interface_impl
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="FiniteGraph.html">Lib/FiniteGraph</a>"</span> <span class="quoted">"<a href="FiniteListGraph.html">Lib/FiniteListGraph</a>"</span> <a href="TopoS_Interface.html">TopoS_Interface</a> <a href="TopoS_Helper.html">TopoS_Helper</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Executable Implementation with Lists›</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Correspondence List Implementation and set Specification›</span></span>
  
  <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Abstraction from list implementation to set specification›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Nomenclature: <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>_spec›</span></span></span></span> is the specification, <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>_impl›</span></span></span></span> the corresponding implementation.›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>_spec›</span></span></span></span> and <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>_impl›</span></span></span></span> only need to comply for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> wf_graph<span class="antiquote"><span class="antiquote">}</span></span></span></span>s. 
   We will always require the stricter <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> wf_list_graph<span class="antiquote"><span class="antiquote">}</span></span></span></span>, which implies <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> wf_graph<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">%</span>invisible <span class="main">(</span><span class="operator">metis</span> wf_list_graph_def wf_list_graph_iff_wf_graph<span class="main">)</span>

  <span class="keyword1"><span class="command">locale</span></span> TopoS_List_Impl <span class="main">=</span> 
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span> <span class="main">(</span><span class="quoted">"<span class="keyword1">⊥</span>"</span><span class="main">)</span> 
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">sinvar_spec</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">sinvar_impl</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">offending_flows_impl</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">node_props_impl</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_Params <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">eval_impl</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_Params <span class="main">⇒</span> bool"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span>
      spec<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant <span class="free">sinvar_spec</span> <span class="free">default_node_properties</span> <span class="free">receiver_violation</span>"</span></span> <span class="comment1">― ‹specification is valid›</span>
    <span class="keyword2"><span class="keyword">and</span></span>
      sinvar_spec_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> 
        <span class="main">(</span><span class="free">sinvar_spec</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free">sinvar_impl</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
      offending_flows_spec_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> 
      <span class="main">(</span>SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar_spec</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span> <span class="main">=</span> 
      set<span class="main">`</span>set <span class="main">(</span><span class="free">offending_flows_impl</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> 
      node_props_spec_impl<span class="main">:</span> 
     <span class="quoted"><span class="quoted">"SecurityInvariant.node_props_formaldef <span class="free">default_node_properties</span> <span class="free">P</span> <span class="main">=</span> <span class="free">node_props_impl</span> <span class="free">P</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
      eval_spec_impl<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">(</span>distinct <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> distinct <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> 
     SecurityInvariant.eval <span class="free">sinvar_spec</span> <span class="free">default_node_properties</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">P</span> <span class="main">)</span> <span class="main">=</span> 
     <span class="main">(</span><span class="free">eval_impl</span> <span class="free">G</span> <span class="free">P</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Security Invariants Packed›</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹We pack all necessary functions and properties of a security invariant in a struct-like data structure.›</span></span>
  <span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'v</span><span class="main">::</span><span class="quoted">vertex</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_packed <span class="main">=</span>
    nm_name <span class="main">::</span> <span class="quoted"><span class="quoted">"string"</span></span>
    nm_receiver_violation <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>
    nm_default <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span>"</span></span>
    nm_sinvar<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span>
    nm_offending_flows<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span>
    nm_node_props<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_Params <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span>"</span></span> 
    nm_eval<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span>TopoS_Params <span class="main">⇒</span> bool"</span></span>
    


   <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The packed list implementation must comply with the formal definition.›</span></span>
   <span class="keyword1"><span class="command">locale</span></span> TopoS_modelLibrary <span class="main">=</span>
    <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_packed"</span></span> <span class="comment1">― ‹concrete model implementation›</span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="free">sinvar_spec</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="comment1">― ‹specification›</span>
    <span class="keyword2"><span class="keyword">assumes</span></span>
       name_not_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>nm_name <span class="free">m</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">0</span>"</span></span>
     <span class="keyword2"><span class="keyword">and</span></span>
       impl_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_List_Impl 
        <span class="main">(</span>nm_default <span class="free">m</span><span class="main">)</span>
        <span class="free">sinvar_spec</span>
        <span class="main">(</span>nm_sinvar <span class="free">m</span><span class="main">)</span>
        <span class="main">(</span>nm_receiver_violation <span class="free">m</span><span class="main">)</span>
        <span class="main">(</span>nm_offending_flows <span class="free">m</span><span class="main">)</span>
        <span class="main">(</span>nm_node_props <span class="free">m</span><span class="main">)</span>
        <span class="main">(</span>nm_eval <span class="free">m</span><span class="main">)</span>"</span></span>



  <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Helpful Lemmata›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹show that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">sinvar</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> complies›</span></span>
  <span class="keyword1" id="TopoS_Interface_impl-TopoS_eval_impl_proofrule"><span class="command">lemma</span></span> TopoS_eval_impl_proofrule<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> inst<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant <span class="free">sinvar_spec</span> <span class="free">default_node_properties</span> <span class="free">receiver_violation</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> ev<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">nP</span><span class="main">.</span> wf_list_graph <span class="free">G</span> <span class="main">⟹</span> <span class="free">sinvar_spec</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">=</span> <span class="free">sinvar_impl</span> <span class="free">G</span> <span class="bound">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"
      <span class="main">(</span>distinct <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> distinct <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> 
       SecurityInvariant.eval <span class="free">sinvar_spec</span> <span class="free">default_node_properties</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span>
      <span class="main">(</span>wf_list_graph <span class="free">G</span> <span class="main">∧</span> <span class="free">sinvar_impl</span> <span class="free">G</span> <span class="main">(</span>SecurityInvariant.node_props <span class="free">default_node_properties</span> <span class="free">P</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="free">sinvar_spec</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>SecurityInvariant.node_props <span class="free">default_node_properties</span> <span class="free">P</span><span class="main">)</span> <span class="main">=</span>
       <span class="free">sinvar_impl</span> <span class="free">G</span> <span class="main">(</span>SecurityInvariant.node_props <span class="free">default_node_properties</span> <span class="free">P</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> ev <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">with</span></span> inst <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> wf_list_graph_def 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_list_graph_iff_wf_graph SecurityInvariant.eval_def<span class="main">)</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False
    <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>distinct <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> distinct <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> wf_list_graph_axioms <span class="free">G</span><span class="main">)</span> <span class="main">=</span> False"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> wf_list_graph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">with</span></span> False <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant.eval_def<span class="main">[</span><span class="operator">OF</span> inst<span class="main">]</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> wf_list_graph_iff_wf_graph<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Helper lemmata›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Provide <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">sinvar</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> function and get back a function that computes the list of offending flows
  
  Exponential time!
›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">Generic_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool <span class="main">)</span><span class="main">⇒</span> <span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Generic_offending_list</span> <span class="free"><span class="bound"><span class="entity">sinvar</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">[</span><span class="bound">f</span> <span class="main">←</span> <span class="main">(</span>subseqs <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">.</span> 
    <span class="main">(</span><span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">sinvar</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">sinvar</span></span></span> <span class="main">(</span>FiniteListGraph.delete_edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">f</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span><span class="main">)</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span>set <span class="bound">f</span><span class="main">.</span> <span class="main">¬</span> <span class="free"><span class="bound"><span class="entity">sinvar</span></span></span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>FiniteListGraph.delete_edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span><span class="main">)</span><span class="main">]</span>"</span></span>
  
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹proof rule: if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">sinvar</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> complies, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Generic_offending_list<span class="antiquote"><span class="antiquote">}</span></span></span></span> complies›</span></span>
  <span class="keyword1" id="TopoS_Interface_impl-Generic_offending_list_correct"><span class="command">lemma</span></span> Generic_offending_list_correct<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">assumes</span></span> spec_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> wf_list_graph <span class="bound">G</span> <span class="main">⟹</span> <span class="free">sinvar_spec</span> <span class="main">(</span>list_graph_to_graph <span class="bound">G</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">=</span> <span class="free">sinvar_impl</span> <span class="bound">G</span> <span class="bound">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar_spec</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span> <span class="main">=</span> 
      set<span class="main">`</span>set<span class="main">(</span> Generic_offending_list <span class="free">sinvar_impl</span> <span class="free">G</span> <span class="free">nP</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">P</span> <span class="bound">G</span><span class="main">.</span> set <span class="main">`</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="main">(</span>subseqs <span class="main">(</span>edgesL <span class="bound">G</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">G</span> <span class="main">(</span>set <span class="bound">x</span><span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">x</span></span> <span class="main">∈</span> set <span class="main">`</span> set <span class="main">(</span>subseqs <span class="main">(</span>edgesL <span class="bound">G</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">G</span> <span class="main">(</span><span class="bound">x</span><span class="main">)</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">hence</span></span> subset_subseqs_filter<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="bound">P</span><span class="main">.</span> <span class="main">{</span><span class="bound">f</span><span class="main">.</span> <span class="bound">f</span> <span class="main">⊆</span> edges <span class="main">(</span>list_graph_to_graph <span class="bound">G</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">P</span> <span class="bound">G</span> <span class="bound">f</span><span class="main">}</span> 
    <span class="main">=</span> set <span class="main">`</span> set <span class="main">[</span><span class="bound">f</span><span class="main">←</span>subseqs <span class="main">(</span>edgesL <span class="bound">G</span><span class="main">)</span> <span class="main">.</span> <span class="bound">P</span> <span class="bound">G</span> <span class="main">(</span>set <span class="bound">f</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> list_graph_to_graph_def
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span><span class="main"><span class="main">:</span></span> subseqs_powset<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> valid delete_edges_wf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">.</span> wf_list_graph<span class="main">(</span>FiniteListGraph.delete_edges <span class="free">G</span> <span class="bound">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">with</span></span> spec_impl<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> FiniteListGraph.delete_edges_correct<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">G</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> impl_spec_delete<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">f</span><span class="main">.</span> <span class="free">sinvar_impl</span> <span class="main">(</span>FiniteListGraph.delete_edges <span class="free">G</span> <span class="bound">f</span><span class="main">)</span> <span class="free">nP</span> <span class="main">=</span> 
          <span class="free">sinvar_spec</span> <span class="main">(</span>FiniteGraph.delete_edges <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>set <span class="bound">f</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">from</span></span> spec_impl<span class="main">[</span><span class="operator">OF</span> valid<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> impl_spec_not<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> <span class="free">sinvar_impl</span> <span class="free">G</span> <span class="free">nP</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">¬</span> <span class="free">sinvar_spec</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> spec_impl<span class="main">[</span><span class="operator">symmetric</span><span class="main">,</span> <span class="operator">OF</span> FiniteListGraph.add_edge_wf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> FiniteListGraph.delete_edges_wf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid<span class="main"><span class="main">]</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> impl_spec_allE<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">E</span><span class="main">.</span> <span class="free">sinvar_impl</span> <span class="main">(</span>FiniteListGraph.add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>FiniteListGraph.delete_edges <span class="free">G</span> <span class="bound">E</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span> <span class="main">=</span>
    <span class="free">sinvar_spec</span> <span class="main">(</span>list_graph_to_graph <span class="main">(</span>FiniteListGraph.add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>FiniteListGraph.delete_edges <span class="free">G</span> <span class="bound">E</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="free">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

    <span class="keyword1"><span class="command">have</span></span> list_graph<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">e1</span> <span class="bound">e2</span> <span class="bound">G</span> <span class="bound">f</span><span class="main">.</span> <span class="main">(</span>list_graph_to_graph <span class="main">(</span>FiniteListGraph.add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>FiniteListGraph.delete_edges <span class="bound">G</span> <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
      <span class="main">(</span>FiniteGraph.add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>FiniteGraph.delete_edges <span class="main">(</span>list_graph_to_graph <span class="bound">G</span><span class="main">)</span> <span class="main">(</span>set <span class="bound">f</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FiniteListGraph.add_edge_correct FiniteListGraph.delete_edges_correct<span class="main">)</span>
    
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
      <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def 
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def 
      SecurityInvariant_withOffendingFlows.is_offending_flows_def
      Generic_offending_list_def
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> impl_spec_delete<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> impl_spec_not<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> impl_spec_allE<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> list_graph<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> subset_subseqs_filter<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="TopoS_Interface_impl-all_edges_list_I"><span class="command">lemma</span></span> all_edges_list_I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="free">Pl</span> <span class="free">G</span> <span class="main">⟹</span> 
    <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span> <span class="main">(</span>edges <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span>set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="free">Pl</span> <span class="free">G</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_graph_to_graph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

  <span class="keyword1" id="TopoS_Interface_impl-all_nodes_list_I"><span class="command">lemma</span></span> all_nodes_list_I<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="free">Pl</span> <span class="free">G</span> <span class="main">⟹</span> 
    <span class="main">(</span><span class="main">∀</span><span class="bound">n</span> <span class="main">∈</span> <span class="main">(</span>nodes <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span>set <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="free">Pl</span> <span class="free">G</span> <span class="bound">n</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> list_graph_to_graph_def
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>






  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">minimalize_offending_overapprox</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> list_graph <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> 
    <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">minimalize_offending_overapprox</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">minimalize_offending_overapprox</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="main">(</span>delete_edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">fs</span></span></span><span class="main">@</span><span class="free"><span class="bound"><span class="entity">keep</span></span></span><span class="main">)</span><span class="main">)</span> <span class="keyword1">then</span>
      <span class="free">minimalize_offending_overapprox</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="free"><span class="bound"><span class="entity">keep</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>
    <span class="keyword1">else</span>
      <span class="free">minimalize_offending_overapprox</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">fs</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">f</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">keep</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>
    <span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">thm</span></span> minimalize_offending_overapprox_boundnP <span class="comment1">(*is usage of this one better?*)</span>
  <span class="keyword1" id="TopoS_Interface_impl-minimalize_offending_overapprox_spec_impl"><span class="command">lemma</span></span> minimalize_offending_overapprox_spec_impl<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> valid<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="main">(</span><span class="free">G</span><span class="main">::</span><span class="tfree">'v</span><span class="main">::</span>vertex list_graph<span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> spec_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">G</span> <span class="bound">nP</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> wf_list_graph <span class="bound">G</span> <span class="main">⟹</span> <span class="free">sinvar_spec</span> <span class="main">(</span>list_graph_to_graph <span class="bound">G</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">=</span> <span class="free">sinvar_impl</span> <span class="bound">G</span> <span class="bound">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"minimalize_offending_overapprox <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="free">sinvar_impl</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span> <span class="free">fs</span> <span class="free">keeps</span> <span class="free">G</span> <span class="main">=</span>
       TopoS_withOffendingFlows.minimalize_offending_overapprox <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="free">sinvar_spec</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span> <span class="free">fs</span> <span class="free">keeps</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> minimalize_offending_overapprox_boundnP<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> valid spec_impl <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">fs</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">keeps</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.minimalize_offending_overapprox.simps<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.minimalize_offending_overapprox.simps<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> FiniteListGraph.delete_edges_wf delete_edges_list_set list_graph_correct<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹With <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> minimalize_offending_overapprox<span class="antiquote"><span class="antiquote">}</span></span></span></span>, we can get one offending flow›</span></span>
  <span class="keyword1" id="TopoS_Interface_impl-minimalize_offending_overapprox_gives_some_offending_flow"><span class="command">lemma</span></span> minimalize_offending_overapprox_gives_some_offending_flow<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> wf<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> NetModelLib<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_modelLibrary <span class="free">m</span> <span class="free">sinvar_spec</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span> violation<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span>nm_sinvar <span class="free">m</span><span class="main">)</span> <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>minimalize_offending_overapprox <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="main">(</span>nm_sinvar <span class="free">m</span><span class="main">)</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span> <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">[]</span> <span class="free">G</span><span class="main">)</span> <span class="main">∈</span>
            SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar_spec</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> wf <span class="keyword1"><span class="command">have</span></span> wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_list_graph_def wf_list_graph_iff_wf_graph<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> wf <span class="keyword1"><span class="command">have</span></span> dist_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_list_graph_def<span class="main">)</span>

      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?spec_algo</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"TopoS_withOffendingFlows.minimalize_offending_overapprox
                          <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="free">sinvar_spec</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span> <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span>

      <span class="keyword1"><span class="command">note</span></span> spec<span class="main">=</span>TopoS_List_Impl.spec<span class="main">[</span><span class="operator">OF</span> TopoS_modelLibrary.impl_spec<span class="main"><span class="main">[</span></span><span class="operator">OF</span> NetModelLib<span class="main"><span class="main">]</span></span><span class="main">]</span>

      <span class="keyword1"><span class="command">from</span></span> spec <span class="keyword1"><span class="command">have</span></span> spec_prelim<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_preliminaries <span class="free">sinvar_spec</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> spec_prelim SecurityInvariant_preliminaries.sinvar_monoI <span class="keyword1"><span class="command">have</span></span> mono<span class="main">:</span>
        <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono <span class="free">sinvar_spec</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        
      <span class="keyword1"><span class="command">from</span></span> spec_prelim <span class="keyword1"><span class="command">have</span></span> empty_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">sinvar_spec</span> <span class="main">⦇</span>nodes <span class="main">=</span> set <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span><span class="main">⦈</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> SecurityInvariant_preliminaries.defined_offending 
        SecurityInvariant_withOffendingFlows.sinvar_mono_imp_sinvar_mono 
        SecurityInvariant_withOffendingFlows.valid_empty_edges_iff_exists_offending_flows  
        mono empty_subsetI graph.simps<span class="main">(</span>1<span class="main">)</span> 
        list_graph_to_graph_def local.wf wf_list_graph_def wf_list_graph_iff_wf_graph
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

      <span class="comment1">(*TODO: tune*)</span>
      <span class="keyword1"><span class="command">have</span></span> spec_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="skolem">G</span> <span class="main">⟹</span> <span class="free">sinvar_spec</span> <span class="main">(</span>list_graph_to_graph <span class="skolem">G</span><span class="main">)</span> <span class="skolem">nP</span> <span class="main">=</span> <span class="main">(</span>nm_sinvar <span class="free">m</span><span class="main">)</span> <span class="skolem">G</span> <span class="skolem">nP</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">G</span> <span class="skolem">nP</span>
        <span class="keyword1"><span class="command">using</span></span> NetModelLib TopoS_List_Impl.sinvar_spec_impl TopoS_modelLibrary.impl_spec <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      
      <span class="keyword1"><span class="command">from</span></span> minimalize_offending_overapprox_spec_impl<span class="main">[</span><span class="operator">OF</span> wf<span class="main">]</span> spec_impl <span class="keyword1"><span class="command">have</span></span> alog_spec<span class="main">:</span>
        <span class="quoted"><span class="quoted">"minimalize_offending_overapprox <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="main">(</span>nm_sinvar <span class="free">m</span><span class="main">)</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span> <span class="skolem">fs</span> <span class="skolem">keeps</span> <span class="free">G</span> <span class="main">=</span>
         TopoS_withOffendingFlows.minimalize_offending_overapprox <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="free">sinvar_spec</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span> <span class="skolem">fs</span> <span class="skolem">keeps</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">fs</span> <span class="skolem">keeps</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="comment1">(*TODO: tune*)</span>
      <span class="keyword1"><span class="command">from</span></span> spec_impl violation <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.is_offending_flows <span class="free">sinvar_spec</span> <span class="main">(</span>set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> local.wf<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> FiniteGraph.delete_edges_simp2 list_graph_to_graph_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> empty_edges<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">hence</span></span> goal<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.is_offending_flows_min_set <span class="free">sinvar_spec</span>
        <span class="main">(</span>set <span class="var">?spec_algo</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> minimalize_offending_overapprox_boundnP<span class="main">)</span> <span class="comment1">(*we do this subst pretty often. is this the right abstraction here?*)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_minimalize_offending_overapprox<span class="main"><span class="main">[</span></span><span class="operator">OF</span>
              mono wfG _ _ dist_edges<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

      <span class="keyword1"><span class="command">from</span></span> SecurityInvariant_withOffendingFlows.minimalize_offending_overapprox_subseteq_input<span class="main">[</span><span class="operator">of</span>
        <span class="quoted"><span class="quoted">"<span class="free">sinvar_spec</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> subset_edges<span class="main">:</span>
        <span class="quoted"><span class="quoted">"set <span class="var">?spec_algo</span> <span class="main">⊆</span> edges <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> minimalize_offending_overapprox_boundnP<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> goal <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def alog_spec subset_edges<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>






<span class="comment1">(*TODO: this should be a header of TopoS_Libary. The header should be printed BEFORE the imports are processed. *)</span>
<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Security Invariant Library›</span></span>
<span class="comment1">(*The SINVAR_* theory files all use the "subsection" command. Here is the top-section.*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_BLPbasic_impl">
<div class="head">
<h1>Theory SINVAR_BLPbasic_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_BLPbasic_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_BLPbasic.html">SINVAR_BLPbasic</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant BLPbasic List Implementation›</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_BLPbasic_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_BLPbasic

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> security_level<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLP_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> security_level<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">BLP_offending_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
    <span class="main">[]</span>
   <span class="keyword1">else</span> 
    <span class="main">[</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">&gt;</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">]</span> <span class="main">]</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_BLPbasic.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_BLPbasic.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">BLP_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> 
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_BLPbasic.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> BLPbasic_impl<span class="main">:</span>TopoS_List_Impl
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_BLPbasic.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_BLPbasic.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_BLPbasic.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">BLP_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">BLP_eval</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_BLPBasic<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def BLP_offending_set BLP_offending_set_def BLP_offending_list_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> BLPbasic.node_props.simps BLPbasic.node_props_eq_node_props_formaldef<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> BLP_eval_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_BLPBasic<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹BLPbasic packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_BLPbasic</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> security_level<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_BLPbasic</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''BLPbasic''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_BLPbasic.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_BLPbasic.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> BLP_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> BLP_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_BLPbasic_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_BLPbasic</span> 
      <span class="quoted">SINVAR_BLPbasic.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_BLPbasic_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Example›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">fabNet</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">fabNet</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Statistics''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''PresenceSensor''</span><span class="main">,</span> <span class="inner_quoted">''Webcam''</span><span class="main">,</span> <span class="inner_quoted">''TempSensor''</span><span class="main">,</span> <span class="inner_quoted">''FireSesnsor''</span><span class="main">,</span>
                     <span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">,</span> <span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Bot1''</span><span class="main">,</span> <span class="inner_quoted">''Bot2''</span><span class="main">]</span><span class="main">,</span> 
              edgesL <span class="main">=</span><span class="main">[</span><span class="main">(</span><span class="inner_quoted">''PresenceSensor''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Webcam''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span> 
                     <span class="main">(</span><span class="inner_quoted">''TempSensor''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span><span class="inner_quoted">''FireSesnsor''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span>
                     <span class="main">(</span><span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''Statistics''</span><span class="main">)</span><span class="main">,</span>
                     <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''Bot1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''Bot2''</span><span class="main">)</span><span class="main">,</span>
                     <span class="main">(</span><span class="inner_quoted">''MissionControl2''</span><span class="main">,</span> <span class="inner_quoted">''Bot2''</span><span class="main">)</span><span class="main">,</span>
                     <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Bot1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Bot2''</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"wf_list_graph fabNet"</span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">sensorProps_try1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> security_level"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sensorProps_try1</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> SINVAR_BLPbasic.default_node_properties<span class="main">)</span><span class="main">(</span><span class="inner_quoted">''PresenceSensor''</span> <span class="main">:=</span> <span class="numeral">2</span><span class="main">,</span> <span class="inner_quoted">''Webcam''</span> <span class="main">:=</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"BLP_offending_list fabNet sensorProps_try1"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar fabNet sensorProps_try1"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">sensorProps_try2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> security_level"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sensorProps_try2</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> SINVAR_BLPbasic.default_node_properties<span class="main">)</span><span class="main">(</span><span class="inner_quoted">''PresenceSensor''</span> <span class="main">:=</span> <span class="numeral">2</span><span class="main">,</span> <span class="inner_quoted">''Webcam''</span> <span class="main">:=</span> <span class="numeral">3</span><span class="main">,</span> 
                                                       <span class="inner_quoted">''SensorSink''</span> <span class="main">:=</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"BLP_offending_list fabNet sensorProps_try2"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar fabNet sensorProps_try2"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">sensorProps_try3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> security_level"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sensorProps_try3</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> SINVAR_BLPbasic.default_node_properties<span class="main">)</span><span class="main">(</span><span class="inner_quoted">''PresenceSensor''</span> <span class="main">:=</span> <span class="numeral">2</span><span class="main">,</span> <span class="inner_quoted">''Webcam''</span> <span class="main">:=</span> <span class="numeral">3</span><span class="main">,</span> 
                                                       <span class="inner_quoted">''SensorSink''</span> <span class="main">:=</span> <span class="numeral">3</span><span class="main">,</span> <span class="inner_quoted">''Statistics''</span> <span class="main">:=</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"BLP_offending_list fabNet sensorProps_try3"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar fabNet sensorProps_try3"</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Another parameter set for confidential controlling information›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">sensorProps_conf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> security_level"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sensorProps_conf</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> SINVAR_BLPbasic.default_node_properties<span class="main">)</span><span class="main">(</span><span class="inner_quoted">''MissionControl1''</span> <span class="main">:=</span> <span class="main">1</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span> <span class="main">:=</span> <span class="numeral">2</span><span class="main">,</span>
      <span class="inner_quoted">''Bot1''</span> <span class="main">:=</span> <span class="main">1</span><span class="main">,</span> <span class="inner_quoted">''Bot2''</span> <span class="main">:=</span> <span class="numeral">2</span> <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"BLP_offending_list fabNet sensorProps_conf"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar fabNet sensorProps_conf"</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Complete example:›</span></span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">sensorProps_NMParams_try3</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string<span class="main">,</span> nat<span class="main">)</span> TopoS_Params"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sensorProps_NMParams_try3</span> <span class="main">≡</span> <span class="main">⦇</span> node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''PresenceSensor''</span> <span class="main">↦</span> <span class="numeral">2</span><span class="main">,</span> 
                                                    <span class="inner_quoted">''Webcam''</span> <span class="main">↦</span> <span class="numeral">3</span><span class="main">,</span> 
                                                    <span class="inner_quoted">''SensorSink''</span> <span class="main">↦</span> <span class="numeral">3</span><span class="main">,</span>
                                                    <span class="inner_quoted">''Statistics''</span> <span class="main">↦</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"BLP_eval fabNet sensorProps_NMParams_try3"</span></span>


<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">SINVAR_LIB_BLPbasic</span></span> <span class="keyword2"><span class="keyword">checking</span></span> Scala

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props BLP_offending_list BLP_eval

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Subnets">
<div class="head">
<h1>Theory SINVAR_Subnets</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Subnets
<span class="keyword2"><span class="keyword">imports</span></span><span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Subnets›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If unsure, maybe you should look at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹SINVAR_SubnetsInGW.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>


<span class="keyword1"><span class="command">datatype</span></span> subnets <span class="main">=</span> Subnet <span class="quoted">nat</span> <span class="main">|</span> BorderRouter <span class="quoted">nat</span> <span class="main">|</span> Unassigned

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"subnets"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> Unassigned"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">allowed_subnet_flow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"subnets <span class="main">⇒</span> subnets <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>Subnet <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span>Subnet <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>Subnet <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span>BorderRouter <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s1</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>Subnet <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> Unassigned <span class="main">=</span> True"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>BorderRouter <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span>Subnet <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span> <span class="comment1">(*(s1 = s2) would also be fine*)</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>BorderRouter <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> Unassigned <span class="main">=</span> True"</span></span> <span class="main">|</span> 
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> <span class="main">(</span>BorderRouter <span class="free"><span class="bound"><span class="entity">s1</span></span></span><span class="main">)</span> <span class="main">(</span>BorderRouter <span class="free"><span class="bound"><span class="entity">s2</span></span></span><span class="main">)</span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> Unassigned Unassigned  <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> Unassigned <span class="main"><span class="bound"><span class="entity">_</span></span></span>  <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> subnets<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> allowed_subnet_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">=</span> False"</span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>
  <span class="keyword1" id="SINVAR_Subnets-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>




<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹ENF›</span></span>
  <span class="keyword1" id="SINVAR_Subnets-Unassigned_only_to_Unassigned"><span class="command">lemma</span></span> Unassigned_only_to_Unassigned<span class="main">:</span> <span class="quoted"><span class="quoted">"allowed_subnet_flow Unassigned <span class="free">e2</span> <span class="main">⟷</span> <span class="free">e2</span> <span class="main">=</span> Unassigned"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">e2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_Subnets-All_to_Unassigned"><span class="command">lemma</span></span> All_to_Unassigned<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e1</span><span class="main">.</span> allowed_subnet_flow <span class="bound">e1</span> Unassigned"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">e1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_Subnets-Unassigned_default_candidate"><span class="command">lemma</span></span> Unassigned_default_candidate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">nP</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> allowed_subnet_flow <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> allowed_subnet_flow Unassigned <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nP</span> <span class="improper">e2</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> All_to_Unassigned<span class="main">)</span>
  <span class="keyword1" id="SINVAR_Subnets-allowed_subnet_flow_refl"><span class="command">lemma</span></span> allowed_subnet_flow_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e</span><span class="main">.</span> allowed_subnet_flow <span class="bound">e</span> <span class="bound">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">e</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_Subnets-Subnets_ENF"><span class="command">lemma</span></span> Subnets_ENF<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form sinvar allowed_subnet_flow"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1" id="SINVAR_Subnets-Subnets_ENF_refl"><span class="command">lemma</span></span> Subnets_ENF_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.ENF_refl sinvar allowed_subnet_flow"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.ENF_refl_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Subnets_ENF<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allowed_subnet_flow_refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">Subnets_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> subnets<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Subnets_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> allowed_subnet_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="SINVAR_Subnets-Subnets_offending_set"><span class="command">lemma</span></span> Subnets_offending_set<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> Subnets_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_eq_iff ENF_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Subnets_ENF<span class="main"><span class="main">]</span></span> Subnets_offending_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> G nP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">interpretation</span></span> Subnets<span class="main">:</span> SecurityInvariant_ACS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">SINVAR_Subnets.default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">SINVAR_Subnets.sinvar</span>
<span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> Subnets_offending_set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SINVAR_Subnets.default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SecurityInvariant_withOffendingFlows.ENF_fsts_refl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Subnets_ENF_refl Unassigned_default_candidate<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">otherbot</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> mysubnetcase<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> BorderRouter <span class="improper">mysubnetcase</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> BorderRouter <span class="free">whatever</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> Subnets_offending_set<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1" id="SINVAR_Subnets-TopoS_Subnets"><span class="command">lemma</span></span> TopoS_Subnets<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Analysis›</span></span>

<span class="keyword1" id="SINVAR_Subnets-violating_configurations"><span class="command">lemma</span></span> violating_configurations<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟹</span> 
    <span class="main">∃</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">e1</span> <span class="main">=</span> Unassigned <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s1</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">e1</span> <span class="main">=</span> Subnet <span class="bound">s1</span><span class="main">)</span> <span class="main">∨</span> <span class="main">(</span><span class="main">∃</span> <span class="bound">s1</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">e1</span> <span class="main">=</span> BorderRouter <span class="bound">s1</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> a b<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="improper">b</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="improper">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="improper">a</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> All_to_Unassigned<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹All cases where the model can become invalid:›</span></span>
<span class="keyword1"><span class="command">theorem</span></span> violating_configurations_exhaust<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟷</span> 
   <span class="main">(</span><span class="main">∃</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> 
      <span class="free">nP</span> <span class="bound">e1</span> <span class="main">=</span> Unassigned <span class="main">∧</span> <span class="free">nP</span> <span class="bound">e2</span> <span class="main">≠</span> Unassigned <span class="main">∨</span> 
      <span class="main">(</span><span class="main">∃</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">e1</span> <span class="main">=</span> Subnet <span class="bound">s1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">∧</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span> <span class="main">=</span> Subnet <span class="bound">s2</span> <span class="main">∨</span> <span class="free">nP</span> <span class="bound">e2</span> <span class="main">=</span> BorderRouter <span class="bound">s2</span><span class="main">)</span><span class="main">)</span> <span class="main">∨</span> 
      <span class="main">(</span><span class="main">∃</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">e1</span> <span class="main">=</span> BorderRouter <span class="bound">s1</span> <span class="main">∧</span> <span class="free">nP</span> <span class="bound">e2</span> <span class="main">=</span> Subnet <span class="bound">s2</span><span class="main">)</span>
   <span class="main">)</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="var">?l</span> <span class="main">⟷</span> <span class="var">?r</span>"</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command">proof</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span> 
    <span class="keyword1"><span class="command">have</span></span> violating_configurations_exhaust_Unassigned<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">nP</span> <span class="skolem">n1</span> <span class="main">=</span> Unassigned <span class="main">⟹</span> <span class="main">¬</span> allowed_subnet_flow <span class="main">(</span><span class="free">nP</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">n2</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">∃</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">.</span>  <span class="free">nP</span> <span class="bound">e1</span> <span class="main">=</span> Unassigned <span class="main">∧</span> <span class="free">nP</span> <span class="bound">e2</span> <span class="main">≠</span> Unassigned "</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n1</span> <span class="skolem">n2</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="skolem">n2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="operator">force</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">have</span></span> violating_configurations_exhaust_Subnet<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">nP</span> <span class="skolem">n1</span> <span class="main">=</span> Subnet <span class="skolem">s1'</span> <span class="main">⟹</span> <span class="main">¬</span> allowed_subnet_flow <span class="main">(</span><span class="free">nP</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">n2</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">∃</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">e1</span> <span class="main">=</span> Subnet <span class="bound">s1</span> <span class="main">∧</span> <span class="bound">s1</span> <span class="main">≠</span> <span class="bound">s2</span> <span class="main">∧</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">e2</span> <span class="main">=</span> Subnet <span class="bound">s2</span> <span class="main">∨</span> <span class="free">nP</span> <span class="bound">e2</span> <span class="main">=</span> BorderRouter <span class="bound">s2</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n1</span> <span class="skolem">n2</span> <span class="skolem">s1'</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="skolem">n2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">have</span></span> violating_configurations_exhaust_BorderRouter<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">n1</span><span class="main">,</span> <span class="skolem">n2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">nP</span> <span class="skolem">n1</span> <span class="main">=</span> BorderRouter <span class="skolem">s1'</span> <span class="main">⟹</span> <span class="main">¬</span> allowed_subnet_flow <span class="main">(</span><span class="free">nP</span> <span class="skolem">n1</span><span class="main">)</span> <span class="main">(</span><span class="free">nP</span> <span class="skolem">n2</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">∃</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">∃</span> <span class="bound">s1</span> <span class="bound">s2</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">e1</span> <span class="main">=</span> BorderRouter <span class="bound">s1</span> <span class="main">∧</span> <span class="free">nP</span> <span class="bound">e2</span> <span class="main">=</span> Subnet <span class="bound">s2</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">n1</span> <span class="skolem">n2</span> <span class="skolem">s1'</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="skolem">n2</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>

    <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="var">?l</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> n1 n2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="improper">n1</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> s1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> s1'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">s1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> violating_configurations_exhaust_Subnet<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> s1<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> s1'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">s1</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> violating_configurations_exhaust_BorderRouter<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> violating_configurations_exhaust_Unassigned<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
  <span class="keyword3"><span class="command">assume</span></span> <span class="var"><span class="quoted"><span class="var">?r</span></span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?l</span></span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">safe</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Unassigned_only_to_Unassigned<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar_mono   
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Subnets_impl">
<div class="head">
<h1>Theory SINVAR_Subnets_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Subnets_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_Subnets.html">SINVAR_Subnets</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Subnets List Implementation›</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_Subnets_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_Subnets

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> subnets<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> allowed_subnet_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Subnets_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> subnets<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Subnets_offending_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
    <span class="main">[]</span>
   <span class="keyword1">else</span> 
    <span class="main">[</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> allowed_subnet_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">]</span> <span class="main">]</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_Subnets.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_Subnets.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Subnets_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span>
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_Subnets.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> Subnets_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_Subnets.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_Subnets.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_Subnets.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">Subnets_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">Subnets_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_Subnets list_graph_to_graph_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def Subnets_offending_set Subnets_offending_set_def Subnets_offending_list_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> Subnets.node_props.simps Subnets.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Subnets_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_Subnets<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Subnets packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_Subnets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> SINVAR_Subnets.subnets<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_Subnets</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''Subnets''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_Subnets.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_Subnets.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> Subnets_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> Subnets_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_Subnets_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_Subnets</span>
      <span class="quoted">SINVAR_Subnets.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_Subnets_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_net_sub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_net_sub</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">42</span><span class="main">]</span><span class="main">,</span> 
    edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> 
    <span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">11</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">11</span><span class="main">)</span><span class="main">,</span> 
    <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">,</span>
    <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">42</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">42</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">42</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"wf_list_graph example_net_sub"</span></span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_conf_sub</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_conf_sub</span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_Subnets.default_node_properties<span class="main">)</span>
    <span class="main">(</span><span class="main">1</span> <span class="main">:=</span> Subnet <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">:=</span> Subnet <span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">:=</span> Subnet <span class="main">1</span><span class="main">,</span> <span class="numeral">4</span><span class="main">:=</span>Subnet <span class="main">1</span><span class="main">,</span> 
     <span class="numeral">11</span><span class="main">:=</span>BorderRouter <span class="main">1</span><span class="main">,</span>
     <span class="numeral">8</span><span class="main">:=</span>Subnet <span class="numeral">2</span><span class="main">,</span> <span class="numeral">9</span><span class="main">:=</span>Subnet <span class="numeral">2</span><span class="main">,</span> 
     <span class="numeral">12</span><span class="main">:=</span>BorderRouter <span class="numeral">2</span><span class="main">,</span>
     <span class="numeral">42</span> <span class="main">:=</span> Unassigned<span class="main">)</span><span class="main">)</span>"</span></span> 
  
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar example_net_sub example_conf_sub"</span></span>
  
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_net_sub_invalid</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_net_sub_invalid</span> <span class="main">≡</span> example_net_sub<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="numeral">42</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>edgesL example_net_sub<span class="main">)</span><span class="main">⦈</span>"</span></span>
  
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar example_net_sub_invalid example_conf_sub"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Subnets_offending_list example_net_sub_invalid example_conf_sub"</span></span>
  


  
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
      <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
      <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_Subnets.default_node_properties<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
      <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">11</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
      <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_Subnets.default_node_properties<span class="main">)</span><span class="main">(</span><span class="main">1</span> <span class="main">:=</span> Subnet <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">:=</span> Subnet <span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">:=</span> Subnet <span class="main">1</span><span class="main">,</span> <span class="numeral">4</span><span class="main">:=</span>Subnet <span class="main">1</span><span class="main">,</span> <span class="numeral">11</span><span class="main">:=</span>BorderRouter <span class="main">1</span><span class="main">,</span>
                                    <span class="numeral">8</span><span class="main">:=</span>Subnet <span class="numeral">2</span><span class="main">,</span> <span class="numeral">9</span><span class="main">:=</span>Subnet <span class="numeral">2</span><span class="main">,</span> <span class="numeral">12</span><span class="main">:=</span>BorderRouter <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
      <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">11</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
      <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_Subnets.default_node_properties<span class="main">)</span><span class="main">(</span><span class="main">1</span> <span class="main">:=</span> Subnet <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">:=</span> Subnet <span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">:=</span> Subnet <span class="main">1</span><span class="main">,</span> <span class="numeral">4</span><span class="main">:=</span>Subnet <span class="main">1</span><span class="main">,</span> <span class="numeral">11</span><span class="main">:=</span>BorderRouter <span class="main">1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
      <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
      <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_Subnets.default_node_properties<span class="main">)</span><span class="main">(</span><span class="numeral">8</span><span class="main">:=</span>Subnet <span class="numeral">8</span><span class="main">,</span> <span class="numeral">9</span><span class="main">:=</span>Subnet <span class="numeral">8</span><span class="main">)</span><span class="main">)</span>"</span></span>
  

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_DomainHierarchyNG">
<div class="head">
<h1>Theory SINVAR_DomainHierarchyNG</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_DomainHierarchyNG
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Lattice/CompleteLattice.html">HOL-Lattice.CompleteLattice</a>"</span> <span class="comment1">(* markarius lattice *)</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹SecurityInvariant DomainHierarchyNG›</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Datatype Domain Hierarchy›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A fully qualified domain name for an entity in a tree-like hierarchy›</span></span>
    <span class="keyword1"><span class="command">datatype</span></span> domainNameDept <span class="main">=</span>  Dept <span class="quoted"><span class="quoted">"string"</span></span> <span class="quoted">domainNameDept</span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1"><span class="keyword1">--</span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span></span>"</span> 65<span class="main">)</span> <span class="main">|</span>
                               Leaf <span class="comment1">― ‹leaf of the tree, end of all domainNames›</span>
    
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Example: the CoffeeMachine of I8›</span></span>
    <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted">''i8''</span><span class="main">--</span><span class="inner_quoted">''CoffeeMachine''</span><span class="main">--</span>Leaf"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A tree strucuture to represent the general hierarchy, i.e. possible domainNameDepts›</span></span>
    <span class="keyword1"><span class="command">datatype</span></span> domainTree <span class="main">=</span> Department 
        <span class="quoted"><span class="quoted">"string"</span></span>  <span class="comment1">― ‹division›</span>
        <span class="quoted"><span class="quoted">"domainTree list"</span></span>  <span class="comment1">― ‹sub divisions›</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹one step in tree to find matching department›</span></span>
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">hierarchy_next</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainTree list <span class="main">⇒</span> domainNameDept <span class="main">⇒</span> domainTree option"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">hierarchy_next</span> <span class="main">[]</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> None"</span></span> <span class="main">|</span> 
      <span class="quoted"><span class="quoted">"<span class="free">hierarchy_next</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span> Leaf <span class="main">=</span> None"</span></span> <span class="main">|</span> 
      <span class="quoted"><span class="quoted">"<span class="free">hierarchy_next</span> <span class="main">(</span><span class="main">(</span>Department <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">ss</span></span></span><span class="main">)</span> <span class="main">(</span>Dept <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="keyword1">then</span> Some <span class="main">(</span>Department <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">hierarchy_next</span> <span class="free"><span class="bound"><span class="entity">ss</span></span></span> <span class="main">(</span>Dept <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Examples:›</span></span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"hierarchy_next <span class="main">[</span>Department <span class="inner_quoted">''i20''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''i8''</span> <span class="main">[</span>Department <span class="inner_quoted">''CoffeeMachine''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''TeaMachine''</span> <span class="main">[]</span><span class="main">]</span><span class="main">]</span> 
        <span class="main">(</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span>
        <span class="main">=</span>
        Some <span class="main">(</span>Department <span class="inner_quoted">''i8''</span> <span class="main">[</span>Department <span class="inner_quoted">''CoffeeMachine''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''TeaMachine''</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"hierarchy_next <span class="main">[</span>Department <span class="inner_quoted">''i20''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''i8''</span> <span class="main">[</span>Department <span class="inner_quoted">''CoffeeMachine''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''TeaMachine''</span> <span class="main">[]</span><span class="main">]</span><span class="main">]</span> 
        <span class="main">(</span><span class="inner_quoted">''i8''</span><span class="main">--</span><span class="inner_quoted">''whatsoever''</span><span class="main">--</span>Leaf<span class="main">)</span>
        <span class="main">=</span>
        Some <span class="main">(</span>Department <span class="inner_quoted">''i8''</span> <span class="main">[</span>Department <span class="inner_quoted">''CoffeeMachine''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''TeaMachine''</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"hierarchy_next <span class="main">[</span>Department <span class="inner_quoted">''i20''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''i8''</span> <span class="main">[</span>Department <span class="inner_quoted">''CoffeeMachine''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''TeaMachine''</span> <span class="main">[]</span><span class="main">]</span><span class="main">]</span> 
        Leaf
        <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"hierarchy_next <span class="main">[</span>Department <span class="inner_quoted">''i20''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''i8''</span> <span class="main">[</span>Department <span class="inner_quoted">''CoffeeMachine''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''TeaMachine''</span> <span class="main">[]</span><span class="main">]</span><span class="main">]</span> 
        <span class="main">(</span><span class="inner_quoted">''i0''</span><span class="main">--</span>Leaf<span class="main">)</span>
        <span class="main">=</span> None"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Does a given <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">domainNameDept</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> match the specified tree structure?›</span></span>
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">valid_hierarchy_pos</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainTree <span class="main">⇒</span> domainNameDept <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">valid_hierarchy_pos</span> <span class="main">(</span>Department <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> Leaf <span class="main">=</span> True"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">valid_hierarchy_pos</span> <span class="main">(</span>Department <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="main">(</span>Dept <span class="free"><span class="bound"><span class="entity">n</span></span></span> Leaf<span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">d</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">valid_hierarchy_pos</span> <span class="main">(</span>Department <span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="free"><span class="bound"><span class="entity">ds</span></span></span><span class="main">)</span> <span class="main">(</span>Dept <span class="free"><span class="bound"><span class="entity">n</span></span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">d</span></span></span> <span class="main">∧</span> 
        <span class="main">(</span><span class="keyword1">case</span> hierarchy_next <span class="free"><span class="bound"><span class="entity">ds</span></span></span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span> <span class="keyword1">of</span> 
          None <span class="main">⇒</span> False <span class="main">|</span>
          Some <span class="bound">t</span> <span class="main">⇒</span> <span class="free">valid_hierarchy_pos</span> <span class="bound">t</span> <span class="free"><span class="bound"><span class="entity">ns</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


     <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Examples:›</span></span>
     <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[]</span><span class="main">)</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
     <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[]</span><span class="main">)</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
     <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
     <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''facilityManagement''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
     <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[]</span><span class="main">)</span> <span class="main">(</span><span class="inner_quoted">''LMU''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
     <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[</span>Department <span class="inner_quoted">''i8''</span> <span class="main">[]</span><span class="main">,</span> <span class="main">(</span>Department <span class="inner_quoted">''i20''</span> <span class="main">[]</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>  <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
     <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[</span>Department <span class="inner_quoted">''i8''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''i20''</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span>  <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
     <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos 
        <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[</span>
           Department <span class="inner_quoted">''i8''</span> <span class="main">[</span>
            Department <span class="inner_quoted">''CoffeeMachine''</span> <span class="main">[]</span><span class="main">,</span>
            Department <span class="inner_quoted">''TeaMachine''</span> <span class="main">[]</span>
           <span class="main">]</span><span class="main">,</span> 
           Department <span class="inner_quoted">''i20''</span> <span class="main">[]</span>
        <span class="main">]</span><span class="main">)</span> 
        <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span><span class="inner_quoted">''CoffeeMachine''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
     <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[</span>Department <span class="inner_quoted">''i8''</span> <span class="main">[</span>Department <span class="inner_quoted">''CoffeeMachine''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''TeaMachine''</span> <span class="main">[]</span><span class="main">]</span><span class="main">,</span> Department <span class="inner_quoted">''i20''</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span> 
        <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span><span class="inner_quoted">''CleanKitchen''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

     <span class="comment1">(*end tree*)</span>
     
  
  <span class="keyword1"><span class="command">instantiation</span></span> domainNameDept <span class="main">::</span> <span class="quoted">order</span>
  <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="keyword1"><span class="command">print_context</span></span>
    
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_eq_domainNameDept</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainNameDept <span class="main">⇒</span> domainNameDept <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"Leaf <span class="main">≤</span> <span class="main">(</span>Dept <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>Dept <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">≤</span> Leaf <span class="main">=</span> True"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"Leaf <span class="main">≤</span> Leaf <span class="main">=</span> True"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>Dept <span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="free"><span class="bound"><span class="entity">n1s</span></span></span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>Dept <span class="free"><span class="bound"><span class="entity">n2</span></span></span> <span class="free"><span class="bound"><span class="entity">n2s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n1</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">n2</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n1s</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">n2s</span></span></span><span class="main">)</span>"</span></span>
    
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">less_domainNameDept</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainNameDept <span class="main">⇒</span> domainNameDept <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"Leaf <span class="main">&lt;</span> Leaf <span class="main">=</span> False"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"Leaf <span class="main">&lt;</span> <span class="main">(</span>Dept <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>Dept <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main">&lt;</span> Leaf <span class="main">=</span> True"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span>Dept <span class="free"><span class="bound"><span class="entity">n1</span></span></span> <span class="free"><span class="bound"><span class="entity">n1s</span></span></span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>Dept <span class="free"><span class="bound"><span class="entity">n2</span></span></span> <span class="free"><span class="bound"><span class="entity">n2s</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">n1</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">n2</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">n1s</span></span></span> <span class="main">&lt;</span> <span class="free"><span class="bound"><span class="entity">n2s</span></span></span><span class="main">)</span>"</span></span>
    
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-Leaf_Top"><span class="command">lemma</span></span> Leaf_Top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> Leaf"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-Leaf_Top_Unique"><span class="command">lemma</span></span> Leaf_Top_Unique<span class="main">:</span> <span class="quoted"><span class="quoted">"Leaf <span class="main">≤</span> <span class="free">a</span> <span class="main">=</span> <span class="main">(</span><span class="free">a</span> <span class="main">=</span> Leaf<span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-no_Bot"><span class="command">lemma</span></span> no_Bot<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">n1</span> <span class="main">--</span> <span class="free">n1s</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">n2</span> <span class="main">--</span> <span class="free">n2s</span> <span class="main">⟹</span> False"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-uncomparable_sup_is_Top"><span class="command">lemma</span></span> uncomparable_sup_is_Top<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">n1</span> <span class="main">≠</span> <span class="free">n2</span> <span class="main">⟹</span> <span class="free">n1</span> <span class="main">--</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">n2</span> <span class="main">--</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">=</span> Leaf"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">z</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

   <span class="keyword1" id="SINVAR_DomainHierarchyNG-common_inf_imp_comparable"><span class="command">lemma</span></span> common_inf_imp_comparable<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">z</span><span class="main">::</span>domainNameDept<span class="main">)</span> <span class="main">≤</span> <span class="free">a</span> <span class="main">⟹</span> <span class="free">z</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">∨</span> <span class="free">b</span> <span class="main">≤</span> <span class="free">a</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> zn zdpt a b<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Leaf_Top_Unique<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> an adpt<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Leaf_Top<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">b</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> bn bdpt<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Leaf_Top<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-prepend_domain"><span class="command">lemma</span></span> prepend_domain<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> <span class="free">b</span> <span class="main">⟹</span> <span class="free">x</span><span class="main">--</span><span class="free">a</span> <span class="main">≤</span> <span class="free">x</span><span class="main">--</span><span class="free">b</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-unfold_dmain_leq"><span class="command">lemma</span></span> unfold_dmain_leq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">zn</span> <span class="main">--</span> <span class="free">zns</span> <span class="main">⟹</span> <span class="main">∃</span><span class="bound">yns</span><span class="main">.</span> <span class="free">y</span> <span class="main">=</span> <span class="free">zn</span> <span class="main">--</span> <span class="bound">yns</span> <span class="main">∧</span> <span class="bound">yns</span> <span class="main">≤</span> <span class="free">zns</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">y</span> <span class="main">≤</span> <span class="free">zn</span> <span class="main">--</span> <span class="free">zns</span>"</span></span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">sk<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>0</sub></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainNameDept <span class="main">⇒</span> char list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem"><span class="skolem">sk<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>1</sub></span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainNameDept <span class="main">⇒</span> domainNameDept"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span><span class="main">.</span> <span class="skolem">sk<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>0</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">--</span> <span class="skolem">sk<span class="hidden">⇩</span><sub>3</sub><span class="hidden">⇩</span><sub>1</sub></span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span> <span class="main">∨</span> Leaf <span class="main">=</span> <span class="bound">x<span class="hidden">⇩</span><sub>0</sub></span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> domainNameDept.exhaust<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">yns</span><span class="main">.</span> <span class="free">y</span> <span class="main">=</span> <span class="free">zn</span> <span class="main">--</span> <span class="bound">yns</span> <span class="main">∧</span> <span class="bound">yns</span> <span class="main">≤</span> <span class="free">zns</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span> a1 <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> less_eq_domainNameDept.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> less_eq_domainNameDept.simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-less_eq_refl"><span class="command">lemma</span></span> less_eq_refl<span class="main">:</span> 
      <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">x</span> <span class="main">::</span> <span class="quoted">domainNameDept</span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟶</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟶</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span> <span class="comment1">(*induction over prems and conclusion*)</span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">z</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span><span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Leaf
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> Leaf"</span></span> <span class="keyword1"><span class="command">using</span></span> Leaf_Top <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Dept <span class="skolem">zn</span> <span class="skolem">zns</span><span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">zn</span><span class="main">--</span><span class="skolem">zns</span>"</span></span>
            <span class="keyword1"><span class="command">from</span></span> unfold_dmain_leq<span class="main">[</span><span class="operator">OF</span> a2<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">yns</span></span> <span class="keyword2"><span class="keyword">where</span></span> y1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">y</span> <span class="main">=</span> <span class="skolem">zn</span><span class="main">--</span><span class="skolem">yns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> y2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">yns</span> <span class="main">≤</span> <span class="skolem">zns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
            <span class="keyword1"><span class="command">from</span></span> unfold_dmain_leq this a1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">xns</span></span> <span class="keyword2"><span class="keyword">where</span></span> x1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">=</span> <span class="skolem">zn</span> <span class="main">--</span> <span class="skolem">xns</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> x2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">xns</span> <span class="main">≤</span> <span class="skolem">yns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">from</span></span> Dept y2 x2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">xns</span> <span class="main">≤</span> <span class="skolem">zns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> this x1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">zn</span><span class="main">--</span><span class="skolem">zns</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="main">≤</span> <span class="free">y</span> <span class="main">⟹</span> <span class="free">y</span> <span class="main">≤</span> <span class="free">z</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">≤</span> <span class="free">z</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
  
    <span class="keyword1"><span class="command">instance</span></span>
      <span class="keyword1"><span class="command">proof</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span><span class="quoted">domainNameDept</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x</span> <span class="main">&lt;</span> <span class="skolem">y</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">∧</span> <span class="main">¬</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_domainNameDept.induct<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span><span class="main">::</span><span class="quoted">domainNameDept</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">x</span>"</span></span>
          <span class="keyword1"><span class="command">using</span></span><span class="main">[</span><span class="main">[</span><span class="operator">show_types</span><span class="main">]</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">x</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="skolem">z</span> <span class="main">::</span> <span class="quoted">domainNameDept</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">z</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">z</span> "</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> less_eq_refl<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">x</span> <span class="skolem">y</span> <span class="main">::</span><span class="quoted">domainNameDept</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">≤</span> <span class="skolem">y</span> <span class="main">⟹</span> <span class="skolem">y</span> <span class="main">≤</span> <span class="skolem">x</span> <span class="main">⟹</span> <span class="skolem">x</span> <span class="main">=</span> <span class="skolem">y</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> less_domainNameDept.induct<span class="main">)</span>
             <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword2"><span class="keyword">end</span></span>

  <span class="keyword1"><span class="command">instantiation</span></span> domainNameDept <span class="main">::</span> <span class="quoted">Orderings.top</span>
  <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity"><span class="class_parameter">top_domainNameDept</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"Orderings.top <span class="main">≡</span> Leaf"</span></span>
    <span class="keyword1"><span class="command">instance</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">intro_classes</span>
  <span class="keyword2"><span class="keyword">end</span></span>

    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''BLUBB''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[</span>Department <span class="inner_quoted">''i8''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''i20''</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">≤</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[</span>Department <span class="inner_quoted">''i8''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''i20''</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> Leaf <span class="main">≤</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"valid_hierarchy_pos <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[</span>Department <span class="inner_quoted">''i8''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''i20''</span> <span class="main">[]</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''BLUBB''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="inner_quoted">''X''</span><span class="main">--</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''BLUBB''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span><span class="inner_quoted">''CoffeeMachine''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span><span class="inner_quoted">''CoffeeMachine''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span><span class="inner_quoted">''CoffeeMachine''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i20''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i20''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>



  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Adding Chop›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹by putting entities higher in the hierarchy.›</span></span>
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">domainNameDeptChopOne</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainNameDept <span class="main">⇒</span> domainNameDept"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">domainNameDeptChopOne</span> Leaf <span class="main">=</span> Leaf"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">domainNameDeptChopOne</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">name</span></span></span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">=</span> Leaf"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">domainNameDeptChopOne</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">name</span></span></span><span class="main">--</span><span class="free"><span class="bound"><span class="entity">dpt</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">name</span></span></span><span class="main">--</span><span class="main">(</span><span class="free">domainNameDeptChopOne</span> <span class="free"><span class="bound"><span class="entity">dpt</span></span></span><span class="main">)</span>"</span></span>
    
    
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"domainNameDeptChopOne <span class="main">(</span><span class="inner_quoted">''i8''</span><span class="main">--</span><span class="inner_quoted">''CoffeeMachine''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''i8''</span> <span class="main">--</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"domainNameDeptChopOne <span class="main">(</span><span class="inner_quoted">''i8''</span><span class="main">--</span><span class="inner_quoted">''CoffeeMachine''</span><span class="main">--</span><span class="inner_quoted">''CoffeeSlave''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''i8''</span> <span class="main">--</span> <span class="inner_quoted">''CoffeeMachine''</span> <span class="main">--</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"domainNameDeptChopOne Leaf <span class="main">=</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> domainNameDeptChopOne.simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    
    <span class="keyword1"><span class="command">theorem</span></span> chopOne_not_decrease<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dn</span> <span class="main">≤</span> domainNameDeptChopOne <span class="free">dn</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">dn</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> name dpt<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">name</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> prepend_domain<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">dpt</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-chopOneContinue"><span class="command">lemma</span></span> chopOneContinue<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dpt</span> <span class="main">≠</span> Leaf <span class="main">⟹</span> domainNameDeptChopOne <span class="main">(</span><span class="free">name</span> <span class="main">--</span> <span class="free">dpt</span><span class="main">)</span> <span class="main">=</span> <span class="free">name</span> <span class="main">--</span> domainNameDeptChopOne <span class="main">(</span><span class="free">dpt</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">dpt</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">domainNameChop</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainNameDept <span class="main">⇒</span> nat <span class="main">⇒</span> domainNameDept"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">domainNameChop</span> Leaf <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Leaf"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">domainNameChop</span> <span class="free"><span class="bound"><span class="entity">namedpt</span></span></span> <span class="main">0</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">namedpt</span></span></span>"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">domainNameChop</span> <span class="free"><span class="bound"><span class="entity">namedpt</span></span></span> <span class="main">(</span>Suc <span class="free"><span class="bound"><span class="entity">n</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="free">domainNameChop</span> <span class="main">(</span>domainNameDeptChopOne <span class="free"><span class="bound"><span class="entity">namedpt</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">n</span></span></span>"</span></span>
    
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"domainNameChop <span class="main">(</span><span class="inner_quoted">''i8''</span><span class="main">--</span><span class="inner_quoted">''CoffeeMachine''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="numeral">2</span> <span class="main">=</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"domainNameChop <span class="main">(</span><span class="inner_quoted">''i8''</span><span class="main">--</span><span class="inner_quoted">''CoffeeMachine''</span><span class="main">--</span><span class="inner_quoted">''CoffeeSlave''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="numeral">2</span> <span class="main">=</span> <span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"domainNameChop <span class="main">(</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">0</span> <span class="main">=</span> <span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"domainNameChop <span class="main">(</span>Leaf<span class="main">)</span> <span class="numeral">8</span> <span class="main">=</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    
    
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-chop0"><span class="command">lemma</span></span> chop0<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"domainNameChop <span class="free">dn</span> <span class="main">0</span> <span class="main">=</span> <span class="free">dn</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">dn</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
    
    
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>domainNameDeptChopOne<span class="main">^^</span><span class="numeral">2</span><span class="main">)</span> <span class="main">(</span><span class="inner_quoted">''d1''</span><span class="main">--</span><span class="inner_quoted">''d2''</span><span class="main">--</span><span class="inner_quoted">''d3''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''d1''</span><span class="main">--</span>Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹domainNameChop is equal to applying n times chop one›</span></span>
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-domainNameChopFunApply"><span class="command">lemma</span></span> domainNameChopFunApply<span class="main">:</span> <span class="quoted"><span class="quoted">"domainNameChop <span class="free">dn</span> <span class="free">n</span> <span class="main">=</span> <span class="main">(</span>domainNameDeptChopOne<span class="main">^^</span><span class="free">n</span><span class="main">)</span> <span class="free">dn</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">dn</span></span> <span class="quoted"><span class="free">n</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> domainNameChop.induct<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> nat<span class="main"><span class="keyword3">,</span></span><span class="operator">induct_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">nat</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> n<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> funpow_swap1<span class="main">)</span>
    
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-domainNameChopRotateSuc"><span class="command">lemma</span></span> domainNameChopRotateSuc<span class="main">:</span> <span class="quoted"><span class="quoted">"domainNameChop <span class="free">dn</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span> <span class="main">=</span> domainNameDeptChopOne <span class="main">(</span>domainNameChop <span class="free">dn</span> <span class="free">n</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domainNameChopFunApply<span class="main">)</span>
    
    <span class="keyword1" id="SINVAR_DomainHierarchyNG-domainNameChopRotate"><span class="command">lemma</span></span> domainNameChopRotate<span class="main">:</span> <span class="quoted"><span class="quoted">"domainNameChop <span class="main">(</span>domainNameDeptChopOne <span class="free">dn</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> domainNameDeptChopOne <span class="main">(</span>domainNameChop <span class="free">dn</span> <span class="free">n</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"domainNameChop <span class="main">(</span>domainNameDeptChopOne <span class="free">dn</span><span class="main">)</span> <span class="free">n</span> <span class="main">=</span> domainNameChop <span class="free">dn</span> <span class="main">(</span>Suc <span class="free">n</span><span class="main">)</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> domainNameChopFunApply<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">dn</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    
    
    <span class="keyword1"><span class="command">theorem</span></span> chop_not_decrease_hierarchy<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">dn</span> <span class="main">≤</span> domainNameChop <span class="free">dn</span> <span class="free">n</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">n</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">dn</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> name dpt<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>domainNameChopRotate<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> chopOne_not_decrease less_eq_refl<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
    <span class="keyword1"><span class="command">corollary</span></span> <span class="quoted"><span class="quoted">"<span class="free">dn</span> <span class="main">≤</span> domainNameDeptChopOne <span class="main">(</span><span class="main">(</span>domainNameDeptChopOne <span class="main">^^</span> <span class="free">n</span><span class="main">)</span> <span class="main">(</span><span class="free">dn</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> chop_not_decrease_hierarchy domainNameChopFunApply domainNameChopRotateSuc<span class="main">)</span>
      

   <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹compute maximum common level of both inputs›</span></span>
   <span class="keyword1"><span class="command">fun</span></span> <span class="entity">chop_sup</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainNameDept <span class="main">⇒</span> domainNameDept <span class="main">⇒</span> domainNameDept"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">chop_sup</span> Leaf <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Leaf"</span></span> <span class="main">|</span> 
      <span class="quoted"><span class="quoted">"<span class="free">chop_sup</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> Leaf <span class="main">=</span> Leaf"</span></span> <span class="main">|</span> 
      <span class="quoted"><span class="quoted">"<span class="free">chop_sup</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">--</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">--</span><span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≠</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> Leaf <span class="keyword1">else</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">--</span><span class="main">(</span><span class="free">chop_sup</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span> 

   <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"chop_sup <span class="main">(</span><span class="inner_quoted">''a''</span><span class="main">--</span><span class="inner_quoted">''b''</span><span class="main">--</span><span class="inner_quoted">''c''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">(</span><span class="inner_quoted">''a''</span><span class="main">--</span><span class="inner_quoted">''b''</span><span class="main">--</span><span class="inner_quoted">''d''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''a''</span> <span class="main">--</span> <span class="inner_quoted">''b''</span> <span class="main">--</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
   <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"chop_sup <span class="main">(</span><span class="inner_quoted">''a''</span><span class="main">--</span><span class="inner_quoted">''b''</span><span class="main">--</span><span class="inner_quoted">''c''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">(</span><span class="inner_quoted">''a''</span><span class="main">--</span><span class="inner_quoted">''x''</span><span class="main">--</span><span class="inner_quoted">''d''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">=</span> <span class="inner_quoted">''a''</span> <span class="main">--</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
   <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"chop_sup <span class="main">(</span><span class="inner_quoted">''a''</span><span class="main">--</span><span class="inner_quoted">''b''</span><span class="main">--</span><span class="inner_quoted">''c''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">(</span><span class="inner_quoted">''x''</span><span class="main">--</span><span class="inner_quoted">''x''</span><span class="main">--</span><span class="inner_quoted">''d''</span><span class="main">--</span>Leaf<span class="main">)</span> <span class="main">=</span> Leaf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

   <span class="keyword1" id="SINVAR_DomainHierarchyNG-chop_sup_commute"><span class="command">lemma</span></span> chop_sup_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"chop_sup <span class="free">a</span> <span class="free">b</span> <span class="main">=</span> chop_sup <span class="free">b</span> <span class="free">a</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> chop_sup.induct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> a<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1" id="SINVAR_DomainHierarchyNG-chop_sup_max1"><span class="command">lemma</span></span> chop_sup_max1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">a</span> <span class="main">≤</span> chop_sup <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> chop_sup.induct<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_DomainHierarchyNG-chop_sup_max2"><span class="command">lemma</span></span> chop_sup_max2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">b</span> <span class="main">≤</span> chop_sup <span class="free">a</span> <span class="free">b</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> chop_sup_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chop_sup_max1<span class="main">)</span>

   <span class="comment1">(* don't need this, preserver ≤ on domainNameDept and ⊑ on domainName
   instantiation domainNameDept :: partial_order
   begin
     fun leq_domainNameDept :: "domainNameDept ⇒ domainNameDept ⇒ bool" (* ⊑ *) where 
      "leq_domainNameDept a b = (a ≤ b)"
   instance
      by(intro_classes,simp_all)
   end
   *)</span>
   <span class="keyword1" id="SINVAR_DomainHierarchyNG-chop_sup_is_sup"><span class="command">lemma</span></span> chop_sup_is_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">z</span><span class="main">.</span> <span class="free">a</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">∧</span> <span class="free">b</span> <span class="main">≤</span> <span class="bound">z</span> <span class="main">⟶</span> chop_sup <span class="free">a</span> <span class="free">b</span> <span class="main">≤</span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span> <span class="quoted"><span class="free">b</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> chop_sup.induct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">z</span><span class="main">=</span>Leaf"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> uncomparable_sup_is_Top<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">z</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    


  <span class="keyword1"><span class="command">datatype</span></span> domainName <span class="main">=</span> DN <span class="quoted">domainNameDept</span> <span class="main">|</span> Unassigned


  <span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Makeing it a complete Lattice›</span></span>
    <span class="keyword1"><span class="command">instantiation</span></span> domainName <span class="main">::</span> <span class="quoted">partial_order</span>
    <span class="keyword2"><span class="keyword">begin</span></span>
      <span class="comment1">(* adding trust here would violate transitivity or antsymmetry *)</span>
      <span class="keyword1"><span class="command">fun</span></span> <span class="entity"><span class="class_parameter">leq_domainName</span></span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainName <span class="main">⇒</span> domainName <span class="main">⇒</span> bool"</span></span> <span class="comment1">(* ⊑ *)</span> <span class="keyword2"><span class="keyword">where</span></span> 
        <span class="quoted"><span class="quoted">"<span class="free">leq_domainName</span> Unassigned <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
        <span class="quoted"><span class="quoted">"<span class="free">leq_domainName</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> Unassigned <span class="main">=</span> False"</span></span> <span class="main">|</span>
        <span class="quoted"><span class="quoted">"<span class="free">leq_domainName</span> <span class="main">(</span>DN <span class="free"><span class="bound"><span class="entity">dnA</span></span></span><span class="main">)</span> <span class="main">(</span>DN <span class="free"><span class="bound"><span class="entity">dnB</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">dnA</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">dnB</span></span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">instance</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro_classes</span><span class="main">)</span>
      <span class="comment1">(* x ⊑ x *)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="comment1">(* x ⊑ y ⟹ y ⊑ z ⟹ x ⊑ z *)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> dnX<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> dnY<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">z</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> dnZ<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="comment1">(* x ⊑ y ⟹ y ⊑ x ⟹ x = y *)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> dnX<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">y</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> dnY<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> domainName.exhaust leq_domainName.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword2"><span class="keyword">end</span></span>

    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"is_Inf <span class="main">{</span>Unassigned<span class="main">,</span> DN Leaf<span class="main">}</span> Unassigned"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_Inf_def<span class="main">)</span>
    
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The infinum of two elements:›</span></span>
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">DN_inf</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainName <span class="main">⇒</span> domainName <span class="main">⇒</span> domainName"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">DN_inf</span> Unassigned <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> Unassigned"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">DN_inf</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> Unassigned <span class="main">=</span> Unassigned"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">DN_inf</span> <span class="main">(</span>DN <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>DN <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">then</span> DN <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">else</span> <span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="main">≤</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="keyword1">then</span> DN <span class="free"><span class="bound"><span class="entity">b</span></span></span> <span class="keyword1">else</span> Unassigned<span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"DN_inf <span class="main">(</span>DN <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span><span class="main">)</span> <span class="main">(</span>DN <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i20''</span><span class="main">--</span>Leaf<span class="main">)</span><span class="main">)</span> <span class="main">=</span> Unassigned"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
    <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"DN_inf <span class="main">(</span>DN <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">)</span><span class="main">)</span> <span class="main">(</span>DN <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span>Leaf<span class="main">)</span><span class="main">)</span> <span class="main">=</span> DN <span class="main">(</span><span class="inner_quoted">''TUM''</span> <span class="main">--</span> <span class="inner_quoted">''i8''</span> <span class="main">--</span> Leaf<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
      

    <span class="keyword1" id="SINVAR_DomainHierarchyNG-DN_inf_commute"><span class="command">lemma</span></span> DN_inf_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"DN_inf <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> DN_inf <span class="free">y</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> DN_inf.induct<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

    <span class="keyword1" id="SINVAR_DomainHierarchyNG-DN_inf_is_inf"><span class="command">lemma</span></span> DN_inf_is_inf<span class="main">:</span> <span class="quoted"><span class="quoted">"is_inf <span class="free">x</span> <span class="free">y</span> <span class="main">(</span>DN_inf <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> DN_inf.induct<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_inf_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_inf_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_inf_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> z<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">z</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> zn<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> common_inf_imp_comparable <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">DN_sup</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainName <span class="main">⇒</span> domainName <span class="main">⇒</span> domainName"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">DN_sup</span> Unassigned <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span> <span class="main">|</span> 
      <span class="quoted"><span class="quoted">"<span class="free">DN_sup</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> Unassigned <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span>"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">DN_sup</span> <span class="main">(</span>DN <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">)</span> <span class="main">(</span>DN <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span> <span class="main">=</span> DN <span class="main">(</span>chop_sup <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="free"><span class="bound"><span class="entity">b</span></span></span><span class="main">)</span>"</span></span>

    <span class="keyword1" id="SINVAR_DomainHierarchyNG-DN_sup_commute"><span class="command">lemma</span></span> DN_sup_commute<span class="main">:</span> <span class="quoted"><span class="quoted">"DN_sup <span class="free">x</span> <span class="free">y</span> <span class="main">=</span> DN_sup <span class="free">y</span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> DN_sup.induct<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chop_sup_commute<span class="main">)</span>

    <span class="keyword1" id="SINVAR_DomainHierarchyNG-DN_sup_is_sup"><span class="command">lemma</span></span> DN_sup_is_sup<span class="main">:</span> <span class="quoted"><span class="quoted">"is_sup <span class="free">x</span> <span class="free">y</span> <span class="main">(</span>DN_sup <span class="free">x</span> <span class="free">y</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span> <span class="quoted"><span class="free">y</span></span> <span class="quasi_keyword">rule</span><span class="main"><span class="main">:</span></span> DN_inf.induct<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sup_def leq_refl<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sup_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_sup_def chop_sup_max1 chop_sup_max2<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> z<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">z</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> zn<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chop_sup_is_sup<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹domainName is a Lattice:›</span></span>
    <span class="keyword1"><span class="command">instantiation</span></span> domainName <span class="main">::</span> <span class="quoted">lattice</span>
      <span class="keyword2"><span class="keyword">begin</span></span>
      <span class="keyword1"><span class="command">instance</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">intro_classes</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"DN_inf <span class="improper">x</span> <span class="improper">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> DN_inf_is_inf<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"DN_sup <span class="improper">x</span> <span class="improper">y</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> DN_sup_is_sup<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword2"><span class="keyword">end</span></span>
    



<span class="comment1">(*TRUST*)</span>


  <span class="keyword1"><span class="command">datatype</span></span> domainNameTrust <span class="main">=</span> DN <span class="quoted"><span class="quoted">"<span class="main">(</span>domainNameDept <span class="main">×</span> nat<span class="main">)</span>"</span></span> <span class="main">|</span> Unassigned

    <span class="comment1">(*transitivity only if trustA ≥ trust C*)</span>
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">leq_domainNameTrust</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainNameTrust <span class="main">⇒</span> domainNameTrust <span class="main">⇒</span> bool"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">infixr</span></span> <span class="quoted">"<span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span>"</span> 65<span class="main">)</span>  <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="free">leq_domainNameTrust</span> Unassigned <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">leq_domainNameTrust</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> Unassigned <span class="main">=</span> False"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">leq_domainNameTrust</span> <span class="main">(</span>DN <span class="main">(</span><span class="free"><span class="bound"><span class="entity">dnA</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">trustA</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>DN <span class="main">(</span><span class="free"><span class="bound"><span class="entity">dnB</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">trustB</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">dnA</span></span></span> <span class="main">≤</span> <span class="main">(</span>domainNameChop <span class="free"><span class="bound"><span class="entity">dnB</span></span></span> <span class="free"><span class="bound"><span class="entity">trustB</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

    <span class="keyword1" id="SINVAR_DomainHierarchyNG-leq_domainNameTrust_refl"><span class="command">lemma</span></span> leq_domainNameTrust_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">x</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> prod<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">prod</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> chop_not_decrease_hierarchy<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   
   <span class="keyword1" id="SINVAR_DomainHierarchyNG-leq_domainNameTrust_NOT_trans"><span class="command">lemma</span></span> leq_domainNameTrust_NOT_trans<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span> <span class="bound">z</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="bound">z</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">x</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="bound">z</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"DN <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"DN <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"DN <span class="main">(</span><span class="inner_quoted">''TUM''</span><span class="main">--</span><span class="inner_quoted">''i8''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

   <span class="keyword1" id="SINVAR_DomainHierarchyNG-leq_domainNameTrust_NOT_antisym"><span class="command">lemma</span></span> leq_domainNameTrust_NOT_antisym<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span> <span class="bound">y</span><span class="main">.</span> <span class="bound">x</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="bound">y</span> <span class="main">∧</span> <span class="bound">y</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="bound">x</span> <span class="main">∧</span> <span class="bound">x</span> <span class="main">≠</span> <span class="bound">y</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"DN <span class="main">(</span>Leaf<span class="main">,</span> <span class="numeral">3</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"DN <span class="main">(</span>Leaf<span class="main">,</span> <span class="numeral">4</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The network security invariant›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainNameTrust"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">=</span> Unassigned"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The sender is, noticing its trust level, on the same or higher hierarchy level as the receiver.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> domainNameTrust<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">r</span><span class="main">)</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="comment1">(*TODO: old legacy function!*)</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹a domain name must be in the supplied tree›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">verify_globals</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> domainNameTrust<span class="main">)</span> <span class="main">⇒</span> domainTree <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">verify_globals</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="free"><span class="bound"><span class="entity">tree</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> 
    <span class="keyword1">case</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v</span><span class="main">)</span> <span class="keyword1">of</span> Unassigned <span class="main">⇒</span> True <span class="main">|</span> DN <span class="main">(</span><span class="bound">level</span><span class="main">,</span> <span class="bound">trust</span><span class="main">)</span> <span class="main">⇒</span> valid_hierarchy_pos <span class="free"><span class="bound"><span class="entity">tree</span></span></span> <span class="bound">level</span>
   <span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"verify_globals <span class="main">⦇</span> nodes<span class="main">=</span>set <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span> edges<span class="main">=</span>set <span class="main">[]</span> <span class="main">⦈</span> <span class="main">(</span><span class="main">λ</span><span class="bound">n</span><span class="main">.</span> default_node_properties<span class="main">)</span> <span class="main">(</span>Department <span class="inner_quoted">''TUM''</span> <span class="main">[]</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> default_node_properties_def<span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">=</span> False"</span></span>




<span class="keyword1"><span class="command">thm</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def
<span class="keyword1" id="SINVAR_DomainHierarchyNG-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> SecurityInvariant_withOffendingFlows.sinvar_mono_I_proofrule<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> nP e1 e2 N E' e1' e2' E<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
<span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_sinvar_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ENF›</span></span>
  <span class="keyword1" id="SINVAR_DomainHierarchyNG-DomainHierarchyNG_ENF"><span class="command">lemma</span></span> DomainHierarchyNG_ENF<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form sinvar <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1" id="SINVAR_DomainHierarchyNG-DomainHierarchyNG_ENF_refl"><span class="command">lemma</span></span> DomainHierarchyNG_ENF_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.ENF_refl sinvar <span class="main">(</span><span class="main">λ</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="bound">s</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.ENF_refl_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DomainHierarchyNG_ENF<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> leq_domainNameTrust_refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1" id="SINVAR_DomainHierarchyNG-unassigned_default_candidate"><span class="command">lemma</span></span> unassigned_default_candidate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">nP</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">r</span><span class="main">)</span>  <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">r</span><span class="main">)</span>  <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> default_node_properties"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> default_node_properties_def<span class="main">)</span> 
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> leq_domainNameTrust.elims<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> leq_domainNameTrust.simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">DomainHierarchyNG_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> domainNameTrust<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">DomainHierarchyNG_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="SINVAR_DomainHierarchyNG-DomainHierarchyNG_offending_set"><span class="command">lemma</span></span> DomainHierarchyNG_offending_set<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> DomainHierarchyNG_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_eq_iff SecurityInvariant_withOffendingFlows.ENF_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> DomainHierarchyNG_ENF<span class="main"><span class="main">]</span></span> DomainHierarchyNG_offending_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> G nP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span>prod.split_asm prod.split <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1" id="SINVAR_DomainHierarchyNG-Unassigned_unique_default"><span class="command">lemma</span></span> Unassigned_unique_default<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">otherbot</span> <span class="main">≠</span> default_node_properties <span class="main">⟹</span>
         <span class="main">∃</span><span class="bound">G</span> <span class="bound">nP</span> <span class="bound">gP</span> <span class="bound">i</span> <span class="bound">f</span><span class="main">.</span>
            wf_graph <span class="bound">G</span> <span class="main">∧</span> 
            <span class="main">¬</span> sinvar <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span>
            <span class="bound">f</span> <span class="main">∈</span> SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span>
            sinvar <span class="main">(</span>delete_edges <span class="bound">G</span> <span class="bound">f</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">∧</span>
            <span class="main">(</span><span class="bound">i</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="bound">f</span> <span class="main">∧</span> sinvar <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
        SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
        SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split domainNameTrust.split<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">otherbot</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> prod<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">prod</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> dn trustlevel<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>

     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">dn</span></span><span class="main">)</span>
  
    <span class="comment1">(* case (name -- dpt, trustlevel)  *)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> name dpt<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> default_node_properties<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> DN <span class="main">(</span><span class="improper">name</span><span class="main">--</span><span class="improper">dpt</span><span class="main">,</span> <span class="main">0</span> <span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>chop_not_decrease_hierarchy<span class="main">)</span>
  
    <span class="comment1">(* case (Leaf, trustlevel)*)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> default_node_properties<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> DN <span class="main">(</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  
    <span class="comment1">(* case Unassigned *)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> default_node_properties_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">interpretation</span></span> DomainHierarchyNG<span class="main">:</span> SecurityInvariant_ACS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
<span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> DomainHierarchyNG_offending_set"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> SecurityInvariant_withOffendingFlows.ENF_fsts_refl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> DomainHierarchyNG_ENF_refl unassigned_default_candidate<span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> Unassigned_unique_default<span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> DomainHierarchyNG_offending_set<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>




<span class="keyword1" id="SINVAR_DomainHierarchyNG-TopoS_DomainHierarchyNG"><span class="command">lemma</span></span> TopoS_DomainHierarchyNG<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>




<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_DomainHierarchyNG_impl">
<div class="head">
<h1>Theory SINVAR_DomainHierarchyNG_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_DomainHierarchyNG_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_DomainHierarchyNG.html">SINVAR_DomainHierarchyNG</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant DomainHierarchy List Implementation›</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_DomainHierarchyNG_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_DomainHierarchyNG

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> domainNameTrust<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">r</span><span class="main">)</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">s</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">DomainHierarchyNG_sanity_check_config</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainNameTrust list <span class="main">⇒</span> domainTree <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">DomainHierarchyNG_sanity_check_config</span> <span class="free"><span class="bound"><span class="entity">host_attributes</span></span></span> <span class="free"><span class="bound"><span class="entity">tree</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">c</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">host_attributes</span></span></span><span class="main">.</span>
    <span class="keyword1">case</span> <span class="bound">c</span> <span class="keyword1">of</span> Unassigned <span class="main">⇒</span> True
            <span class="main">|</span> DN <span class="main">(</span><span class="bound">level</span><span class="main">,</span> <span class="bound">trust</span><span class="main">)</span> <span class="main">⇒</span> valid_hierarchy_pos <span class="free"><span class="bound"><span class="entity">tree</span></span></span> <span class="bound">level</span>
   <span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">verify_globals</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> domainNameTrust<span class="main">)</span> <span class="main">⇒</span> domainTree <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">verify_globals</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="free"><span class="bound"><span class="entity">tree</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> 
    <span class="keyword1">case</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v</span><span class="main">)</span> <span class="keyword1">of</span> Unassigned <span class="main">⇒</span> True <span class="main">|</span> DN <span class="main">(</span><span class="bound">level</span><span class="main">,</span> <span class="bound">trust</span><span class="main">)</span> <span class="main">⇒</span> valid_hierarchy_pos <span class="free"><span class="bound"><span class="entity">tree</span></span></span> <span class="bound">level</span>
   <span class="main">)</span>"</span></span>

<span class="comment1">(*TODO: to get rid of verify_globals
  this stronger DomainHierarchyNG_sanity_check_config sanity checker checks the config
  for all graphs!*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"DomainHierarchyNG_sanity_check_config <span class="free">c</span> <span class="free">tree</span> <span class="main">⟹</span>
    <span class="main">{</span><span class="bound">x</span><span class="main">.</span> <span class="main">∃</span><span class="bound">v</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">=</span> <span class="bound">x</span><span class="main">}</span> <span class="main">=</span> set <span class="free">c</span> <span class="main">⟹</span>
    verify_globals <span class="free">G</span> <span class="free">nP</span> <span class="free">tree</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DomainHierarchyNG_sanity_check_config_def <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="improper">v</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">DomainHierarchyNG_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> domainNameTrust<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">DomainHierarchyNG_offending_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
    <span class="main">[]</span>
   <span class="keyword1">else</span> 
    <span class="main">[</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">r</span><span class="main">)</span> <span class="keyword1">⊑<span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>r</sub><span class="hidden">⇩</span><sub>u</sub><span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="main">]</span> <span class="main">]</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"DomainHierarchyNG.node_props <span class="free">P</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">λ</span><span class="bound">i</span><span class="main">.</span> <span class="keyword1">case</span> node_properties <span class="free">P</span> <span class="bound">i</span> <span class="keyword1">of</span> None <span class="main">⇒</span> SINVAR_DomainHierarchyNG.default_node_properties <span class="main">|</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant.node_props.simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_DomainHierarchyNG<span class="main"><span class="main">,</span></span> <span class="operator">of</span> <span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free"><span class="free">P</span></span></span>"</span></span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_DomainHierarchyNG.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="comment1">(*lemma[code_unfold]: "SecurityInvariant.node_props SINVAR_DomainHierarchy.default_node_properties P = NetModel_node_props P"
apply(simp add: NetModel_node_props_def)
done*)</span>

<span class="comment1">(*TODO does this work?*)</span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"DomainHierarchyNG.node_props <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">DomainHierarchyNG_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span>
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_DomainHierarchyNG.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> DomainHierarchyNG_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_DomainHierarchyNG.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_DomainHierarchyNG.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_DomainHierarchyNG.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">DomainHierarchyNG_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">DomainHierarchyNG_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_DomainHierarchyNG list_graph_to_graph_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def DomainHierarchyNG_offending_set
        DomainHierarchyNG_offending_set_def DomainHierarchyNG_offending_list_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> DomainHierarchyNG.node_props.simps DomainHierarchyNG.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> DomainHierarchyNG_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_DomainHierarchyNG<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹DomainHierarchyNG packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_DomainHierarchyNG</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> domainNameTrust<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_DomainHierarchyNG</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''DomainHierarchyNG''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_DomainHierarchyNG.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_DomainHierarchyNG.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> DomainHierarchyNG_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> DomainHierarchyNG_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_DomainHierarchyNG_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_DomainHierarchyNG</span> 
      <span class="quoted">SINVAR_DomainHierarchyNG.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_DomainHierarchyNG_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>






<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Examples:›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_TUM_net</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_TUM_net</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL<span class="main">=</span><span class="main">[</span><span class="inner_quoted">''Gateway''</span><span class="main">,</span> <span class="inner_quoted">''LowerSVR''</span><span class="main">,</span> <span class="inner_quoted">''UpperSRV''</span><span class="main">]</span><span class="main">,</span> 
        edgesL<span class="main">=</span><span class="main">[</span>
          <span class="main">(</span><span class="inner_quoted">''Gateway''</span><span class="main">,</span><span class="inner_quoted">''LowerSVR''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Gateway''</span><span class="main">,</span><span class="inner_quoted">''UpperSRV''</span><span class="main">)</span><span class="main">,</span> 
          <span class="main">(</span><span class="inner_quoted">''LowerSVR''</span><span class="main">,</span> <span class="inner_quoted">''Gateway''</span><span class="main">)</span><span class="main">,</span>
          <span class="main">(</span><span class="inner_quoted">''UpperSRV''</span><span class="main">,</span> <span class="inner_quoted">''Gateway''</span><span class="main">)</span>
        <span class="main">]</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"wf_list_graph example_TUM_net"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_TUM_config</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> domainNameTrust"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_TUM_config</span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">e</span><span class="main">.</span> default_node_properties<span class="main">)</span>
        <span class="main">(</span><span class="inner_quoted">''Gateway''</span><span class="main">:=</span> DN <span class="main">(</span><span class="inner_quoted">''ACD''</span><span class="main">--</span><span class="inner_quoted">''AISD''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span>
         <span class="inner_quoted">''LowerSVR''</span><span class="main">:=</span> DN <span class="main">(</span><span class="inner_quoted">''ACD''</span><span class="main">--</span><span class="inner_quoted">''AISD''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span>
         <span class="inner_quoted">''UpperSRV''</span><span class="main">:=</span> DN <span class="main">(</span><span class="inner_quoted">''ACD''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span>
       <span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_TUM_hierarchy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"domainTree"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">example_TUM_hierarchy</span> <span class="main">≡</span> <span class="main">(</span>Department <span class="inner_quoted">''ACD''</span> <span class="main">[</span>
           Department <span class="inner_quoted">''AISD''</span> <span class="main">[]</span>
       <span class="main">]</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"verify_globals example_TUM_net example_TUM_config example_TUM_hierarchy"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar     example_TUM_net example_TUM_config"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_TUM_net_invalid</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">example_TUM_net_invalid</span> <span class="main">≡</span> example_TUM_net<span class="main">⦇</span>edgesL <span class="main">:=</span>  
    <span class="main">(</span><span class="inner_quoted">''LowerSRV''</span><span class="main">,</span> <span class="inner_quoted">''UpperSRV''</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>edgesL example_TUM_net<span class="main">)</span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"verify_globals example_TUM_net_invalid example_TUM_config example_TUM_hierarchy"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar     example_TUM_net_invalid example_TUM_config"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"DomainHierarchyNG_offending_list example_TUM_net_invalid example_TUM_config"</span></span>


<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar 

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_BLPtrusted_impl">
<div class="head">
<h1>Theory SINVAR_BLPtrusted_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_BLPtrusted_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_BLPtrusted.html">SINVAR_BLPtrusted</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant List Implementation›</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_BLPtrusted_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_BLPtrusted

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> SINVAR_BLPtrusted.node_config<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">if</span> trusted <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span> <span class="keyword1">then</span> True <span class="keyword1">else</span> security_level <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> security_level <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span> <span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLP_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> SINVAR_BLPtrusted.node_config<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">BLP_offending_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
    <span class="main">[]</span>
   <span class="keyword1">else</span> 
    <span class="main">[</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> SINVAR_BLPtrusted.BLP_P <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">]</span> <span class="main">]</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_BLPtrusted.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_BLPtrusted.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">BLP_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span>
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_BLPtrusted.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> BLPtrusted_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_BLPtrusted.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_BLPtrusted.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_BLPtrusted.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">BLP_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">BLP_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_BLPtrusted list_graph_to_graph_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def BLP_offending_set BLP_offending_set_def BLP_offending_list_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> BLPtrusted.node_props.simps BLPtrusted.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> BLP_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_BLPtrusted<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹BLPtrusted packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_BLPtrusted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> SINVAR_BLPtrusted.node_config<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_BLPtrusted</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''BLPtrusted''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_BLPtrusted.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_BLPtrusted.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> BLP_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> BLP_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_BLPtrusted_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_BLPtrusted</span> 
      <span class="quoted">SINVAR_BLPtrusted.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_BLPtrusted_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Example›</span></span>
 <span class="comment1">(*TODO*)</span>


<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">SINVAR_LIB_BLPtrusted</span></span> <span class="keyword2"><span class="keyword">checking</span></span> Scala


<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props BLP_offending_list BLP_eval

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_SecGwExt">
<div class="head">
<h1>Theory SINVAR_SecGwExt</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_SecGwExt
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant PolEnforcePointExtended›</span></span>
<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A PolEnforcePoint is an application-level central policy enforcement point.
Legacy note: The old verions called it a SecurityGateway.

Hosts may belong to a certain domain. 
Sometimes, a pattern where intra-domain communication between domain members must be approved by a central instance is required. 

We call such a central instance PolEnforcePoint and present a template for this architecture. 
Five host roles are distinguished:. 
A PolEnforcePoint, aPolEnforcePointIN which accessible from the outside, a DomainMember,
a less-restricted AccessibleMember which is accessible from the outside world, 
and a default value Unassigned that reflects none of these roles.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> secgw_member <span class="main">=</span> PolEnforcePoint <span class="main">|</span> PolEnforcePointIN <span class="main">|</span> DomainMember  <span class="main">|</span> AccessibleMember <span class="main">|</span> Unassigned

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"secgw_member"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> Unassigned"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">allowed_secgw_flow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"secgw_member <span class="main">⇒</span> secgw_member <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_secgw_flow</span> PolEnforcePoint <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_secgw_flow</span> PolEnforcePointIN <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_secgw_flow</span> DomainMember DomainMember <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_secgw_flow</span> DomainMember <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_secgw_flow</span> AccessibleMember DomainMember <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_secgw_flow</span> AccessibleMember <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_secgw_flow</span> Unassigned Unassigned <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_secgw_flow</span> Unassigned PolEnforcePointIN <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_secgw_flow</span> Unassigned AccessibleMember <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_secgw_flow</span> Unassigned <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span> 


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> secgw_member<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">⟶</span> allowed_secgw_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>
  <span class="keyword1" id="SINVAR_SecGwExt-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹ENF›</span></span>
  <span class="keyword1" id="SINVAR_SecGwExt-PolEnforcePoint_ENFnr"><span class="command">lemma</span></span> PolEnforcePoint_ENFnr<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_not_refl sinvar allowed_secgw_flow"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_not_refl_def<span class="main">)</span>
  <span class="keyword1" id="SINVAR_SecGwExt-Unassigned_botdefault"><span class="command">lemma</span></span> Unassigned_botdefault<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="bound">e2</span> <span class="main">≠</span> Unassigned <span class="main">⟶</span> <span class="main">¬</span> allowed_secgw_flow <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">⟶</span> <span class="main">¬</span> allowed_secgw_flow Unassigned <span class="bound">e2</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">e2</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">e1</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">e1</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1" id="SINVAR_SecGwExt-Unassigned_not_to_Member"><span class="command">lemma</span></span> Unassigned_not_to_Member<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> allowed_secgw_flow Unassigned DomainMember"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_SecGwExt-All_to_Unassigned"><span class="command">lemma</span></span> All_to_Unassigned<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e1</span><span class="main">.</span> allowed_secgw_flow <span class="bound">e1</span> Unassigned"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">e1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">PolEnforcePointExtended_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> secgw_member<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PolEnforcePointExtended_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">∧</span> <span class="main">¬</span> allowed_secgw_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="SINVAR_SecGwExt-PolEnforcePointExtended_offending_set"><span class="command">lemma</span></span> PolEnforcePointExtended_offending_set<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> PolEnforcePointExtended_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_eq_iff ENFnr_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> PolEnforcePoint_ENFnr<span class="main"><span class="main">]</span></span> PolEnforcePointExtended_offending_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> G nP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">interpretation</span></span> PolEnforcePointExtended<span class="main">:</span> SecurityInvariant_ACS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
<span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> PolEnforcePointExtended_offending_set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SecurityInvariant_withOffendingFlows.ENFnr_fsts_weakrefl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> PolEnforcePoint_ENFnr Unassigned_botdefault All_to_Unassigned<span class="main"><span class="main">]</span></span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">otherbot</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> DomainMember<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> DomainMember<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> PolEnforcePoint<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> PolEnforcePoint<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> PolEnforcePointExtended_offending_set<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



  <span class="keyword1" id="SINVAR_SecGwExt-TopoS_PolEnforcePointExtended"><span class="command">lemma</span></span> TopoS_PolEnforcePointExtended<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>  

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_SecGwExt_impl">
<div class="head">
<h1>Theory SINVAR_SecGwExt_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_SecGwExt_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_SecGwExt.html">SINVAR_SecGwExt</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_SecGwExt_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_SecGwExt

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant PolEnforcePointExtended List Implementation›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> SINVAR_SecGwExt.secgw_member<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">⟶</span> SINVAR_SecGwExt.allowed_secgw_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">PolEnforcePointExtended_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> secgw_member<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PolEnforcePointExtended_offending_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
    <span class="main">[]</span>
   <span class="keyword1">else</span> 
    <span class="main">[</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">∧</span> <span class="main">¬</span> allowed_secgw_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">]</span> <span class="main">]</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_SecGwExt.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_SecGwExt.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">PolEnforcePoint_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span>
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_SecGwExt.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> PolEnforcePoint_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_SecGwExt.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_SecGwExt.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_SecGwExt.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">PolEnforcePointExtended_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">PolEnforcePoint_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_PolEnforcePointExtended list_graph_to_graph_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def PolEnforcePointExtended_offending_set PolEnforcePointExtended_offending_set_def PolEnforcePointExtended_offending_list_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> PolEnforcePointExtended.node_props.simps PolEnforcePointExtended.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> PolEnforcePoint_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_PolEnforcePointExtended<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹PolEnforcePoint packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_PolEnforcePointExtended</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> secgw_member<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_PolEnforcePointExtended</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''PolEnforcePointExtended''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_SecGwExt.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_SecGwExt.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> PolEnforcePointExtended_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> PolEnforcePoint_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_PolEnforcePointExtended_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_PolEnforcePointExtended</span> 
      <span class="quoted">SINVAR_SecGwExt.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_PolEnforcePointExtended_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_net_secgw</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_net_secgw</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">]</span><span class="main">,</span> 
    edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">11</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"wf_list_graph example_net_secgw"</span></span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_conf_secgw</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_conf_secgw</span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_SecGwExt.default_node_properties<span class="main">)</span>
    <span class="main">(</span><span class="main">1</span> <span class="main">:=</span> DomainMember<span class="main">,</span> <span class="numeral">2</span><span class="main">:=</span> DomainMember<span class="main">,</span> <span class="numeral">3</span><span class="main">:=</span> AccessibleMember<span class="main">,</span>
     <span class="numeral">8</span><span class="main">:=</span> PolEnforcePoint<span class="main">,</span> <span class="numeral">9</span><span class="main">:=</span> PolEnforcePointIN<span class="main">)</span><span class="main">)</span>"</span></span> 
  
  <span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">sinvar</span></span> <span class="keyword2"><span class="keyword">checking</span></span> SML
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">test</span> <span class="main">=</span> sinvar <span class="main">⦇</span> nodesL<span class="main">=</span><span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">]</span><span class="main">,</span> edgesL<span class="main">=</span><span class="main">[]</span> <span class="main">⦈</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> SINVAR_SecGwExt.default_node_properties<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">test</span></span> <span class="keyword2"><span class="keyword">checking</span></span> SML
  <span class="keyword1"><span class="command">value</span></span><span class="comment1">(**)</span> <span class="quoted"><span class="quoted">"sinvar <span class="main">⦇</span> nodesL<span class="main">=</span><span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">]</span><span class="main">,</span> edgesL<span class="main">=</span><span class="main">[]</span> <span class="main">⦈</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> SINVAR_SecGwExt.default_node_properties<span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">value</span></span><span class="comment1">(**)</span> <span class="quoted"><span class="quoted">"sinvar example_net_secgw example_conf_secgw"</span></span>
  <span class="keyword1"><span class="command">value</span></span><span class="comment1">(**)</span> <span class="quoted"><span class="quoted">"<span class="free">PolEnforcePoint_offending_list</span> example_net_secgw example_conf_secgw"</span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_net_secgw_invalid</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_net_secgw_invalid</span> <span class="main">≡</span> example_net_secgw<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>edgesL example_net_secgw<span class="main">)</span><span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">value</span></span><span class="comment1">(**)</span> <span class="quoted"><span class="quoted">"sinvar example_net_secgw_invalid example_conf_secgw"</span></span>
  <span class="keyword1"><span class="command">value</span></span><span class="comment1">(**)</span> <span class="quoted"><span class="quoted">"<span class="free">PolEnforcePoint_offending_list</span> example_net_secgw_invalid example_conf_secgw"</span></span>


<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Sink">
<div class="head">
<h1>Theory SINVAR_Sink</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Sink
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Sink (IFS)›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> node_config <span class="main">=</span> Sink <span class="main">|</span> SinkPool <span class="main">|</span> Unassigned

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node_config"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">=</span> Unassigned"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">allowed_sink_flow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node_config <span class="main">⇒</span> node_config <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_sink_flow</span> Sink <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_sink_flow</span> SinkPool SinkPool <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_sink_flow</span> SinkPool Sink <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_sink_flow</span> SinkPool <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_sink_flow</span> Unassigned <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">⟶</span> allowed_sink_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">=</span> True"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>
  <span class="keyword1" id="SINVAR_Sink-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹ENF›</span></span>
  <span class="keyword1" id="SINVAR_Sink-Sink_ENFnr"><span class="command">lemma</span></span> Sink_ENFnr<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_not_refl sinvar allowed_sink_flow"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_not_refl_def<span class="main">)</span>
  <span class="keyword1" id="SINVAR_Sink-Unassigned_to_All"><span class="command">lemma</span></span> Unassigned_to_All<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e2</span><span class="main">.</span> allowed_sink_flow Unassigned <span class="bound">e2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper">e2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_Sink-Unassigned_default_candidate"><span class="command">lemma</span></span> Unassigned_default_candidate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> allowed_sink_flow <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">⟶</span> <span class="main">¬</span> allowed_sink_flow <span class="bound">e1</span> Unassigned"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">e2</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">e1</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">e1</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp_all</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">Sink_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Sink_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">∧</span> <span class="main">¬</span> allowed_sink_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="SINVAR_Sink-Sink_offending_set"><span class="command">lemma</span></span> Sink_offending_set<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> Sink_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_eq_iff ENFnr_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Sink_ENFnr<span class="main"><span class="main">]</span></span> Sink_offending_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> G nP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">interpretation</span></span> Sink<span class="main">:</span> SecurityInvariant_IFS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
<span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> Sink_offending_set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> SecurityInvariant_withOffendingFlows.ENFnr_snds_weakrefl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Sink_ENFnr Unassigned_default_candidate Unassigned_to_All<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>

   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_IFS<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">otherbot</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> SinkPool<span class="main">,</span> vertex_2 <span class="main">:=</span> Unassigned<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_2"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> SinkPool<span class="main">,</span> vertex_2 <span class="main">:=</span> Unassigned<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_2"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> Sink_offending_set<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1" id="SINVAR_Sink-TopoS_Sink"><span class="command">lemma</span></span> TopoS_Sink<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar_mono   
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Sink_impl">
<div class="head">
<h1>Theory SINVAR_Sink_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Sink_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_Sink.html">SINVAR_Sink</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_Sink_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_Sink


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Sink (IFS) List Implementation›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">⟶</span> SINVAR_Sink.allowed_sink_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Sink_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> SINVAR_Sink.node_config<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Sink_offending_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
    <span class="main">[]</span>
   <span class="keyword1">else</span> 
    <span class="main">[</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">∧</span> <span class="main">¬</span> allowed_sink_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">]</span> <span class="main">]</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_Sink.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_Sink.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Sink_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span>
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_Sink.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> Sink_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_Sink.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_Sink.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_Sink.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">Sink_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">Sink_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_Sink list_graph_to_graph_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def Sink_offending_set Sink_offending_set_def Sink_offending_list_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> Sink.node_props.simps Sink.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Sink_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_Sink<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Sink packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_Sink</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> node_config<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_Sink</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''Sink''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_Sink.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_Sink.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> Sink_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> Sink_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_Sink_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_Sink</span>
      <span class="quoted">SINVAR_Sink.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_Sink_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_net_sink</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_net_sink</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">]</span><span class="main">,</span> 
    edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"wf_list_graph example_net_sink"</span></span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_conf_sink</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_conf_sink</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_Sink.default_node_properties<span class="main">)</span><span class="main">(</span><span class="numeral">8</span><span class="main">:=</span> Sink<span class="main">,</span> <span class="numeral">2</span><span class="main">:=</span> SinkPool<span class="main">,</span> <span class="numeral">3</span><span class="main">:=</span> SinkPool<span class="main">,</span> <span class="numeral">4</span><span class="main">:=</span> SinkPool<span class="main">)</span>"</span></span> 
  
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar example_net_sink example_conf_sink"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Sink_offending_list example_net_sink example_conf_sink"</span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_net_sink_invalid</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_net_sink_invalid</span> <span class="main">≡</span> example_net_sink<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">11</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>edgesL example_net_sink<span class="main">)</span><span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar example_net_sink_invalid example_conf_sink"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Sink_offending_list example_net_sink_invalid example_conf_sink"</span></span>


<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_SubnetsInGW">
<div class="head">
<h1>Theory SINVAR_SubnetsInGW</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_SubnetsInGW
<span class="keyword2"><span class="keyword">imports</span></span><span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant SubnetsInGW›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> subnets <span class="main">=</span> Member <span class="main">|</span> InboundGateway <span class="main">|</span> Unassigned

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"subnets"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> Unassigned"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">allowed_subnet_flow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"subnets <span class="main">⇒</span> subnets <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> Member <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> InboundGateway <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> Unassigned Unassigned <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> Unassigned InboundGateway <span class="main">=</span> True"</span></span><span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_subnet_flow</span> Unassigned Member <span class="main">=</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> subnets<span class="main">)</span>  <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> allowed_subnet_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">=</span> False"</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>
  <span class="keyword1" id="SINVAR_SubnetsInGW-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹ENF›</span></span>
  <span class="keyword1" id="SINVAR_SubnetsInGW-Unassigned_not_to_Member"><span class="command">lemma</span></span> Unassigned_not_to_Member<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> allowed_subnet_flow Unassigned Member"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_SubnetsInGW-All_to_Unassigned"><span class="command">lemma</span></span> All_to_Unassigned<span class="main">:</span> <span class="quoted"><span class="quoted">"allowed_subnet_flow <span class="free">e1</span> Unassigned"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">e1</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_SubnetsInGW-Member_to_All"><span class="command">lemma</span></span> Member_to_All<span class="main">:</span> <span class="quoted"><span class="quoted">"allowed_subnet_flow Member <span class="free">e2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">e2</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_SubnetsInGW-Unassigned_default_candidate"><span class="command">lemma</span></span> Unassigned_default_candidate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">nP</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">.</span> <span class="main">¬</span> allowed_subnet_flow <span class="main">(</span><span class="bound">nP</span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⟶</span> <span class="main">¬</span> allowed_subnet_flow Unassigned <span class="main">(</span><span class="bound">nP</span> <span class="bound">e2</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nP</span> <span class="improper">e2</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nP</span> <span class="improper">e1</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>3<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> All_to_Unassigned<span class="main">)</span>
  <span class="keyword1" id="SINVAR_SubnetsInGW-allowed_subnet_flow_refl"><span class="command">lemma</span></span> allowed_subnet_flow_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"allowed_subnet_flow <span class="free">e</span> <span class="free">e</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">e</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_SubnetsInGW-SubnetsInGW_ENF"><span class="command">lemma</span></span> SubnetsInGW_ENF<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form sinvar allowed_subnet_flow"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_def
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1" id="SINVAR_SubnetsInGW-SubnetsInGW_ENF_refl"><span class="command">lemma</span></span> SubnetsInGW_ENF_refl<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.ENF_refl sinvar allowed_subnet_flow"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.ENF_refl_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SubnetsInGW_ENF<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> allowed_subnet_flow_refl<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SubnetsInGW_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> subnets<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SubnetsInGW_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> allowed_subnet_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="SINVAR_SubnetsInGW-SubnetsInGW_offending_set"><span class="command">lemma</span></span> SubnetsInGW_offending_set<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> SubnetsInGW_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_eq_iff ENF_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> SubnetsInGW_ENF<span class="main"><span class="main">]</span></span> SubnetsInGW_offending_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> G nP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">interpretation</span></span> SubnetsInGW<span class="main">:</span> SecurityInvariant_ACS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">SINVAR_SubnetsInGW.default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">SINVAR_SubnetsInGW.sinvar</span>
<span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> SubnetsInGW_offending_set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SINVAR_SubnetsInGW.default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>

    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword1"><span class="command">thm</span></span> SecurityInvariant_withOffendingFlows.ENF_fsts_refl_instance<span class="main">[</span><span class="operator">OF</span> SubnetsInGW_ENF_refl Unassigned_default_candidate<span class="main">]</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> SecurityInvariant_withOffendingFlows.ENF_fsts_refl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> SubnetsInGW_ENF_refl Unassigned_default_candidate<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>

   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">otherbot</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> Member<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> Unassigned<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Unassigned<span class="main">,</span> vertex_2 <span class="main">:=</span> Member<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SubnetsInGW_offending_set<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



  <span class="keyword1" id="SINVAR_SubnetsInGW-TopoS_SubnetsInGW"><span class="command">lemma</span></span> TopoS_SubnetsInGW<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>

 
<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar_mono   
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_SubnetsInGW_impl">
<div class="head">
<h1>Theory SINVAR_SubnetsInGW_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_SubnetsInGW_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_SubnetsInGW.html">SINVAR_SubnetsInGW</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_SubnetsInGW_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_SubnetsInGW

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant SubnetsInGw List Implementation›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> subnets<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> SINVAR_SubnetsInGW.allowed_subnet_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">SubnetsInGW_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> subnets<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">SubnetsInGW_offending_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
    <span class="main">[]</span>
   <span class="keyword1">else</span> 
    <span class="main">[</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> allowed_subnet_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">]</span> <span class="main">]</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_SubnetsInGW.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_SubnetsInGW.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SubnetsInGW_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span>
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_SubnetsInGW.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> SubnetsInGW_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_SubnetsInGW.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_SubnetsInGW.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_SubnetsInGW.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">SubnetsInGW_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">SubnetsInGW_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_SubnetsInGW list_graph_to_graph_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def SubnetsInGW_offending_set SubnetsInGW_offending_set_def SubnetsInGW_offending_list_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> SubnetsInGW.node_props.simps SubnetsInGW.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SubnetsInGW_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_SubnetsInGW<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SubnetsInGW packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_SubnetsInGW</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> subnets<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_SubnetsInGW</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''SubnetsInGW''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_SubnetsInGW.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_SubnetsInGW.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> SubnetsInGW_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> SubnetsInGW_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_SubnetsInGW_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_SubnetsInGW</span>
      <span class="quoted">SINVAR_SubnetsInGW.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_SubnetsInGW_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_net_sub</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">example_net_sub</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">42</span><span class="main">]</span><span class="main">,</span> 
  edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> 
  <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">11</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">42</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span><span class="numeral">42</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">42</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"wf_list_graph example_net_sub"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_conf_sub</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">example_conf_sub</span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_SubnetsInGW.default_node_properties<span class="main">)</span>
  <span class="main">(</span><span class="main">1</span> <span class="main">:=</span> Member<span class="main">,</span> <span class="numeral">2</span><span class="main">:=</span> Member<span class="main">,</span> <span class="numeral">3</span><span class="main">:=</span> Member<span class="main">,</span> <span class="numeral">4</span><span class="main">:=</span>Member<span class="main">,</span>
   <span class="numeral">8</span><span class="main">:=</span>InboundGateway<span class="main">)</span><span class="main">)</span>"</span></span> 

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar example_net_sub example_conf_sub"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_net_sub_invalid</span> <span class="keyword2"><span class="keyword">where</span></span>
<span class="quoted"><span class="quoted">"<span class="free">example_net_sub_invalid</span> <span class="main">≡</span> example_net_sub<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="numeral">42</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>edgesL example_net_sub<span class="main">)</span><span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar example_net_sub_invalid example_conf_sub"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"SubnetsInGW_offending_list example_net_sub_invalid example_conf_sub"</span></span>



<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_CommunicationPartners">
<div class="head">
<h1>Theory SINVAR_CommunicationPartners</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_CommunicationPartners
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant CommunicationPartners›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Idea of this securityinvariant:
  Only some nodes can communicate with Master nodes.
    It constrains who may access master nodes, Master nodes can access the world (except other prohibited master nodes).
  A node configured as Master has a list of nodes that can access it.
  Also, in order to be able to access a Master node, the sender must be denoted as a node we Care about.
  By default, all nodes are set to DontCare, thus they cannot access Master nodes. But they can access 
  all other DontCare nodes and Care nodes.

  TL;DR: An access control list determines who can access a master node.
›</span></span>
<span class="keyword1"><span class="command">datatype</span></span> <span class="tfree">'v</span> node_config <span class="main">=</span> DontCare <span class="main">|</span> Care <span class="main">|</span> Master <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> node_config"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">=</span> DontCare"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Unrestricted accesses among DontCare nodes!›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">allowed_flow</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> node_config <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> node_config <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_flow</span> DontCare <span class="main"><span class="bound"><span class="entity">_</span></span></span> DontCare <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_flow</span> DontCare <span class="main"><span class="bound"><span class="entity">_</span></span></span> Care <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_flow</span> DontCare <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">(</span>Master <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> False"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_flow</span> Care <span class="main"><span class="bound"><span class="entity">_</span></span></span> Care <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_flow</span> Care <span class="main"><span class="bound"><span class="entity">_</span></span></span> DontCare <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_flow</span> Care <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Master <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_flow</span> <span class="main">(</span>Master <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">(</span>Master <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">r</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_flow</span> <span class="main">(</span>Master <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> Care <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">allowed_flow</span> <span class="main">(</span>Master <span class="main"><span class="bound"><span class="entity">_</span></span></span><span class="main">)</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> DontCare <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="main">=</span> True"</span></span> 


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> node_config<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">⟶</span> allowed_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">=</span> False"</span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>
  <span class="keyword1" id="SINVAR_CommunicationPartners-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹ENRnr›</span></span>
  <span class="keyword1" id="SINVAR_CommunicationPartners-CommunicationPartners_ENRnrSR"><span class="command">lemma</span></span> CommunicationPartners_ENRnrSR<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_not_refl_SR sinvar allowed_flow"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_not_refl_SR_def<span class="main">)</span>
  <span class="keyword1" id="SINVAR_CommunicationPartners-Unassigned_weakrefl"><span class="command">lemma</span></span> Unassigned_weakrefl<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> allowed_flow DontCare <span class="bound">s</span> DontCare <span class="bound">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_CommunicationPartners-Unassigned_botdefault"><span class="command">lemma</span></span> Unassigned_botdefault<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="main">≠</span> DontCare <span class="main">⟶</span> <span class="main">¬</span> allowed_flow <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="main">⟶</span> <span class="main">¬</span> allowed_flow DontCare <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="improper">r</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="improper">s</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">lemma</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> allowed_flow DontCare <span class="free">s</span> <span class="main">(</span>Master <span class="free">M</span><span class="main">)</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">lemma</span></span>  <span class="quoted"><span class="quoted">"<span class="main">¬</span> allowed_flow <span class="free">any</span> <span class="free">s</span> <span class="main">(</span>Master <span class="main">[]</span><span class="main">)</span> <span class="free">r</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">any</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
    
  <span class="keyword1" id="SINVAR_CommunicationPartners-All_to_Unassigned"><span class="command">lemma</span></span> All_to_Unassigned<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> allowed_flow <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> DontCare <span class="bound">r</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="improper">s</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1" id="SINVAR_CommunicationPartners-Unassigned_default_candidate"><span class="command">lemma</span></span> Unassigned_default_candidate<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">s</span> <span class="bound">r</span><span class="main">.</span> <span class="main">¬</span> allowed_flow <span class="main">(</span><span class="free">nP</span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span> <span class="main">⟶</span> <span class="main">¬</span> allowed_flow DontCare <span class="bound">s</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> s r<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="improper">s</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="improper">r</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="improper">r</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">CommunicationPartners_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> node_config<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">CommunicationPartners_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">∧</span> <span class="main">¬</span> allowed_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="bound">e1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span> <span class="bound">e2</span><span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="SINVAR_CommunicationPartners-CommunicationPartners_offending_set"><span class="command">lemma</span></span> CommunicationPartners_offending_set<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> CommunicationPartners_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_eq_iff ENFnrSR_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> CommunicationPartners_ENRnrSR<span class="main"><span class="main">]</span></span> CommunicationPartners_offending_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> G nP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">interpretation</span></span> CommunicationPartners<span class="main">:</span> SecurityInvariant_ACS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
<span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> CommunicationPartners_offending_set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def
  <span class="keyword1"><span class="command">unfolding</span></span> default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule_tac</span> f<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">f</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.ENFnrSR_fsts_weakrefl_instance<span class="main"><span class="main">[</span></span><span class="operator">OF</span> CommunicationPartners_ENRnrSR Unassigned_weakrefl Unassigned_botdefault All_to_Unassigned<span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> CommunicationPartners_offending_set CommunicationPartners_offending_set_def delete_edges_simp2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">otherbot</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> DontCare<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> DontCare<span class="main">,</span> vertex_2 <span class="main">:=</span> Master <span class="main">[</span>vertex_1<span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> M<span class="main">)</span> <span class="comment1">(*case Master M*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> DontCare<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> DontCare<span class="main">,</span> vertex_2 <span class="main">:=</span> <span class="main">(</span>Master <span class="main">(</span>vertex_1<span class="main">#</span><span class="free">M'</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> CommunicationPartners_offending_set<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1" id="SINVAR_CommunicationPartners-TopoS_SubnetsInGW"><span class="command">lemma</span></span> TopoS_SubnetsInGW<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Example:›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"sinvar <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span><span class="inner_quoted">''db1''</span><span class="main">,</span> <span class="inner_quoted">''db2''</span><span class="main">,</span> <span class="inner_quoted">''h1''</span><span class="main">,</span> <span class="inner_quoted">''h2''</span><span class="main">,</span> <span class="inner_quoted">''foo''</span><span class="main">,</span> <span class="inner_quoted">''bar''</span><span class="main">}</span><span class="main">,</span>
               edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''h1''</span><span class="main">,</span> <span class="inner_quoted">''db1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''h2''</span><span class="main">,</span> <span class="inner_quoted">''db1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''h1''</span><span class="main">,</span> <span class="inner_quoted">''h2''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''db1''</span><span class="main">,</span> <span class="inner_quoted">''h1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''db1''</span><span class="main">,</span> <span class="inner_quoted">''foo''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''db1''</span><span class="main">,</span> <span class="inner_quoted">''db2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''db1''</span><span class="main">,</span> <span class="inner_quoted">''db1''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''h1''</span><span class="main">,</span> <span class="inner_quoted">''foo''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''foo''</span><span class="main">,</span> <span class="inner_quoted">''h1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''foo''</span><span class="main">,</span> <span class="inner_quoted">''bar''</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>
    <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">h</span><span class="main">.</span> default_node_properties<span class="main">)</span><span class="main">(</span><span class="inner_quoted">''h1''</span> <span class="main">:=</span> Care<span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="inner_quoted">''h2''</span> <span class="main">:=</span> Care<span class="main">)</span><span class="main">)</span>
        <span class="main">(</span><span class="inner_quoted">''db1''</span> <span class="main">:=</span> Master <span class="main">[</span><span class="inner_quoted">''h1''</span><span class="main">,</span> <span class="inner_quoted">''h2''</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="inner_quoted">''db2''</span> <span class="main">:=</span> Master <span class="main">[</span><span class="inner_quoted">''db1''</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar_mono   
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_CommunicationPartners_impl">
<div class="head">
<h1>Theory SINVAR_CommunicationPartners_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_CommunicationPartners_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_CommunicationPartners.html">SINVAR_CommunicationPartners</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_CommunicationPartners_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_CommunicationPartners


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant CommunicationPartners List Implementation›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> node_config<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="bound">r</span> <span class="main">⟶</span> SINVAR_CommunicationPartners.allowed_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">s</span><span class="main">)</span> <span class="bound">s</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">r</span><span class="main">)</span> <span class="bound">r</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">CommunicationPartners_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> node_config<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">CommunicationPartners_offending_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
    <span class="main">[]</span>
   <span class="keyword1">else</span> 
    <span class="main">[</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">e1</span> <span class="main">≠</span> <span class="bound">e2</span> <span class="main">∧</span> <span class="main">¬</span> allowed_flow <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="bound">e1</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span> <span class="bound">e2</span><span class="main">]</span> <span class="main">]</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">thm</span></span> SINVAR_CommunicationPartners.CommunicationPartners.node_props.simps
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'v</span> node_config<span class="main">)</span> TopoS_Params<span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_CommunicationPartners.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_CommunicationPartners.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">CommunicationPartners_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> 
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_CommunicationPartners.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> CommunicationPartners_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_CommunicationPartners.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_CommunicationPartners.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_CommunicationPartners.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">CommunicationPartners_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">CommunicationPartners_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_SubnetsInGW list_graph_to_graph_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def CommunicationPartners_offending_set CommunicationPartners_offending_set_def CommunicationPartners_offending_list_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> CommunicationPartners.node_props.simps CommunicationPartners.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> CommunicationPartners_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_SubnetsInGW<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹CommunicationPartners packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_CommunicationPartners</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'v</span> SINVAR_CommunicationPartners.node_config<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_CommunicationPartners</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''CommunicationPartners''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_CommunicationPartners.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_CommunicationPartners.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> CommunicationPartners_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> CommunicationPartners_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_CommunicationPartners_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_CommunicationPartners</span>
      <span class="quoted">SINVAR_CommunicationPartners.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_CommunicationPartners_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>



<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_NoRefl">
<div class="head">
<h1>Theory SINVAR_NoRefl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_NoRefl
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant NoRefl›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Hosts are not allowed to communicate with themselves.›</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹This can be used to effectively lift hosts to roles.
        Just list all roles that are allowed to communicate with themselves.
        Otherwise, communication between hosts of the same role (group) is prohibited. 
        Useful in conjunction with the security gateway.›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> node_config <span class="main">=</span> NoRefl <span class="main">|</span> Refl

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node_config"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">=</span> NoRefl"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span> <span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">s</span> <span class="main">=</span> Refl<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">=</span> False"</span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Preliminaries›</span></span>
  <span class="keyword1" id="SINVAR_NoRefl-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  
  <span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

 <span class="keyword1" id="SINVAR_NoRefl-NoRfl_ENRsr"><span class="command">lemma</span></span> NoRfl_ENRsr<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_sr sinvar <span class="main">(</span><span class="main">λ</span> <span class="bound">nP<span class="hidden">⇩</span><sub>s</sub></span> <span class="bound">s</span> <span class="bound">nP<span class="hidden">⇩</span><sub>r</sub></span> <span class="bound">r</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">⟶</span> <span class="bound">nP<span class="hidden">⇩</span><sub>s</sub></span> <span class="main">=</span> Refl<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_all_edges_normal_form_sr_def<span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">NoRefl_offending_set</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">NoRefl_offending_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
      <span class="main">{}</span>
     <span class="keyword1">else</span> 
      <span class="main">{</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">e1</span> <span class="main">=</span> <span class="bound">e2</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span> <span class="main">=</span> NoRefl<span class="main">}</span> <span class="main">}</span><span class="main">)</span>"</span></span>

 <span class="keyword1"><span class="command">thm</span></span> SecurityInvariant_withOffendingFlows.ENFsr_offending_set<span class="main">[</span><span class="operator">OF</span> NoRfl_ENRsr<span class="main">]</span>

  <span class="keyword1" id="SINVAR_NoRefl-NoRefl_offending_set"><span class="command">lemma</span></span> NoRefl_offending_set<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> NoRefl_offending_set"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> fun_eq_iff NoRefl_offending_set_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> G nP<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.ENFsr_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> NoRfl_ENRsr<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"sinvar <span class="improper">G</span> <span class="improper">nP</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> node_config.exhaust <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1" id="SINVAR_NoRefl-NoRefl_unique_default"><span class="command">lemma</span></span> NoRefl_unique_default<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span> <span class="bound">f</span> <span class="bound">nP</span> <span class="bound">i</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> set_offending_flows <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="bound">f</span> <span class="main">⟶</span> <span class="main">¬</span> sinvar <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="free">otherbot</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
     <span class="free">otherbot</span> <span class="main">=</span> NoRefl"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_1<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">otherbot</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> NoRefl<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> NoRefl<span class="main">,</span> vertex_2 <span class="main">:=</span> NoRefl<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_1<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">interpretation</span></span> NoRefl<span class="main">:</span> SecurityInvariant_ACS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
<span class="keyword2"><span class="keyword">rewrites</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.set_offending_flows sinvar <span class="main">=</span> NoRefl_offending_set"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> SINVAR_NoRefl.offending_notevalD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.ENFsr_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> NoRfl_ENRsr<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> NoRefl_unique_default<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> NoRefl_offending_set<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹It can also be interpreted as IFS›</span></span>
<span class="keyword1" id="SINVAR_NoRefl-NoRefl_SecurityInvariant_IFS"><span class="command">lemma</span></span> NoRefl_SecurityInvariant_IFS<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_IFS sinvar default_node_properties"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> SINVAR_NoRefl.offending_notevalD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.ENFsr_offending_set<span class="main"><span class="main">[</span></span><span class="operator">OF</span> NoRfl_ENRsr<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_IFS<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_1<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">otherbot</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> NoRefl<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> NoRefl<span class="main">,</span> vertex_2 <span class="main">:=</span> NoRefl<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_1<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="SINVAR_NoRefl-TopoS_NoRefl"><span class="command">lemma</span></span> TopoS_NoRefl<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>  

<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar_mono   
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_NoRefl_impl">
<div class="head">
<h1>Theory SINVAR_NoRefl_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_NoRefl_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_NoRefl.html">SINVAR_NoRefl</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span>  SINVAR_NoRefl_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_NoRefl


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant NoRefl List Implementation›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="bound">r</span> <span class="main">⟶</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">s</span> <span class="main">=</span> Refl<span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">NoRefl_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">NoRefl_offending_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
    <span class="main">[]</span>
   <span class="keyword1">else</span> 
    <span class="main">[</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="bound">e1</span> <span class="main">=</span> <span class="bound">e2</span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span> <span class="main">=</span> NoRefl<span class="main">]</span> <span class="main">]</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_NoRefl.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_NoRefl.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NoRefl_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span>
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_NoRefl.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> NoRefl_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_NoRefl.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_NoRefl.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_NoRefl.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">NoRefl_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">NoRefl_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_NoRefl list_graph_to_graph_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def NoRefl_offending_set NoRefl_offending_set_def NoRefl_offending_list_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> NoRefl.node_props.simps NoRefl.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NoRefl_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_NoRefl<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹PolEnforcePoint packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_NoRefl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> node_config<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_NoRefl</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''NoRefl''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_NoRefl.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_NoRefl.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> NoRefl_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> NoRefl_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_NoRefl_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_NoRefl</span>
      <span class="quoted">SINVAR_NoRefl.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_NoRefl_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_net</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_net</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span> 
    edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph example_net"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_conf</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_conf</span> <span class="main">≡</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_NoRefl.default_node_properties<span class="main">)</span><span class="main">(</span><span class="numeral">2</span><span class="main">:=</span> Refl<span class="main">)</span><span class="main">)</span>"</span></span> 
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"sinvar example_net example_conf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"NoRefl_offending_list example_net <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_NoRefl.default_node_properties<span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Tainting_impl">
<div class="head">
<h1>Theory SINVAR_Tainting_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Tainting_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_Tainting.html">SINVAR_Tainting</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Tainting List Implementation›</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_Tainting_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_Tainting

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> SINVAR_Tainting.taints<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Tainting_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> SINVAR_Tainting.taints<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Tainting_offending_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
    <span class="main">[]</span>
   <span class="keyword1">else</span> 
    <span class="main">[</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">]</span> <span class="main">]</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span>
                  Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span>
                <span class="main">|</span> None <span class="main">⇒</span> SINVAR_Tainting.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_Tainting.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def SecurityInvariant.node_props.simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_Tainting<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Tainting_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> 
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_Tainting.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> Tainting_impl<span class="main">:</span>TopoS_List_Impl
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_Tainting.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_Tainting.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_Tainting.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">Tainting_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">Tainting_eval</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_Tainting<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def SINVAR_Tainting.sinvar_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def SINVAR_Tainting.sinvar_def Taints_offending_set
                    SINVAR_Tainting.Taints_offending_set_def Tainting_offending_list_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
   <span class="comment1">(*interpretation is in local context*)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> SecurityInvariant.node_props.simps SecurityInvariant.node_props_eq_node_props_formaldef TopoS_Tainting<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Tainting_eval_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_Tainting<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def SINVAR_Tainting.sinvar_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Tainting packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_Tainting</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> SINVAR_Tainting.taints<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_Tainting</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''Tainting''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_Tainting.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_Tainting.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> Tainting_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> Tainting_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_BLPbasic_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_Tainting</span>
      <span class="quoted">SINVAR_Tainting.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_Tainting_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Example›</span></span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">tainting_example</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tainting_example</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''produce 1''</span><span class="main">,</span>
                                  <span class="inner_quoted">''produce 2''</span><span class="main">,</span>
                                  <span class="inner_quoted">''produce 3''</span><span class="main">,</span>
                                  <span class="inner_quoted">''read 1 2''</span><span class="main">,</span>
                                  <span class="inner_quoted">''read 3''</span><span class="main">,</span>
                                  <span class="inner_quoted">''consume 1 2 3''</span><span class="main">,</span>
                                  <span class="inner_quoted">''consume 3''</span><span class="main">]</span><span class="main">,</span> 
              edgesL <span class="main">=</span><span class="main">[</span><span class="main">(</span><span class="inner_quoted">''produce 1''</span><span class="main">,</span> <span class="inner_quoted">''read 1 2''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''produce 2''</span><span class="main">,</span> <span class="inner_quoted">''read 1 2''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''produce 3''</span><span class="main">,</span> <span class="inner_quoted">''read 3''</span><span class="main">)</span><span class="main">,</span> 
                       <span class="main">(</span><span class="inner_quoted">''read 3''</span><span class="main">,</span> <span class="inner_quoted">''read 1 2''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''read 1 2''</span><span class="main">,</span> <span class="inner_quoted">''consume 1 2 3''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''read 3''</span><span class="main">,</span> <span class="inner_quoted">''consume 3''</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph tainting_example"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">tainting_example_props</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> SINVAR_Tainting.taints"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">tainting_example_props</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> SINVAR_Tainting.default_node_properties<span class="main">)</span>
                          <span class="main">(</span><span class="inner_quoted">''produce 1''</span> <span class="main">:=</span> <span class="main">{</span><span class="inner_quoted">''1''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''produce 2''</span> <span class="main">:=</span> <span class="main">{</span><span class="inner_quoted">''2''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''produce 3''</span> <span class="main">:=</span> <span class="main">{</span><span class="inner_quoted">''3''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''read 1 2''</span> <span class="main">:=</span> <span class="main">{</span><span class="inner_quoted">''1''</span><span class="main">,</span><span class="inner_quoted">''2''</span><span class="main">,</span> <span class="inner_quoted">''3''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''read 3''</span> <span class="main">:=</span> <span class="main">{</span><span class="inner_quoted">''3''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''consume 1 2 3''</span> <span class="main">:=</span> <span class="main">{</span><span class="inner_quoted">''1''</span><span class="main">,</span><span class="inner_quoted">''2''</span><span class="main">,</span><span class="inner_quoted">''3''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''consume 3''</span> <span class="main">:=</span> <span class="main">{</span><span class="inner_quoted">''3''</span><span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"sinvar tainting_example tainting_example_props"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">SINVAR_LIB_Tainting</span></span> <span class="keyword2"><span class="keyword">checking</span></span> Scala

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props Tainting_offending_list Tainting_eval

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_TaintingTrusted_impl">
<div class="head">
<h1>Theory SINVAR_TaintingTrusted_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_TaintingTrusted_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_TaintingTrusted.html">SINVAR_TaintingTrusted</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Tainting with Trust List Implementation›</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_Tainting_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_Tainting

<span class="comment1">(*could we use those to make code more efficient?*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">C</span> <span class="main">∨</span> <span class="bound">a</span> <span class="main">∈</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span><span class="main">(</span><span class="free">A</span> <span class="main">-</span> <span class="free">B</span> <span class="main">⊆</span> <span class="free">C</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">a</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∉</span> <span class="free">C</span> <span class="main">∧</span> <span class="bound">a</span> <span class="main">∉</span> <span class="free">B</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> SINVAR_TaintingTrusted.taints<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> taints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v1</span><span class="main">)</span> <span class="main">-</span> untaints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v1</span><span class="main">)</span> <span class="main">⊆</span> taints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="comment1">(*Test that we have executable code, despite the abstractions*)</span>
<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">sinvar</span></span> <span class="keyword2"><span class="keyword">checking</span></span> SML
<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"sinvar <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[]</span><span class="main">,</span> edgesL <span class="main">=</span><span class="main">[]</span> <span class="main">⦈</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> SINVAR_TaintingTrusted.default_node_properties<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"sinvar <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[]</span><span class="main">,</span> edgesL <span class="main">=</span><span class="main">[]</span> <span class="main">⦈</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> SINVAR_TaintingTrusted.default_node_properties<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">TaintingTrusted_offending_list</span> 
  <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> SINVAR_TaintingTrusted.taints<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">TaintingTrusted_offending_list</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="keyword1">then</span>
    <span class="main">[]</span>
   <span class="keyword1">else</span> 
    <span class="main">[</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span><span class="main">(</span>taints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v1</span><span class="main">)</span> <span class="main">-</span> untaints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v1</span><span class="main">)</span> <span class="main">⊆</span> taints <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v2</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">]</span><span class="main">)</span>"</span></span>

<span class="comment1">(*TODO: is this code somewhat efficient?*)</span>
<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">TaintingTrusted_offending_list</span></span> <span class="keyword2"><span class="keyword">checking</span></span> SML


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span>
  <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span>
                  Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span>
                <span class="main">|</span> None <span class="main">⇒</span> SINVAR_TaintingTrusted.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_TaintingTrusted.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def SecurityInvariant.node_props.simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_TaintingTrusted<span class="main"><span class="main">]</span></span><span class="main">)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">TaintingTrusted_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> 
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_TaintingTrusted.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> TaintingTrusted_impl<span class="main">:</span>TopoS_List_Impl
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_TaintingTrusted.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_TaintingTrusted.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_TaintingTrusted.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">TaintingTrusted_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">TaintingTrusted_eval</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_TaintingTrusted<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def SINVAR_TaintingTrusted.sinvar_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def SINVAR_TaintingTrusted.sinvar_def Taints_offending_set
                    SINVAR_TaintingTrusted.Taints_offending_set_def TaintingTrusted_offending_list_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
   <span class="comment1">(*interpretation is in local context*)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> SecurityInvariant.node_props.simps SecurityInvariant.node_props_eq_node_props_formaldef TopoS_TaintingTrusted<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> TaintingTrusted_eval_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_TaintingTrusted<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def SINVAR_TaintingTrusted.sinvar_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹TaintingTrusted packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_TaintingTrusted</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> SINVAR_TaintingTrusted.taints<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_TaintingTrusted</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''TaintingTrusted''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_TaintingTrusted.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_TaintingTrusted.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> TaintingTrusted_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> TaintingTrusted_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_BLPbasic_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_TaintingTrusted</span>
      <span class="quoted">SINVAR_TaintingTrusted.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_TaintingTrusted_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Example›</span></span>
<span class="keyword1"><span class="command">context</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">tainting_example</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">tainting_example</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''produce 1''</span><span class="main">,</span>
                                  <span class="inner_quoted">''produce 2''</span><span class="main">,</span>
                                  <span class="inner_quoted">''produce 3''</span><span class="main">,</span>
                                  <span class="inner_quoted">''read 1 2''</span><span class="main">,</span>
                                  <span class="inner_quoted">''read 3''</span><span class="main">,</span>
                                  <span class="inner_quoted">''consume 1 2 3''</span><span class="main">,</span>
                                  <span class="inner_quoted">''consume 3''</span><span class="main">]</span><span class="main">,</span> 
              edgesL <span class="main">=</span><span class="main">[</span><span class="main">(</span><span class="inner_quoted">''produce 1''</span><span class="main">,</span> <span class="inner_quoted">''read 1 2''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''produce 2''</span><span class="main">,</span> <span class="inner_quoted">''read 1 2''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''produce 3''</span><span class="main">,</span> <span class="inner_quoted">''read 3''</span><span class="main">)</span><span class="main">,</span> 
                       <span class="main">(</span><span class="inner_quoted">''read 3''</span><span class="main">,</span> <span class="inner_quoted">''read 1 2''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''read 1 2''</span><span class="main">,</span> <span class="inner_quoted">''consume 1 2 3''</span><span class="main">)</span><span class="main">,</span>
                       <span class="main">(</span><span class="inner_quoted">''read 3''</span><span class="main">,</span> <span class="inner_quoted">''consume 3''</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph tainting_example"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">tainting_example_props</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string <span class="main">⇒</span> SINVAR_TaintingTrusted.taints"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">tainting_example_props</span> <span class="main">≡</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> SINVAR_TaintingTrusted.default_node_properties<span class="main">)</span>
                          <span class="main">(</span><span class="inner_quoted">''produce 1''</span> <span class="main">:=</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''1''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''produce 2''</span> <span class="main">:=</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''2''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''produce 3''</span> <span class="main">:=</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''3''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''read 1 2''</span> <span class="main">:=</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''3''</span><span class="main">,</span><span class="inner_quoted">''foo''</span><span class="main">}</span> <span class="main">{</span><span class="inner_quoted">''1''</span><span class="main">,</span><span class="inner_quoted">''2''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''read 3''</span> <span class="main">:=</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''3''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''consume 1 2 3''</span> <span class="main">:=</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''foo''</span><span class="main">,</span><span class="inner_quoted">''3''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''consume 3''</span> <span class="main">:=</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''3''</span><span class="main">}</span> <span class="main">{}</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"tainting_example_props <span class="main">(</span><span class="inner_quoted">''consume 1 2 3''</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"TaintingTrusted_offending_list tainting_example tainting_example_props"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"sinvar tainting_example tainting_example_props"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="comment1">(*TODO: fails. why?*)</span>
<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">SINVAR_LIB_TaintingTrusted</span></span> <span class="keyword2"><span class="keyword">checking</span></span> Scala
<span class="keyword1"><span class="command">export_code</span></span> <span class="quoted"><span class="quoted">SINVAR_LIB_TaintingTrusted</span></span> <span class="keyword2"><span class="keyword">checking</span></span> SML

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props TaintingTrusted_offending_list TaintingTrusted_eval

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Dependability">
<div class="head">
<h1>Theory SINVAR_Dependability</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Dependability
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Dependability›</span></span>


<span class="keyword1"><span class="command">type_synonym</span></span> dependability_level <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dependability_level"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Less-equal other nodes depend on the output of a node than its dependability level.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> dependability_level<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">(</span>num_reachable <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">≡</span> False"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹It does not matter whether we iterate over all edges or all nodes. We chose all edges because it is in line with the other models.›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar_nodes</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> dependability_level<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">sinvar_nodes</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">(</span>num_reachable <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">theorem</span></span> sinvar_edges_nodes_iff<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> 
    sinvar_nodes <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> sinvar <span class="free">G</span> <span class="free">nP</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> sinvar_nodes.simps sinvar.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main">)</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>  a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>nodes <span class="free">G</span><span class="main">.</span> num_reachable <span class="free">G</span> <span class="bound">v</span> <span class="main">≤</span> <span class="free">nP</span> <span class="bound">v</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> a1<span class="main">[</span><span class="operator">simplified</span> wf_graph_def<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> edges <span class="free">G</span> <span class="main">⊆</span> nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> f1 a2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">`</span> edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> num_reachable <span class="free">G</span> <span class="bound">v</span> <span class="main">≤</span> <span class="free">nP</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> num_reachable <span class="free">G</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">nP</span> <span class="bound">e1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>  a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="main"><span class="bound">_</span></span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span><span class="main">.</span> num_reachable <span class="free">G</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">nP</span> <span class="bound">e1</span>"</span></span>

      <span class="keyword1"><span class="command">from</span></span> a2 <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> <span class="main">(</span>fst <span class="main">`</span> edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> num_reachable <span class="free">G</span> <span class="bound">v</span> <span class="main">≤</span> <span class="free">nP</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

      <span class="keyword1"><span class="command">from</span></span> FiniteGraph.succ_tran_empty<span class="main">[</span><span class="operator">OF</span> a1<span class="main">]</span> num_reachable_zero_iff<span class="main">[</span><span class="operator">OF</span> a1<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">v</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∉</span> <span class="main">(</span>fst <span class="main">`</span> edges <span class="free">G</span><span class="main">)</span> <span class="main">⟶</span> num_reachable <span class="free">G</span> <span class="bound">v</span> <span class="main">≤</span> <span class="free">nP</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le0<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> g1 g2 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>nodes <span class="free">G</span><span class="main">.</span> num_reachable <span class="free">G</span> <span class="bound">v</span> <span class="main">≤</span> <span class="free">nP</span> <span class="bound">v</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
  <span class="keyword1"><span class="command">qed</span></span>




  <span class="keyword1" id="SINVAR_Dependability-num_reachable_le_nodes"><span class="command">lemma</span></span> num_reachable_le_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> num_reachable <span class="free">G</span> <span class="free">v</span> <span class="main">≤</span> card <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> num_reachable_def
    <span class="keyword1"><span class="command">using</span></span> succ_tran_subseteq_nodes card_seteq nat_le_linear wf_graph.finiteV <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹nP is valid if all dependability level are greater equal the total number of nodes in the graph›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span><span class="main">;</span> <span class="main">∀</span><span class="bound">v</span> <span class="main">∈</span> nodes <span class="free">G</span><span class="main">.</span> <span class="free">nP</span> <span class="bound">v</span> <span class="main">≥</span> card <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> sinvar <span class="free">G</span> <span class="free">nP</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sinvar_edges_nodes_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> num_reachable_le_nodes <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_trans<span class="main">)</span>



  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Generate a valid configuration to start from:›</span></span>
   <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Takes arbitrary configuration, returns a valid one›</span></span>
   <span class="keyword1"><span class="command">fun</span></span> <span class="entity">dependability_fix_nP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> dependability_level<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> dependability_level<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">dependability_fix_nP</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">if</span> num_reachable <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v</span><span class="main">)</span> <span class="keyword1">else</span> num_reachable <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span><span class="main">)</span>"</span></span>
  
   <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> dependability_fix_nP<span class="antiquote"><span class="antiquote">}</span></span></span></span> always gives you a valid solution›</span></span>
   <span class="keyword1" id="SINVAR_Dependability-dependability_fix_nP_valid"><span class="command">lemma</span></span> dependability_fix_nP_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> sinvar <span class="free">G</span> <span class="main">(</span>dependability_fix_nP <span class="free">G</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">subst</span> sinvar_edges_nodes_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
  
   <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹furthermore, it gives you a minimal solution, i.e. if someone supplies a configuration with a value lower than
          calculated by <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> dependability_fix_nP<span class="antiquote"><span class="antiquote">}</span></span></span></span>, this is invalid!›</span></span>
   <span class="keyword1" id="SINVAR_Dependability-dependability_fix_nP_minimal_solution"><span class="command">lemma</span></span> dependability_fix_nP_minimal_solution<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span><span class="main">;</span> <span class="main">∃</span> <span class="bound">v</span> <span class="main">∈</span> nodes <span class="free">G</span><span class="main">.</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">v</span><span class="main">)</span> <span class="main">&lt;</span> <span class="main">(</span>dependability_fix_nP <span class="free">G</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span> <span class="bound">v</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">¬</span> sinvar <span class="free">G</span> <span class="free">nP</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> sinvar_edges_nodes_iff<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">v</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="comment1">(*
lemma card_less_equal_trancl: "finite A ⟹ card {e2. (aa, e2) ∈ (A - X)<span class="hidden">⇧</span><sup>+</sup>} ≤ card {e2. (aa, e2) ∈ (A)<span class="hidden">⇧</span><sup>+</sup>}"
apply(subgoal_tac "{e2. (aa, e2) ∈ (A - X)<span class="hidden">⇧</span><sup>+</sup>} ⊆ {e2. (aa, e2) ∈ (A)<span class="hidden">⇧</span><sup>+</sup>}")
apply(rule card_mono)
defer
apply(simp)
apply (metis (lifting) Collect_mono Diff_subset trancl_mono)
by (metis (lifting) Range_iff finite_Range mem_Collect_eq rev_finite_subset subsetI trancl_range)
*)</span>


<span class="keyword1" id="SINVAR_Dependability-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> SecurityInvariant_withOffendingFlows.sinvar_mono_I_proofrule<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="comment1">(*TODO: auto in the midddle*)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> nP e1 e2 N E' e1' e2' E<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> E'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">E'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">e1'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> num_reachable_mono<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">e1'</span><span class="main">,</span> <span class="improper">e2'</span><span class="main">)</span> <span class="main">∈</span> <span class="improper">E</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  

<span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
<span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_sinvar_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">interpretation</span></span> Dependability<span class="main">:</span> SecurityInvariant_ACS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">SINVAR_Dependability.default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">SINVAR_Dependability.sinvar</span>
  <span class="keyword1"><span class="command">unfolding</span></span> SINVAR_Dependability.default_node_properties_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">G</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> graph"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span> <span class="skolem">nP</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set_offending_flows <span class="skolem">G</span> <span class="skolem">nP</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>fst <span class="main">`</span> <span class="skolem">f</span><span class="main">.</span> <span class="main">¬</span> sinvar <span class="skolem">G</span> <span class="main">(</span><span class="skolem">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> gr0I le0<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">otherbot</span> 
   <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span> <span class="bound">f</span> <span class="bound">nP</span> <span class="bound">i</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> set_offending_flows <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="bound">f</span> <span class="main">⟶</span> <span class="main">¬</span> sinvar <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="skolem">otherbot</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">have</span></span> unique_default_example_succ_tran<span class="main">:</span>
    <span class="quoted"><span class="quoted">"succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> vertex_1 <span class="main">=</span> <span class="main">{</span>vertex_2<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unique_default_example1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">otherbot</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
        SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
        SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> <span class="main">0</span><span class="main">,</span> vertex_2 <span class="main">:=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_default_example_succ_tran num_reachable_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_default_example_succ_tran num_reachable_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def unique_default_example_simp1 unique_default_example_simp2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="SINVAR_Dependability-TopoS_Dependability"><span class="command">lemma</span></span> TopoS_Dependability<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>  

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Dependability_impl">
<div class="head">
<h1>Theory SINVAR_Dependability_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Dependability_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_Dependability.html">SINVAR_Dependability</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_Dependability_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_Dependability


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Dependability List Implementation›</span></span>


<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Less-equal other nodes depend on the output of a node than its dependability level.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> dependability_level<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>num_reachable <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
    <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
    <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>





<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Generate a valid configuration to start from:›</span></span>
   <span class="keyword1"><span class="command">fun</span></span> <span class="entity">dependability_fix_nP</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> dependability_level<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> dependability_level<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">dependability_fix_nP</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="keyword1">let</span> <span class="bound">nr</span> <span class="main">=</span> num_reachable <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span> <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">if</span> <span class="bound">nr</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v</span><span class="main">)</span> <span class="keyword1">then</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v</span><span class="main">)</span> <span class="keyword1">else</span> <span class="bound">nr</span><span class="main">)</span><span class="main">)</span>"</span></span>

   <span class="keyword1"><span class="command">theorem</span></span> dependability_fix_nP_impl_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> dependability_fix_nP <span class="free">G</span> <span class="free">nP</span>  <span class="main">=</span> SINVAR_Dependability.dependability_fix_nP <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> num_reachable_correct fun_eq_iff<span class="main">)</span>

   <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">nP</span> <span class="main">=</span> dependability_fix_nP <span class="bound">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">in</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="bound">nP</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>nodesL <span class="bound">G</span><span class="main">)</span><span class="main">)</span>"</span></span>


   <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="keyword1">in</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">nP</span> <span class="main">=</span> dependability_fix_nP <span class="bound">G</span> <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span> <span class="keyword1">in</span> map <span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> <span class="bound">nP</span> <span class="bound">v</span><span class="main">)</span> <span class="main">(</span>nodesL <span class="bound">G</span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Dependability_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> dependability_level<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Dependability_offending_list</span> <span class="main">=</span> Generic_offending_list sinvar"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_Dependability.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_Dependability.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Dependability_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span>
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_Dependability.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1" id="SINVAR_Dependability_impl-sinvar_correct"><span class="command">lemma</span></span> sinvar_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> SINVAR_Dependability.sinvar <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span> <span class="main">=</span> sinvar <span class="free">G</span> <span class="free">nP</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> all_edges_list_I<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>  num_reachable_correct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">interpretation</span></span> Dependability_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_Dependability.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_Dependability.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_Dependability.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">Dependability_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">Dependability_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_Dependability<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> sinvar_correct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> Dependability_offending_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Generic_offending_list_correct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinvar_correct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> Dependability.node_props.simps Dependability.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Dependability_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_Dependability<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinvar_correct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Dependability packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_Dependability</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> SINVAR_Dependability.dependability_level<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_Dependability</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''Dependability''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_Dependability.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_Dependability.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> Dependability_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> Dependability_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_Dependability_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_Dependability</span>
      <span class="quoted">SINVAR_Dependability.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_Dependability_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Example:›</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
      <span class="keyword1">in</span> sinvar <span class="bound">G</span>  <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> SINVAR_Dependability.default_node_properties<span class="main">)</span><span class="main">(</span><span class="main">1</span><span class="main">:=</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">2</span><span class="main">:=</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">:=</span><span class="main">1</span><span class="main">,</span> <span class="numeral">4</span><span class="main">:=</span><span class="main">0</span><span class="main">,</span> <span class="numeral">8</span><span class="main">:=</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">9</span><span class="main">:=</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">10</span><span class="main">:=</span><span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
      <span class="keyword1">in</span> sinvar <span class="bound">G</span>  <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> SINVAR_Dependability.default_node_properties<span class="main">)</span><span class="main">(</span><span class="main">1</span><span class="main">:=</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">2</span><span class="main">:=</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">3</span><span class="main">:=</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">4</span><span class="main">:=</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">8</span><span class="main">:=</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">9</span><span class="main">:=</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">10</span><span class="main">:=</span><span class="numeral">10</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
      <span class="keyword1">in</span> sinvar <span class="bound">G</span>  <span class="main">(</span><span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
      <span class="keyword1">in</span> Dependability_eval <span class="bound">G</span>  <span class="main">⦇</span>node_properties<span class="main">=</span><span class="main">[</span><span class="main">1</span><span class="main">↦</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">2</span><span class="main">↦</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">↦</span><span class="main">1</span><span class="main">,</span> <span class="numeral">4</span><span class="main">↦</span><span class="main">0</span><span class="main">,</span> <span class="numeral">8</span><span class="main">↦</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">9</span><span class="main">↦</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">10</span><span class="main">↦</span><span class="main">0</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"Dependability_offending_list <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">n</span><span class="main">.</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar_correct
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar NetModel_node_props

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_NonInterference">
<div class="head">
<h1>Theory SINVAR_NonInterference</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_NonInterference
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant NonInterference›</span></span>

<span class="keyword1"><span class="command">datatype</span></span> node_config <span class="main">=</span> Interfering <span class="main">|</span> Unrelated

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"node_config"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">=</span> Interfering"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">undirected_reachable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">=&gt;</span> <span class="tfree">'v</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">undirected_reachable</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> <span class="main">(</span>succ_tran <span class="main">(</span>undirected <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">{</span><span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">}</span>"</span></span>


<span class="keyword1" id="SINVAR_NonInterference-undirected_reachable_mono"><span class="command">lemma</span></span> undirected_reachable_mono<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> undirected_reachable <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span><span class="main">⦈</span> <span class="free">n</span> <span class="main">⊆</span> undirected_reachable <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="free">n</span>"</span></span>
<span class="keyword1"><span class="command">unfolding</span></span> undirected_reachable_def undirected_def succ_tran_def
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">fastforce</span> <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span> trancl_mono<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">(</span>nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> Interfering <span class="main">⟶</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">`</span> <span class="main">(</span>undirected_reachable <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span>Unrelated<span class="main">}</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟷</span> 
  <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> <span class="main">{</span><span class="bound"><span class="bound">v'</span></span> <span class="main">∈</span> <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free">nP</span> <span class="bound">v'</span><span class="main">)</span> <span class="main">=</span> Interfering<span class="main">}</span><span class="main">.</span> <span class="main">{</span><span class="free">nP</span> <span class="bound">v'</span> <span class="main">|</span> <span class="bound">v'</span><span class="main">.</span> <span class="bound">v'</span> <span class="main">∈</span> undirected_reachable <span class="free">G</span> <span class="bound">n</span><span class="main">}</span> <span class="main">⊆</span> <span class="main">{</span>Unrelated<span class="main">}</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">=</span> True"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹simplifications for sets we need in the uniqueness proof›</span></span>
  <span class="keyword1" id="SINVAR_NonInterference-tmp1"><span class="command">lemma</span></span> tmp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> vertex_1 <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> vertex_2<span class="main">}</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_2<span class="main">,</span> vertex_1<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1" id="SINVAR_NonInterference-tmp6"><span class="command">lemma</span></span> tmp6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">,</span> <span class="main">(</span>vertex_2<span class="main">,</span> vertex_1<span class="main">)</span><span class="main">}</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> 
    <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_1<span class="main">)</span><span class="main">,</span> <span class="main">(</span>vertex_2<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">,</span> <span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">,</span> <span class="main">(</span>vertex_2<span class="main">,</span> vertex_1<span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> r<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">,</span> <span class="main">(</span>vertex_2<span class="main">,</span> vertex_1<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> trancl_induct<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>mono_tags<span class="main"><span class="main">)</span></span> insertCI r_r_into_trancl<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1" id="SINVAR_NonInterference-tmp2"><span class="command">lemma</span></span> tmp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>insert <span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span> <span class="main">{</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> vertex_1 <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> vertex_2<span class="main">}</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">=</span> 
    <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_1<span class="main">)</span><span class="main">,</span> <span class="main">(</span>vertex_2<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">,</span> <span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">,</span> <span class="main">(</span>vertex_2<span class="main">,</span> vertex_1<span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tmp1<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> tmp6<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1" id="SINVAR_NonInterference-tmp4"><span class="command">lemma</span></span> tmp4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">.</span> <span class="bound">e1</span> <span class="main">=</span> vertex_1 <span class="main">∧</span> <span class="bound">e2</span> <span class="main">=</span> vertex_2 <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">=</span> vertex_1 <span class="main">⟶</span> <span class="bound">e2</span> <span class="main">≠</span> vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1" id="SINVAR_NonInterference-tmp5"><span class="command">lemma</span></span> tmp5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">b</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">=</span> vertex_1 <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> vertex_2 <span class="main">∨</span> <span class="bound">a</span> <span class="main">=</span> vertex_1 <span class="main">∧</span> <span class="bound">b</span> <span class="main">=</span> vertex_2 <span class="main">∧</span> <span class="main">(</span><span class="bound">a</span> <span class="main">=</span> vertex_1 <span class="main">⟶</span> <span class="bound">b</span> <span class="main">≠</span> vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">=</span> 
    <span class="main">{</span><span class="main">(</span>vertex_2<span class="main">,</span> vertex_1<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  <span class="keyword1" id="SINVAR_NonInterference-unique_default_example"><span class="command">lemma</span></span> unique_default_example<span class="main">:</span> <span class="quoted"><span class="quoted">"undirected_reachable <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> vertex_1 <span class="main">=</span> <span class="main">{</span>vertex_2<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> undirected_def undirected_reachable_def succ_tran_def tmp2<span class="main">)</span>
  <span class="keyword1" id="SINVAR_NonInterference-unique_default_example_hlp1"><span class="command">lemma</span></span> unique_default_example_hlp1<span class="main">:</span> <span class="quoted"><span class="quoted">"delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">=</span> 
    <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_def<span class="main">)</span>
  <span class="keyword1" id="SINVAR_NonInterference-unique_default_example_2"><span class="command">lemma</span></span> unique_default_example_2<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"undirected_reachable <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2 <span class="main">)</span><span class="main">}</span><span class="main">)</span> vertex_1 <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> undirected_def undirected_reachable_def succ_tran_def unique_default_example_hlp1<span class="main">)</span>
  <span class="keyword1" id="SINVAR_NonInterference-unique_default_example_3"><span class="command">lemma</span></span> unique_default_example_3<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"undirected_reachable <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2 <span class="main">)</span><span class="main">}</span><span class="main">)</span> vertex_2 <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> undirected_def undirected_reachable_def succ_tran_def unique_default_example_hlp1<span class="main">)</span>
  <span class="keyword1" id="SINVAR_NonInterference-unique_default_example_4"><span class="command">lemma</span></span> unique_default_example_4<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>undirected_reachable <span class="main">(</span>add_edge vertex_1 vertex_2 <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> 
    edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> vertex_1<span class="main">)</span> <span class="main">=</span> <span class="main">{</span>vertex_2<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_def add_edge_def undirected_def undirected_reachable_def succ_tran_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tmp4<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tmp5<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tmp6<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  <span class="keyword1" id="SINVAR_NonInterference-unique_default_example_5"><span class="command">lemma</span></span> unique_default_example_5<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span>undirected_reachable <span class="main">(</span>add_edge vertex_1 vertex_2 <span class="main">(</span>delete_edges <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> 
    edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">)</span><span class="main">)</span> vertex_2<span class="main">)</span> <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_def add_edge_def undirected_def undirected_reachable_def succ_tran_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tmp4<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tmp5<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> tmp6<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


  <span class="comment1">(*lemma empty_undirected_reachable_false: "xb ∈ undirected_reachable ⦇nodes = nodes G, edges = {(e1, e2). False}⦈ na ⟷ False"
    apply(simp add: undirected_reachable_def succ_tran_def undirected_def)
    apply(subst tmp3)
    by fastforce*)</span>

  <span class="keyword1" id="SINVAR_NonInterference-empty_undirected_reachable_false"><span class="command">lemma</span></span> empty_undirected_reachable_false<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">xb</span> <span class="main">∈</span> undirected_reachable <span class="main">(</span>delete_edges <span class="free">G</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="free">na</span> <span class="main">⟷</span> False"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> undirected_reachable_def succ_tran_def undirected_def delete_edges_edges_empty<span class="main">)</span>

<span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹monotonic and preliminaries›</span></span>
  <span class="keyword1" id="SINVAR_NonInterference-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> nP N E' n E xa<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> N<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">N</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> n<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> undirected_reachable_mono<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    
  
  <span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
  <span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def empty_undirected_reachable_false<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_sinvar_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">interpretation</span></span> NonInterference<span class="main">:</span> SecurityInvariant_IFS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">SINVAR_NonInterference.default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">SINVAR_NonInterference.sinvar</span>
  <span class="keyword1"><span class="command">unfolding</span></span> SINVAR_NonInterference.default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> SINVAR_NonInterference.offending_notevalD<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">clarify</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> xa<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nP</span> <span class="improper">xa</span>"</span></span><span class="main">)</span>
    <span class="comment1">(*case Interfering*)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">n</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"nodes <span class="improper">G</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"wf_graph <span class="improper">G</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">a</span><span class="main">,</span><span class="improper">b</span><span class="main">)</span> <span class="main">∈</span> <span class="improper">f</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">n</span> <span class="main">∈</span> nodes <span class="improper">G</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">nP</span> <span class="improper">n</span> <span class="main">=</span> Interfering"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
   <span class="comment1">(*case Unrelated*)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="comment1">(*unique: *)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_IFS<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>delete_edges_set_nodes<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> default_node_properties<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> Interfering<span class="main">,</span> vertex_2 <span class="main">:=</span> Interfering<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_default_example<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_2"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_default_example<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_default_example_2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_default_example_3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_default_example_4<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_default_example_5<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">otherbot</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1" id="SINVAR_NonInterference-TopoS_NonInterference"><span class="command">lemma</span></span> TopoS_NonInterference<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>
   

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="comment1">― ‹Hide all the helper lemmas.›</span>
<span class="keyword1"><span class="command">hide_fact</span></span> tmp1 tmp2 tmp4 tmp5 tmp6 unique_default_example 
          unique_default_example_2 unique_default_example_3 unique_default_example_4
          unique_default_example_5 empty_undirected_reachable_false

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_NonInterference_impl">
<div class="head">
<h1>Theory SINVAR_NonInterference_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_NonInterference_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_NonInterference.html">SINVAR_NonInterference</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_NonInterference_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_NonInterference


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant NonInterference List Implementation›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">undirected_reachable</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">=&gt;</span> <span class="tfree">'v</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">undirected_reachable</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">=</span> removeAll <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span>succ_tran <span class="main">(</span>undirected <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">)</span>"</span></span>

<span class="keyword1" id="SINVAR_NonInterference_impl-undirected_reachable_set"><span class="command">lemma</span></span> undirected_reachable_set<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>undirected_reachable <span class="free">G</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span><span class="bound">e2</span><span class="main">.</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>edgesL <span class="main">(</span>undirected <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">}</span> <span class="main">-</span> <span class="main">{</span><span class="free">v</span><span class="main">}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> undirected_succ_tran_set undirected_nodes_set undirected_reachable_def<span class="main">)</span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar_set</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar_set</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> Interfering <span class="main">⟶</span> set <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">(</span>undirected_reachable <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span>Unrelated<span class="main">}</span><span class="main">)</span>"</span></span>

<span class="comment1">(* equal: lemma sinvar_list_eq_set*)</span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">n</span> <span class="main">∈</span> set <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">n</span><span class="main">)</span> <span class="main">=</span> Interfering <span class="main">⟶</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">result</span> <span class="main">=</span> remdups <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">(</span>undirected_reachable <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span> <span class="bound">result</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">result</span> <span class="main">=</span> <span class="main">[</span>Unrelated<span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="free">P</span> <span class="main">=</span> <span class="free">Q</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">P</span> <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">x</span><span class="main">.</span> <span class="free">Q</span> <span class="bound">x</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">erule</span> arg_cong<span class="main">)</span>


<span class="keyword1" id="SINVAR_NonInterference_impl-sinvar_eq_help1"><span class="command">lemma</span></span> sinvar_eq_help1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="main">`</span> set <span class="main">(</span>undirected_reachable <span class="free">G</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>map <span class="free">nP</span> <span class="main">(</span>undirected_reachable <span class="free">G</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1" id="SINVAR_NonInterference_impl-sinvar_eq_help2"><span class="command">lemma</span></span> sinvar_eq_help2<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">l</span> <span class="main">=</span> <span class="main">{</span>Unrelated<span class="main">}</span> <span class="main">⟹</span> remdups <span class="free">l</span> <span class="main">=</span> <span class="main">[</span>Unrelated<span class="main">]</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">l</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> empty_iff insertI1 set_empty2 subset_singletonD<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1" id="SINVAR_NonInterference_impl-sinvar_eq_help3"><span class="command">lemma</span></span> sinvar_eq_help3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">let</span> <span class="bound">result</span> <span class="main">=</span> remdups <span class="main">(</span>map <span class="free">nP</span> <span class="main">(</span>undirected_reachable <span class="free">G</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="keyword1">in</span> <span class="bound">result</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">∨</span> <span class="bound">result</span> <span class="main">=</span> <span class="main">[</span>Unrelated<span class="main">]</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>set <span class="main">(</span>map <span class="free">nP</span> <span class="main">(</span>undirected_reachable <span class="free">G</span> <span class="free">n</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span>Unrelated<span class="main">}</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> set_map<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> set_remdups<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">" <span class="free">nP</span> <span class="main">`</span> set <span class="main">(</span>undirected_reachable <span class="free">G</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">" <span class="free">nP</span> <span class="main">`</span> set <span class="main">(</span>undirected_reachable <span class="free">G</span> <span class="free">n</span><span class="main">)</span> <span class="main">=</span> <span class="main">{</span>Unrelated<span class="main">}</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="main">`</span> set <span class="main">(</span>undirected_reachable <span class="free">G</span> <span class="free">n</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span>Unrelated<span class="main">}</span> <span class="main">⟹</span>
    <span class="free">nP</span> <span class="main">`</span> set <span class="main">(</span>undirected_reachable <span class="free">G</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
    <span class="free">nP</span> <span class="main">`</span> set <span class="main">(</span>undirected_reachable <span class="free">G</span> <span class="free">n</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{</span>Unrelated<span class="main">}</span> <span class="main">⟹</span> False"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> subset_singletonD<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> disjI2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinvar_eq_help1<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>sinvar_eq_help2<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1" id="SINVAR_NonInterference_impl-sinvar_list_eq_set"><span class="command">lemma</span></span> sinvar_list_eq_set<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar <span class="main">=</span> sinvar_set"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">insert</span> sinvar_eq_help3<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
    <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_NonInterference.default_node_properties<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
    <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
    <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_NonInterference.default_node_properties<span class="main">)</span><span class="main">(</span><span class="main">1</span><span class="main">:=</span> Interfering<span class="main">,</span> <span class="numeral">2</span><span class="main">:=</span> Unrelated<span class="main">,</span> <span class="numeral">3</span><span class="main">:=</span> Unrelated<span class="main">,</span> <span class="numeral">4</span><span class="main">:=</span> Unrelated<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
    <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
    <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_NonInterference.default_node_properties<span class="main">)</span><span class="main">(</span><span class="main">1</span><span class="main">:=</span> Interfering<span class="main">,</span> <span class="numeral">2</span><span class="main">:=</span> Unrelated<span class="main">,</span> <span class="numeral">3</span><span class="main">:=</span> Unrelated<span class="main">,</span> <span class="numeral">4</span><span class="main">:=</span> Unrelated<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
    <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
    <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_NonInterference.default_node_properties<span class="main">)</span><span class="main">(</span><span class="main">1</span><span class="main">:=</span> Interfering<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>undirected_reachable <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="main">1</span><span class="main">)</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> 
  <span class="comment1">(* apply(simp add: removeAll_def remdups_def undirected_reachable_def succ_tran_def trancl_list_impl_def trancl_impl_def) *)</span>





<span class="keyword1"><span class="command">definition</span></span> <span class="entity">NonInterference_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> node_config<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">NonInterference_offending_list</span> <span class="main">=</span> Generic_offending_list sinvar"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_NonInterference.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_NonInterference.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NonInterference_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span>
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_NonInterference.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1" id="SINVAR_NonInterference_impl-sinvar_correct"><span class="command">lemma</span></span> sinvar_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> SINVAR_NonInterference.sinvar <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span> <span class="main">=</span> sinvar <span class="free">G</span> <span class="free">nP</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> sinvar_list_eq_set<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> all_nodes_list_I<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_NonInterference.undirected_reachable_def succ_tran_correct undirected_correct undirected_reachable_def<span class="main">)</span>



<span class="keyword1"><span class="command">interpretation</span></span> NonInterference_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_NonInterference.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_NonInterference.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_NonInterference.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">NonInterference_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">NonInterference_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_NonInterference<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> sinvar_correct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> NonInterference_offending_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Generic_offending_list_correct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinvar_correct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> NonInterference.node_props.simps NonInterference.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NonInterference_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_NonInterference<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinvar_correct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹NonInterference packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_NonInterference</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> node_config<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_NonInterference</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''NonInterference''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_NonInterference.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_NonInterference.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> NonInterference_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> NonInterference_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_NonInterference_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_NonInterference</span>
      <span class="quoted">SINVAR_NonInterference.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_NonInterference_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>




<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Example:›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">example_graph</span> <span class="main">=</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span><span class="quoted"><span class="quoted">"<span class="free">example_conf</span> <span class="main">=</span> <span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> SINVAR_NonInterference.default_node_properties<span class="main">)</span>
      <span class="main">(</span><span class="main">1</span><span class="main">:=</span> Interfering<span class="main">,</span> <span class="numeral">2</span><span class="main">:=</span> Unrelated<span class="main">,</span> <span class="numeral">3</span><span class="main">:=</span> Unrelated<span class="main">,</span> <span class="numeral">4</span><span class="main">:=</span> Unrelated<span class="main">,</span> <span class="numeral">8</span><span class="main">:=</span> Unrelated<span class="main">,</span> <span class="numeral">9</span><span class="main">:=</span> Unrelated<span class="main">)</span><span class="main">)</span>"</span></span>
  
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> sinvar example_graph example_conf"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"NonInterference_offending_list example_graph example_conf <span class="main">=</span>
                     <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_ACLcommunicateWith">
<div class="head">
<h1>Theory SINVAR_ACLcommunicateWith</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_ACLcommunicateWith
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant ACLcommunicateWith›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An access control list strategy that says that hosts must only transitively access each other if allowed›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Warning: this transitive model has exponential computational complexity›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> <span class="main">[]</span>"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> list<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span>succ_tran <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">≡</span> False"</span></span>


<span class="comment1">(*Alternative definition*)</span>
<span class="keyword1" id="SINVAR_ACLcommunicateWith-ACLcommunicateWith_sinvar_alternative"><span class="command">lemma</span></span> ACLcommunicateWith_sinvar_alternative<span class="main">:</span>
  <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span><span class="main">.</span> <span class="bound">e2</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">nP</span> <span class="bound">e1</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> sinvar.simps<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> iffI<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
  <span class="keyword3"><span class="command">case</span></span> 1
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> e1_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">⟹</span> <span class="skolem">e1</span> <span class="main">∈</span> nodes <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">e1</span> <span class="skolem">e2</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph.E_wfD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> 1<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">∈</span>nodes <span class="free">G</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> <span class="bound">a</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟶</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">nP</span> <span class="bound">v</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> e1_nodes <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e1</span><span class="main">,</span> <span class="skolem">e2</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main"><span class="hidden">⇧</span><sup>+</sup></span> <span class="main">⟹</span> <span class="skolem">e2</span> <span class="main">∈</span> set <span class="main">(</span><span class="free">nP</span> <span class="skolem">e1</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">e1</span> <span class="skolem">e2</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> tranclD<span class="main">)</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> 2
      <span class="keyword1"><span class="command">from</span></span> 2<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> e1_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span> <span class="skolem">a</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">⟹</span> <span class="skolem">v</span> <span class="main">∈</span> nodes <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="skolem">a</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph.E_wfD<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">with</span></span> 2<span class="main">(</span>2<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1" id="SINVAR_ACLcommunicateWith-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nP</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> list<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">N</span> <span class="skolem">E'</span> <span class="skolem">E</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    a3<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="skolem">nP</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="main">∀</span><span class="bound">a</span><span class="main">∈</span><span class="main">(</span>succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="skolem">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">nP</span> <span class="skolem">v</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">with</span></span> a2 <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span> <span class="main">∈</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span>succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span> <span class="skolem">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="skolem">nP</span> <span class="skolem">v</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">v</span>
      <span class="keyword1"><span class="command">using</span></span> succ_tran_mono<span class="main">[</span><span class="operator">OF</span> a1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sinvar <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span> <span class="skolem">nP</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
<span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops False_set succ_tran_empty<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_sinvar_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="SINVAR_ACLcommunicateWith-unique_default_example"><span class="command">lemma</span></span> unique_default_example<span class="main">:</span> <span class="quoted"><span class="quoted">"succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> vertex_2 <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Domain.DomainI Domain_empty Domain_insert distinct_vertices12 singleton_iff trancl_domain<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> ACLcommunicateWith<span class="main">:</span> SecurityInvariant_ACS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">SINVAR_ACLcommunicateWith.default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">SINVAR_ACLcommunicateWith.sinvar</span>
  <span class="keyword1"><span class="command">unfolding</span></span> SINVAR_ACLcommunicateWith.default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
  
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>


  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> List.neq_Nil_conv<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> canAccessThis<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">canAccessThis</span> <span class="main">=</span> vertex_1"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span><span class="improper">canAccessThis</span><span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_2<span class="main">,</span><span class="improper">canAccessThis</span><span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">[]</span><span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> <span class="main">[]</span><span class="main">,</span> vertex_2 <span class="main">:=</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> example_simps<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_2<span class="main">,</span>vertex_1<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> example_simps<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span><span class="improper">canAccessThis</span><span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span><span class="improper">canAccessThis</span><span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">[]</span><span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> <span class="main">[]</span><span class="main">,</span> <span class="improper">canAccessThis</span> <span class="main">:=</span> <span class="main">[]</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> example_simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span><span class="improper">canAccessThis</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> example_simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fastforce</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


  <span class="keyword1" id="SINVAR_ACLcommunicateWith-TopoS_ACLcommunicateWith"><span class="command">lemma</span></span> TopoS_ACLcommunicateWith<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>  

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_ACLnotCommunicateWith">
<div class="head">
<h1>Theory SINVAR_ACLnotCommunicateWith</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_ACLnotCommunicateWith
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span> <a href="SINVAR_ACLcommunicateWith.html">SINVAR_ACLcommunicateWith</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant ACLnotCommunicateWith›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An access control list strategy that says that hosts must not transitively access each other.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹node properties: a set of hosts this host must not access›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> UNIV"</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> set<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span>succ_tran <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∉</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">≡</span> False"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹It is the inverse of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SINVAR_ACLcommunicateWith.sinvar<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1" id="SINVAR_ACLnotCommunicateWith-ACLcommunicateNotWith_inverse_ACLcommunicateWith"><span class="command">lemma</span></span> ACLcommunicateNotWith_inverse_ACLcommunicateWith<span class="main">:</span>
  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">v</span><span class="main">.</span> UNIV <span class="main">-</span> <span class="free">nP'</span> <span class="bound">v</span> <span class="main">=</span> set <span class="main">(</span><span class="free">nP</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⟹</span> SINVAR_ACLcommunicateWith.sinvar <span class="free">G</span> <span class="free">nP</span> <span class="main">⟷</span> sinvar <span class="free">G</span> <span class="free">nP'</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="keyword1" id="SINVAR_ACLnotCommunicateWith-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">nP</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">N</span> <span class="skolem">E'</span> <span class="skolem">E</span>
    <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    a3<span class="main">:</span> <span class="quoted"><span class="quoted">"sinvar <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="skolem">nP</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">N</span> <span class="main">⟹</span>  <span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span>succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∉</span> <span class="main">(</span><span class="skolem">nP</span> <span class="bound">v</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">from</span></span> this a2 <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">v</span> <span class="bound">a</span><span class="main">.</span> <span class="bound">v</span> <span class="main">∈</span> <span class="skolem">N</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span>succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span> <span class="bound">v</span><span class="main">)</span> <span class="main">⟹</span> <span class="bound">a</span> <span class="main">∉</span> <span class="main">(</span><span class="skolem">nP</span> <span class="bound">v</span><span class="main">)</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> succ_tran_mono<span class="main">[</span><span class="operator">OF</span> a1<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"sinvar <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span> <span class="skolem">nP</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command">qed</span></span>
  

<span class="keyword1" id="SINVAR_ACLnotCommunicateWith-succ_tran_empty"><span class="command">lemma</span></span> succ_tran_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span><span class="main">⦈</span> <span class="free">v</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
<span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops succ_tran_empty<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_sinvar_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1" id="SINVAR_ACLnotCommunicateWith-unique_default_example"><span class="command">lemma</span></span> unique_default_example<span class="main">:</span> <span class="quoted"><span class="quoted">"succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> vertex_2 <span class="main">=</span> <span class="main">{}</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def<span class="main">)</span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Domain.DomainI Domain_empty Domain_insert distinct_vertices12 singleton_iff trancl_domain<span class="main">)</span>

<span class="keyword1"><span class="command">interpretation</span></span> ACLnotCommunicateWith<span class="main">:</span> SecurityInvariant_ACS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">SINVAR_ACLnotCommunicateWith.default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">SINVAR_ACLnotCommunicateWith.sinvar</span>
  <span class="keyword1"><span class="command">unfolding</span></span> SINVAR_ACLnotCommunicateWith.default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
 
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_simp<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">otherbot</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>

   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> UNIV<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> <span class="main">{</span>vertex_2<span class="main">}</span><span class="main">,</span> vertex_2 <span class="main">:=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> example_simps<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> example_simps<span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">canAccess</span><span class="main">.</span> <span class="bound">canAccess</span> <span class="main">∈</span> UNIV <span class="main">∧</span> <span class="bound">canAccess</span> <span class="main">∉</span> <span class="improper">otherbot</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> canAccessThis<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"vertex_1 <span class="main">≠</span> <span class="improper">canAccessThis</span>"</span></span><span class="main">)</span>

   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span><span class="improper">canAccessThis</span><span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span><span class="improper">canAccessThis</span><span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> UNIV<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> UNIV<span class="main">,</span> <span class="improper">canAccessThis</span> <span class="main">:=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> example_simps<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span><span class="improper">canAccessThis</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> example_simps<span class="main">)</span>

  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span><span class="improper">canAccessThis</span><span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_2<span class="main">,</span><span class="improper">canAccessThis</span><span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> UNIV<span class="main">)</span><span class="main">(</span>vertex_2 <span class="main">:=</span> UNIV<span class="main">,</span> <span class="improper">canAccessThis</span> <span class="main">:=</span> <span class="main">{}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> example_simps<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_2<span class="main">,</span><span class="improper">canAccessThis</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> example_simps<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="SINVAR_ACLnotCommunicateWith-TopoS_ACLnotCommunicateWith"><span class="command">lemma</span></span> TopoS_ACLnotCommunicateWith<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>  

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_ACLnotCommunicateWith_impl">
<div class="head">
<h1>Theory SINVAR_ACLnotCommunicateWith_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_ACLnotCommunicateWith_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_ACLnotCommunicateWith.html">SINVAR_ACLnotCommunicateWith</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_ACLnotCommunicateWith_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_ACLnotCommunicateWith


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant ACLnotCommunicateWith List Implementation›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> set<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span>succ_tran <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∉</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'v</span> set<span class="main">)</span> TopoS_Params<span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_ACLnotCommunicateWith.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_ACLnotCommunicateWith.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ACLnotCommunicateWith_offending_list</span> <span class="main">=</span> Generic_offending_list sinvar"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ACLnotCommunicateWith_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> 
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_ACLnotCommunicateWith.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="SINVAR_ACLnotCommunicateWith_impl-sinvar_correct"><span class="command">lemma</span></span> sinvar_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> SINVAR_ACLnotCommunicateWith.sinvar <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span> <span class="main">=</span> sinvar <span class="free">G</span> <span class="free">nP</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SINVAR_ACLnotCommunicateWith.sinvar.simps SINVAR_ACLnotCommunicateWith_impl.sinvar.simps graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list_graph_to_graph_def succ_tran_correct<span class="main">)</span>


<span class="keyword1"><span class="command">interpretation</span></span> ACLnotCommunicateWith_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_ACLnotCommunicateWith.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_ACLnotCommunicateWith.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_ACLnotCommunicateWith.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">ACLnotCommunicateWith_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">ACLnotCommunicateWith_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_ACLnotCommunicateWith<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> sinvar_correct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> ACLnotCommunicateWith_offending_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Generic_offending_list_correct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinvar_correct<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> ACLnotCommunicateWith.node_props.simps ACLnotCommunicateWith.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ACLnotCommunicateWith_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_ACLnotCommunicateWith<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinvar_correct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_ACLnotCommunicateWith</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'v</span> set<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_ACLnotCommunicateWith</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''ACLnotCommunicateWith''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_ACLnotCommunicateWith.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_ACLnotCommunicateWith.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> ACLnotCommunicateWith_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> ACLnotCommunicateWith_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_ACLnotCommunicateWith_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_ACLnotCommunicateWith</span>
      <span class="quoted">SINVAR_ACLnotCommunicateWith.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_ACLnotCommunicateWith_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>



<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_ACLcommunicateWith_impl">
<div class="head">
<h1>Theory SINVAR_ACLcommunicateWith_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_ACLcommunicateWith_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_ACLcommunicateWith.html">SINVAR_ACLcommunicateWith</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_ACLcommunicateWith_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_ACLcommunicateWith


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹List Implementation›</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> list<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="bound">v</span> <span class="main">∈</span> set <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> <span class="main">(</span>set <span class="main">(</span>succ_tran <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∈</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">v</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'v</span> list<span class="main">)</span> TopoS_Params<span class="main">)</span> <span class="main">=</span> 
  <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_ACLcommunicateWith.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_ACLcommunicateWith.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ACLcommunicateWith_offending_list</span> <span class="main">=</span> Generic_offending_list sinvar"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ACLcommunicateWith_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> 
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_ACLcommunicateWith.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1" id="SINVAR_ACLcommunicateWith_impl-sinvar_correct"><span class="command">lemma</span></span> sinvar_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> SINVAR_ACLcommunicateWith.sinvar <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span> <span class="main">=</span> sinvar <span class="free">G</span> <span class="free">nP</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> SINVAR_ACLcommunicateWith.sinvar.simps SINVAR_ACLcommunicateWith_impl.sinvar.simps graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> list_graph_to_graph_def succ_tran_correct<span class="main">)</span>


<span class="keyword1"><span class="command">interpretation</span></span> SINVAR_ACLcommunicateWith_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_ACLcommunicateWith.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_ACLcommunicateWith.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_ACLcommunicateWith.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">ACLcommunicateWith_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">ACLcommunicateWith_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_ACLcommunicateWith<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> sinvar_correct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> ACLcommunicateWith_offending_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Generic_offending_list_correct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinvar_correct<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> ACLcommunicateWith.node_props.simps ACLcommunicateWith.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> ACLcommunicateWith_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_ACLcommunicateWith<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinvar_correct<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_ACLcommunicateWith</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'v</span> list<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_ACLcommunicateWith</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''ACLcommunicateWith''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_ACLcommunicateWith.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_ACLcommunicateWith.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> ACLcommunicateWith_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> ACLcommunicateWith_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_ACLcommunicateWith_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_ACLcommunicateWith</span>
      <span class="quoted">SINVAR_ACLcommunicateWith.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_ACLcommunicateWith_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>



<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Examples›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    1 can access 2 and 3
    2 can access 3
›</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"sinvar
            <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">]</span><span class="main">,</span>
              edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>
            <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> SINVAR_ACLcommunicateWith.default_node_properties<span class="main">)</span>
                    <span class="main">(</span><span class="main">1</span> <span class="main">:=</span> <span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
                    <span class="main">(</span><span class="numeral">2</span> <span class="main">:=</span> <span class="main">[</span><span class="numeral">3</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    Everyone can access everyone, except for 1: 1 must not access 4.
    The offending flows may be any edge on the path from 1 to 4
›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ACLcommunicateWith_offending_list 
          <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
            edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>
          <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> SINVAR_ACLcommunicateWith.default_node_properties<span class="main">)</span>
          <span class="main">(</span><span class="main">1</span> <span class="main">:=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="numeral">2</span> <span class="main">:=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="numeral">3</span> <span class="main">:=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="numeral">4</span> <span class="main">:=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    If we add the additional edge from 1 to 3, then the offending flows are either
    <span class="antiquoted"><span class="antiquoted">▪</span></span> [(3.4)], because this disconnects 4 from the graph completely
    <span class="antiquoted"><span class="antiquoted">▪</span></span> any pair of edges which disconnects 1 from 3
›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"ACLcommunicateWith_offending_list 
          <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
            edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>
          <span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="main">λ</span><span class="bound">v</span><span class="main">.</span> SINVAR_ACLcommunicateWith.default_node_properties<span class="main">)</span>
          <span class="main">(</span><span class="main">1</span> <span class="main">:=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="numeral">2</span> <span class="main">:=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="numeral">3</span> <span class="main">:=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">)</span><span class="main">)</span>
          <span class="main">(</span><span class="numeral">4</span> <span class="main">:=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> NetModel_node_props
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Dependability_norefl">
<div class="head">
<h1>Theory SINVAR_Dependability_norefl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Dependability_norefl
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>Dependability_norefl›</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A version of the Dependability model but if a node reaches itself, it is ignored›</span></span>


<span class="keyword1"><span class="command">type_synonym</span></span> dependability_level <span class="main">=</span> <span class="quoted">nat</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"dependability_level"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> <span class="main">0</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Less-equal other nodes depend on the output of a node than its dependability level.›</span></span>
<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> dependability_level<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">.</span> <span class="main">(</span>num_reachable_norefl <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">receiver_violation</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">receiver_violation</span> <span class="main">≡</span> False"</span></span>





<span class="keyword1" id="SINVAR_Dependability_norefl-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> SecurityInvariant_withOffendingFlows.sinvar_mono_I_proofrule<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> nP e1 e2 N E' e1' e2' E<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> E'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">E'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">e1'</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> num_reachable_norefl_mono<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">e1'</span><span class="main">,</span> <span class="improper">e2'</span><span class="main">)</span> <span class="main">∈</span> <span class="improper">E</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  

<span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
<span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>4<span class="main"><span class="keyword3">]</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_sinvar_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">interpretation</span></span> Dependability<span class="main">:</span> SecurityInvariant_ACS
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">SINVAR_Dependability_norefl.default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">SINVAR_Dependability_norefl.sinvar</span>
  <span class="keyword1"><span class="command">unfolding</span></span> SINVAR_Dependability_norefl.default_node_properties_def
  <span class="keyword1"><span class="command">proof</span></span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">G</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> graph"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">f</span> <span class="skolem">nP</span>
    <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">f</span> <span class="main">∈</span> set_offending_flows <span class="skolem">G</span> <span class="skolem">nP</span>"</span></span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">i</span><span class="main">∈</span>fst <span class="main">`</span> <span class="skolem">f</span><span class="main">.</span> <span class="main">¬</span> sinvar <span class="skolem">G</span> <span class="main">(</span><span class="skolem">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
      SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> gr0I le0<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">otherbot</span> 
   <span class="keyword3"><span class="command">assume</span></span> assm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span> <span class="bound">f</span> <span class="bound">nP</span> <span class="bound">i</span><span class="main">.</span> wf_graph <span class="bound">G</span> <span class="main">∧</span> <span class="bound">f</span> <span class="main">∈</span> set_offending_flows <span class="bound">G</span> <span class="bound">nP</span> <span class="main">∧</span> <span class="bound">i</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="bound">f</span> <span class="main">⟶</span> <span class="main">¬</span> sinvar <span class="bound">G</span> <span class="main">(</span><span class="bound">nP</span><span class="main">(</span><span class="bound">i</span> <span class="main">:=</span> <span class="skolem">otherbot</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">have</span></span> unique_default_example_succ_tran<span class="main">:</span>
     <span class="quoted"><span class="quoted">"succ_tran <span class="main">⦇</span>nodes <span class="main">=</span> <span class="main">{</span>vertex_1<span class="main">,</span> vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span> vertex_2<span class="main">)</span><span class="main">}</span><span class="main">⦈</span> vertex_1 <span class="main">=</span> <span class="main">{</span>vertex_2<span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> unique_default_example1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">from</span></span> assm <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">otherbot</span> <span class="main">=</span> <span class="main">0</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> default_uniqueness_by_counterexample_ACS<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
        SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
        SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>graph_ops<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">,</span>vertex_2<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> <span class="main">0</span><span class="main">,</span> vertex_2 <span class="main">:=</span> <span class="main">0</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_default_example_succ_tran num_reachable_norefl_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"vertex_1"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_2<span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> unique_default_example_succ_tran num_reachable_norefl_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> succ_tran_def unique_default_example_simp1 unique_default_example_simp2<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1" id="SINVAR_Dependability_norefl-TopoS_Dependability_norefl"><span class="command">lemma</span></span> TopoS_Dependability_norefl<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant sinvar default_node_properties receiver_violation"</span></span>
  <span class="keyword1"><span class="command">unfolding</span></span> receiver_violation_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">unfold_locales</span>  

<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar receiver_violation default_node_properties

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Dependability_norefl_impl">
<div class="head">
<h1>Theory SINVAR_Dependability_norefl_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Dependability_norefl_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_Dependability_norefl.html">SINVAR_Dependability_norefl</a> <span class="quoted">"<a href="TopoS_Interface_impl.html">../TopoS_Interface_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">code_identifier</span></span> <span class="keyword2"><span class="keyword">code_module</span></span> SINVAR_Dependability_norefl_impl <span class="main">=&gt;</span> <span class="main">(</span>Scala<span class="main">)</span> SINVAR_Dependability_norefl


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹SecurityInvariant Dependability norefl List Implementation›</span></span>


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> dependability_level<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span>num_reachable_norefl <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">≤</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
    <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="numeral">3</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"sinvar 
    <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>
    <span class="main">(</span><span class="main">λ</span><span class="bound">e</span><span class="main">.</span> <span class="numeral">2</span><span class="main">)</span>"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Dependability_norefl_offending_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> dependability_level<span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">Dependability_norefl_offending_list</span> <span class="main">=</span> Generic_offending_list sinvar"</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NetModel_node_props</span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">i</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> <span class="main">(</span>node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span> <span class="bound">i</span> <span class="keyword1">of</span> Some <span class="bound">property</span> <span class="main">⇒</span> <span class="bound">property</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_Dependability_norefl.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span><span class="main">[</span><span class="operator">code_unfold</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant.node_props SINVAR_Dependability_norefl.default_node_properties <span class="free">P</span> <span class="main">=</span> NetModel_node_props <span class="free">P</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Dependability_norefl_eval</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">P</span></span></span> <span class="main">=</span> <span class="main">(</span>wf_list_graph <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span>
  sinvar <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>SecurityInvariant.node_props SINVAR_Dependability_norefl.default_node_properties <span class="free"><span class="bound"><span class="entity">P</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>



<span class="keyword1" id="SINVAR_Dependability_norefl_impl-sinvar_correct"><span class="command">lemma</span></span> sinvar_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> SINVAR_Dependability_norefl.sinvar <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="free">nP</span> <span class="main">=</span> sinvar <span class="free">G</span> <span class="free">nP</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> all_edges_list_I<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> v<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span>  num_reachable_norefl_correct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">presburger</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">interpretation</span></span> Dependability_norefl_impl<span class="main">:</span>TopoS_List_Impl 
  <span class="keyword2"><span class="keyword">where</span></span> default_node_properties<span class="main">=</span><span class="quoted">SINVAR_Dependability_norefl.default_node_properties</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_spec<span class="main">=</span><span class="quoted">SINVAR_Dependability_norefl.sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> sinvar_impl<span class="main">=</span><span class="quoted">sinvar</span>
  <span class="keyword2"><span class="keyword">and</span></span> receiver_violation<span class="main">=</span><span class="quoted">SINVAR_Dependability_norefl.receiver_violation</span>
  <span class="keyword2"><span class="keyword">and</span></span> offending_flows_impl<span class="main">=</span><span class="quoted">Dependability_norefl_offending_list</span>
  <span class="keyword2"><span class="keyword">and</span></span> node_props_impl<span class="main">=</span><span class="quoted">NetModel_node_props</span>
  <span class="keyword2"><span class="keyword">and</span></span> eval_impl<span class="main">=</span><span class="quoted">Dependability_norefl_eval</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_List_Impl_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_Dependability_norefl<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> sinvar_correct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> Dependability_norefl_offending_list_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Generic_offending_list_correct<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinvar_correct<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> NetModel_node_props_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">metis</span> Dependability.node_props.simps Dependability.node_props_eq_node_props_formaldef<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> Dependability_norefl_eval_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> allI impI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> TopoS_eval_impl_proofrule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> TopoS_Dependability_norefl<span class="main"><span class="main">]</span></span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> sinvar_correct<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹packing›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SINVAR_LIB_Dependability_norefl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> SINVAR_Dependability_norefl.dependability_level<span class="main">)</span> TopoS_packed"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SINVAR_LIB_Dependability_norefl</span> <span class="main">≡</span> 
    <span class="main">⦇</span> nm_name <span class="main">=</span> <span class="inner_quoted">''Dependability_norefl''</span><span class="main">,</span> 
      nm_receiver_violation <span class="main">=</span> SINVAR_Dependability_norefl.receiver_violation<span class="main">,</span>
      nm_default <span class="main">=</span> SINVAR_Dependability_norefl.default_node_properties<span class="main">,</span> 
      nm_sinvar <span class="main">=</span> sinvar<span class="main">,</span>
      nm_offending_flows <span class="main">=</span> Dependability_norefl_offending_list<span class="main">,</span> 
      nm_node_props <span class="main">=</span> NetModel_node_props<span class="main">,</span>
      nm_eval <span class="main">=</span> Dependability_norefl_eval
      <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">interpretation</span></span> SINVAR_LIB_Dependability_norefl_interpretation<span class="main">:</span> TopoS_modelLibrary <span class="quoted">SINVAR_LIB_Dependability_norefl</span>
      <span class="quoted">SINVAR_Dependability_norefl.sinvar</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> TopoS_modelLibrary_def SINVAR_LIB_Dependability_norefl_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>


<span class="keyword1"><span class="command">hide_fact</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar_correct
<span class="keyword1"><span class="command">hide_const</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">open</span></span><span class="main">)</span> sinvar NetModel_node_props

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Library">
<div class="head">
<h1>Theory TopoS_Library</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Library
<span class="keyword2"><span class="keyword">imports</span></span>
  <span class="quoted">"<a href="FiniteListGraph_Impl.html">Lib/FiniteListGraph_Impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_BLPbasic_impl.html">Security_Invariants/SINVAR_BLPbasic_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_Subnets_impl.html">Security_Invariants/SINVAR_Subnets_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_DomainHierarchyNG_impl.html">Security_Invariants/SINVAR_DomainHierarchyNG_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_BLPtrusted_impl.html">Security_Invariants/SINVAR_BLPtrusted_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_SecGwExt_impl.html">Security_Invariants/SINVAR_SecGwExt_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_Sink_impl.html">Security_Invariants/SINVAR_Sink_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_SubnetsInGW_impl.html">Security_Invariants/SINVAR_SubnetsInGW_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_CommunicationPartners_impl.html">Security_Invariants/SINVAR_CommunicationPartners_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_NoRefl_impl.html">Security_Invariants/SINVAR_NoRefl_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_Tainting_impl.html">Security_Invariants/SINVAR_Tainting_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_TaintingTrusted_impl.html">Security_Invariants/SINVAR_TaintingTrusted_impl</a>"</span>
  <span class="comment1">(*invariants you probably don't want to use because of exponential runtime*)</span>
  <span class="quoted">"<a href="SINVAR_Dependability_impl.html">Security_Invariants/SINVAR_Dependability_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_NonInterference_impl.html">Security_Invariants/SINVAR_NonInterference_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_ACLnotCommunicateWith_impl.html">Security_Invariants/SINVAR_ACLnotCommunicateWith_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_ACLcommunicateWith_impl.html">Security_Invariants/SINVAR_ACLcommunicateWith_impl</a>"</span>
  <span class="quoted">"<a href="SINVAR_Dependability_norefl_impl.html">Security_Invariants/SINVAR_Dependability_norefl_impl</a>"</span>
  <span class="quoted">"<a href="Efficient_Distinct.html">Lib/Efficient_Distinct</a>"</span>
  <span class="quoted">"<a href="../../HOL/HOL-Library/Code_Target_Nat.html">HOL-Library.Code_Target_Nat</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="comment1">(*&lt;*)</span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Summarizing the Security Invariant Library›</span></span>

<span class="comment1">(*none of those should be defined or a hide_const is missing at the end of a SINVAR_*.thy file*)</span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="free">sinvar</span></span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="free">receiver_violation</span></span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="free">eval</span></span>

<span class="comment1">(*TODO check all before export*)</span>

<span class="keyword1"><span class="command">print_interps</span></span> TopoS_modelLibrary

<span class="comment1">(*some checks: *)</span>
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_BLPbasic_interpretation.impl_spec
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_Dependability_interpretation.impl_spec
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_DomainHierarchyNG_interpretation.impl_spec
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_Subnets_interpretation.impl_spec
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_BLPtrusted_interpretation.impl_spec
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_PolEnforcePointExtended_interpretation.impl_spec
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_Sink_interpretation.impl_spec
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_NonInterference_interpretation.impl_spec
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_SubnetsInGW_interpretation.impl_spec
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_CommunicationPartners_interpretation.impl_spec
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_Dependability_interpretation.impl_spec
<span class="keyword1"><span class="command">thm</span></span> SINVAR_LIB_ACLcommunicateWith_interpretation.impl_spec


<span class="comment1">(*&gt;*)</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Composition_Theory">
<div class="head">
<h1>Theory TopoS_Composition_Theory</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Composition_Theory
<span class="keyword2"><span class="keyword">imports</span></span> <a href="TopoS_Interface.html">TopoS_Interface</a> <a href="TopoS_Helper.html">TopoS_Helper</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Composition Theory›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Several invariants may apply to one policy.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The security invariants are all collected in a list. 
The list corresponds to the security requirements. 
The list should have the type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'v</span></span> graph <span class="main"><span class="main">⇒</span></span> bool<span class="main"><span class="main">)</span></span> list"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, i.e.\ a list of predicates over the policy. 
We need in instantiated security invariant, i.e.\ get rid of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

 <span class="comment1">― ‹An instance (configured) a security invariant I.e.\ a concrete security requirement, in different terminology.›</span>
 <span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'v</span><span class="main">)</span> SecurityInvariant_configured <span class="main">=</span>
    c_sinvar<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">)</span> graph <span class="main">⇒</span> bool"</span></span>
    c_offending_flows<span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set"</span></span>
    c_isIFS<span class="main">::</span><span class="quoted"><span class="quoted">"bool"</span></span>

  <span class="comment1">― ‹parameters 1-3 are the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"SecurityInvariant"</span><span class="antiquote">}</span></span>:
      <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">sinvar</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"⊥"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"receiver_violation"</span><span class="antiquote">}</span></span>

      Fourth parameter is the host attribute mapping <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">nP</span><span class="antiquote">}</span></span>

      
      TODO: probably check <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"wf_graph"</span><span class="antiquote">}</span></span> here and optionally some host-attribute sanity checker as in DomainHierachy.›</span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">new_configured_SecurityInvariant</span> <span class="main">::</span>
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">×</span> <span class="tfree">'a</span> <span class="main">×</span> bool <span class="main">×</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> SecurityInvariant_configured<span class="main">)</span> option"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="free">new_configured_SecurityInvariant</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">sinvar</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">defbot</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">receiver_violation</span></span></span><span class="main">,</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span><span class="main">)</span> <span class="main">=</span> 
        <span class="main">(</span> 
        <span class="keyword1">if</span> SecurityInvariant <span class="free"><span class="bound"><span class="entity">sinvar</span></span></span> <span class="free"><span class="bound"><span class="entity">defbot</span></span></span> <span class="free"><span class="bound"><span class="entity">receiver_violation</span></span></span> <span class="keyword1">then</span> 
          Some <span class="main">⦇</span> 
            c_sinvar <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="free"><span class="bound"><span class="entity">sinvar</span></span></span> <span class="bound">G</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span><span class="main">)</span><span class="main">,</span>
            c_offending_flows <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free"><span class="bound"><span class="entity">sinvar</span></span></span> <span class="bound">G</span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span><span class="main">)</span><span class="main">,</span>
            c_isIFS <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">receiver_violation</span></span></span>
          <span class="main">⦈</span>
        <span class="keyword1">else</span> None
        <span class="main">)</span>"</span></span>

   <span class="keyword1"><span class="command">declare</span></span> new_configured_SecurityInvariant.simps<span class="main">[</span><span class="operator">simp</span> <span class="quasi_keyword">del</span><span class="main">]</span>

   <span class="keyword1" id="TopoS_Composition_Theory-new_configured_TopoS_sinvar_correct"><span class="command">lemma</span></span> new_configured_TopoS_sinvar_correct<span class="main">:</span>
   <span class="quoted"><span class="quoted">"SecurityInvariant <span class="free">sinvar</span> <span class="free">defbot</span> <span class="free">receiver_violation</span> <span class="main">⟹</span> 
   c_sinvar <span class="main">(</span>the <span class="main">(</span>new_configured_SecurityInvariant <span class="main">(</span><span class="free">sinvar</span><span class="main">,</span> <span class="free">defbot</span><span class="main">,</span> <span class="free">receiver_violation</span><span class="main">,</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def new_configured_SecurityInvariant.simps<span class="main">)</span>

   <span class="keyword1" id="TopoS_Composition_Theory-new_configured_TopoS_offending_flows_correct"><span class="command">lemma</span></span> new_configured_TopoS_offending_flows_correct<span class="main">:</span>
   <span class="quoted"><span class="quoted">"SecurityInvariant <span class="free">sinvar</span> <span class="free">defbot</span> <span class="free">receiver_violation</span> <span class="main">⟹</span> 
   c_offending_flows <span class="main">(</span>the <span class="main">(</span>new_configured_SecurityInvariant <span class="main">(</span><span class="free">sinvar</span><span class="main">,</span> <span class="free">defbot</span><span class="main">,</span> <span class="free">receiver_violation</span><span class="main">,</span> <span class="free">nP</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
   <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def new_configured_SecurityInvariant.simps<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We now collect all the core properties of a security invariant, but without the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'a</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'b</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
      types, so it is instantiated with a concrete configuration.›</span></span>
<span class="keyword1"><span class="command">locale</span></span> configured_SecurityInvariant <span class="main">=</span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">m</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> SecurityInvariant_configured"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="comment1">― ‹As in SecurityInvariant definition›</span>
    valid_c_offending_flows<span class="main">:</span>
    <span class="quoted"><span class="quoted">"c_offending_flows <span class="free">m</span> <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="free">G</span> <span class="main">∧</span> c_sinvar <span class="free">m</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">F</span><span class="main">)</span> <span class="main">∧</span> 
      <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="bound">F</span><span class="main">.</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">― ‹A empty network can have no security violations›</span>
    defined_offending<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span> <span class="main">⦈</span> <span class="main">⟧</span> <span class="main">⟹</span> c_sinvar <span class="free">m</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span><span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">― ‹prohibiting more does not decrease security›</span>
    mono_sinvar<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">;</span> c_sinvar <span class="free">m</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      c_sinvar <span class="free">m</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="comment1">(*compatibility with other definitions*)</span>
    <span class="keyword1" id="TopoS_Composition_Theory-sinvar_monoI"><span class="command">lemma</span></span> sinvar_monoI<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> graph<span class="main">)</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> c_sinvar <span class="free">m</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> mono_sinvar<span class="main">)</span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹if the network where nobody communicates with anyone fulfilles its security requirement,
          the offending flows are always defined.›</span></span>
    <span class="keyword1" id="TopoS_Composition_Theory-defined_offending'"><span class="command">lemma</span></span> defined_offending'<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G</span><span class="main">;</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> c_offending_flows <span class="free">m</span> <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>    a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">have</span></span> subst_set_offending_flows<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">nP</span><span class="main">.</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="main">(</span><span class="main">λ</span><span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> c_sinvar <span class="free">m</span> <span class="bound">G</span><span class="main">)</span> <span class="free">G</span> <span class="bound">nP</span> <span class="main">=</span> c_offending_flows <span class="free">m</span> <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_c_offending_flows fun_eq_iff 
            SecurityInvariant_withOffendingFlows.set_offending_flows_def
            SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
            SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> wfG_empty<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>wf_graph_def<span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">nP</span><span class="main">.</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="free">G</span> <span class="main">⟹</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="main">(</span><span class="main">λ</span><span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> c_sinvar <span class="free">m</span> <span class="bound">G</span><span class="main">)</span> <span class="free">G</span> <span class="bound">nP</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_monoI<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def delete_edges_simp2 defined_offending<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wfG_empty<span class="main"><span class="main">]</span></span><span class="main">)</span>
      
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> a2 subst_set_offending_flows<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="comment1">(* The offending flows definitions are equal, compatibility *)</span>
    <span class="keyword1" id="TopoS_Composition_Theory-subst_offending_flows"><span class="command">lemma</span></span> subst_offending_flows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">nP</span><span class="main">.</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="main">(</span><span class="main">λ</span><span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> c_sinvar <span class="free">m</span> <span class="bound">G</span><span class="main">)</span> <span class="free">G</span> <span class="bound">nP</span> <span class="main">=</span> c_offending_flows <span class="free">m</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">unfold</span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
            SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
            SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_c_offending_flows<span class="main">)</span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹all the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">SecurityInvariant_preliminaries</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> stuff must hold, for an arbitrary <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">nP</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
    <span class="keyword1" id="TopoS_Composition_Theory-SecurityInvariant_preliminariesD"><span class="command">lemma</span></span> SecurityInvariant_preliminariesD<span class="main">:</span>
      <span class="quoted"><span class="quoted">"SecurityInvariant_preliminaries <span class="main">(</span><span class="main">λ</span> <span class="main">(</span><span class="bound">G</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> graph<span class="main">)</span> <span class="main">(</span><span class="bound">nP</span><span class="main">::</span><span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'a</span><span class="main">)</span><span class="main">.</span> c_sinvar <span class="free">m</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> 1 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">using</span></span> defined_offending' <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subst_offending_flows<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> mono_sinvar<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span> <span class="keyword3"><span class="command">case</span></span> 3 <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_monoI<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1" id="TopoS_Composition_Theory-negative_mono"><span class="command">lemma</span></span> negative_mono<span class="main">:</span>
     <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">N</span> <span class="bound">E'</span> <span class="bound">E</span><span class="main">.</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span> <span class="main">⦈</span> <span class="main">⟹</span> 
        <span class="bound">E'</span> <span class="main">⊆</span> <span class="bound">E</span> <span class="main">⟹</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E'</span> <span class="main">⦈</span> <span class="main">⟹</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E</span> <span class="main">⦈</span>"</span></span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> mono_sinvar<span class="main">)</span>

    
    <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Reusing Lemmata›</span></span>
      <span class="keyword1"><span class="command">lemmas</span></span> mono_extend_set_offending_flows <span class="main">=</span>
      SecurityInvariant_preliminaries.mono_extend_set_offending_flows<span class="main">[</span><span class="operator">OF</span> SecurityInvariant_preliminariesD<span class="main">,</span> <span class="operator">simplified</span> subst_offending_flows<span class="main">]</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> mono_extend_set_offending_flows <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

      <span class="keyword1"><span class="command">lemmas</span></span> offending_flows_union_mono <span class="main">=</span>
      SecurityInvariant_preliminaries.offending_flows_union_mono<span class="main">[</span><span class="operator">OF</span> SecurityInvariant_preliminariesD<span class="main">,</span> <span class="operator">simplified</span> subst_offending_flows<span class="main">]</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> offending_flows_union_mono <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

      <span class="keyword1"><span class="command">lemmas</span></span> sinvar_valid_remove_flattened_offending_flows <span class="main">=</span>
      SecurityInvariant_preliminaries.sinvar_valid_remove_flattened_offending_flows<span class="main">[</span><span class="operator">OF</span> SecurityInvariant_preliminariesD<span class="main">,</span> <span class="operator">simplified</span> subst_offending_flows<span class="main">]</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> sinvar_valid_remove_flattened_offending_flows <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

      <span class="keyword1"><span class="command">lemmas</span></span> sinvar_valid_remove_SOME_offending_flows <span class="main">=</span>
      SecurityInvariant_preliminaries.sinvar_valid_remove_SOME_offending_flows<span class="main">[</span><span class="operator">OF</span> SecurityInvariant_preliminariesD<span class="main">,</span> <span class="operator">simplified</span> subst_offending_flows<span class="main">]</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> sinvar_valid_remove_SOME_offending_flows <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>


      <span class="keyword1"><span class="command">lemmas</span></span> sinvar_valid_remove_minimalize_offending_overapprox <span class="main">=</span>
      SecurityInvariant_preliminaries.sinvar_valid_remove_minimalize_offending_overapprox<span class="main">[</span><span class="operator">OF</span> SecurityInvariant_preliminariesD<span class="main">,</span> <span class="operator">simplified</span> subst_offending_flows<span class="main">]</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> sinvar_valid_remove_minimalize_offending_overapprox <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
      

      <span class="keyword1"><span class="command">lemmas</span></span> empty_offending_contra <span class="main">=</span>
      SecurityInvariant_withOffendingFlows.empty_offending_contra<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> sinvar<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> c_sinvar <span class="free">m</span> <span class="bound">G</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span> subst_offending_flows<span class="main">]</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> empty_offending_contra <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

      <span class="keyword1"><span class="command">lemmas</span></span> Un_set_offending_flows_bound_minus_subseteq <span class="main">=</span> 
      SecurityInvariant_preliminaries.Un_set_offending_flows_bound_minus_subseteq<span class="main">[</span><span class="operator">OF</span> SecurityInvariant_preliminariesD<span class="main">,</span> <span class="operator">simplified</span> subst_offending_flows<span class="main">]</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Un_set_offending_flows_bound_minus_subseteq <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

      <span class="keyword1"><span class="command">lemmas</span></span> Un_set_offending_flows_bound_minus_subseteq' <span class="main">=</span> 
      SecurityInvariant_preliminaries.Un_set_offending_flows_bound_minus_subseteq'<span class="main">[</span><span class="operator">OF</span> SecurityInvariant_preliminariesD<span class="main">,</span> <span class="operator">simplified</span> subst_offending_flows<span class="main">]</span>
      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> Un_set_offending_flows_bound_minus_subseteq' <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">thm</span></span> configured_SecurityInvariant_def
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> configured_SecurityInvariant_def <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">thm</span></span> configured_SecurityInvariant.mono_sinvar
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> configured_SecurityInvariant.mono_sinvar <span class="main"><span class="main">[</span></span><span class="operator"><span class="operator">no_vars</span></span><span class="main"><span class="main">]</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Naming convention:
    m :: network security requirement
    M :: network security requirement list
›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The function <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">new_configured_SecurityInvariant</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> takes some tuple and if it returns a result,
         the locale assumptions are automatically fulfilled.›</span></span>
  <span class="keyword1"><span class="command">theorem</span></span> new_configured_SecurityInvariant_sound<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"<span class="main">⟦</span> new_configured_SecurityInvariant <span class="main">(</span><span class="free">sinvar</span><span class="main">,</span> <span class="free">defbot</span><span class="main">,</span> <span class="free">receiver_violation</span><span class="main">,</span> <span class="free">nP</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">m</span> <span class="main">⟧</span> <span class="main">⟹</span>
    configured_SecurityInvariant <span class="free">m</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"new_configured_SecurityInvariant <span class="main">(</span><span class="free">sinvar</span><span class="main">,</span> <span class="free">defbot</span><span class="main">,</span> <span class="free">receiver_violation</span><span class="main">,</span> <span class="free">nP</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> NetModel<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant <span class="free">sinvar</span> <span class="free">defbot</span> <span class="free">receiver_violation</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new_configured_SecurityInvariant.simps <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> NetModel_p<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_preliminaries <span class="free">sinvar</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_def<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> c_eval<span class="main">:</span> <span class="quoted"><span class="quoted">"c_sinvar <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="free">sinvar</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> c_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"c_offending_flows <span class="free">m</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
         <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"c_isIFS <span class="free">m</span> <span class="main">=</span> <span class="free">receiver_violation</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new_configured_SecurityInvariant.simps NetModel <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> monoI<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono <span class="free">sinvar</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_preliminaries.mono_sinvar<span class="main"><span class="main">[</span></span><span class="operator">OF</span> NetModel_p<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> SecurityInvariant_withOffendingFlows.valid_empty_edges_iff_exists_offending_flows<span class="main">[</span><span class="operator">OF</span> monoI<span class="main">,</span> <span class="operator">symmetric</span><span class="main">]</span>
            SecurityInvariant_preliminaries.defined_offending<span class="main">[</span><span class="operator">OF</span> NetModel_p<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> eval_empty_graph<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">N</span> <span class="bound">nP</span><span class="main">.</span> wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span><span class="main">⦈</span> <span class="main">⟹</span> <span class="free">sinvar</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="bound">N</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{}</span><span class="main">⦈</span> <span class="bound">nP</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_eval c_offending SecurityInvariant_withOffendingFlows.set_offending_flows_def SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_eval eval_empty_graph<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> c_eval<span class="main"><span class="keyword3">,</span></span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> SecurityInvariant_preliminaries.mono_sinvar<span class="main"><span class="main">[</span></span><span class="operator">OF</span> NetModel_p<span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
   <span class="keyword1"><span class="command">qed</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹All security invariants are valid according to the definition›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">valid_reqs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> SecurityInvariant_configured list <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">valid_reqs</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> configured_SecurityInvariant <span class="bound">m</span>"</span></span>

 <span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Algorithms›</span></span>
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A (generic) security invariant corresponds to a type of security requirements (type: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'v</span></span> graph <span class="main"><span class="main">⇒</span></span> <span class="main"><span class="main">(</span></span><span class="tfree"><span class="tfree">'v</span></span> <span class="main"><span class="main">⇒</span></span> <span class="tfree"><span class="tfree">'a</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">⇒</span></span> bool"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>).
          A configured security invariant is a security requirement in a scenario specific setting (type: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'v</span></span> graph <span class="main"><span class="main">⇒</span></span> bool"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>).
          I.e., it is a security requirement as listed in the requirements document.
          All security requirements are fulfilled for a fixed policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> if all security requirements are fulfilled for <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">G</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>


    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Get all possible offending flows from all security requirements›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_offending_flows</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set set<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">get_offending_flows</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> c_offending_flows <span class="bound">m</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>  

    <span class="comment1">(*Note: only checks sinvar, not eval!! No 'a 'b type variables here*)</span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">all_security_requirements_fulfilled</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="tfree">'v</span> graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">all_security_requirements_fulfilled</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="main">(</span>c_sinvar <span class="bound">m</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>
    
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Generate a valid topology from the security requirements›</span></span>
    <span class="comment1">(*constant G, remove after algorithm*)</span>
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">generate_valid_topology</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">generate_valid_topology</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">generate_valid_topology</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Ms</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> delete_edges <span class="main">(</span><span class="free">generate_valid_topology</span> <span class="free"><span class="bound"><span class="entity">Ms</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>c_offending_flows <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

     <span class="comment1">― ‹return all Access Control Strategy models from a list of models›</span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_ACS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant_configured list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">get_ACS</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">[</span><span class="bound">m</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="main">¬</span> c_isIFS <span class="bound">m</span><span class="main">]</span>"</span></span>
     <span class="comment1">― ‹return all Information Flows Strategy models from a list of models›</span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_IFS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant_configured list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">get_IFS</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">[</span><span class="bound">m</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> c_isIFS <span class="bound">m</span><span class="main">]</span>"</span></span>
    <span class="keyword1" id="TopoS_Composition_Theory-get_ACS_union_get_IFS"><span class="command">lemma</span></span> get_ACS_union_get_IFS<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">=</span> set <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ACS_def get_IFS_def<span class="main">)</span>
  

   <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Lemmata›</span></span>
    <span class="keyword1" id="TopoS_Composition_Theory-valid_reqs1"><span class="command">lemma</span></span> valid_reqs1<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span><span class="free">m</span> <span class="main">#</span> <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span> configured_SecurityInvariant <span class="free">m</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_reqs_def<span class="main">)</span>
    <span class="keyword1" id="TopoS_Composition_Theory-valid_reqs2"><span class="command">lemma</span></span> valid_reqs2<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span><span class="free">m</span> <span class="main">#</span> <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span> valid_reqs <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_reqs_def<span class="main">)</span>
    <span class="keyword1" id="TopoS_Composition_Theory-get_offending_flows_alt1"><span class="command">lemma</span></span> get_offending_flows_alt1<span class="main">:</span> <span class="quoted"><span class="quoted">"get_offending_flows <span class="free">M</span> <span class="free">G</span> <span class="main">=</span> <span class="main">⋃</span> <span class="main">{</span>c_offending_flows <span class="bound">m</span> <span class="free">G</span> <span class="main">|</span> <span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1" id="TopoS_Composition_Theory-get_offending_flows_un"><span class="command">lemma</span></span> get_offending_flows_un<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="free">M</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
  
    <span class="keyword1" id="TopoS_Composition_Theory-all_security_requirements_fulfilled_mono"><span class="command">lemma</span></span> all_security_requirements_fulfilled_mono<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_reqs <span class="free">M</span><span class="main">;</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">;</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">⟧</span> <span class="main">⟹</span>  
        all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">⟹</span>
        all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span> <span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">E'</span></span> <span class="quoted"><span class="free">E</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> m M E' E<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> configured_SecurityInvariant.mono_sinvar<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid_reqs1<span class="main"><span class="main">]</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> valid_reqs2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹generate valid topology›</span></span>
    <span class="comment1">(*
      lemma generate_valid_topology_def_delete_multiple: 
        "generate_valid_topology M G = delete_edges (generate_valid_topology M G) (⋃ (get_offending_flows M G))"
        proof(induction M arbitrary: G)
          case Nil
            thus ?case by(simp add: get_offending_flows_def)
          next
          case (Cons m M)
            from Cons[simplified delete_edges_simp2 get_offending_flows_def] 
            have "edges (generate_valid_topology M G) = edges (generate_valid_topology M G) - ⋃(⋃m∈set M. c_offending_flows m G)"
              by (metis graph.select_convs(2))
            thus ?case
              apply(simp add: get_offending_flows_def delete_edges_simp2)
              by blast
        qed*)</span>
      <span class="keyword1" id="TopoS_Composition_Theory-generate_valid_topology_nodes"><span class="command">lemma</span></span> generate_valid_topology_nodes<span class="main">:</span>
      <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>nodes <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> graph_ops<span class="main">)</span>

      <span class="keyword1" id="TopoS_Composition_Theory-generate_valid_topology_def_alt"><span class="command">lemma</span></span> generate_valid_topology_def_alt<span class="main">:</span>
        <span class="quoted"><span class="quoted">"generate_valid_topology <span class="free">M</span> <span class="free">G</span> <span class="main">=</span> delete_edges <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>get_offending_flows <span class="free">M</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Nil
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">M</span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">[</span><span class="operator">simplified</span> delete_edges_simp2 get_offending_flows_def<span class="main">]</span> 
            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>generate_valid_topology <span class="skolem">M</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span> edges <span class="skolem">G</span> <span class="main">-</span> <span class="main">⋃</span><span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="skolem">M</span><span class="main">.</span> c_offending_flows <span class="bound">m</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> graph.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
            <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def delete_edges_simp2<span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
               <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_topology_nodes<span class="main">)</span>
              <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
    
      <span class="keyword1" id="TopoS_Composition_Theory-wf_graph_generate_valid_topology"><span class="command">lemma</span></span> wf_graph_generate_valid_topology<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  
     <span class="keyword1" id="TopoS_Composition_Theory-generate_valid_topology_mono_models"><span class="command">lemma</span></span> generate_valid_topology_mono_models<span class="main">:</span>
      <span class="quoted"><span class="quoted">"edges <span class="main">(</span>generate_valid_topology <span class="main">(</span><span class="free">m</span><span class="main">#</span><span class="free">M</span><span class="main">)</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">E</span></span> <span class="quoted"><span class="free">m</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
     
      <span class="keyword1" id="TopoS_Composition_Theory-generate_valid_topology_subseteq_edges"><span class="command">lemma</span></span> generate_valid_topology_subseteq_edges<span class="main">:</span>
      <span class="quoted"><span class="quoted">"edges <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

      <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">generate_valid_topology</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> generates a valid topology (Policy)!›</span></span>
      <span class="keyword1"><span class="command">theorem</span></span> generate_valid_topology_sound<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_reqs <span class="free">M</span><span class="main">;</span> wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      all_security_requirements_fulfilled <span class="free">M</span> <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">E</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> Nil
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">M</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> valid_reqs1<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> validReq<span class="main">:</span> <span class="quoted"><span class="quoted">"configured_SecurityInvariant <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

          <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> valid_rmUnOff<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">-</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_remove_edges<span class="main">)</span>
          
          <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.sinvar_valid_remove_flattened_offending_flows<span class="main">[</span><span class="operator">OF</span> validReq Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> valid_eval_rmUnOff<span class="main">:</span> <span class="quoted"><span class="quoted">"c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">-</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    
          <span class="keyword1"><span class="command">from</span></span> generate_valid_topology_subseteq_edges <span class="keyword1"><span class="command">have</span></span> edges_gentopo_subseteq<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"edges <span class="main">(</span>generate_valid_topology <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">-</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span>
               <span class="main">⊆</span>
            <span class="skolem">E</span> <span class="main">-</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span>  <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    
          <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.mono_sinvar<span class="main">[</span><span class="operator">OF</span> validReq valid_rmUnOff edges_gentopo_subseteq valid_eval_rmUnOff<span class="main">]</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span>edges <span class="main">(</span>generate_valid_topology <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> goal1<span class="main">:</span> 
            <span class="quoted"><span class="quoted">"c_sinvar <span class="skolem">m</span> <span class="main">(</span>delete_edges <span class="main">(</span>generate_valid_topology <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
               <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 generate_valid_topology_nodes<span class="main">)</span>
    
          <span class="keyword1"><span class="command">from</span></span> valid_reqs2<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_reqs <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
          <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_reqs <span class="skolem">M</span>›</span></span> Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span>
            <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="skolem">M</span> <span class="main">(</span>generate_valid_topology <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

          <span class="keyword1"><span class="command">have</span></span> generate_valid_topology_EX_graph_record<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">hypE</span><span class="main">.</span> <span class="main">(</span>generate_valid_topology <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">hypE</span><span class="main">⦈</span> "</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">V</span></span> <span class="quoted"><span class="skolem">E</span></span><span class="main">)</span>
               <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 generate_valid_topology_nodes<span class="main">)</span>
              
          <span class="keyword1"><span class="command">from</span></span> generate_valid_topology_EX_graph_record <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E_IH</span></span> <span class="keyword2"><span class="keyword">where</span></span>  E_IH_prop<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span>generate_valid_topology <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E_IH</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
          <span class="keyword1"><span class="command">from</span></span> wf_graph_generate_valid_topology<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> E_IH_prop
          <span class="keyword1"><span class="command">have</span></span> valid_G_E_IH<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E_IH</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    
          <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> IH<span class="main">[</span><span class="operator">simplified</span> E_IH_prop<span class="main">]</span><span class="antiquote">}</span></span>›</span>
          <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> all_security_requirements_fulfilled_mono<span class="main">[</span><span class="operator">OF</span> <span class="quoted">`valid_reqs <span class="skolem">M</span>`</span> _  valid_G_E_IH IH<span class="main">[</span><span class="operator">simplified</span> E_IH_prop<span class="main">]</span><span class="main">]</span><span class="antiquote">}</span></span>›</span>
    
          <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_mono<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_reqs <span class="skolem">M</span>›</span></span> _  valid_G_E_IH IH<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> E_IH_prop<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> mono_rule<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">E'</span><span class="main">.</span> <span class="bound">E'</span> <span class="main">⊆</span> <span class="skolem">E_IH</span> <span class="main">⟹</span> all_security_requirements_fulfilled <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">E'</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="skolem">M</span> 
            <span class="main">(</span>delete_edges <span class="main">(</span>generate_valid_topology <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> E_IH_prop<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> mono_rule<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword1"><span class="command">have</span></span> goal2<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">ma</span><span class="main">∈</span>set <span class="skolem">M</span><span class="main">.</span>
            c_sinvar <span class="bound">ma</span> <span class="main">(</span>delete_edges <span class="main">(</span>generate_valid_topology <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span><span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>
    
          <span class="keyword1"><span class="command">from</span></span> goal1 goal2 
          <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>generate_valid_topology <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>
       <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1" id="TopoS_Composition_Theory-generate_valid_topology_as_set"><span class="command">lemma</span></span> generate_valid_topology_as_set<span class="main">:</span> 
  <span class="quoted"><span class="quoted">"generate_valid_topology <span class="free">M</span> <span class="free">G</span> <span class="main">=</span> delete_edges <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> <span class="main">(</span><span class="main">⋃</span> <span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 generate_valid_topology_nodes<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

  <span class="keyword1" id="TopoS_Composition_Theory-c_offending_flows_subseteq_edges"><span class="command">lemma</span></span> c_offending_flows_subseteq_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"configured_SecurityInvariant <span class="free">m</span> <span class="main">⟹</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="free">m</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> configured_SecurityInvariant.valid_c_offending_flows<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"configured_SecurityInvariant <span class="skolem">x</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">x</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Does it also generate a maximum topology? It does, if the security invariants are in ENF-form. That means, if 
        all security invariants can be expressed as a predicate over the edges, 
        <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">∃</span></span><span class="bound"><span class="bound">P</span></span><span class="main"><span class="main">.</span></span> <span class="main"><span class="main">∀</span></span><span class="bound"><span class="bound">G</span></span><span class="main"><span class="main">.</span></span> c_sinvar <span class="free"><span class="free">m</span></span> <span class="bound"><span class="bound">G</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">(</span></span><span class="main"><span class="main">∀</span></span><span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">v1</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">v2</span></span><span class="main"><span class="main">)</span></span> <span class="main"><span class="main">∈</span></span> edges <span class="bound"><span class="bound">G</span></span><span class="main"><span class="main">.</span></span> <span class="bound"><span class="bound">P</span></span> <span class="main"><span class="main">(</span></span><span class="bound"><span class="bound">v1</span></span><span class="main"><span class="main">,</span></span><span class="bound"><span class="bound">v2</span></span><span class="main"><span class="main">)</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">max_topo</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="tfree">'v</span> graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">max_topo</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> all_security_requirements_fulfilled <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">∧</span> <span class="main">(</span>
      <span class="main">∀</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">×</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> all_security_requirements_fulfilled <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span>add_edge <span class="bound">v1</span> <span class="bound">v2</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="TopoS_Composition_Theory-unique_offending_obtain"><span class="command">lemma</span></span> unique_offending_obtain<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"configured_SecurityInvariant <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> unique<span class="main">:</span> <span class="quoted"><span class="quoted">"c_offending_flows <span class="free">m</span> <span class="free">G</span> <span class="main">=</span> <span class="main">{</span><span class="free">F</span><span class="main">}</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">P</span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">v1</span></span><span class="main">,</span> <span class="bound"><span class="bound">v2</span></span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"c_sinvar <span class="free">m</span> <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">-</span> <span class="free">F</span><span class="main">.</span> <span class="free">P</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword3"><span class="command">assume</span></span> EX<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋀</span><span class="bound">P</span><span class="main">.</span> <span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">¬</span> <span class="bound">P</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">}</span> <span class="main">⟹</span> c_sinvar <span class="free">m</span> <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span><span class="main">.</span> <span class="bound">P</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">∈</span>edges <span class="free">G</span> <span class="main">-</span> <span class="free">F</span><span class="main">.</span> <span class="bound">P</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span> <span class="main">⟹</span> <span class="free">thesis</span><span class="main">)</span>"</span></span>

    <span class="keyword1"><span class="command">from</span></span> unique c_offending_flows_subseteq_edges<span class="main">[</span><span class="operator">OF</span> m<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">P</span> <span class="bound">e</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_diff set_diff_eq subset_refl<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">v1</span></span><span class="main">,</span> <span class="bound"><span class="bound">v2</span></span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.valid_c_offending_flows<span class="main">[</span><span class="operator">OF</span> m<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_offending_flows <span class="free">m</span> <span class="free">G</span> <span class="main">=</span>
          <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="free">G</span> <span class="main">∧</span> c_sinvar <span class="free">m</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">F</span><span class="main">)</span> <span class="main">∧</span> 
              <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="bound">F</span><span class="main">.</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="bound">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

    <span class="keyword1"><span class="command">from</span></span> this unique <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"c_sinvar <span class="free">m</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">F</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
                          3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">F</span><span class="main">.</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="free">G</span> <span class="free">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">P</span> <span class="bound">e</span><span class="main">}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> x3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">e</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">-</span> <span class="free">F</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">e</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> mem_Collect_eq set_diff_eq<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">-</span> <span class="free">F</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> assms<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> assms<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> configured_SecurityInvariant.empty_offending_contra insertCI<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="free">F</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">P</span> <span class="bound">e</span><span class="main">}</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="free">G</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"c_sinvar <span class="free">m</span> <span class="free">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span><span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> edges <span class="free">G</span><span class="main">.</span> <span class="skolem">P</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> graph_ops<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> EX<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">P</span></span><span class="main">]</span> unique 1 x3 5 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="TopoS_Composition_Theory-enf_offending_flows"><span class="command">lemma</span></span> enf_offending_flows<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> vm<span class="main">:</span> <span class="quoted"><span class="quoted">"configured_SecurityInvariant <span class="free">m</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> enf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span><span class="main">.</span> c_sinvar <span class="free">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="free">P</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span><span class="main">.</span> c_offending_flows <span class="free">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> c_sinvar <span class="free">m</span> <span class="bound">G</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">e</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">G</span>
        <span class="keyword1"><span class="command">from</span></span> vm configured_SecurityInvariant.valid_c_offending_flows <span class="keyword1"><span class="command">have</span></span> offending_formaldef<span class="main">:</span>
          <span class="quoted"><span class="quoted">"c_offending_flows <span class="free">m</span> <span class="skolem">G</span> <span class="main">=</span>
            <span class="main">{</span><span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> edges <span class="skolem">G</span> <span class="main">∧</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="skolem">G</span> <span class="main">∧</span> c_sinvar <span class="free">m</span> <span class="main">(</span>delete_edges <span class="skolem">G</span> <span class="bound">F</span><span class="main">)</span> <span class="main">∧</span>
                <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="bound">F</span><span class="main">.</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="main">(</span>add_edge <span class="bound">e1</span> <span class="bound">e2</span> <span class="main">(</span>delete_edges <span class="skolem">G</span> <span class="bound">F</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_offending_flows <span class="free">m</span> <span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> c_sinvar <span class="free">m</span> <span class="skolem">G</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="skolem">G</span><span class="main">.</span> <span class="main">¬</span> <span class="free">P</span> <span class="bound">e</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"c_sinvar <span class="free">m</span> <span class="skolem">G</span>"</span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">case</span></span> True <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">{}</span>"</span><span class="antiquote">}</span></span>›</span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> offending_formaldef<span class="main">)</span>
          <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">case</span></span> False <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> offending_formaldef graph_ops enf<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>
      
      
<span class="keyword1" id="TopoS_Composition_Theory-enf_not_fulfilled_if_in_offending"><span class="command">lemma</span></span> enf_not_fulfilled_if_in_offending<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> validRs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   wfG<span class="main">:</span>     <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   enf<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">G</span><span class="main">.</span> c_sinvar <span class="bound">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="main">(</span>fully_connected <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
                <span class="main">¬</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="bound">x</span> <span class="free">E</span><span class="main">⦈</span>"</span></span>
   <span class="keyword1"><span class="command">unfolding</span></span> all_security_requirements_fulfilled_def
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">clarify</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> m F a b<span class="main">)</span>
     <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fully_connected <span class="free">G</span><span class="main">)</span>"</span></span>
     <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">m</span> <span class="skolem">F</span> <span class="skolem">v1</span> <span class="skolem">v2</span>
     <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">∈</span> set <span class="free">M</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="var">?G</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">F</span>"</span></span>
       
    <span class="keyword1"><span class="command">from</span></span> validRs <span class="keyword1"><span class="command">have</span></span> valid_mD<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span> <span class="main">⟹</span> configured_SecurityInvariant <span class="bound">m</span> "</span></span> 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_reqs_def<span class="main">)</span>
    
     <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> set <span class="free">M</span>›</span></span> valid_mD <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"configured_SecurityInvariant <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

     <span class="keyword1"><span class="command">from</span></span> enf <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> set <span class="free">M</span>›</span></span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">P</span></span> <span class="keyword2"><span class="keyword">where</span></span> enf_m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span><span class="main">.</span> c_sinvar <span class="skolem">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">∈</span>edges <span class="bound">G</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">e</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     
     <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

     <span class="keyword1"><span class="command">from</span></span> enf_offending_flows<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹configured_SecurityInvariant <span class="skolem">m</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="main">∀</span><span class="bound">G</span><span class="main">.</span> c_sinvar <span class="skolem">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span><span class="main">∈</span>edges <span class="bound">G</span><span class="main">.</span> <span class="skolem">P</span> <span class="bound">e</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
      offending<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">G</span><span class="main">.</span> c_offending_flows <span class="skolem">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> c_sinvar <span class="skolem">m</span> <span class="bound">G</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">P</span> <span class="bound">e</span><span class="main">}</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="var">?G</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">F</span> <span class="main">≠</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span> <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> edges <span class="var">?G</span><span class="main">.</span> <span class="main">¬</span> <span class="skolem">P</span> <span class="bound">e</span><span class="main">}</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> offending<span class="main">)</span>
     <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">F</span>›</span></span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">P</span> <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

     <span class="keyword1"><span class="command">from</span></span> this enf_m <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span> <span class="free">E</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">¬</span> c_sinvar <span class="bound">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="main">(</span><span class="skolem">v1</span><span class="main">,</span> <span class="skolem">v2</span><span class="main">)</span> <span class="free">E</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">m</span> <span class="main">∈</span> set <span class="free">M</span>›</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">m</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp_all</span>
<span class="keyword1"><span class="command">qed</span></span>
        

 <span class="keyword1"><span class="command">theorem</span></span> generate_valid_topology_max_topo<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_reqs <span class="free">M</span><span class="main">;</span> wf_graph <span class="free">G</span><span class="main">;</span>
      <span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">G</span><span class="main">.</span> c_sinvar <span class="bound">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">e</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> 
      max_topo <span class="free">M</span> <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="main">(</span>fully_connected <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?G</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span>fully_connected <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword3"><span class="command">assume</span></span> validRs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>    wfG<span class="main">:</span>       <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> enf<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">G</span><span class="main">.</span> c_sinvar <span class="bound">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">e</span><span class="main">)</span>"</span></span>

    <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> VE_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span> <span class="main">=</span> generate_valid_topology <span class="free">M</span> <span class="var">?G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> graph.cases<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> VE_prop_asset<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span> <span class="main">=</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fully_connected_def generate_valid_topology_as_set delete_edges_simp2<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> VE_prop_asset <span class="keyword1"><span class="command">have</span></span> E_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span>  <span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">from</span></span> VE_prop <span class="keyword1"><span class="command">have</span></span> V_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="free">G</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fully_connected_def delete_edges_simp2 generate_valid_topology_def_alt<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> VE_prop <span class="keyword1"><span class="command">have</span></span> V_full_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="var">?G</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> VE_prop <span class="keyword1"><span class="command">have</span></span> E_full_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="var">?G</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> graph.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> VE_prop wf_graph_generate_valid_topology<span class="main">[</span><span class="operator">OF</span> fully_connected_wf<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wfG<span class="main"><span class="main">]</span></span><span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> wfG_VE<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword1"><span class="command">from</span></span> generate_valid_topology_sound<span class="main">[</span><span class="operator">OF</span> validRs wfG_VE<span class="main">]</span> fully_connected_wf<span class="main">[</span><span class="operator">OF</span> wfG<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> VE_all_valid<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> VE_prop VE_prop_asset fully_connected_def generate_valid_topology_sound validRs<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> goal1<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="main">(</span>fully_connected <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> VE_prop VE_prop_asset<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> validRs <span class="keyword1"><span class="command">have</span></span> valid_mD<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span> <span class="main">⟹</span> configured_SecurityInvariant <span class="bound">m</span> "</span></span> 
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_reqs_def<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> c_offending_flows_subseteq_edges<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?G</span>"</span></span><span class="main">]</span> validRs <span class="keyword1"><span class="command">have</span></span> hlp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fully_connected_def V_prop<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> valid_reqs_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="bound">A</span> <span class="main">-</span> <span class="main">(</span><span class="bound">A</span> <span class="main">-</span> <span class="bound">B</span><span class="main">)</span> <span class="main">=</span> <span class="bound">B</span> <span class="main">∩</span> <span class="bound">A</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span> 
    <span class="keyword1"><span class="command">from</span></span> E_prop hlp1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


    <span class="keyword1"><span class="command">from</span></span> enf_not_fulfilled_if_in_offending<span class="main">[</span><span class="operator">OF</span> validRs wfG enf<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
       <span class="main">¬</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
    <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="skolem">E</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">.</span>
         <span class="main">¬</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">hence</span></span> goal2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">∈</span>nodes <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="var">?G</span><span class="main">)</span> <span class="main">×</span> nodes <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="var">?G</span><span class="main">)</span> <span class="main">-</span>
                edges <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="var">?G</span><span class="main">)</span><span class="main">.</span>
        <span class="main">¬</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="main">(</span>add_edge <span class="bound">v1</span> <span class="bound">v2</span> <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="var">?G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">unfold</span> V_full_prop E_full_prop graph_ops<span class="main">)</span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">.</span> <span class="main">¬</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">.</span>  <span class="skolem">V</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">}</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">.</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="main">=</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">}</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> this a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">∈</span><span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">.</span> <span class="main">¬</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span> <span class="skolem">E</span><span class="main">⦈</span>"</span></span>
        <span class="comment1">― ‹TODO: this should be trivial ...›</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span>
     
    <span class="keyword1"><span class="command">from</span></span> goal1 goal2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> max_topo_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="TopoS_Composition_Theory-enf_all_valid_policy_subset_of_max"><span class="command">lemma</span></span> enf_all_valid_policy_subset_of_max<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> validRs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     wfG<span class="main">:</span>     <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     enf<span class="main">:</span>     <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">G</span><span class="main">.</span> c_sinvar <span class="bound">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">e</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     nodesG'<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="free">G</span> <span class="main">=</span> nodes <span class="free">G'</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="free">G'</span><span class="main">;</span>
        all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G'</span><span class="main">⟧</span> <span class="main">⟹</span> 
        edges <span class="free">G'</span> <span class="main">⊆</span> edges <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="main">(</span>fully_connected <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> nodesG' <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"generate_valid_topology <span class="free">M</span> <span class="main">(</span>fully_connected <span class="free">G</span><span class="main">)</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> V E<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">G'</span>"</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> V' E'<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"nodes <span class="free">G</span> <span class="main">=</span> <span class="improper">V</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> fully_connected_def generate_valid_topology_nodes graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
    <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">V</span> <span class="skolem">E</span> <span class="skolem">V'</span> <span class="skolem">E'</span>
    <span class="keyword3"><span class="command">assume</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           a6<span class="main">:</span> <span class="quoted"><span class="quoted">"generate_valid_topology <span class="free">M</span> <span class="main">(</span>fully_connected <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           a10<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           contr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">E'</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span>
    
    <span class="keyword1"><span class="command">from</span></span> wfG a6 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> fully_connected_wf wf_graph_generate_valid_topology<span class="main">)</span>
    <span class="keyword1"><span class="command">with</span></span> a10 <span class="keyword1"><span class="command">have</span></span> EE'subsets<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="skolem">E</span> <span class="main">⊆</span> <span class="skolem">V</span> <span class="main">∧</span> snd <span class="main">`</span> <span class="skolem">E</span> <span class="main">⊆</span> <span class="skolem">V</span> <span class="main">∧</span> fst <span class="main">`</span> <span class="skolem">E'</span> <span class="main">⊆</span> <span class="skolem">V</span> <span class="main">∧</span> snd <span class="main">`</span> <span class="skolem">E'</span> <span class="main">⊆</span> <span class="skolem">V</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> EE'subsets'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">⊆</span> <span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">∧</span> <span class="skolem">E'</span> <span class="main">⊆</span> <span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">from</span></span> generate_valid_topology_max_topo<span class="main">[</span><span class="operator">OF</span> validRs wfG enf<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> m1<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
           m2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">.</span> <span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">v1</span><span class="main">,</span> <span class="bound">v2</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="main">(</span>add_edge <span class="bound">v1</span> <span class="bound">v2</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> max_topo_def a6<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
        
    <span class="keyword1"><span class="command">from</span></span> m2 <span class="keyword1"><span class="command">have</span></span> m2'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">x</span><span class="main">∈</span><span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">.</span> <span class="main">¬</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="bound">x</span> <span class="skolem">E</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> add_edge_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> x<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">x</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">x</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
    
     <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span>
       <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="skolem">V</span> <span class="main">=</span> <span class="main">{}</span>"</span></span><span class="main">)</span>
         <span class="keyword3"><span class="command">case</span></span> True
         <span class="keyword1"><span class="command">with</span></span> EE'subsets a10 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
         <span class="keyword1"><span class="command">with</span></span> True contr <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
       <span class="keyword1"><span class="command">next</span></span>
         <span class="keyword3"><span class="command">case</span></span> False
         <span class="keyword1"><span class="command">with</span></span> EE'subsets' contr <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> x<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">E'</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∉</span> <span class="skolem">E</span> <span class="main">∧</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="skolem">V</span> <span class="main">×</span> <span class="skolem">V</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">from</span></span> m2' x <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">x</span> <span class="skolem">E</span><span class="main">⦈</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
         
         <span class="keyword1"><span class="command">from</span></span> a6 x <span class="keyword1"><span class="command">have</span></span> x_offedning<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="main">(</span>fully_connected <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_topology_as_set delete_edges_simp2 fully_connected_def<span class="main">)</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  
         <span class="keyword1"><span class="command">from</span></span> enf_not_fulfilled_if_in_offending<span class="main">[</span><span class="operator">OF</span> validRs wfG enf<span class="main">]</span> x_offedning <span class="keyword1"><span class="command">have</span></span>
           1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">x</span> <span class="skolem">myE</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">myE</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         
         <span class="keyword1"><span class="command">from</span></span> x <span class="keyword1"><span class="command">have</span></span> insertxE'<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">x</span> <span class="skolem">E'</span> <span class="main">=</span> <span class="skolem">E'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">with</span></span> a5 <span class="keyword1"><span class="command">have</span></span>
           <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">x</span> <span class="skolem">E'</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
         <span class="keyword1"><span class="command">with</span></span> insertxE' all_security_requirements_fulfilled_mono<span class="main">[</span><span class="operator">OF</span> validRs _ a10 a5<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
           2<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">x</span> <span class="main">{}</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
         <span class="keyword1"><span class="command">from</span></span> 1 2 <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>
    


   <span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹More Lemmata›</span></span>
     <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> configured_SecurityInvariant<span class="main">)</span> c_sinvar_valid_imp_no_offending_flows<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"c_sinvar <span class="free">m</span> <span class="free">G</span> <span class="main">⟹</span> c_offending_flows <span class="free">m</span> <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_c_offending_flows<span class="main">)</span>

     <span class="keyword1" id="TopoS_Composition_Theory-all_security_requirements_fulfilled_imp_no_offending_flows"><span class="command">lemma</span></span> all_security_requirements_fulfilled_imp_no_offending_flows<span class="main">:</span>
        <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span> <span class="main">⟹</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Cons <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> all_security_requirements_fulfilled_def
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> valid_reqs2 valid_reqs1 configured_SecurityInvariant.c_sinvar_valid_imp_no_offending_flows<span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

    <span class="keyword1"><span class="command">corollary</span></span> all_security_requirements_fulfilled_imp_get_offending_empty<span class="main">:</span>
      <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span> <span class="main">⟹</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span> <span class="main">⟹</span> get_offending_flows <span class="free">M</span> <span class="free">G</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> all_security_requirements_fulfilled_imp_no_offending_flows<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_reqs_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> configured_SecurityInvariant.empty_offending_contra <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
  
    <span class="keyword1"><span class="command">corollary</span></span> generate_valid_topology_does_nothing_if_valid<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_reqs <span class="free">M</span><span class="main">;</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span><span class="main">⟧</span> <span class="main">⟹</span> 
          generate_valid_topology <span class="free">M</span> <span class="free">G</span> <span class="main">=</span> <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_topology_as_set graph_ops all_security_requirements_fulfilled_imp_no_offending_flows<span class="main">)</span>


    <span class="keyword1" id="TopoS_Composition_Theory-mono_extend_get_offending_flows"><span class="command">lemma</span></span> mono_extend_get_offending_flows<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_reqs <span class="free">M</span><span class="main">;</span>
         wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">;</span>
         <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">;</span>
         <span class="free">F'</span> <span class="main">∈</span> get_offending_flows <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span><span class="main">⦈</span> <span class="main">⟧</span> <span class="main">⟹</span>
       <span class="main">∃</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">.</span> <span class="free">F'</span> <span class="main">⊆</span> <span class="bound">F</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
     <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
     <span class="keyword1"><span class="command">next</span></span>
     <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">M</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"configured_SecurityInvariant <span class="skolem">m</span>"</span></span>
                       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"valid_reqs <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> valid_reqs2 valid_reqs1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span><span class="main">⦈</span> <span class="main">∨</span>
         <span class="main">(</span><span class="free">F'</span> <span class="main">∈</span> get_offending_flows <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
       <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">elim</span> disjE<span class="main"><span class="keyword3">,</span></span> <span class="operator">goal_cases</span><span class="main">)</span>
       <span class="keyword3"><span class="command">case</span></span> 1
         <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹configured_SecurityInvariant <span class="skolem">m</span>›</span></span> Cons.prems<span class="main">(</span>2<span class="main">,</span>3<span class="main">,</span>4<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">F</span></span> <span class="keyword2"><span class="keyword">where</span></span>
           <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">∈</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">F</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> configured_SecurityInvariant.mono_extend_set_offending_flows<span class="main">)</span>
         <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
         <span class="keyword1"><span class="command">with</span></span> <span class="quoted"><span class="quoted">‹<span class="free">F'</span> <span class="main">⊆</span> <span class="skolem">F</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">next</span></span>
       <span class="keyword3"><span class="command">case</span></span> 2 <span class="keyword1"><span class="command">with</span></span> Cons <span class="quoted"><span class="quoted">‹valid_reqs <span class="skolem">M</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span> <span class="operator">blast</span>
       <span class="keyword1"><span class="command">qed</span></span>
     <span class="keyword1"><span class="command">qed</span></span>

     <span class="keyword1" id="TopoS_Composition_Theory-get_offending_flows_subseteq_edges"><span class="command">lemma</span></span> get_offending_flows_subseteq_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">∈</span> get_offending_flows <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">⟹</span> <span class="free">F</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> valid_reqs2<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> valid_reqs1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> configured_SecurityInvariant.valid_c_offending_flows<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">thm</span></span> configured_SecurityInvariant.offending_flows_union_mono
    <span class="keyword1" id="TopoS_Composition_Theory-get_offending_flows_union_mono"><span class="command">lemma</span></span> get_offending_flows_union_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>valid_reqs <span class="free">M</span><span class="main">;</span> 
      wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">;</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟧</span> <span class="main">⟹</span>
      <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E'</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> valid_reqs2<span class="main"><span class="keyword3">,</span></span> <span class="operator">drule</span> valid_reqs1<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> configured_SecurityInvariant.offending_flows_union_mono<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">thm</span></span> configured_SecurityInvariant.Un_set_offending_flows_bound_minus_subseteq'
    <span class="keyword1" id="TopoS_Composition_Theory-Un_set_offending_flows_bound_minus_subseteq'"><span class="command">lemma</span></span> Un_set_offending_flows_bound_minus_subseteq'<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span>valid_reqs <span class="free">M</span><span class="main">;</span> 
      wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">;</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">;</span>
      <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">⟧</span> <span class="main">⟹</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="free">E'</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">-</span> <span class="free">E'</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">M</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> valid_reqs2 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_reqs <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> valid_reqs1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"configured_SecurityInvariant <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_reqs <span class="skolem">M</span>›</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="free">E'</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">-</span> <span class="free">E'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.Un_set_offending_flows_bound_minus_subseteq'<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹configured_SecurityInvariant <span class="skolem">m</span>›</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹<span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="free">E'</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">X</span> <span class="main">-</span> <span class="free">E'</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> this IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

 


 <span class="comment1">(*ENF has uniquely defined offending flows*)</span>
 <span class="keyword1" id="TopoS_Composition_Theory-ENF_uniquely_defined_offedning"><span class="command">lemma</span></span> ENF_uniquely_defined_offedning<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span> <span class="main">⟹</span> wf_graph <span class="free">G</span> <span class="main">⟹</span> 
      <span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> <span class="main">∃</span><span class="bound">P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">G</span><span class="main">.</span> c_sinvar <span class="bound">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> edges <span class="bound">G</span><span class="main">.</span> <span class="bound">P</span> <span class="bound">e</span><span class="main">)</span> <span class="main">⟹</span> 
      <span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> <span class="main">∀</span><span class="bound">G</span><span class="main">.</span> <span class="main">¬</span> c_sinvar <span class="bound">m</span> <span class="bound">G</span> <span class="main">⟶</span>  <span class="main">(</span><span class="main">∃</span><span class="bound">OFF</span><span class="main">.</span> c_offending_flows <span class="bound">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">{</span><span class="bound">OFF</span><span class="main">}</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> m M<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> valid_reqs1<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> valid_reqs2<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">elim</span> conjE<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> exE<span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> P<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> P<span class="main"><span class="main">=</span></span><span class="quoted"><span class="improper">P</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> enf_offending_flows<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

 <span class="keyword1"><span class="command">lemma</span></span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"configured_SecurityInvariant <span class="free">m</span>"</span></span>
       <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">G</span><span class="main">.</span> <span class="main">¬</span> c_sinvar <span class="free">m</span> <span class="bound">G</span> <span class="main">⟶</span> <span class="main">(</span><span class="main">∃</span><span class="bound">OFF</span><span class="main">.</span> c_offending_flows <span class="free">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">{</span><span class="bound">OFF</span><span class="main">}</span><span class="main">)</span>"</span></span>
       <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">OFF_P</span><span class="main">.</span> <span class="main">∀</span><span class="bound">G</span><span class="main">.</span> c_offending_flows <span class="free">m</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> c_sinvar <span class="free">m</span> <span class="bound">G</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="bound">OFF_P</span> <span class="bound">G</span><span class="main">}</span><span class="main">)</span>"</span></span>
 <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">OFF_P</span><span class="main">.</span> 
          c_offending_flows <span class="free">m</span> <span class="skolem">G</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> c_sinvar <span class="free">m</span> <span class="skolem">G</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">{</span><span class="bound">OFF_P</span> <span class="skolem">G</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">G</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">G</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"c_sinvar <span class="free">m</span> <span class="skolem">G</span>"</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> configured_SecurityInvariant.c_sinvar_valid_imp_no_offending_flows<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
   <span class="keyword1"><span class="command">with</span></span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
 <span class="keyword1"><span class="command">qed</span></span>
 <span class="comment1">(*TODO: generate_valid_topology_max_topo for sinvars with unique offending flows in general*)</span>



   <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Hilber's eps operator example›</span></span>
   <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">:</span> <span class="main">{</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span>
     <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">}</span><span class="main">)</span> <span class="main">∈</span> <span class="main">{</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">unfolding</span></span> some_in_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">:</span> <span class="main">{</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="free">x</span> <span class="main">⟹</span> <span class="free">x</span> <span class="main">=</span> <span class="main">1</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">2</span> <span class="main">∨</span> <span class="free">x</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
     <span class="keyword1"><span class="command">qed</span></span>

  <span class="comment1">(*TODO: remove the offending flows from the graph for each iteration. requires proof arbitrary: G
          allows to put expensive invariants at back of list and hope that sinvar is true until the are evaluated*)</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Only removing one offending flow should be enough›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">generate_valid_topology_SOME</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">generate_valid_topology_SOME</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">generate_valid_topology_SOME</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Ms</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> c_sinvar <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>
      <span class="keyword1">then</span> <span class="free">generate_valid_topology_SOME</span> <span class="free"><span class="bound"><span class="entity">Ms</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>
      <span class="keyword1">else</span> delete_edges <span class="main">(</span><span class="free">generate_valid_topology_SOME</span> <span class="free"><span class="bound"><span class="entity">Ms</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> c_offending_flows <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>
      <span class="main">)</span>"</span></span>

  <span class="keyword1" id="TopoS_Composition_Theory-generate_valid_topology_SOME_nodes"><span class="command">lemma</span></span> generate_valid_topology_SOME_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>generate_valid_topology_SOME <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="free">V</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>

  <span class="keyword1"><span class="command">theorem</span></span> generate_valid_topology_SOME_sound<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_reqs <span class="free">M</span><span class="main">;</span> wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    all_security_requirements_fulfilled <span class="free">M</span> <span class="main">(</span>generate_valid_topology_SOME <span class="free">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">M</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> valid_reqs1<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> validReq<span class="main">:</span> <span class="quoted"><span class="quoted">"configured_SecurityInvariant <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        
        <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.sinvar_valid_remove_SOME_offending_flows<span class="main">[</span><span class="operator">OF</span> validReq<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
         <span class="quoted"><span class="quoted">"c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
           c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

        <span class="keyword1"><span class="command">have</span></span> generate_valid_topology_SOME_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> SecurityInvariant_configured list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V</span> <span class="skolem">E</span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.mono_sinvar<span class="main">[</span><span class="operator">OF</span> validReq Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span>
              <span class="operator">of</span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span><span class="main">]</span>
            generate_valid_topology_SOME_edges
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">⟹</span>
            c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.defined_offending'<span class="main">[</span><span class="operator">OF</span> validReq Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> not_sinvar_off<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">⟹</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> goal_sinvar_m<span class="main">:</span>
          <span class="quoted"><span class="quoted">"c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> 
              c_sinvar <span class="skolem">m</span> <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> generate_valid_topology_SOME_nodes 
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> graph.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> graph_eq_intro<span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> valid_reqs2<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_reqs <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_reqs <span class="skolem">M</span>›</span></span> Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span>
          <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="skolem">M</span> <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

        <span class="keyword1"><span class="command">have</span></span> goal_rm_SOME_m<span class="main">:</span> <span class="quoted"><span class="quoted">"c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
            c_sinvar <span class="skolem">m</span> <span class="main">(</span>delete_edges <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>
                                      <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> <span class="comment1">(*sledgehammered*)</span>
          <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="bound">ra</span> <span class="bound">p</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">r</span> <span class="main">⊆</span> <span class="bound">ra</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">r</span> <span class="main">∨</span> <span class="bound">p</span> <span class="main">∈</span> <span class="bound">ra</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">r</span> <span class="bound">ra</span> <span class="bound">p</span><span class="main">.</span> <span class="main">¬</span> <span class="bound">r</span> <span class="main">⊆</span> <span class="bound">ra</span> <span class="main">∨</span> <span class="main">(</span><span class="bound">p</span><span class="main">::</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> <span class="main">∉</span> <span class="bound">r</span> <span class="main">∨</span> <span class="bound">p</span> <span class="main">∈</span> <span class="bound">ra</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">meson</span>
          <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> wf_graph_remove_edges<span class="main">)</span>
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f2 generate_valid_topology_SOME_edges<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">E</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> f3 a1 <span class="quoted"><span class="quoted">‹c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">⦈</span>›</span></span> configured_SecurityInvariant.negative_mono validReq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">then</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"c_sinvar <span class="skolem">m</span> <span class="main">(</span>delete_edges <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">r</span><span class="main">.</span> <span class="bound">r</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_topology_SOME_nodes graph_ops<span class="main"><span class="main">(</span></span>5<span class="main"><span class="main">)</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">have</span></span> wf_graph_generate_valid_topology_SOME<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="skolem">G</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">G</span> <span class="comment1">(*TODO: tune*)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">G</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def generate_valid_topology_SOME_nodes<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> generate_valid_topology_SOME_edges <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans image_mono rev_finite_subset<span class="main">)</span> 

        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> notempty<span class="main">:</span> <span class="quoted"><span class="quoted">"c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">hypE</span><span class="main">.</span> <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">hypE</span><span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">E</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 generate_valid_topology_SOME_nodes<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E_IH</span></span> <span class="keyword2"><span class="keyword">where</span></span> E_IH_prop<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E_IH</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
          <span class="keyword1"><span class="command">from</span></span> wf_graph_generate_valid_topology_SOME<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> E_IH_prop
          <span class="keyword1"><span class="command">have</span></span> valid_G_E_IH<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E_IH</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
          <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_mono<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_reqs <span class="skolem">M</span>›</span></span> _ valid_G_E_IH <span class="main">]</span> IH E_IH_prop
          <span class="keyword1"><span class="command">have</span></span> mono_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">⊆</span> <span class="skolem">E_IH</span> <span class="main">⟹</span> all_security_requirements_fulfilled <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">E'</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="skolem">M</span>
            <span class="main">(</span>delete_edges <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>
                          <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> E_IH_prop <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>mono_rule<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> goal_fulfilled_M<span class="main">=</span>this

        <span class="keyword1"><span class="command">have</span></span> no_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">⟹</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> configured_SecurityInvariant.c_sinvar_valid_imp_no_offending_flows validReq<span class="main">)</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>generate_valid_topology_SOME <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> goal_sinvar_m no_offending <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> goal_rm_SOME_m not_sinvar_off <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> goal_fulfilled_M not_sinvar_off <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     <span class="keyword1"><span class="command">qed</span></span>

    
   <span class="keyword1" id="TopoS_Composition_Theory-generate_valid_topology_SOME_def_alt"><span class="command">lemma</span></span> generate_valid_topology_SOME_def_alt<span class="main">:</span>
      <span class="quoted"><span class="quoted">"generate_valid_topology_SOME <span class="free">M</span> <span class="free">G</span> <span class="main">=</span> delete_edges <span class="free">G</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> <span class="keyword1">if</span> c_sinvar <span class="bound">m</span> <span class="free">G</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> c_offending_flows <span class="bound">m</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">G</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
          <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">M</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> Cons<span class="main">[</span><span class="operator">simplified</span> delete_edges_simp2 get_offending_flows_def<span class="main">]</span> 
          <span class="keyword1"><span class="command">have</span></span> IH <span class="main">:</span><span class="quoted"><span class="quoted">"edges <span class="main">(</span>generate_valid_topology_SOME <span class="skolem">M</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span>
                   edges <span class="skolem">G</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="skolem">M</span><span class="main">.</span> <span class="keyword1">if</span> c_sinvar <span class="bound">m</span> <span class="skolem">G</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> c_offending_flows <span class="bound">m</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> c_sinvar <span class="skolem">m</span> <span class="skolem">G</span> <span class="main">⟹</span> 
                    edges <span class="main">(</span>generate_valid_topology_SOME <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> <span class="skolem">G</span><span class="main">)</span> <span class="main">=</span>
                    <span class="main">(</span>edges <span class="skolem">G</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="main">(</span><span class="skolem">m</span><span class="main">#</span><span class="skolem">M</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">if</span> c_sinvar <span class="bound">m</span> <span class="skolem">G</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> c_offending_flows <span class="bound">m</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def delete_edges_simp2<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">with</span></span> Cons.IH <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def delete_edges_simp2<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1" id="TopoS_Composition_Theory-generate_valid_topology_SOME_superset"><span class="command">lemma</span></span> generate_valid_topology_SOME_superset<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_reqs <span class="free">M</span><span class="main">;</span> wf_graph <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      edges <span class="main">(</span>generate_valid_topology <span class="free">M</span> <span class="free">G</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="main">(</span>generate_valid_topology_SOME <span class="free">M</span> <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> isabelle2016_1_helper<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="keyword1">if</span> c_sinvar <span class="bound">m</span> <span class="free">G</span> <span class="keyword1">then</span> <span class="main">{}</span> <span class="keyword1">else</span> <span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> c_offending_flows <span class="bound">m</span> <span class="free">G</span><span class="main">)</span> <span class="main">⟷</span>
          <span class="main">(</span><span class="main">∃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> <span class="main">¬</span> c_sinvar <span class="bound">m</span> <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span>c_sinvar <span class="bound">m</span> <span class="free">G</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> c_offending_flows <span class="bound">m</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span><span class="main">∈</span>set <span class="free">M</span> <span class="main">⟹</span> <span class="main">¬</span> c_sinvar <span class="skolem">m</span> <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span>c_sinvar <span class="skolem">m</span> <span class="free">G</span> <span class="main">∨</span> <span class="skolem">x</span> <span class="main">∈</span> <span class="main">(</span><span class="keyword1">SOME</span> <span class="bound">F</span><span class="main">.</span> <span class="bound">F</span> <span class="main">∈</span> c_offending_flows <span class="skolem">m</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
            c_offending_flows <span class="skolem">m</span> <span class="free">G</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
            <span class="skolem">x</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> c_offending_flows <span class="bound">m</span> <span class="free">G</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">x</span> <span class="skolem">m</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="skolem">m</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> bexI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
       <span class="keyword1"><span class="command">using</span></span> some_in_eq <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
     
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span> <span class="main">⟹</span> wf_graph <span class="free">G</span> <span class="main">⟹</span> <span class="var">?thesis</span>"</span></span>
      <span class="keyword1"><span class="command">unfolding</span></span> generate_valid_topology_SOME_def_alt generate_valid_topology_def_alt
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> delete_edges_edges_mono<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 get_offending_flows_def valid_reqs_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> configured_SecurityInvariant.defined_offending' some_in_eq<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>




  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Notation:
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> generate_valid_topology_SOME<span class="antiquote"><span class="antiquote">}</span></span></span></span>: non-deterministic choice
    <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>generate_valid_topology_some›</span></span></span></span>: executable which selects always the same
›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">generate_valid_topology_some</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">×</span><span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="tfree">'v</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">generate_valid_topology_some</span> <span class="main">[]</span> <span class="main"><span class="bound"><span class="entity">_</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">generate_valid_topology_some</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Ms</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> c_sinvar <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>
      <span class="keyword1">then</span> <span class="free">generate_valid_topology_some</span> <span class="free"><span class="bound"><span class="entity">Ms</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>
      <span class="keyword1">else</span> delete_edges <span class="main">(</span><span class="free">generate_valid_topology_some</span> <span class="free"><span class="bound"><span class="entity">Ms</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="main">(</span>c_sinvar <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>
      <span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">theorem</span></span> generate_valid_topology_some_sound<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_reqs <span class="free">M</span><span class="main">;</span> wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">;</span> set <span class="free">Es</span> <span class="main">=</span> <span class="free">E</span><span class="main">;</span> distinct <span class="free">Es</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    all_security_requirements_fulfilled <span class="free">M</span> <span class="main">(</span>generate_valid_topology_some <span class="free">M</span> <span class="free">Es</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">M</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> valid_reqs1<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> validReq<span class="main">:</span> <span class="quoted"><span class="quoted">"configured_SecurityInvariant <span class="skolem">m</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
         
        <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.sinvar_valid_remove_minimalize_offending_overapprox<span class="main">[</span><span class="operator">OF</span>
          validReq Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> _  Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> rm_off_valid<span class="main">:</span>
         <span class="quoted"><span class="quoted">"<span class="main">¬</span> c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">⟹</span>
           c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="main">(</span>c_sinvar <span class="skolem">m</span><span class="main">)</span> <span class="free">Es</span> <span class="main">[]</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span><span class="main"><span class="main">(</span></span><span class="quasi_keyword">asm</span><span class="main"><span class="main">)</span></span> minimalize_offending_overapprox_boundnP<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span> <span class="comment1">(*TODO: type for nP unspecified!*)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

        <span class="keyword1"><span class="command">have</span></span> generate_valid_topology_some_nodes<span class="main">:</span> <span class="quoted"><span class="quoted">"nodes <span class="main">(</span>generate_valid_topology_some <span class="skolem">M</span> <span class="free">Es</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">V</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> SecurityInvariant_configured list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V</span> <span class="skolem">E</span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>


        <span class="keyword1"><span class="command">have</span></span> generate_valid_topology_some_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>generate_valid_topology_some <span class="skolem">M</span> <span class="free">Es</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">M</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'a</span> SecurityInvariant_configured list"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="skolem">V</span> <span class="skolem">E</span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">M</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2<span class="main">)</span>
        
        <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.mono_sinvar<span class="main">[</span><span class="operator">OF</span> validReq Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span>
              <span class="operator">of</span> <span class="quoted"><span class="quoted">"edges <span class="main">(</span>generate_valid_topology_some <span class="skolem">M</span> <span class="free">Es</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span><span class="main">]</span>
            generate_valid_topology_some_edges
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">⟹</span>
            c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="main">(</span>generate_valid_topology_some <span class="skolem">M</span> <span class="free">Es</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.defined_offending'<span class="main">[</span><span class="operator">OF</span> validReq Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> not_sinvar_off<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">¬</span> c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">⟹</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> goal_sinvar_m<span class="main">:</span>
          <span class="quoted"><span class="quoted">"c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟹</span> 
              c_sinvar <span class="skolem">m</span> <span class="main">(</span>generate_valid_topology_some <span class="skolem">M</span> <span class="free">Es</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">using</span></span> generate_valid_topology_some_nodes 
           <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> graph.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> graph_eq_intro<span class="main">)</span>

  
        <span class="keyword1"><span class="command">from</span></span> valid_reqs2<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"valid_reqs <span class="skolem">M</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_reqs <span class="skolem">M</span>›</span></span> Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> Cons.prems <span class="keyword1"><span class="command">have</span></span> IH<span class="main">:</span>
          <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="skolem">M</span> <span class="main">(</span>generate_valid_topology_some <span class="skolem">M</span> <span class="free">Es</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

 


        <span class="keyword1"><span class="command">have</span></span> wf_graph_generate_valid_topology_some<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="skolem">G</span> <span class="main">⟹</span> wf_graph <span class="main">(</span>generate_valid_topology_some <span class="skolem">M</span> <span class="free">Es</span> <span class="skolem">G</span><span class="main">)</span>"</span></span>
          <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">G</span> <span class="comment1">(*TODO: tune*)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">G</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def generate_valid_topology_some_nodes<span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> generate_valid_topology_some_edges <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">meson</span> dual_order.trans image_mono rev_finite_subset<span class="main">)</span> 

        
        <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">assume</span></span> notempty<span class="main">:</span> <span class="quoted"><span class="quoted">"c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">hypE</span><span class="main">.</span> <span class="main">(</span>generate_valid_topology_some <span class="skolem">M</span> <span class="free">Es</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="bound">hypE</span><span class="main">⦈</span>"</span></span>
            <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="skolem">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">V</span></span> <span class="quoted"><span class="free">E</span></span><span class="main">)</span>
            <span class="keyword1"><span class="command">qed</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 generate_valid_topology_some_nodes<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E_IH</span></span> <span class="keyword2"><span class="keyword">where</span></span> E_IH_prop<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">(</span>generate_valid_topology_some <span class="skolem">M</span> <span class="free">Es</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E_IH</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
          <span class="keyword1"><span class="command">from</span></span> wf_graph_generate_valid_topology_some<span class="main">[</span><span class="operator">OF</span> Cons<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span><span class="main">]</span> E_IH_prop
          <span class="keyword1"><span class="command">have</span></span> valid_G_E_IH<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E_IH</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
          <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_mono<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹valid_reqs <span class="skolem">M</span>›</span></span> _ valid_G_E_IH <span class="main">]</span> IH E_IH_prop
          <span class="keyword1"><span class="command">have</span></span> mono_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">⊆</span> <span class="skolem">E_IH</span> <span class="main">⟹</span> all_security_requirements_fulfilled <span class="skolem">M</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E'</span><span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">E'</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="skolem">M</span>
            <span class="main">(</span>delete_edges <span class="main">(</span>generate_valid_topology_some <span class="skolem">M</span> <span class="free">Es</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>
                          <span class="main">(</span>set <span class="main">(</span>minimalize_offending_overapprox <span class="main">(</span>c_sinvar <span class="skolem">m</span><span class="main">)</span> <span class="free">Es</span> <span class="main">[]</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">unfolding</span></span> E_IH_prop <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_simp2 <span class="quasi_keyword">intro</span><span class="main"><span class="main">:</span></span>mono_rule<span class="main">)</span>
        <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">note</span></span> goal_fulfilled_M<span class="main">=</span>this

        <span class="keyword1"><span class="command">have</span></span> no_offending<span class="main">:</span> <span class="quoted"><span class="quoted">"c_sinvar <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">⟹</span> c_offending_flows <span class="skolem">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> configured_SecurityInvariant.c_sinvar_valid_imp_no_offending_flows validReq<span class="main">)</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">(</span>generate_valid_topology_some <span class="main">(</span><span class="skolem">m</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> <span class="free">Es</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> goal_sinvar_m no_offending <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> IH <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> rm_off_valid <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>no_types<span class="main"><span class="main">,</span></span> lifting<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> Diff_mono 
            configured_SecurityInvariant.mono_sinvar delete_edges_simp2 generate_valid_topology_some_edges
            generate_valid_topology_some_nodes order_refl validReq wf_graph_remove_edges<span class="main">)</span> <span class="comment1">(*TODO!*)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword1"><span class="command">using</span></span> goal_fulfilled_M not_sinvar_off <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     <span class="keyword1"><span class="command">qed</span></span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Stateful_Policy">
<div class="head">
<h1>Theory TopoS_Stateful_Policy</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Stateful_Policy
<span class="keyword2"><span class="keyword">imports</span></span> <a href="TopoS_Composition_Theory.html">TopoS_Composition_Theory</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Stateful Policy›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Details described in \cite{diekmann2014esss}.›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Algorithm›</span></span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted">TopoS_Composition_Theory.generate_valid_topology</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹generates a valid high-level topology. Now we discuss how to turn this into
       a stateful policy.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Example:
  SensorNode produces data and has no security level.
  SensorSink has high security level
  SensorNode -&gt; SensorSink, but not the other way round.
  Implementation: UDP in one direction

  Alice is in internal protected subnet. Google can not arbitrarily access Alice.
  Alice sends requests to google.
  It is desirable that Alice gets the response back
  Implementation: TCP and stateful packet filter that allows, once Alice establishes a connection, to get a response back via this connection.

Result:
  IFS violations undesirable.
  ACS violations may be okay under certain conditions.
›</span></span>

<span class="keyword1"><span class="command">term</span></span> <span class="quoted">all_security_requirements_fulfilled</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">G</span></span> <span class="main"><span class="main">=</span></span> <span class="main"><span class="main">(</span></span><span class="free"><span class="free">V</span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">E<span class="hidden">⇩</span><sub>f</sub><span class="hidden">⇩</span><sub>i</sub><span class="hidden">⇩</span><sub>x</sub></span></span><span class="main"><span class="main">,</span></span> <span class="free"><span class="free">E<span class="hidden">⇩</span><sub>s</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>a</sub><span class="hidden">⇩</span><sub>t</sub><span class="hidden">⇩</span><sub>e</sub></span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'v</span> stateful_policy <span class="main">=</span>
    hosts <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> set"</span></span> <span class="comment1">― ‹nodes, vertices›</span>
    flows_fix <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span><span class="tfree">'v</span><span class="main">)</span> set"</span></span> <span class="comment1">― ‹edges in high-level policy›</span>
    flows_state <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span><span class="tfree">'v</span><span class="main">)</span> set"</span></span> <span class="comment1">― ‹edges that can have stateful flows, i.e. backflows›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹All the possible ways packets can travel in a <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'v</span></span> stateful_policy"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
        They can either choose the fixed links;
        Or use a stateful link, i.e. establish state.
        Once state is established, packets can flow back via the established link.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">all_flows</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> stateful_policy <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">all_flows</span> <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span> <span class="main">≡</span> flows_fix <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span> <span class="main">∪</span> flows_state <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span> <span class="main">∪</span> backflows <span class="main">(</span>flows_state <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span><span class="main">)</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stateful_policy_to_network_graph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> stateful_policy <span class="main">⇒</span> <span class="tfree">'v</span> graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stateful_policy_to_network_graph</span> <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span> <span class="main">=</span> <span class="main">⦇</span> nodes <span class="main">=</span> hosts <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span><span class="main">,</span> edges <span class="main">=</span> all_flows <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span> <span class="main">⦈</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"<span class="tfree"><span class="tfree">'v</span></span> stateful_policy"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> syntactically well-formed›</span></span>
<span class="keyword1"><span class="command">locale</span></span> wf_stateful_policy <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">𝒯</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> stateful_policy"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span> E_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>flows_fix <span class="free">𝒯</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>hosts <span class="free">𝒯</span><span class="main">)</span>"</span></span>
                   <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>flows_fix <span class="free">𝒯</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>hosts <span class="free">𝒯</span><span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> E_state_fix<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_state <span class="free">𝒯</span> <span class="main">⊆</span> flows_fix <span class="free">𝒯</span>"</span></span>
  <span class="keyword2"><span class="keyword">and</span></span> finite_Hosts<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>hosts <span class="free">𝒯</span><span class="main">)</span>"</span></span>
<span class="keyword2"><span class="keyword">begin</span></span>

  <span class="keyword1" id="TopoS_Stateful_Policy-E_wfD"><span class="command">lemma</span></span> E_wfD<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> flows_fix <span class="free">𝒯</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> hosts <span class="free">𝒯</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> hosts <span class="free">𝒯</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E_wf<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E_wf<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
 
  <span class="keyword1" id="TopoS_Stateful_Policy-E_state_valid"><span class="command">lemma</span></span> E_state_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>hosts <span class="free">𝒯</span><span class="main">)</span>"</span></span>
                       <span class="quoted"><span class="quoted">"snd <span class="main">`</span> <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>hosts <span class="free">𝒯</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">using</span></span> E_wf<span class="main">(</span>1<span class="main">)</span> E_state_fix <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
   <span class="keyword1"><span class="command">using</span></span> E_wf<span class="main">(</span>2<span class="main">)</span> E_state_fix <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="TopoS_Stateful_Policy-E_state_validD"><span class="command">lemma</span></span> E_state_validD<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span> <span class="main">∈</span> flows_state <span class="free">𝒯</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span> <span class="main">∈</span> hosts <span class="free">𝒯</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span> <span class="main">∈</span> hosts <span class="free">𝒯</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">-</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E_state_valid<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">rule</span> subsetD<span class="main"><span class="main">[</span></span><span class="operator">OF</span> E_state_valid<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> assms <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="TopoS_Stateful_Policy-finite_fix"><span class="command">lemma</span></span> finite_fix<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>flows_fix <span class="free">𝒯</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> E_wf<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> finite_Hosts<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fst <span class="main">`</span> flows_fix <span class="free">𝒯</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> E_wf<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> finite_Hosts<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>snd <span class="main">`</span> flows_fix <span class="free">𝒯</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">have</span></span> s<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_fix <span class="free">𝒯</span> <span class="main">⊆</span> <span class="main">(</span>fst <span class="main">`</span> flows_fix <span class="free">𝒯</span> <span class="main">×</span> snd <span class="main">`</span> flows_fix <span class="free">𝒯</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command">from</span></span> finite_cartesian_product<span class="main">[</span><span class="operator">OF</span> 1 2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>fst <span class="main">`</span> flows_fix <span class="free">𝒯</span> <span class="main">×</span> snd <span class="main">`</span> flows_fix <span class="free">𝒯</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">from</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> s this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="TopoS_Stateful_Policy-finite_state"><span class="command">lemma</span></span> finite_state<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> finite_subset<span class="main">[</span><span class="operator">OF</span> E_state_fix finite_fix<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>


  <span class="keyword1" id="TopoS_Stateful_Policy-finite_backflows_state"><span class="command">lemma</span></span> finite_backflows_state<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_Collect<span class="main">]</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def finite_state<span class="main">)</span>

  <span class="keyword1" id="TopoS_Stateful_Policy-E_state_backflows_wf"><span class="command">lemma</span></span> E_state_backflows_wf<span class="main">:</span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>hosts <span class="free">𝒯</span><span class="main">)</span>"</span></span>
                         <span class="quoted"><span class="quoted">"snd <span class="main">`</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>hosts <span class="free">𝒯</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def E_state_valid E_state_validD<span class="main">)</span>

<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Minimizing stateful flows such that only newly added backflows remain›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">filternew_flows_state</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> stateful_policy <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">filternew_flows_state</span> <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span> <span class="main">≡</span> <span class="main">{</span><span class="main">(</span><span class="bound"><span class="bound">s</span></span><span class="main">,</span> <span class="bound"><span class="bound">r</span></span><span class="main">)</span> <span class="main">∈</span> flows_state <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span> <span class="main">∉</span> flows_fix <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span><span class="main">}</span>"</span></span>

  <span class="keyword1" id="TopoS_Stateful_Policy-filternew_subseteq_flows_state"><span class="command">lemma</span></span> filternew_subseteq_flows_state<span class="main">:</span> <span class="quoted"><span class="quoted">"filternew_flows_state <span class="free">𝒯</span> <span class="main">⊆</span> flows_state <span class="free">𝒯</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_def<span class="main">)</span>

  <span class="comment1">― ‹alternative definitions, all are equal›</span>
  <span class="keyword1" id="TopoS_Stateful_Policy-filternew_flows_state_alt"><span class="command">lemma</span></span> filternew_flows_state_alt<span class="main">:</span> <span class="quoted"><span class="quoted">"filternew_flows_state <span class="free">𝒯</span>  <span class="main">=</span> flows_state <span class="free">𝒯</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span>flows_fix <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def filternew_flows_state_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1" id="TopoS_Stateful_Policy-filternew_flows_state_alt2"><span class="command">lemma</span></span> filternew_flows_state_alt2<span class="main">:</span> <span class="quoted"><span class="quoted">"filternew_flows_state <span class="free">𝒯</span>  <span class="main">=</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> flows_state <span class="free">𝒯</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> backflows <span class="main">(</span>flows_fix <span class="free">𝒯</span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def filternew_flows_state_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
  <span class="keyword1" id="TopoS_Stateful_Policy-backflows_filternew_flows_state"><span class="command">lemma</span></span> backflows_filternew_flows_state<span class="main">:</span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>flows_fix <span class="free">𝒯</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_alt backflows_minus_backflows<span class="main">)</span>

  <span class="keyword1" id="TopoS_Stateful_Policy-stateful_policy_to_network_graph_filternew"><span class="command">lemma</span></span> stateful_policy_to_network_graph_filternew<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_stateful_policy <span class="free">𝒯</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    stateful_policy_to_network_graph <span class="free">𝒯</span> <span class="main">=</span> 
    stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> flows_fix <span class="main">=</span> flows_fix <span class="free">𝒯</span><span class="main">,</span> flows_state <span class="main">=</span> filternew_flows_state <span class="free">𝒯</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> wf_stateful_policy.E_state_fix<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> Set.equalityI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_def backflows_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_def backflows_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="TopoS_Stateful_Policy-backflows_filternew_disjunct_flows_fix"><span class="command">lemma</span></span> backflows_filternew_disjunct_flows_fix<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">b</span> <span class="main">∈</span> <span class="main">(</span>backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">b</span> <span class="main">∉</span> flows_fix <span class="free">𝒯</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_def backflows_def<span class="main">)</span>





<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Given a high-level policy, we can construct a pretty large syntactically valid low level policy. However, the stateful policy will
       almost certainly violate security requirements!›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> wf_stateful_policy <span class="main">⦇</span> hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> nodes <span class="free">G</span> <span class="main">×</span> nodes <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> nodes <span class="free">G</span> <span class="main">×</span> nodes <span class="free">G</span> <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_stateful_policy_def wf_graph_def<span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> wf_stateful_policy<span class="antiquote"><span class="antiquote">}</span></span></span></span> implies <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">wf_graph</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
  <span class="keyword1" id="TopoS_Stateful_Policy-wf_stateful_policy_is_wf_graph"><span class="command">lemma</span></span> wf_stateful_policy_is_wf_graph<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_stateful_policy <span class="free">𝒯</span> <span class="main">⟹</span> wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> all_flows <span class="free">𝒯</span><span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> wf_stateful_policy.E_state_backflows_wf<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> wf_stateful_policy.E_state_backflows_wf<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> wf_stateful_policy.E_state_valid<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> wf_stateful_policy.E_state_valid<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> wf_stateful_policy.E_wf<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span> wf_stateful_policy.E_wf<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_flows_def wf_graph_def wf_stateful_policy_def 
          wf_stateful_policy.finite_fix wf_stateful_policy.finite_state wf_stateful_policy.finite_backflows_state<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> image_Un sup.bounded_iff<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(*we use the second way of writing it in the paper*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span> <span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span>
    <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>flows_fix <span class="free">𝒯</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_alt backflows_minus_backflows<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹When is a stateful policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">𝒯</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> compliant with a high-level policy <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">G</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and the security requirements <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="free"><span class="free">M</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>?›</span></span>
<span class="keyword1"><span class="command">locale</span></span> stateful_policy_compliance <span class="main">=</span>  
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">𝒯</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> stateful_policy"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">G</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph"</span></span>
  <span class="keyword2"><span class="keyword">fixes</span></span> <span class="free">M</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">)</span> SecurityInvariant_configured list"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="comment1">― ‹the graph must be syntactically valid›</span>
    wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">― ‹security requirements must be valid›</span>
    validReqs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">― ‹the high-level policy must be valid›</span>
    high_level_policy_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">― ‹the stateful policy must be syntactically valid›</span>
    stateful_policy_wf<span class="main">:</span>
    <span class="quoted"><span class="quoted">"wf_stateful_policy <span class="free">𝒯</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">― ‹the stateful policy must talk about the same nodes as the high-level policy›</span>
    hosts_nodes<span class="main">:</span>
    <span class="quoted"><span class="quoted">"hosts <span class="free">𝒯</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">― ‹only flows that are allowed in the high-level policy are allowed in the stateful policy›</span>
    flows_edges<span class="main">:</span>
    <span class="quoted"><span class="quoted">"flows_fix <span class="free">𝒯</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>
    <span class="comment1">― ‹the low level policy must comply with the high-level policy›</span>
      <span class="comment1">― ‹all information flow strategy requirements must be fulfilled, i.e. no leaks!›</span>
      compliant_stateful_IFS<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>
      <span class="comment1">― ‹No Access Control side effects must occur›</span>
      compliant_stateful_ACS<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span> <span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
        
  <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="keyword1" id="TopoS_Stateful_Policy-compliant_stateful_ACS_no_side_effects_filternew_helper"><span class="command">lemma</span></span> compliant_stateful_ACS_no_side_effects_filternew_helper<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">E</span></span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span> nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> <span class="bound">E</span> <span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">E</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span><span class="main">)</span>
      <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
      <span class="keyword3"><span class="command">assume</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> validReqs <span class="keyword1"><span class="command">have</span></span> valid_ReqsACS<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ACS_def valid_reqs_def<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> compliant_stateful_ACS stateful_policy_to_network_graph_filternew<span class="main">[</span><span class="operator">OF</span> stateful_policy_wf<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> compliant_stateful_ACS_only_state_violations_filternew<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> flows_fix <span class="main">=</span> flows_fix <span class="free">𝒯</span><span class="main">,</span> flows_state <span class="main">=</span> filternew_flows_state <span class="free">𝒯</span> <span class="main">⦈</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
      <span class="keyword1"><span class="command">from</span></span> wf_stateful_policy_is_wf_graph<span class="main">[</span><span class="operator">OF</span> stateful_policy_wf<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> wfGfilternew<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> filternew_flows_state <span class="free">𝒯</span> <span class="main">∪</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_flows_def filternew_flows_state_alt backflows_minus_backflows<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
    
      <span class="keyword1"><span class="command">from</span></span> wf_stateful_policy.E_state_fix<span class="main">[</span><span class="operator">OF</span> stateful_policy_wf<span class="main">]</span> filternew_subseteq_flows_state <span class="keyword1"><span class="command">have</span></span> flows_fix_un_filternew_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_fix <span class="free">𝒯</span> <span class="main">∪</span> filternew_flows_state <span class="free">𝒯</span> <span class="main">=</span> flows_fix <span class="free">𝒯</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
      <span class="keyword1"><span class="command">from</span></span> compliant_stateful_ACS_only_state_violations_filternew <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span> 
        <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> filternew_flows_state <span class="free">𝒯</span> <span class="main">∪</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def get_offending_flows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
    
      <span class="comment1">― ‹idea: use <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> compliant_stateful_ACS<span class="antiquote">}</span></span> with the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> configured_SecurityInvariant.Un_set_offending_flows_bound_minus_subseteq<span class="antiquote">}</span></span> 
        lemma and substract <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">E</span>"</span><span class="antiquote">}</span></span>, on the right hand side <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted"><span class="skolem">E</span></span><span class="antiquote">}</span></span> remains, as Graph's edges <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fix <span class="free">𝒯</span>  <span class="main">∪</span> <span class="skolem">E</span>"</span><span class="antiquote">}</span></span> remains›</span>

      <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.Un_set_offending_flows_bound_minus_subseteq<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> _ wfGfilternew this<span class="main">]</span>
        <span class="quoted"><span class="quoted">‹valid_reqs <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span>›</span></span>
        <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">m</span> <span class="bound">E</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>c_offending_flows <span class="bound">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> filternew_flows_state <span class="free">𝒯</span> <span class="main">∪</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="bound">E</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="bound">E</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_flows_def valid_reqs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this flows_fix_un_filternew_simp <span class="keyword1"><span class="command">have</span></span> rule<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">m</span> <span class="bound">E</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>c_offending_flows <span class="bound">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="bound">E</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="bound">E</span>"</span></span>  
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
      <span class="keyword1"><span class="command">from</span></span>  backflows_finite rev_finite_subset<span class="main">[</span><span class="operator">OF</span> wf_stateful_policy.finite_state<span class="main"><span class="main">[</span></span><span class="operator">OF</span> stateful_policy_wf<span class="main"><span class="main">]</span></span> filternew_subseteq_flows_state<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"finite <span class="main">(</span>backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> a1 this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rev_finite_subset<span class="main">)</span>
    
      <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E'</span></span> <span class="keyword2"><span class="keyword">where</span></span> E'_prop1<span class="main">:</span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">E'</span> <span class="main">=</span> <span class="skolem">E</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> E'_prop2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E'</span> <span class="main">=</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> E'_prop2 <span class="quoted"><span class="quoted">‹finite <span class="main">(</span>backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹finite <span class="skolem">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="skolem">E'</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
      <span class="keyword1"><span class="command">from</span></span> Set.double_diff<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> B<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> C<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> A<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">E</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> a1<span class="main">,</span> <span class="operator">simplified</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> Ebackflowssimp<span class="main">:</span>
        <span class="quoted"><span class="quoted">"backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"flows_fix <span class="free">𝒯</span> <span class="main">∪</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">)</span> <span class="main">=</span> 
          <span class="main">(</span>flows_fix <span class="free">𝒯</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">E</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Set.Un_Diff<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Ebackflowssimp<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>flows_fix <span class="free">𝒯</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> <span class="skolem">E</span> <span class="main">=</span> flows_fix <span class="free">𝒯</span>  <span class="main">∪</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> backflows_filternew_disjunct_flows_fix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> flows_E_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_fix <span class="free">𝒯</span> <span class="main">∪</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">)</span> <span class="main">=</span> flows_fix <span class="free">𝒯</span>  <span class="main">∪</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
    
      <span class="keyword1"><span class="command">from</span></span> rule<span class="main">[</span><span class="operator">simplified</span> E'_prop1 E'_prop2<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span>
      <span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>c_offending_flows <span class="bound">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">)</span><span class="main">⦈</span><span class="main">.</span>
       <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">E</span><span class="main">)</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this Ebackflowssimp flows_E_simp <span class="keyword1"><span class="command">have</span></span>
      <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span>
        <span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>c_offending_flows <span class="bound">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span>
       <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword3"><span class="command">thus</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>
    
    
    <span class="keyword1"><span class="command">theorem</span></span> compliant_stateful_ACS_no_side_effects<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">E</span></span> <span class="main">⊆</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">F</span> <span class="main">∈</span> get_offending_flows<span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span> nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> <span class="bound">E</span> <span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">E</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> compliant_stateful_ACS stateful_policy_to_network_graph_filternew<span class="main">[</span><span class="operator">OF</span> stateful_policy_wf<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> a1<span class="main">:</span> 
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> flows_fix <span class="main">=</span> flows_fix <span class="free">𝒯</span><span class="main">,</span> flows_state <span class="main">=</span> filternew_flows_state <span class="free">𝒯</span> <span class="main">⦈</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
      <span class="keyword1"><span class="command">have</span></span> backflows_split<span class="main">:</span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset Un_Diff_cancel Un_absorb1 backflows_minus_backflows filternew_flows_state_alt<span class="main">)</span>
    
      <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound"><span class="bound">E</span></span><span class="main">⊆</span>backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> 
             <span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> <span class="bound">E</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">E</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
          <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span>"</span></span>
    
          <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">E1</span> <span class="bound">E2</span><span class="main">.</span> <span class="bound">E1</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">E2</span> <span class="main">⊆</span> <span class="main">(</span>backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">E1</span> <span class="main">∪</span> <span class="bound">E2</span> <span class="main">=</span> <span class="skolem">E</span> <span class="main">∧</span> <span class="bound">E1</span> <span class="main">∩</span> <span class="bound">E2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="skolem">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="skolem">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span><span class="main">(</span>backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
             <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
             <span class="keyword1"><span class="command">using</span></span> h1 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
            <span class="keyword1"><span class="command">using</span></span> backflows_filternew_disjunct_flows_fix <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
          <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">E1</span></span> <span class="skolem"><span class="skolem">E2</span></span> <span class="keyword2"><span class="keyword">where</span></span> E1_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E1</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> E2_prop<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E2</span> <span class="main">⊆</span> <span class="main">(</span>backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">-</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">=</span> <span class="skolem">E1</span> <span class="main">∪</span> <span class="skolem">E2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E1</span> <span class="main">∩</span> <span class="skolem">E2</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
          <span class="comment1">― ‹the stateful flows are <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">text</span> <span class="raw_text">"⊆"</span><span class="antiquote">}</span></span> fix flows. If substracting the new stateful flows, onyly the existing fix flows remain›</span>
          <span class="keyword1"><span class="command">from</span></span> E2_prop filternew_flows_state_alt <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E2</span> <span class="main">⊆</span> flows_fix <span class="free">𝒯</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>hide_lams<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Diff_subset_conv Un_Diff_cancel2 backflows_minus_backflows inf_sup_ord<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> order.trans<span class="main">)</span>
          <span class="comment1">― ‹hence, E2 disappears›</span>
          <span class="keyword1"><span class="command">from</span></span> Set.Un_absorb1<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> E2_absorb<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_fix <span class="free">𝒯</span> <span class="main">∪</span> <span class="skolem">E2</span> <span class="main">=</span> flows_fix <span class="free">𝒯</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">=</span> <span class="skolem">E1</span> <span class="main">∪</span> <span class="skolem">E2</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> E2E1eq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E2</span> <span class="main">∪</span> <span class="skolem">E1</span> <span class="main">=</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    
          <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E</span> <span class="main">=</span> <span class="skolem">E1</span> <span class="main">∪</span> <span class="skolem">E2</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">E1</span> <span class="main">∩</span> <span class="skolem">E2</span> <span class="main">=</span> <span class="main">{}</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E1</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    
          <span class="keyword1"><span class="command">from</span></span> compliant_stateful_ACS_no_side_effects_filternew_helper E1_prop <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> <span class="skolem">E1</span> <span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="skolem">E1</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> <span class="skolem">E2</span> <span class="main">∪</span> <span class="skolem">E1</span> <span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="skolem">E1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> E2_absorb<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> <span class="skolem">E</span> <span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="skolem">E1</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> E2E1eq <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_assoc<span class="main">)</span>
    
          <span class="keyword1"><span class="command">from</span></span> this <span class="quoted"><span class="quoted">‹<span class="skolem">E1</span> <span class="main">⊆</span> <span class="skolem">E</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> <span class="skolem">E</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
    
      <span class="keyword1"><span class="command">from</span></span> this backflows_split <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
    <span class="keyword1"><span class="command">qed</span></span>


    <span class="keyword1"><span class="command">corollary</span></span> compliant_stateful_ACS_no_side_effects'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound"><span class="bound">E</span></span> <span class="main">⊆</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> <span class="main">∀</span> <span class="bound">F</span> <span class="main">∈</span> get_offending_flows<span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span> nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> flows_state <span class="free">𝒯</span> <span class="main">∪</span> <span class="bound">E</span> <span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">E</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> compliant_stateful_ACS_no_side_effects wf_stateful_policy.E_state_fix<span class="main">[</span><span class="operator">OF</span> stateful_policy_wf<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_absorb2<span class="main">)</span>


    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The high level graph generated from the low level policy is a valid graph›</span></span>
    <span class="keyword1" id="TopoS_Stateful_Policy-valid_stateful_policy"><span class="command">lemma</span></span> valid_stateful_policy<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> all_flows <span class="free">𝒯</span><span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">rule</span> wf_stateful_policy_is_wf_graph<span class="main"><span class="keyword3">,</span></span><span class="operator">fact</span> stateful_policy_wf<span class="main">)</span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The security requirements are definitely fulfilled if we consider only the fixed flows and the
           normal direction of the stateful flows (i.e. no backflows).
           I.e. considering no states, everything must be fulfilled›</span></span>
    <span class="keyword1" id="TopoS_Stateful_Policy-compliant_stateful_ACS_static_valid"><span class="command">lemma</span></span> compliant_stateful_ACS_static_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span> nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span>  <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> validReqs <span class="keyword1"><span class="command">have</span></span> valid_ReqsACS<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ACS_def valid_reqs_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> wfG hosts_nodes<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> wfG'<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span>  <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> high_level_policy_valid <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_ACS_def all_security_requirements_fulfilled_def<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this hosts_nodes<span class="main">[</span><span class="operator">symmetric</span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span> nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span>  <span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_mono<span class="main">[</span><span class="operator">OF</span> valid_ReqsACS flows_edges wfG' this<span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">theorem</span></span> compliant_stateful_ACS_static_valid'<span class="main">:</span>
      <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span> nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> flows_state <span class="free">𝒯</span>  <span class="main">⦈</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> validReqs <span class="keyword1"><span class="command">have</span></span> valid_ReqsIFS<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_IFS_def valid_reqs_def<span class="main">)</span>
    
        <span class="comment1">― ‹show that it holds for IFS, by monotonicity as it holds for more in IFS›</span>
        <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_mono<span class="main">[</span><span class="operator">OF</span> valid_ReqsIFS _ valid_stateful_policy compliant_stateful_IFS<span class="main"><span class="main">[</span></span><span class="operator">unfolded</span> stateful_policy_to_network_graph_def<span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
          goalIFS<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span> nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> flows_state <span class="free">𝒯</span>  <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_flows_def<span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> wf_stateful_policy.E_state_fix<span class="main">[</span><span class="operator">OF</span> stateful_policy_wf<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"flows_fix <span class="free">𝒯</span> <span class="main">∪</span> flows_state <span class="free">𝒯</span> <span class="main">=</span>  flows_fix <span class="free">𝒯</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this compliant_stateful_ACS_static_valid <span class="keyword1"><span class="command">have</span></span> goalACS<span class="main">:</span>
          <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span> nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> flows_state <span class="free">𝒯</span>  <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
        <span class="comment1">― ‹ACS and IFS together form M, we know it holds for ACS›</span>
        <span class="keyword1"><span class="command">from</span></span> goalACS goalIFS <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def get_IFS_def get_ACS_def<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command">qed</span></span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The flows with state are a subset of the flows allowed by the policy›</span></span>
    <span class="keyword1"><span class="command">theorem</span></span> flows_state_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_state <span class="free">𝒯</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> wf_stateful_policy.E_state_fix<span class="main">[</span><span class="operator">OF</span> stateful_policy_wf<span class="main">]</span> flows_edges <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>


    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹All offending flows are subsets of the reveres stateful flows›</span></span>
    <span class="keyword1" id="TopoS_Stateful_Policy-compliant_stateful_ACS_only_state_violations"><span class="command">lemma</span></span> compliant_stateful_ACS_only_state_violations<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset backflows_minus_backflows filternew_flows_state_alt<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> compliant_stateful_ACS this <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subset_trans<span class="main">)</span>
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">theorem</span></span> compliant_stateful_ACS_only_state_violations'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="free">M</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> validReqs <span class="keyword1"><span class="command">have</span></span> valid_ReqsIFS<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_IFS_def valid_reqs_def<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> offending_split<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">G</span><span class="main">.</span> get_offending_flows <span class="free">M</span> <span class="bound">G</span> <span class="main">=</span> <span class="main">(</span>get_offending_flows <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="bound">G</span> <span class="main">∪</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="bound">G</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_offending_flows_def get_IFS_def get_ACS_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
       <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> offending_split<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> compliant_stateful_ACS_only_state_violations 
              all_security_requirements_fulfilled_imp_get_offending_empty<span class="main">[</span><span class="operator">OF</span> valid_ReqsIFS compliant_stateful_IFS<span class="main">]</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">qed</span></span>


    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹All violations are backflows of valid flows›</span></span>
    <span class="keyword1"><span class="command">corollary</span></span> compliant_stateful_ACS_only_state_violations_union<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> compliant_stateful_ACS_only_state_violations <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">corollary</span></span> compliant_stateful_ACS_only_state_violations_union'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="free">M</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> compliant_stateful_ACS_only_state_violations' <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹All individual flows cause no side effects, i.e. each backflow causes at most itself as violation, no other
           side-effect violations are induced.›</span></span>
    <span class="keyword1" id="TopoS_Stateful_Policy-compliant_stateful_ACS_no_state_singleflow_side_effect"><span class="command">lemma</span></span>  compliant_stateful_ACS_no_state_singleflow_side_effect<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">v<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">v<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∈</span> backflows <span class="main">(</span>flows_state <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> 
       <span class="main">⋃</span><span class="main">(</span>get_offending_flows<span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span> nodes <span class="main">=</span> hosts <span class="free">𝒯</span><span class="main">,</span> edges <span class="main">=</span> flows_fix <span class="free">𝒯</span> <span class="main">∪</span> flows_state <span class="free">𝒯</span> <span class="main">∪</span> <span class="main">{</span><span class="main">(</span><span class="bound">v<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">v<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">}</span> <span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">{</span><span class="main">(</span><span class="bound">v<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">v<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span><span class="main">}</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> compliant_stateful_ACS_no_side_effects' <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Summarizing the important theorems›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹No information flow security requirements are violated (including all added stateful flows)›</span></span>
  <span class="keyword1"><span class="command">thm</span></span> stateful_policy_compliance.compliant_stateful_IFS
  
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹There are not access control side effects when allowing stateful backflows. 
          I.e. for all possible subsets of the to-allow backflows, the violations they cause are only these backflows themselves›</span></span>
  <span class="keyword1"><span class="command">thm</span></span> stateful_policy_compliance.compliant_stateful_ACS_no_side_effects'
  
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Also, considering all backflows individually, they cause no side effect, i.e. the only violation added is the backflow itself›</span></span>
    <span class="keyword1"><span class="command">thm</span></span> stateful_policy_compliance.compliant_stateful_ACS_no_state_singleflow_side_effect
  
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In particular, all introduced offending flows for access control strategies are at most the stateful backflows›</span></span>
    <span class="keyword1"><span class="command">thm</span></span> stateful_policy_compliance.compliant_stateful_ACS_only_state_violations_union
    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Which implies: all introduced offending flows are at most the stateful backflows›</span></span>
    <span class="keyword1"><span class="command">thm</span></span> stateful_policy_compliance.compliant_stateful_ACS_only_state_violations_union'
    
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Disregarding the backflows of stateful flows, all security requirements are fulfilled.›</span></span>
  <span class="keyword1"><span class="command">thm</span></span> stateful_policy_compliance.compliant_stateful_ACS_static_valid'


 
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Composition_Theory_impl">
<div class="head">
<h1>Theory TopoS_Composition_Theory_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Composition_Theory_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="TopoS_Interface_impl.html">TopoS_Interface_impl</a> <a href="TopoS_Composition_Theory.html">TopoS_Composition_Theory</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Composition Theory -- List Implementation›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Several invariants may apply to one policy.›</span></span>


<span class="comment1">(*the packed network model record from the list implementation*)</span>
<span class="keyword1"><span class="command">term</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_packed"</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Generating instantiated (configured) network security invariants›</span></span>

  <span class="comment1">― ‹a configured network security invariant in list implementaion›</span>
  <span class="comment1">(*very minimal version, no eval, ...*)</span>
  <span class="keyword1"><span class="command">record</span></span> <span class="main">(</span><span class="tfree">'v</span><span class="main">)</span> SecurityInvariant <span class="main">=</span>
    implc_type <span class="main">::</span> <span class="quoted">string</span>
    implc_description <span class="main">::</span> <span class="quoted">string</span>
    implc_sinvar <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">)</span> list_graph <span class="main">⇒</span> bool"</span></span>
    implc_offending_flows <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">)</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list"</span></span>
    implc_isIFS <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Test if this definition is compliant with the formal definition on sets.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">SecurityInvariant_complies_formal_def</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">)</span> SecurityInvariant <span class="main">⇒</span> <span class="tfree">'v</span> TopoS_Composition_Theory.SecurityInvariant_configured <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">SecurityInvariant_complies_formal_def</span> <span class="free"><span class="bound"><span class="entity">impl</span></span></span> <span class="free"><span class="bound"><span class="entity">spec</span></span></span> <span class="main">≡</span> 
      <span class="main">(</span><span class="main">∀</span> <span class="bound">G</span><span class="main">.</span> wf_list_graph <span class="bound">G</span> <span class="main">⟶</span> implc_sinvar <span class="free"><span class="bound"><span class="entity">impl</span></span></span> <span class="bound">G</span> <span class="main">=</span> c_sinvar <span class="free"><span class="bound"><span class="entity">spec</span></span></span> <span class="main">(</span>list_graph_to_graph <span class="bound">G</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span><span class="main">∀</span> <span class="bound">G</span><span class="main">.</span> wf_list_graph <span class="bound">G</span> <span class="main">⟶</span> set<span class="main">`</span>set <span class="main">(</span>implc_offending_flows <span class="free"><span class="bound"><span class="entity">impl</span></span></span> <span class="bound">G</span><span class="main">)</span> <span class="main">=</span> c_offending_flows <span class="free"><span class="bound"><span class="entity">spec</span></span></span> <span class="main">(</span>list_graph_to_graph <span class="bound">G</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span>
      <span class="main">(</span>implc_isIFS <span class="free"><span class="bound"><span class="entity">impl</span></span></span> <span class="main">=</span> c_isIFS <span class="free"><span class="bound"><span class="entity">spec</span></span></span><span class="main">)</span>"</span></span>
    

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">new_configured_list_SecurityInvariant</span> <span class="main">::</span> 
    <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_packed <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">,</span> <span class="tfree">'a</span><span class="main">)</span> TopoS_Params <span class="main">⇒</span> string <span class="main">⇒</span>
        <span class="main">(</span><span class="tfree">'v</span> SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="quoted"><span class="quoted">"<span class="free">new_configured_list_SecurityInvariant</span> <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">description</span></span></span> <span class="main">=</span> 
        <span class="main">(</span><span class="keyword1">let</span> <span class="bound">nP</span> <span class="main">=</span> nm_node_props <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="keyword1">in</span>
         <span class="main">⦇</span> 
            implc_type <span class="main">=</span> nm_name <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">,</span>
            implc_description <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">description</span></span></span><span class="main">,</span>
            implc_sinvar <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="main">(</span>nm_sinvar <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">)</span><span class="main">,</span>
            implc_offending_flows <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="main">(</span>nm_offending_flows <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="bound">G</span> <span class="bound">nP</span><span class="main">)</span><span class="main">,</span>
            implc_isIFS <span class="main">=</span> nm_receiver_violation <span class="free"><span class="bound"><span class="entity">m</span></span></span>
          <span class="main">⦈</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">TopoS_Composition_Theory.new_configured_SecurityInvariant</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> must give a
         result if we have the SecurityInvariant modelLibrary›</span></span>
  <span class="keyword1" id="TopoS_Composition_Theory_impl-TopoS_modelLibrary_yields_new_configured_SecurityInvariant"><span class="command">lemma</span></span> TopoS_modelLibrary_yields_new_configured_SecurityInvariant<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> NetModelLib<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_modelLibrary <span class="free">m</span> <span class="free">sinvar_spec</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     nPdef<span class="main">:</span>       <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="main">=</span> nm_node_props <span class="free">m</span> <span class="free">C</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> formalSpec<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="free">Spec</span> <span class="main">=</span> <span class="main">⦇</span> 
                              c_sinvar <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="free">sinvar_spec</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">,</span>
                              c_offending_flows <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar_spec</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">,</span>
                              c_isIFS <span class="main">=</span> nm_receiver_violation <span class="free">m</span>
                            <span class="main">⦈</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"new_configured_SecurityInvariant <span class="main">(</span><span class="free">sinvar_spec</span><span class="main">,</span> nm_default <span class="free">m</span><span class="main">,</span> nm_receiver_violation <span class="free">m</span><span class="main">,</span> <span class="free">nP</span><span class="main">)</span> <span class="main">=</span> Some <span class="free">Spec</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> NetModelLib <span class="keyword1"><span class="command">have</span></span> NetModel<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant <span class="free">sinvar_spec</span> <span class="main">(</span>nm_default <span class="free">m</span><span class="main">)</span> <span class="main">(</span>nm_receiver_violation <span class="free">m</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_modelLibrary_def TopoS_List_Impl_def<span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> Spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⦇</span>c_sinvar <span class="main">=</span> <span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="free">sinvar_spec</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">,</span>
             c_offending_flows <span class="main">=</span> <span class="main">λ</span><span class="bound">G</span><span class="main">.</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar_spec</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">,</span>
             c_isIFS <span class="main">=</span> nm_receiver_violation <span class="free">m</span><span class="main">⦈</span> <span class="main">=</span> <span class="free">Spec</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> formalSpec<span class="main">)</span>
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">unfolding</span></span> new_configured_SecurityInvariant.simps
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NetModel Spec<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">thm</span></span> TopoS_modelLibrary_yields_new_configured_SecurityInvariant<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> <span class="comment1">(*todo fold in Spec*)</span>


  <span class="comment1">(* The new_* functions comply, i.e. we can instance network security models that are executable. *)</span>
  <span class="keyword1" id="TopoS_Composition_Theory_impl-new_configured_list_SecurityInvariant_complies"><span class="command">lemma</span></span> new_configured_list_SecurityInvariant_complies<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> NetModelLib<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_modelLibrary <span class="free">m</span> <span class="free">sinvar_spec</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     nPdef<span class="main">:</span>       <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="main">=</span> nm_node_props <span class="free">m</span> <span class="free">C</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> formalSpec<span class="main">:</span>      <span class="quoted"><span class="quoted">"<span class="free">Spec</span> <span class="main">=</span> new_configured_SecurityInvariant <span class="main">(</span><span class="free">sinvar_spec</span><span class="main">,</span> nm_default <span class="free">m</span><span class="main">,</span> nm_receiver_violation <span class="free">m</span><span class="main">,</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> implSpec<span class="main">:</span>        <span class="quoted"><span class="quoted">"<span class="free">Impl</span> <span class="main">=</span> new_configured_list_SecurityInvariant <span class="free">m</span> <span class="free">C</span> <span class="free">description</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"SecurityInvariant_complies_formal_def <span class="free">Impl</span> <span class="main">(</span>the <span class="free">Spec</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> TopoS_modelLibrary_yields_new_configured_SecurityInvariant<span class="main">[</span><span class="operator">OF</span> NetModelLib nPdef<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> SpecUnfolded<span class="main">:</span> <span class="quoted"><span class="quoted">"new_configured_SecurityInvariant <span class="main">(</span><span class="free">sinvar_spec</span><span class="main">,</span> nm_default <span class="free">m</span><span class="main">,</span> nm_receiver_violation <span class="free">m</span><span class="main">,</span> <span class="free">nP</span><span class="main">)</span> <span class="main">=</span>
        Some <span class="main">⦇</span>c_sinvar <span class="main">=</span> <span class="main">λ</span><span class="bound">G</span><span class="main">.</span> <span class="free">sinvar_spec</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">,</span>
             c_offending_flows <span class="main">=</span> <span class="main">λ</span><span class="bound">G</span><span class="main">.</span> SecurityInvariant_withOffendingFlows.set_offending_flows <span class="free">sinvar_spec</span> <span class="bound">G</span> <span class="free">nP</span><span class="main">,</span>
             c_isIFS <span class="main">=</span> nm_receiver_violation <span class="free">m</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      
      <span class="keyword1"><span class="command">from</span></span> NetModelLib <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SpecUnfolded formalSpec implSpec Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_complies_formal_def_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_modelLibrary_def TopoS_List_Impl_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> nPdef<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">corollary</span></span> new_configured_list_SecurityInvariant_complies'<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> TopoS_modelLibrary <span class="free">m</span> <span class="free">sinvar_spec</span> <span class="main">⟧</span> <span class="main">⟹</span> 
    SecurityInvariant_complies_formal_def <span class="main">(</span>new_configured_list_SecurityInvariant <span class="free">m</span> <span class="free">C</span> <span class="free">description</span><span class="main">)</span>
      <span class="main">(</span>the <span class="main">(</span>new_configured_SecurityInvariant <span class="main">(</span><span class="free">sinvar_spec</span><span class="main">,</span> nm_default <span class="free">m</span><span class="main">,</span> nm_receiver_violation <span class="free">m</span><span class="main">,</span> nm_node_props <span class="free">m</span> <span class="free">C</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> new_configured_list_SecurityInvariant_complies<span class="main">)</span>

  <span class="comment1">― ‹From›</span>
  <span class="keyword1"><span class="command">thm</span></span> new_configured_SecurityInvariant_sound
  <span class="comment1">― ‹we get that <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> new_configured_list_SecurityInvariant<span class="antiquote">}</span></span> has all the necessary properties (modulo <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> SecurityInvariant_complies_formal_def<span class="antiquote">}</span></span>)›</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹About security invariants›</span></span>

   <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹specification and implementation comply.›</span></span>
   <span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'v</span> security_models_spec_impl<span class="main">=</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> SecurityInvariant <span class="main">×</span> <span class="tfree">'v</span> TopoS_Composition_Theory.SecurityInvariant_configured<span class="main">)</span> list"</span></span>
   
   <span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_spec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> security_models_spec_impl <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> TopoS_Composition_Theory.SecurityInvariant_configured<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_spec</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">[</span>snd <span class="bound">m</span><span class="main">.</span> m <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">]</span>"</span></span>
   <span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_impl</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> security_models_spec_impl <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> SecurityInvariant<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_impl</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">[</span>fst <span class="bound">m</span><span class="main">.</span> m <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Calculating offending flows›</span></span>
  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">implc_get_offending_flows</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">)</span> SecurityInvariant list <span class="main">⇒</span> <span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">implc_get_offending_flows</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span>  <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">implc_get_offending_flows</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Ms</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span>implc_offending_flows <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">@</span><span class="main">(</span><span class="free">implc_get_offending_flows</span> <span class="free"><span class="bound"><span class="entity">Ms</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>  
  

  <span class="keyword1" id="TopoS_Composition_Theory_impl-implc_get_offending_flows_fold"><span class="command">lemma</span></span> implc_get_offending_flows_fold<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"implc_get_offending_flows <span class="free">M</span> <span class="free">G</span> <span class="main">=</span> fold <span class="main">(</span><span class="main">λ</span><span class="bound">m</span> <span class="bound">accu</span><span class="main">.</span> <span class="bound">accu</span><span class="main">@</span><span class="main">(</span>implc_offending_flows <span class="bound">m</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="free">M</span> <span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
    <span class="keyword1"><span class="command">{</span></span> <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">accu</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">accu</span><span class="main">@</span><span class="main">(</span>implc_get_offending_flows <span class="free">M</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> fold <span class="main">(</span><span class="main">λ</span><span class="bound">m</span> <span class="bound">accu</span><span class="main">.</span> <span class="bound">accu</span><span class="main">@</span><span class="main">(</span>implc_offending_flows <span class="bound">m</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="free">M</span> <span class="skolem">accu</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="skolem">accu</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">metis</span> append_eq_appendI<span class="main">)</span> <span class="keyword1"><span class="command">}</span></span>
    <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> accu2<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="TopoS_Composition_Theory_impl-implc_get_offending_flows_Un"><span class="command">lemma</span></span> implc_get_offending_flows_Un<span class="main">:</span> <span class="quoted"><span class="quoted">"set<span class="main">`</span>set <span class="main">(</span>implc_get_offending_flows <span class="free">M</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">⋃</span><span class="bound">m</span><span class="main">∈</span>set <span class="free">M</span><span class="main">.</span> set<span class="main">`</span>set <span class="main">(</span>implc_offending_flows <span class="bound">m</span> <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> image_Un<span class="main">)</span>


  <span class="keyword1" id="TopoS_Composition_Theory_impl-implc_get_offending_flows_map_concat"><span class="command">lemma</span></span> implc_get_offending_flows_map_concat<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>implc_get_offending_flows <span class="free">M</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> concat <span class="main">[</span>implc_offending_flows <span class="bound">m</span> <span class="free">G</span><span class="main">.</span> m <span class="main">←</span> <span class="free">M</span><span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

  
  <span class="keyword1"><span class="command">theorem</span></span> implc_get_offending_flows_complies<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     a2<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"set<span class="main">`</span>set <span class="main">(</span>implc_get_offending_flows <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>get_offending_flows <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> set <span class="main">`</span> set <span class="main">(</span>implc_offending_flows <span class="bound">m_impl</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> c_offending_flows <span class="bound">m_spec</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_complies_formal_def_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> a2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> set <span class="main">`</span> set <span class="main">(</span>implc_offending_flows <span class="main">(</span>fst <span class="bound">m</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> c_offending_flows <span class="main">(</span>snd <span class="bound">m</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_impl_def get_spec_def implc_get_offending_flows_Un get_offending_flows_def<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Accessors›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_IFS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> SecurityInvariant list <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_IFS</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">[</span><span class="bound">m</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> implc_isIFS <span class="bound">m</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">get_ACS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> SecurityInvariant list <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">get_ACS</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> <span class="main">[</span><span class="bound">m</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="main">¬</span> implc_isIFS <span class="bound">m</span><span class="main">]</span>"</span></span>

  <span class="keyword1" id="TopoS_Composition_Theory_impl-get_IFS_get_ACS_complies"><span class="command">lemma</span></span> get_IFS_get_ACS_complies<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
      SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_ACS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
      SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> implc_isIFS <span class="bound">m_impl</span> <span class="main">=</span> c_isIFS <span class="bound">m_spec</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_complies_formal_def_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> set_zip_IFS<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>zip <span class="main">(</span>filter implc_isIFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>filter c_isIFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_impl_def get_spec_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> set_zip_IFS a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
          SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_IFS_def get_ACS_def
          TopoS_Composition_Theory.get_IFS_def TopoS_Composition_Theory.get_ACS_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword1"><span class="command">from</span></span> a <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> implc_isIFS <span class="bound">m_impl</span> <span class="main">=</span> c_isIFS <span class="bound">m_spec</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_complies_formal_def_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
      <span class="keyword1"><span class="command">hence</span></span> set_zip_ACS<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>zip <span class="main">[</span><span class="bound">m</span><span class="main">←</span>get_impl <span class="free">M</span> <span class="main">.</span> <span class="main">¬</span> implc_isIFS <span class="bound">m</span><span class="main">]</span> <span class="main">[</span><span class="bound">m</span><span class="main">←</span>get_spec <span class="free">M</span> <span class="main">.</span> <span class="main">¬</span> c_isIFS <span class="bound">m</span><span class="main">]</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">M</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_impl_def get_spec_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
      <span class="keyword1"><span class="command">from</span></span> this a <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_ACS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span>
        SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_IFS_def get_ACS_def
          TopoS_Composition_Theory.get_IFS_def TopoS_Composition_Theory.get_ACS_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
     <span class="keyword1"><span class="command">qed</span></span>



   <span class="keyword1" id="TopoS_Composition_Theory_impl-get_IFS_get_ACS_select_simps"><span class="command">lemma</span></span> get_IFS_get_ACS_select_simps<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?zippedIFS</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>get_impl <span class="main">(</span>zip <span class="main">(</span>TopoS_Composition_Theory_impl.get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TopoS_Composition_Theory_impl.get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>get_spec <span class="main">(</span>zip <span class="main">(</span>TopoS_Composition_Theory_impl.get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_ACS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="var">?zippedACS</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>get_impl <span class="main">(</span>zip <span class="main">(</span>TopoS_Composition_Theory_impl.get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_ACS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TopoS_Composition_Theory_impl.get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"<span class="main">(</span>get_spec <span class="main">(</span>zip <span class="main">(</span>TopoS_Composition_Theory_impl.get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_ACS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TopoS_Composition_Theory.get_ACS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword1"><span class="command">from</span></span> get_IFS_get_ACS_complies<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> a1<span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?zippedIFS</span><span class="main">)</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>get_impl <span class="var">?zippedIFS</span><span class="main">)</span> <span class="main">=</span> TopoS_Composition_Theory_impl.get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_Composition_Theory_impl.get_IFS_def get_spec_def get_impl_def TopoS_Composition_Theory.get_IFS_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
           <span class="keyword1"><span class="command">using</span></span> SecurityInvariant_complies_formal_def_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> SecurityInvariant_complies_formal_def_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>get_spec <span class="var">?zippedIFS</span><span class="main">)</span> <span class="main">=</span> TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_Composition_Theory_impl.get_IFS_def get_spec_def get_impl_def TopoS_Composition_Theory.get_IFS_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
           <span class="keyword1"><span class="command">using</span></span> SecurityInvariant_complies_formal_def_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> SecurityInvariant_complies_formal_def_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> get_IFS_get_ACS_complies<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> a1<span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span><span class="var">?zippedACS</span><span class="main">)</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>get_impl <span class="var">?zippedACS</span><span class="main">)</span> <span class="main">=</span> TopoS_Composition_Theory_impl.get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_Composition_Theory_impl.get_ACS_def get_spec_def get_impl_def TopoS_Composition_Theory.get_ACS_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
           <span class="keyword1"><span class="command">using</span></span> SecurityInvariant_complies_formal_def_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> SecurityInvariant_complies_formal_def_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword1"><span class="command">from</span></span> a1 <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>get_spec <span class="var">?zippedACS</span><span class="main">)</span> <span class="main">=</span> TopoS_Composition_Theory.get_ACS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_Composition_Theory_impl.get_ACS_def get_spec_def get_impl_def TopoS_Composition_Theory.get_ACS_def<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
           <span class="keyword1"><span class="command">using</span></span> SecurityInvariant_complies_formal_def_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
          <span class="keyword1"><span class="command">using</span></span> SecurityInvariant_complies_formal_def_def <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
      <span class="keyword1"><span class="command">qed</span></span> 
 
   <span class="keyword1"><span class="command">thm</span></span> get_IFS_get_ACS_select_simps

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹All security requirements fulfilled›</span></span>
   <span class="keyword1"><span class="command">definition</span></span> <span class="entity">all_security_requirements_fulfilled</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> SecurityInvariant list <span class="main">⇒</span> <span class="tfree">'v</span> list_graph <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">all_security_requirements_fulfilled</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">≡</span> <span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">.</span> <span class="main">(</span>implc_sinvar <span class="bound">m</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span>

  <span class="keyword1" id="TopoS_Composition_Theory_impl-all_security_requirements_fulfilled_complies"><span class="command">lemma</span></span> all_security_requirements_fulfilled_complies<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span><span class="main">;</span> 
       wf_list_graph <span class="main">(</span><span class="free">G</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex<span class="main">)</span> list_graph<span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
    all_security_requirements_fulfilled <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟷</span> TopoS_Composition_Theory.all_security_requirements_fulfilled <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def TopoS_Composition_Theory.all_security_requirements_fulfilled_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_impl_def get_spec_def<span class="main">)</span>
    <span class="keyword1"><span class="command">using</span></span> SecurityInvariant_complies_formal_def_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹generate valid topology›</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"concat <span class="main">[</span><span class="main">[</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">5</span><span class="main">]</span><span class="main">]</span>"</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">generate_valid_topology</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> SecurityInvariant list <span class="main">⇒</span> <span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> list_graph<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">generate_valid_topology</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> delete_edges <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">(</span>concat <span class="main">(</span>implc_get_offending_flows <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>


  <span class="keyword1" id="TopoS_Composition_Theory_impl-generate_valid_topology_complies"><span class="command">lemma</span></span> generate_valid_topology_complies<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span><span class="main">;</span>
       wf_list_graph <span class="main">(</span><span class="free">G</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span> list_graph<span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> 
       list_graph_to_graph <span class="main">(</span>generate_valid_topology <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> 
       TopoS_Composition_Theory.generate_valid_topology <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">subst</span> generate_valid_topology_def_alt<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> implc_get_offending_flows_complies<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_correct <span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹generate valid topology›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹tuned for invariants where we don't want to calculate all offending flows›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Theoretic foundations: The algorithm <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> generate_valid_topology_SOME<span class="antiquote"><span class="antiquote">}</span></span></span></span> picks
        ONE offending flow non-deterministically.
        This is sound: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> generate_valid_topology_SOME_sound<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
        However, this non-deterministic choice is hard to implement. 
        To pick one offending flow deterministically, we have implemented <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> minimalize_offending_overapprox<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
        It gives back one offending flow:
          <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> SecurityInvariant_preliminaries.minimalize_offending_overapprox_gives_back_an_offending_flow<span class="antiquote"><span class="antiquote">}</span></span></span></span>
        The good thing about this function is, that it does not need to construct the complete
        <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows<span class="antiquote"><span class="antiquote">}</span></span></span></span>. Therefore, 
        it can be used for security invariants which may have an exponential number of offending flows. 
        The corresponding algorithm that uses this function is <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> TopoS_Composition_Theory.generate_valid_topology_some<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
        It is also sound: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> generate_valid_topology_some_sound<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">generate_valid_topology_some</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> SecurityInvariant list <span class="main">⇒</span> <span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> list_graph<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">generate_valid_topology_some</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">generate_valid_topology_some</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Ms</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> implc_sinvar <span class="free"><span class="bound"><span class="entity">m</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>
      <span class="keyword1">then</span> <span class="free">generate_valid_topology_some</span> <span class="free"><span class="bound"><span class="entity">Ms</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span>
      <span class="keyword1">else</span> delete_edges <span class="main">(</span><span class="free">generate_valid_topology_some</span> <span class="free"><span class="bound"><span class="entity">Ms</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">(</span>minimalize_offending_overapprox <span class="main">(</span>implc_sinvar <span class="free"><span class="bound"><span class="entity">m</span></span></span><span class="main">)</span> <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>
      <span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">thm</span></span> TopoS_Composition_Theory.generate_valid_topology_some_sound

  <span class="keyword1" id="TopoS_Composition_Theory_impl-generate_valid_topology_some_complies"><span class="command">lemma</span></span> generate_valid_topology_some_complies<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span><span class="main">;</span>
       wf_list_graph <span class="main">(</span><span class="free">G</span><span class="main">::</span><span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex list_graph<span class="main">)</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> 
       list_graph_to_graph <span class="main">(</span>generate_valid_topology_some <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="free">G</span><span class="main">)</span> <span class="main">=</span> 
       TopoS_Composition_Theory.generate_valid_topology_some <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">M</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_spec_def get_impl_def<span class="main">)</span>
    <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">m</span> <span class="skolem">M</span><span class="main">)</span>
      <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">m_impl</span></span> <span class="skolem"><span class="skolem">m_spec</span></span> <span class="keyword2"><span class="keyword">where</span></span> m<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">m</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">m_impl</span><span class="main">,</span> <span class="skolem">m_spec</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">m</span></span><span class="main">)</span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">from</span></span> m <span class="keyword1"><span class="command">have</span></span> m_impl<span class="main">:</span> <span class="quoted"><span class="quoted">"get_impl <span class="main">(</span><span class="main">(</span><span class="skolem">m_impl</span><span class="main">,</span> <span class="skolem">m_spec</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m_impl</span> <span class="main">#</span> <span class="main">(</span>get_impl <span class="skolem">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_impl_def<span class="main">)</span> 
      <span class="keyword1"><span class="command">from</span></span> m <span class="keyword1"><span class="command">have</span></span> m_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"get_spec <span class="main">(</span><span class="main">(</span><span class="skolem">m_impl</span><span class="main">,</span> <span class="skolem">m_spec</span><span class="main">)</span> <span class="main">#</span> <span class="skolem">M</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">m_spec</span> <span class="main">#</span> <span class="main">(</span>get_spec <span class="skolem">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_spec_def<span class="main">)</span> 
      
      <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span> m <span class="keyword1"><span class="command">have</span></span> complies_formal_def<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_complies_formal_def <span class="skolem">m_impl</span> <span class="skolem">m_spec</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> impl_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"implc_sinvar <span class="skolem">m_impl</span> <span class="free">G</span> <span class="main">⟷</span> c_sinvar <span class="skolem">m_spec</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_complies_formal_def_def<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> complies_formal_def
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> wf_list_graph <span class="bound">G</span> <span class="main">⟹</span>
        <span class="main">(</span><span class="main">λ</span><span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="main">(</span>c_sinvar <span class="skolem">m_spec</span><span class="main">)</span> <span class="bound">G</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="bound">G</span><span class="main">)</span> <span class="bound">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="main">(</span>implc_sinvar <span class="skolem">m_impl</span><span class="main">)</span> <span class="bound">G</span><span class="main">)</span> <span class="bound">G</span> <span class="bound">nP</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_complies_formal_def_def<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> minimalize_offending_overapprox_spec_impl<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span>
          <span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="main">(</span>c_sinvar <span class="skolem">m_spec</span><span class="main">)</span> <span class="bound">G</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="bound">G</span> <span class="bound">nP</span><span class="main">.</span> <span class="main">(</span>implc_sinvar <span class="skolem">m_impl</span><span class="main">)</span> <span class="bound">G</span><span class="main">)</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> this<span class="main">]</span>
        <span class="comment1">(*TODO: because of funny type, horribly complex instantiation*)</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"TopoS_Interface_impl.minimalize_offending_overapprox <span class="main">(</span>implc_sinvar <span class="skolem">m_impl</span><span class="main">)</span> <span class="skolem">fs</span> <span class="skolem">keeps</span> <span class="free">G</span> <span class="main">=</span>
            TopoS_withOffendingFlows.minimalize_offending_overapprox <span class="main">(</span>c_sinvar <span class="skolem">m_spec</span><span class="main">)</span> <span class="skolem">fs</span> <span class="skolem">keeps</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">for</span></span> <span class="skolem">fs</span> <span class="skolem">keeps</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span>  <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> minimalize_offending_overapprox_spec<span class="main">:</span>
         <span class="quoted"><span class="quoted">"TopoS_Interface_impl.minimalize_offending_overapprox <span class="main">(</span>implc_sinvar <span class="skolem">m_impl</span><span class="main">)</span> <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">[]</span> <span class="free">G</span> <span class="main">=</span>
          TopoS_withOffendingFlows.minimalize_offending_overapprox <span class="main">(</span>c_sinvar <span class="skolem">m_spec</span><span class="main">)</span> <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">[]</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      
      <span class="keyword1"><span class="command">from</span></span> Cons <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> m m_impl m_spec<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI impI<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> impl_spec<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> impl_spec<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> delete_edges_correct<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def FiniteGraph.delete_edges_simp2<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> minimalize_offending_overapprox_spec<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

<span class="comment1">(*
subsection{*generate valid topology*}
  text{*tuned for invariants where we don't want to calculate all offending flows*}

  fun generate_valid_topology_SOME :: "'v SecurityInvariant list ⇒ 'v list_graph ⇒ ('v list_graph)" where
    "generate_valid_topology_SOME [] G = G" |
    "generate_valid_topology_SOME (m#Ms) G = (if implc_sinvar m G
      then generate_valid_topology_SOME Ms G
      else delete_edges (generate_valid_topology_SOME Ms G) (minimalize_offending_overapprox (implc_sinvar m) (edgesL G) [] G)
      )"

  thm TopoS_Composition_Theory.generate_valid_topology_SOME_sound

  (*TODO: show conformance to generate_valid_topology_some_sound*)
  (*TODO: won't work because of the SOME!
    I will probably have to show something like
       all_security_requirements_fulfilled (get_impl M) (generate_valid_topology_SOME (get_impl M) G)
    How can I do this without copy&amp;pasting the proof of the spec?*)
  lemma generate_valid_topology_SOME_complies:
    "⟦ ∀ (m_impl, m_spec) ∈ set M. SecurityInvariant_complies_formal_def m_impl m_spec;
       wf_list_graph (G::('v list_graph)) ⟧ ⟹ 
       list_graph_to_graph (generate_valid_topology_SOME (get_impl M) G) = 
       TopoS_Composition_Theory.generate_valid_topology_SOME (get_spec M) (list_graph_to_graph G)"
    proof(induction M)
    case Nil thus ?case by(simp add: get_spec_def get_impl_def)
    next
    case (Cons m M)
      obtain m_impl m_spec where m: "m = (m_impl, m_spec)" by(cases m) blast
      from m have m_impl: "get_impl ((m_impl, m_spec) # M) = m_impl # (get_impl M)" by (simp add: get_impl_def) 
      from m have m_spec: "get_spec ((m_impl, m_spec) # M) = m_spec # (get_spec M)" by (simp add: get_spec_def) 
      
      from Cons.prems(1) m have complies_formal_def:  "SecurityInvariant_complies_formal_def m_impl m_spec" by simp
      with Cons.prems(2) have impl_spec: "implc_sinvar m_impl G ⟷  c_sinvar m_spec (list_graph_to_graph G)"
        by (simp add: SecurityInvariant_complies_formal_def_def)
      
      (*from minimalize_offending_overapprox_gives_some_offending_flow
      have "set (minimalize_offending_overapprox (implc_sinvar m_impl) (edgesL G) [] G)
        ∈ SecurityInvariant_withOffendingFlows.set_offending_flows (c_sinvar_m_spec_bound_to_nP) (list_graph_to_graph G) nP" sorry
      *)

      have my_todo: "set (minimalize_offending_overapprox (implc_sinvar m_impl) (edgesL G) [] G)
        ∈ c_offending_flows m_spec (list_graph_to_graph G)" sorry
      
      from my_todo[simplified list_graph_to_graph_def] have how_do_i_solve_this:
      "set (minimalize_offending_overapprox (implc_sinvar m_impl) (edgesL G) [] G) =
       (SOME F. F ∈ c_offending_flows m_spec ⦇nodes = set (nodesL G), edges = set (edgesL G)⦈)" sorry
      
      from Cons show ?case
        apply(simp)
        apply(simp add: m m_impl m_spec)
        apply(intro conjI impI)
          apply (simp add: impl_spec; fail)
         apply (simp add: impl_spec; fail)
        apply(simp add: delete_edges_correct[symmetric])
        apply(simp add: list_graph_to_graph_def FiniteGraph.delete_edges_simp2)
        using how_do_i_solve_this by simp
    qed
*)</span>

    
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Stateful_Policy_Algorithm">
<div class="head">
<h1>Theory TopoS_Stateful_Policy_Algorithm</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Stateful_Policy_Algorithm
<span class="keyword2"><span class="keyword">imports</span></span> <a href="TopoS_Stateful_Policy.html">TopoS_Stateful_Policy</a> <a href="TopoS_Composition_Theory.html">TopoS_Composition_Theory</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Stateful Policy -- Algorithm›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Some unimportant lemmata›</span></span>
  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-False_set"><span class="command">lemma</span></span> False_set<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">{</span><span class="main">(</span><span class="bound">r</span><span class="main">,</span> <span class="bound">s</span><span class="main">)</span><span class="main">.</span> False<span class="main">}</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-valid_reqs_ACS_D"><span class="command">lemma</span></span> valid_reqs_ACS_D<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span> <span class="main">⟹</span> valid_reqs <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_reqs_def get_ACS_def<span class="main">)</span>
  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-valid_reqs_IFS_D"><span class="command">lemma</span></span> valid_reqs_IFS_D<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span> <span class="main">⟹</span> valid_reqs <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_reqs_def get_IFS_def<span class="main">)</span>
  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-all_security_requirements_fulfilled_ACS_D"><span class="command">lemma</span></span> all_security_requirements_fulfilled_ACS_D<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span> <span class="main">⟹</span>
    all_security_requirements_fulfilled <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def get_ACS_def<span class="main">)</span>
  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-all_security_requirements_fulfilled_IFS_D"><span class="command">lemma</span></span> all_security_requirements_fulfilled_IFS_D<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span> <span class="main">⟹</span>
    all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="free">G</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def get_IFS_def<span class="main">)</span>
  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-all_security_requirements_fulfilled_mono_stateful_policy_to_network_graph"><span class="command">lemma</span></span> all_security_requirements_fulfilled_mono_stateful_policy_to_network_graph<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_reqs <span class="free">M</span><span class="main">;</span> <span class="free">E'</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">;</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">Efix</span> <span class="main">∪</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">⟧</span> <span class="main">⟹</span>  
        all_security_requirements_fulfilled <span class="free">M</span> 
          <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">Efix</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">)</span><span class="main">⟹</span>
        all_security_requirements_fulfilled <span class="free">M</span> 
          <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">Efix</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">E'</span> <span class="main">⦈</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> all_security_requirements_fulfilled_mono<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> E<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">Efix</span></span> <span class="main"><span class="main">∪</span></span> <span class="free"><span class="free">E</span></span> <span class="main"><span class="main">∪</span></span> backflows <span class="free"><span class="free">E</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> E'<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">Efix</span></span> <span class="main"><span class="main">∪</span></span> <span class="free"><span class="free">E'</span></span> <span class="main"><span class="main">∪</span></span> backflows <span class="free"><span class="free">E'</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> V<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">V</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"wf_graph <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">G</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="skolem">M</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">M</span> <span class="skolem">G</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="skolem">M</span> <span class="skolem">G</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">for</span></span></span> <span class="skolem">M</span> <span class="skolem">G</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> <span class="main">[</span><span class="main">[</span><span class="operator">simproc</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> finite_Collect<span class="main">]</span><span class="main">]</span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Sketch for generating a stateful policy from a simple directed policy›</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Having no stateful flows, we trivially get a valid stateful policy.›</span></span>
    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-trivial_stateful_policy_compliance"><span class="command">lemma</span></span> trivial_stateful_policy_compliance<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span> valid_reqs <span class="free">M</span><span class="main">;</span> all_security_requirements_fulfilled <span class="free">M</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">⟧</span> <span class="main">⟹</span> 
      stateful_policy_compliance <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="main">{}</span> <span class="main">⦈</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">M</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
                   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def stateful_policy_to_network_graph_def all_flows_def backflows_def False_set<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_IFS_def get_ACS_def all_security_requirements_fulfilled_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> valid_reqs_ACS_D<span class="main">)</span> 
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span> all_security_requirements_fulfilled_ACS_D<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> all_security_requirements_fulfilled_imp_get_offending_empty<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹trying better›</span></span>

    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹First, filtering flows that cause no IFS violations›</span></span>
    <span class="comment1">(*the edges front of the list are more likely to be kept*)</span>
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">filter_IFS_no_violations_accu</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span><span class="main">::</span>vertex graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_IFS_no_violations_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span>"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_IFS_no_violations_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span>
        all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accu</span></span></span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="free">filter_IFS_no_violations_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accu</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span>
        <span class="keyword1">else</span> <span class="free">filter_IFS_no_violations_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">filter_IFS_no_violations</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span><span class="main">::</span>vertex graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_IFS_no_violations</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span> <span class="main">=</span> filter_IFS_no_violations_accu <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span>"</span></span>


    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_IFS_no_violations_subseteq_input"><span class="command">lemma</span></span> filter_IFS_no_violations_subseteq_input<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">Es</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">Es</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">accu</span><span class="main">.</span> set <span class="main">(</span>filter_IFS_no_violations_accu <span class="free">G</span> <span class="free">M</span> <span class="bound">accu</span> <span class="free">Es</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">Es</span> <span class="main">∪</span> set <span class="bound">accu</span>"</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_IFS_no_violations_def<span class="main">)</span>
    <span class="keyword1"><span class="command">unfolding</span></span> filter_IFS_no_violations_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Es</span></span></span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">force</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_IFS_no_violations_accu_correct_induction"><span class="command">lemma</span></span> filter_IFS_no_violations_accu_correct_induction<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">⟹</span>
            all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="free">accu</span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span> <span class="main">⟹</span> 
            <span class="main">(</span>set <span class="free">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> 
            all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span>filter_IFS_no_violations_accu <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">M</span> <span class="free">accu</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">edgesList</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">accu</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_IFS_no_violations_correct"><span class="command">lemma</span></span> filter_IFS_no_violations_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>valid_reqs <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span><span class="main">;</span> wf_graph <span class="free">G</span><span class="main">;</span>
            all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="free">G</span><span class="main">;</span> 
            <span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> 
            all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filter_IFS_no_violations_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter_IFS_no_violations_accu_correct_induction<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> accu<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def backflows_def False_set<span class="main">)</span>
    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_IFS_no_violations_accu_no_IFS"><span class="command">lemma</span></span> filter_IFS_no_violations_accu_no_IFS<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span> wf_graph <span class="free">G</span> <span class="main">⟹</span> get_IFS <span class="free">M</span> <span class="main">=</span> <span class="main">[]</span> <span class="main">⟹</span>
            <span class="main">(</span>set <span class="free">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">⟹</span> 
            filter_IFS_no_violations_accu <span class="free">G</span> <span class="free">M</span> <span class="free">accu</span> <span class="free">edgesList</span> <span class="main">=</span> rev<span class="main">(</span><span class="free">edgesList</span><span class="main">)</span><span class="main">@</span><span class="free">accu</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">edgesList</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">accu</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>


    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_IFS_no_violations_accu_maximal_induction"><span class="command">lemma</span></span> filter_IFS_no_violations_accu_maximal_induction<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">⟹</span> 
      set <span class="free">accu</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> set <span class="free">edgesList</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span>
        <span class="main">∀</span> <span class="bound">e</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="free">accu</span> <span class="main">∪</span> set <span class="free">edgesList</span><span class="main">)</span><span class="main">.</span>
            <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span> <span class="main">∪</span> <span class="main">(</span>set <span class="free">accu</span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span>
         <span class="main">⟹</span>
           <span class="keyword1">let</span> <span class="bound">stateful</span> <span class="main">=</span> set <span class="main">(</span>filter_IFS_no_violations_accu <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">M</span> <span class="free">accu</span> <span class="free">edgesList</span><span class="main">)</span> <span class="keyword1">in</span>
            <span class="main">(</span><span class="main">∀</span> <span class="bound">e</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> <span class="bound">stateful</span><span class="main">.</span>
            <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">stateful</span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">edgesList</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">accu</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span><span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">Es</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"fst <span class="main">`</span> set <span class="skolem">accu</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"snd <span class="main">`</span> set <span class="skolem">accu</span> <span class="main">⊆</span> <span class="free">V</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
        <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const</span> wf_graph<span class="antiquote">}</span></span> for some complicated structures›</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> this Cons.prems<span class="main">(</span>4<span class="main">)</span>  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ea</span><span class="main">.</span> <span class="bound">ea</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> backflows_wf<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> wf_graph_union_edges<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ea</span><span class="main">.</span> <span class="bound">ea</span><span class="main">∈</span><span class="free">E</span>  <span class="main">⟹</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ea</span><span class="main">.</span> <span class="bound">ea</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⦈</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>3<span class="main"><span class="main">)</span></span> sup.order_iff<span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this Cons.prems<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ea</span><span class="main">.</span> <span class="bound">ea</span><span class="main">∈</span><span class="free">E</span> <span class="main">⟹</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> insert_absorb<span class="main">)</span>
        <span class="keyword1"><span class="command">hence</span></span> validgraph1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ea</span><span class="main">.</span> <span class="bound">ea</span><span class="main">∈</span><span class="free">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> set <span class="skolem">Es</span><span class="main">)</span> <span class="main">⟹</span> 
          wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> validgraph2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">ea</span><span class="main">.</span> 
         insert <span class="bound">ea</span> <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        
        <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_mono<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> validgraph2 validgraph1<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> neg_mono<span class="main">:</span>
            <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ea</span><span class="main">.</span> <span class="bound">ea</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> set <span class="skolem">Es</span><span class="main">)</span> <span class="main">⟹</span>
         <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> 
            <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="bound">ea</span> <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>
         <span class="main">⟹</span>
         <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> 
            <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="bound">ea</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

         <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">ea</span><span class="main">.</span> <span class="bound">ea</span><span class="main">∈</span><span class="free">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> set <span class="skolem">Es</span><span class="main">)</span> <span class="main">⟹</span>
          <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph 
              <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="main">{</span><span class="bound">ea</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">ea</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def stateful_policy.select_convs<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> neg_mono<span class="main"><span class="main">[</span></span><span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command">hence</span></span> goalTrue<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">ea</span><span class="main">∈</span><span class="free">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> set <span class="skolem">Es</span><span class="main">)</span><span class="main">.</span> 
            <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> 
                <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="main">{</span><span class="bound">ea</span><span class="main">}</span> <span class="main">∪</span> set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
         
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>

         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">_</span>"</span></span><span class="main">)</span> <span class="comment1">(*dont't need it*)</span>
         <span class="keyword1"><span class="command">using</span></span> Cons.IH<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> accu<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> _ _ goalTrue<span class="main">,</span> <span class="operator">simplified</span> Let_def<span class="main">]</span> Cons.prems<span class="main">(</span>3<span class="main">)</span> Cons.prems<span class="main">(</span>4<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span> <span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>

        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> Cons.IH<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> accu<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="skolem">accu</span>"</span></span><span class="main">,</span> <span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">,</span> <span class="operator">simplified</span> Let_def<span class="main">]</span> Cons.prems<span class="main">(</span>5<span class="main">)</span> Cons.prems<span class="main">(</span>3<span class="main">)</span> Cons.prems<span class="main">(</span>4<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
     <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_IFS_no_violations_maximal"><span class="command">lemma</span></span> filter_IFS_no_violations_maximal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span>valid_reqs <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span><span class="main">;</span> wf_graph <span class="free">G</span><span class="main">;</span>
            <span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span> 
            <span class="keyword1">let</span> <span class="bound">stateful</span> <span class="main">=</span> set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="keyword1">in</span> 
            <span class="main">∀</span> <span class="bound">e</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">-</span> <span class="bound">stateful</span><span class="main">.</span>
              <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">stateful</span> <span class="main">⦈</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filter_IFS_no_violations_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter_IFS_no_violations_accu_maximal_induction<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> accu<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword"><span class="quasi_keyword">and</span></span></span></span> edgesList<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="free"><span class="free">edgesList</span></span>"</span></span></span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

    <span class="comment1">― ‹It is not only maximal for single flows but all non-empty subsets›</span>
    <span class="keyword1"><span class="command">corollary</span></span> filter_IFS_no_violations_maximal_allsubsets<span class="main">:</span> 
    <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     a2<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">and</span></span>     a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">stateful</span> <span class="main">=</span> set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="keyword1">in</span> 
            <span class="main">∀</span> <span class="bound"><span class="bound">E</span></span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">-</span> <span class="bound">stateful</span><span class="main">.</span> <span class="bound">E</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟶</span>
              <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="bound">E</span> <span class="main">∪</span> <span class="bound">stateful</span> <span class="main">⦈</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?stateful</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> filter_IFS_no_violations_maximal<span class="main">[</span><span class="operator">OF</span> a1 a2 a4<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> not_fulfilled_single<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">∈</span>edges <span class="free">G</span> <span class="main">-</span> <span class="var">?stateful</span><span class="main">.</span> <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span>
                <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span> <span class="main">∪</span> <span class="var">?stateful</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> neg_mono<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">e</span> <span class="bound">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> <span class="bound">E</span> <span class="main">⟹</span> <span class="bound">E</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">-</span> <span class="var">?stateful</span> <span class="main">⟹</span> <span class="bound">E</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span>
          <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> 
              <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span> <span class="main">∪</span> <span class="var">?stateful</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⟹</span> 
          <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> 
              <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="bound">E</span> <span class="main">∪</span> <span class="var">?stateful</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
          <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span> <span class="skolem">E</span>
          <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">E</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>    h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">-</span> <span class="var">?stateful</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>    h3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>    h4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> 
            <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span> <span class="main">∪</span> <span class="var">?stateful</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  
          <span class="keyword1"><span class="command">from</span></span> filter_IFS_no_violations_subseteq_input a4 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="var">?stateful</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"edges <span class="free">G</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> <span class="var">?stateful</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> h2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">from</span></span> a2 this <span class="keyword1"><span class="command">have</span></span> validgraph1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> <span class="var">?stateful</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
  
          <span class="keyword1"><span class="command">from</span></span> h1 h2 h3 <span class="keyword1"><span class="command">have</span></span> subseteq<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">{</span><span class="skolem">e</span><span class="main">}</span> <span class="main">∪</span> <span class="var">?stateful</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> <span class="var">?stateful</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

          <span class="keyword1"><span class="command">have</span></span> revimp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">A</span> <span class="bound">B</span><span class="main">.</span> <span class="main">(</span><span class="bound">A</span> <span class="main">⟹</span> <span class="bound">B</span><span class="main">)</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">¬</span> <span class="bound">B</span> <span class="main">⟹</span> <span class="main">¬</span> <span class="bound">A</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
          
          <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_mono_stateful_policy_to_network_graph<span class="main">[</span><span class="operator">OF</span> a1 subseteq validgraph1<span class="main">]</span> h4
          <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> 
            <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="skolem">E</span> <span class="main">∪</span> <span class="var">?stateful</span><span class="main">⦈</span><span class="main">)</span>"</span></span> 
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> revimp<span class="main">)</span>
            <span class="keyword1"><span class="command">by</span></span> <span class="operator">assumption</span>
        <span class="keyword1"><span class="command">qed</span></span>
      
      <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> allI<span class="main"><span class="keyword3">,</span></span><span class="operator">rule</span> impI<span class="main"><span class="keyword3">,</span></span> <span class="operator">rule</span> impI<span class="main">)</span>
        <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">E</span>
        <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">-</span> <span class="var">?stateful</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>    h2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>

        <span class="keyword1"><span class="command">from</span></span>  h1 h2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">e</span></span> <span class="keyword2"><span class="keyword">where</span></span> e_prop1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span> 
        <span class="keyword1"><span class="command">from</span></span> this h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> edges <span class="free">G</span> <span class="main">-</span> <span class="var">?stateful</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">from</span></span> this not_fulfilled_single <span class="keyword1"><span class="command">have</span></span> e_prop2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span>
          <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span> <span class="main">∪</span> <span class="var">?stateful</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        
        <span class="keyword1"><span class="command">from</span></span> neg_mono<span class="main">[</span><span class="operator">OF</span> e_prop1 h1 h2 e_prop2<span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">" <span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span>
               <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="skolem">E</span> <span class="main">∪</span> set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">qed</span></span>
    <span class="keyword1"><span class="command">qed</span></span>
    
    <span class="comment1">― ‹soundness and completeness›</span>
    <span class="keyword1"><span class="command">thm</span></span> filter_IFS_no_violations_correct filter_IFS_no_violations_maximal





  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Next›</span></span>
    <span class="comment1">(*"∀F ∈ get_offending_flows (get_ACS M) (stateful_policy_to_network_graph 𝒯 ). F ⊆ backflows (filternew_flows_state 𝒯)"*)</span>
    <span class="comment1">(*first in list are more likely to be kept*)</span>
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">filter_compliant_stateful_ACS_accu</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span><span class="main">::</span>vertex graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_compliant_stateful_ACS_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span>"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_compliant_stateful_ACS_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span>
        <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∉</span> backflows <span class="main">(</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accu</span></span></span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>set <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accu</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="free">filter_compliant_stateful_ACS_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accu</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span>
        <span class="keyword1">else</span> <span class="free">filter_compliant_stateful_ACS_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">filter_compliant_stateful_ACS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span><span class="main">::</span>vertex graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_compliant_stateful_ACS</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span> <span class="main">=</span> filter_compliant_stateful_ACS_accu <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span>"</span></span>


    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_compliant_stateful_ACS_subseteq_input"><span class="command">lemma</span></span> filter_compliant_stateful_ACS_subseteq_input<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="free">Es</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">Es</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">accu</span><span class="main">.</span> set <span class="main">(</span>filter_compliant_stateful_ACS_accu <span class="free">G</span> <span class="free">M</span> <span class="bound">accu</span> <span class="free">Es</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">Es</span> <span class="main">∪</span> set <span class="bound">accu</span>"</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> allE<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_compliant_stateful_ACS_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induct_tac</span> <span class="quoted"><span class="free"><span class="quoted"><span class="free">Es</span></span></span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Un_insert_right set_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> set_subset_Cons set_union subset_trans<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_compliant_stateful_ACS_accu_correct_induction"><span class="command">lemma</span></span> filter_compliant_stateful_ACS_accu_correct_induction<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="main">⟹</span>
            <span class="main">(</span>set <span class="free">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">⟹</span> 
            <span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="free">accu</span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>set <span class="free">accu</span><span class="main">)</span> <span class="main">⟹</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">accu</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∉</span> <span class="main">(</span>backflows <span class="free">E</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
            <span class="free">𝒯</span> <span class="main">=</span> <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span>filter_compliant_stateful_ACS_accu <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">M</span> <span class="free">accu</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">⦈</span> <span class="main">⟹</span>
            <span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">edgesList</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">accu</span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">case</span></span> Nil
          <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span> <span class="main">=</span> backflows <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> set <span class="skolem">accu</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> backflows <span class="free">E</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">)</span></span> Collect_cong Collect_mem_eq<span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> this Nil<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span><span class="main">⦈</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> set <span class="skolem">accu</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> backflows <span class="free">E</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">from</span></span> this Nil<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_alt2<span class="main">)</span>
        <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">Es</span><span class="main">)</span>
          <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">]</span> Cons.prems<span class="main">(</span>3<span class="main">)</span> Cons.prems<span class="main">(</span>4<span class="main">)</span> Cons.prems<span class="main">(</span>5<span class="main">)</span> Cons.prems<span class="main">(</span>6<span class="main">)</span>
          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_alt2 <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
      <span class="keyword1"><span class="command">qed</span></span>

    
    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_compliant_stateful_ACS_accu_no_side_effects"><span class="command">lemma</span></span> filter_compliant_stateful_ACS_accu_no_side_effects<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span> wf_graph <span class="free">G</span> <span class="main">⟹</span>
            <span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="main">(</span>backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span>
            <span class="main">(</span>set <span class="free">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">⟹</span> 
            <span class="main">(</span><span class="main">∀</span><span class="bound">a</span> <span class="main">∈</span> set <span class="free">accu</span><span class="main">.</span> <span class="bound">a</span> <span class="main">∉</span> <span class="main">(</span>backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟹</span>
            filter_compliant_stateful_ACS_accu <span class="free">G</span> <span class="free">M</span> <span class="free">accu</span> <span class="free">edgesList</span> <span class="main">=</span> rev<span class="main">(</span><span class="main">[</span> <span class="bound">e</span> <span class="main">←</span> <span class="free">edgesList</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">@</span><span class="free">accu</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_minus_backflows<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">edgesList</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">accu</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> impI<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">rename_tac</span> V E<span class="main">)</span>
      <span class="keyword1"><span class="command">thm</span></span> Un_set_offending_flows_bound_minus_subseteq'<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"backflows <span class="free">E</span> <span class="main">-</span> <span class="free">E</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> E<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∪</span> backflows <span class="free">E</span>"</span></span><span class="main">]</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule_tac</span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"backflows <span class="improper">E</span> <span class="main">-</span> <span class="improper">E</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> E<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">E</span> <span class="main">∪</span> backflows <span class="improper">E</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> E'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">E</span> <span class="main">∪</span> backflows <span class="improper">E</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>insert <span class="improper">a</span> <span class="main">(</span><span class="improper">E</span> <span class="main">∪</span> set <span class="improper">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="improper">a</span> <span class="main">(</span>set <span class="improper">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> Un_set_offending_flows_bound_minus_subseteq'<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">auto</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"<span class="improper">E</span> <span class="main">∪</span> backflows <span class="improper">E</span> <span class="main">-</span> <span class="main">(</span><span class="improper">E</span> <span class="main">∪</span> backflows <span class="improper">E</span> <span class="main">-</span> insert <span class="improper">a</span> <span class="main">(</span><span class="improper">E</span> <span class="main">∪</span> set <span class="improper">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="improper">a</span> <span class="main">(</span>set <span class="improper">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> insert <span class="improper">a</span> <span class="main">(</span><span class="improper">E</span> <span class="main">∪</span> set <span class="improper">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="improper">a</span> <span class="main">(</span>set <span class="improper">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">prefer</span></span></span></span> 2
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> Un_assoc Un_least Un_mono backflows_subseteq double_diff insert_def insert_subset subset_refl<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subgoal_tac</span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span>insert <span class="improper">a</span> <span class="main">(</span>set <span class="improper">accu</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="improper">E</span> <span class="main">-</span> <span class="improper">E</span> <span class="main">-</span> <span class="main">(</span><span class="improper">E</span> <span class="main">∪</span> backflows <span class="improper">E</span> <span class="main">-</span> insert <span class="improper">a</span> <span class="main">(</span><span class="improper">E</span> <span class="main">∪</span> set <span class="improper">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="improper">a</span> <span class="main">(</span>set <span class="improper">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">using</span></span> FiniteGraph.backflows_wf FiniteGraph.wf_graph_union_edges <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>



    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_compliant_stateful_ACS_correct"><span class="command">lemma</span></span> filter_compliant_stateful_ACS_correct<span class="main">:</span> 
      <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>     a2<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>     a3<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="free">edgesList</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span>  
      <span class="keyword2"><span class="keyword">and</span></span>     a4<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="free">G</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span>     a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒯</span> <span class="main">=</span> <span class="main">⦇</span> hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">⦈</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span>   <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
        <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">V</span></span> <span class="skolem"><span class="skolem">E</span></span> <span class="keyword2"><span class="keyword">where</span></span> VE<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">G</span> <span class="main">=</span> <span class="main">⦇</span> nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> VE a2 <span class="keyword1"><span class="command">have</span></span> wfVE<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> VE a3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="free">edgesList</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">from</span></span> a5 VE <span class="keyword1"><span class="command">have</span></span> a5'<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒯</span> <span class="main">=</span> <span class="main">⦇</span>hosts <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span>filter_compliant_stateful_ACS_accu <span class="main">⦇</span>nodes <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="free">M</span> <span class="main">[]</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
          <span class="keyword1"><span class="command">unfolding</span></span> filter_compliant_stateful_ACS_def
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_imp_get_offending_empty<span class="main">[</span><span class="operator">OF</span> a1 a4<span class="main">]</span> VE
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="skolem">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="main">{}</span><span class="main">⦈</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">{}</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def backflows_def False_set<span class="main">)</span>

        <span class="keyword1"><span class="command">from</span></span> filter_compliant_stateful_ACS_accu_correct_induction<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> accu<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> edgesList<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">edgesList</span>"</span></span><span class="main">,</span> <span class="operator">simplified</span><span class="main">,</span> <span class="operator">OF</span> a1 wfVE <span class="quoted"><span class="quoted">‹set <span class="free">edgesList</span> <span class="main">⊆</span> <span class="skolem">E</span>›</span></span> this a5'<span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
     <span class="keyword1"><span class="command">qed</span></span>


    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_compliant_stateful_ACS_accu_induction_maximal"><span class="command">lemma</span></span> filter_compliant_stateful_ACS_accu_induction_maximal<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_reqs <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span><span class="main">;</span>  wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span>
            <span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">;</span>
            <span class="main">(</span>set <span class="free">accu</span><span class="main">)</span> <span class="main">⊆</span> <span class="free">E</span><span class="main">;</span> 
            <span class="free">stateful</span> <span class="main">=</span> set <span class="main">(</span>filter_compliant_stateful_ACS_accu <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">M</span> <span class="free">accu</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">;</span>
            <span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="free">edgesList</span> <span class="main">∪</span> set <span class="free">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="free">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> backflows <span class="free">E</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
            <span class="main">¬</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="free">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="free">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span> <span class="main">⦈</span><span class="main">)</span>
            <span class="main">⟧</span> <span class="main">⟹</span>
            <span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="free">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> backflows <span class="free">E</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="comment1">⌦‹E - {computed stateful flows plus trivial stateful flows}›</span>
            <span class="main">¬</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span> <span class="main">⦈</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">edgesList</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">accu</span></span> <span class="quoted"><span class="free">E</span></span><span class="main">)</span>
   <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword1"><span class="command">from</span></span> Nil<span class="main">(</span>5<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> Nil<span class="main">(</span>6<span class="main">)</span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command">next</span></span>
   <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">a</span> <span class="skolem">Es</span><span class="main">)</span>
     <span class="comment1">― ‹case distinction›</span>
     <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?caseDistinction</span></span></span><span class="main">=</span><span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> backflows <span class="main">(</span><span class="skolem">E</span><span class="main">)</span> <span class="main">∧</span>  <span class="main">(</span><span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span>
                 <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">.</span>
                    <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
     <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">Es</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

     <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">cases</span> <span class="var"><span class="quoted"><span class="var">?caseDistinction</span></span></span><span class="main">)</span>
        <span class="keyword3"><span class="command">assume</span></span> CaseTrue<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?caseDistinction</span></span></span>
        <span class="keyword1"><span class="command">from</span></span> CaseTrue <span class="keyword1"><span class="command">have</span></span> 
          <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_compliant_stateful_ACS_accu <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="free">M</span> <span class="skolem">accu</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">Es</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
           set <span class="main">(</span>filter_compliant_stateful_ACS_accu <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="free">M</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="skolem">Es</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command">from</span></span> this Cons.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> statefulsimp<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="free">stateful</span> <span class="main">=</span> set <span class="main">(</span>filter_compliant_stateful_ACS_accu <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="free">M</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="skolem">Es</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> Cons.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">∈</span><span class="skolem">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="skolem">Es</span> <span class="main">∪</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="skolem">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> backflows <span class="skolem">E</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
     <span class="main">¬</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>
        <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ballI<span class="main">)</span>
            <span class="keyword3"><span class="command">fix</span></span> <span class="skolem">e</span>
            <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="skolem">Es</span> <span class="main">∪</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="skolem">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> backflows <span class="skolem">E</span><span class="main">}</span><span class="main">)</span>"</span></span>

            <span class="keyword1"><span class="command">from</span></span> conjunct1<span class="main">[</span><span class="operator">OF</span> CaseTrue<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> filternew_flows_state_moveout_a<span class="main">:</span>
              <span class="quoted"><span class="quoted">"filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">⦈</span> <span class="main">=</span> 
              <span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∪</span> filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">⦈</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_alt<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

            <span class="keyword1"><span class="command">have</span></span> backflowssubseta<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">X</span><span class="main">.</span> backflows <span class="bound">X</span> <span class="main">⊆</span> backflows <span class="main">(</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∪</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

            <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>6<span class="main">)</span> h1 <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">dat_offender</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
              dat_in<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword2"><span class="keyword">and</span></span> dat_offends<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">∉</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

            <span class="keyword1"><span class="command">have</span></span> wfGraphA<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> h1 Cons.prems<span class="main">(</span>3<span class="main">)</span> Cons.prems<span class="main">(</span>4<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes<span class="main">=</span><span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span> <span class="main">⦈</span>"</span></span> 
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
              <span class="keyword1"><span class="command">from</span></span> this backflows_wf
              <span class="keyword1"><span class="command">have</span></span> vgh1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
              <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> wf_graph_add_subset_edges h1  Cons.prems<span class="main">(</span>3<span class="main">)</span> Cons.prems<span class="main">(</span>4<span class="main">)</span>
              <span class="keyword1"><span class="command">have</span></span> vgh2<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span><span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">E</span><span class="main">)</span> <span class="main">∪</span> set <span class="skolem">accu</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
                <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
                  <span class="keyword1"><span class="command">have</span></span> f1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="skolem">Es</span> <span class="main">∪</span> insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">R</span></span> <span class="main">∈</span> <span class="skolem">E</span><span class="main">.</span> <span class="bound">R</span> <span class="main">∈</span> backflows <span class="skolem">E</span><span class="main">}</span><span class="main">)</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> h1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> f2<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">E</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
                  <span class="keyword1"><span class="command">have</span></span> f3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∈</span> <span class="skolem">E</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> f1 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">E</span> <span class="main">∪</span> insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span> <span class="main">=</span> <span class="skolem">E</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> f2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                  <span class="keyword3"><span class="command">thus</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="skolem">E</span> <span class="main">∪</span> set <span class="skolem">accu</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
                    <span class="keyword1"><span class="command">using</span></span> f3 Cons.prems<span class="main">(</span>2<span class="main">)</span> Un_insert_right insert_absorb sup_commute <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
                <span class="keyword1"><span class="command">qed</span></span>
              <span class="keyword1"><span class="command">from</span></span> vgh1 vgh2 wf_graph_union_edges
              <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
           <span class="keyword1"><span class="command">qed</span></span>
            
            <span class="keyword1"><span class="command">from</span></span> dat_in <span class="keyword1"><span class="command">have</span></span> dat_in_simplified<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def<span class="main">)</span>

            <span class="keyword1"><span class="command">have</span></span> subsethlp<span class="main">:</span> <span class="quoted"><span class="quoted">"insert <span class="skolem">e</span> <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">E</span> <span class="main">∪</span> <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">)</span> <span class="main">∪</span> backflows <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

            <span class="keyword1"><span class="command">from</span></span> get_offending_flows_union_mono<span class="main">[</span><span class="operator">OF</span> 
                Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> 
                wfGraphA<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> stateful_policy_to_network_graph_def all_flows_def graph.select_convs stateful_policy.select_convs<span class="main"><span class="main">]</span></span><span class="main">,</span>
                <span class="operator">OF</span> subsethlp<span class="main">]</span>
            dat_in_simplified <span class="keyword1"><span class="command">have</span></span> dat_in_a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">∈</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> 
              <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fast</span><span class="main">)</span>

            <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">≠</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">,</span> fst <span class="skolem">a</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
              <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="skolem">dat_offender</span> <span class="main">≠</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">,</span> fst <span class="skolem">a</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command">hence</span></span> hlpassm<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">=</span> <span class="main">(</span>snd <span class="skolem">a</span><span class="main">,</span> fst <span class="skolem">a</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> this <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">a1</span></span> <span class="skolem"><span class="skolem">a2</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">=</span> <span class="main">(</span><span class="skolem">a2</span><span class="main">,</span> <span class="skolem">a1</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              
              
              <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> 
                  insert <span class="skolem">e</span> <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Sup_le_iff get_offending_flows_subseteq_edges<span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> this h1 <span class="keyword1"><span class="command">have</span></span> UN_get_subset<span class="main">:</span> 
                    <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> insert <span class="skolem">e</span> <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> 
                   <span class="main">(</span><span class="skolem">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

            <span class="keyword1"><span class="command">from</span></span> dat_offends <span class="keyword1"><span class="command">have</span></span> dat_offends_simplified<span class="main">:</span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">∉</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">E</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> filternew_flows_state_alt stateful_policy.select_convs backflows_minus_backflows<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
              
              <span class="keyword1"><span class="command">from</span></span> conjunct1<span class="main">[</span><span class="operator">OF</span> CaseTrue<span class="main">]</span> hlpassm <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">∉</span> <span class="skolem">E</span>"</span></span>
                <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
              <span class="keyword1"><span class="command">from</span></span> dat_in_simplified UN_get_subset this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">∈</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">from</span></span> this Cons.prems<span class="main">(</span>4<span class="main">)</span> <span class="quoted"><span class="quoted">‹<span class="skolem">dat_offender</span> <span class="main">∉</span> <span class="skolem">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">∈</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
              <span class="keyword1"><span class="command">from</span></span> dat_offends_simplified<span class="main">[</span><span class="operator">simplified</span><span class="main">]</span> this <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">∈</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
              <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">dat_offender</span> <span class="main">∉</span> <span class="skolem">E</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">dat_offender</span> <span class="main">∈</span> <span class="skolem">E</span>›</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
            <span class="keyword1"><span class="command">qed</span></span>

            <span class="keyword1"><span class="command">from</span></span> this dat_offends <span class="keyword1"><span class="command">have</span></span> 
              <span class="quoted"><span class="quoted">"<span class="skolem">dat_offender</span> <span class="main">∉</span> backflows <span class="main">(</span><span class="main">{</span><span class="skolem">a</span><span class="main">}</span> <span class="main">∪</span> filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
              <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

            <span class="keyword1"><span class="command">from</span></span> dat_in_a this
            <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>
            <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> filternew_flows_state_moveout_a<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
          <span class="keyword1"><span class="command">qed</span></span>

        <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">Es</span> <span class="main">⊆</span> <span class="skolem">E</span>›</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> <span class="skolem">E</span>›</span></span> statefulsimp this <span class="main">]</span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"<span class="var">?case</span>"</span></span> 
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
        <span class="keyword3"><span class="command">assume</span></span> CaseFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?caseDistinction</span>"</span></span>

        <span class="keyword1"><span class="command">from</span></span> CaseFalse <span class="keyword1"><span class="command">have</span></span> funapplysimp<span class="main">:</span> 
          <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_compliant_stateful_ACS_accu <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="free">M</span> <span class="skolem">accu</span> <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">Es</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> 
           set <span class="main">(</span>filter_compliant_stateful_ACS_accu <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="free">M</span> <span class="skolem">accu</span> <span class="skolem">Es</span><span class="main">)</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
        <span class="keyword1"><span class="command">from</span></span> this Cons.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> statefulsimp<span class="main">:</span>
          <span class="quoted"><span class="quoted">"<span class="free">stateful</span> <span class="main">=</span> set <span class="main">(</span>filter_compliant_stateful_ACS_accu <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span><span class="main">⦈</span> <span class="free">M</span> <span class="skolem">accu</span> <span class="skolem">Es</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">accu</span> <span class="main">⊆</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="skolem">Es</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="skolem">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> backflows <span class="skolem">E</span><span class="main">}</span><span class="main">)</span><span class="main">⟹</span> <span class="main">¬</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main">)</span>
            <span class="keyword3"><span class="command">assume</span></span> h1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∈</span> <span class="skolem">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="skolem">Es</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="skolem">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> backflows <span class="skolem">E</span><span class="main">}</span><span class="main">)</span>"</span></span>
            <span class="keyword2"><span class="keyword">and</span></span>    <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">¬</span><span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">hence</span></span> hccontr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> stateful_to_graph<span class="main">:</span> <span class="quoted"><span class="quoted">"stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">⦈</span> <span class="main">=</span>  <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>
            <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">a</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> backflows <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">E</span>"</span></span>
              <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_alt backflows_minus_backflows<span class="main">)</span>
            <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> hccontr_simp<span class="main">:</span>
              <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

            <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> Cons.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> backaaccusubE<span class="main">:</span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">fastforce</span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> h1 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> backflows <span class="skolem">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
            <span class="keyword1"><span class="command">from</span></span> backaaccusubE <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∉</span> backflows <span class="skolem">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">a</span> <span class="main">∉</span> backflows <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


            <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">a</span> <span class="main">∉</span> backflows <span class="skolem">E</span>›</span></span> CaseFalse <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>set <span class="main">(</span><span class="skolem">a</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this stateful_to_graph <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="skolem">E</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> backflows <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>insert <span class="skolem">a</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
            <span class="keyword1"><span class="command">from</span></span> this hccontr_simp <span class="keyword3"><span class="command">show</span></span> <span class="quoted">False</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">qed</span></span>
        <span class="keyword1"><span class="command">from</span></span>  Cons.prems<span class="main">(</span>6<span class="main">)</span><span class="main">[</span><span class="operator">simplified</span> funapplysimp statefulsimp<span class="main">]</span> this
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">∈</span><span class="skolem">E</span> <span class="main">-</span> <span class="main">(</span>set <span class="skolem">Es</span> <span class="main">∪</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="skolem">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> backflows <span class="skolem">E</span><span class="main">}</span><span class="main">)</span><span class="main">.</span>
       <span class="main">¬</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="skolem">E</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="skolem">accu</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

        <span class="keyword1"><span class="command">from</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">Es</span> <span class="main">⊆</span> <span class="skolem">E</span>›</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">accu</span> <span class="main">⊆</span> <span class="skolem">E</span>›</span></span> statefulsimp this<span class="main">]</span>
        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">qed</span></span>
   <span class="keyword1"><span class="command">qed</span></span>






   

    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_compliant_stateful_ACS_maximal"><span class="command">lemma</span></span> filter_compliant_stateful_ACS_maximal<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> valid_reqs <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span><span class="main">;</span> wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span><span class="main">;</span>
            <span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> <span class="free">E</span><span class="main">;</span>
            <span class="free">stateful</span> <span class="main">=</span> set <span class="main">(</span>filter_compliant_stateful_ACS <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>
            <span class="main">⟧</span> <span class="main">⟹</span>
            <span class="main">∀</span><span class="bound">e</span> <span class="main">∈</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="free">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> backflows <span class="free">E</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="comment1">⌦‹E - {computed stateful flows plus trivial stateful flows}›</span>
            <span class="main">¬</span> <span class="main">⋃</span> <span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span> <span class="main">⦈</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">drule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter_compliant_stateful_ACS_accu_induction_maximal<span class="main"><span class="main">[</span></span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> accu<span class="main"><span class="main"><span class="main">=</span></span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">[]</span></span>"</span></span></span><span class="main"><span class="main">,</span></span> <span class="operator">simplified</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_compliant_stateful_ACS_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_compliant_stateful_ACS_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


    <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-filter_compliant_stateful_ACS_maximal_allsubsets"><span class="command">lemma</span></span> filter_compliant_stateful_ACS_maximal_allsubsets<span class="main">:</span>
      <span class="keyword2"><span class="keyword">assumes</span></span> a1<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> <span class="free">E</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">stateful</span> <span class="main">=</span> set <span class="main">(</span>filter_compliant_stateful_ACS <span class="main">⦇</span> nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">⦈</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">and</span></span> a5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> backflows <span class="free">E</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> a6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">≠</span> <span class="main">{}</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"
      <span class="main">¬</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span>
                <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span> hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span> <span class="main">⦈</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">rule</span> ccontr<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> a5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">⊆</span> <span class="free">E</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword3"><span class="command">assume</span></span> accontr<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">∪</span> backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def filternew_flows_state_alt backflows_minus_backflows<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> <span class="free">X</span> <span class="main">∪</span> backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> a4 a3 filter_compliant_stateful_ACS_subseteq_input <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_subset_conv Un_Diff_cancel Un_assoc a3 bot.extremum_unique sup_bot_right<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> accontr_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> <span class="main">(</span>backflows <span class="free">stateful</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>backflows <span class="free">X</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> Set.Un_absorb2<span class="main">[</span><span class="operator">OF</span> <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="free">E</span>›</span></span><span class="main">]</span> backflows_un<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="free">stateful</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_assoc<span class="main">)</span>
      
      <span class="keyword1"><span class="command">from</span></span> a2 a5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>full_types<span class="main"><span class="main">)</span></span> finite_Diff finite_subset<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> a6 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x</span></span> <span class="keyword2"><span class="keyword">where</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> a5 <span class="keyword1"><span class="command">have</span></span> xX_simp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>backflows <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span>  <span class="main">=</span> backflows <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">from</span></span> a5 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="free">X</span> <span class="main">∩</span> <span class="free">stateful</span> <span class="main">=</span> <span class="main">{}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> this <span class="keyword1"><span class="command">have</span></span> xX_simp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>backflows <span class="free">stateful</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span> <span class="main">=</span> backflows <span class="free">stateful</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">have</span></span> xX_simp3<span class="main">:</span><span class="quoted"><span class="quoted">"backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span> <span class="main">=</span> backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> backflows_un<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> xX_simp1 xX_simp2 <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> xX_simp4<span class="main">:</span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span> <span class="main">=</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_alt backflows_minus_backflows<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> xX_simp3 <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


      <span class="keyword1"><span class="command">have</span></span> xX_simp5<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">E</span> <span class="main">∪</span> backflows <span class="free">stateful</span> <span class="main">∪</span> backflows <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span> <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> backflows <span class="free">stateful</span> <span class="main">∪</span> backflows <span class="main">{</span><span class="skolem">x</span><span class="main">}</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> xX_simp3<span class="main">[</span><span class="operator">simplified</span> backflows_un<span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> Eexpand<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">E</span> <span class="main">∪</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span> <span class="main">=</span> <span class="free">E</span>"</span></span> 
      <span class="keyword1"><span class="command">using</span></span> a4 a3 filter_compliant_stateful_ACS_subseteq_input a5 <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span> <span class="main">-</span> backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span> <span class="main">-</span> backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹finite <span class="free">X</span>›</span></span> backflows_finite <span class="keyword1"><span class="command">have</span></span> finite<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">from</span></span> a2 a4 a3 filter_compliant_stateful_ACS_subseteq_input <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">stateful</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Diff_partition wf_graph_remove_edges_union<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> backflows_wf<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> backflows <span class="free">stateful</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> a2 <span class="quoted"><span class="quoted">‹<span class="free">X</span> <span class="main">⊆</span> <span class="free">E</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">X</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> double_diff dual_order.refl wf_graph_remove_edges<span class="main">)</span>
       <span class="keyword1"><span class="command">from</span></span> backflows_wf<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> backflows <span class="free">X</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> this wf_graph_union_edges <span class="quoted"><span class="quoted">‹wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> backflows <span class="free">stateful</span><span class="main">⦈</span>›</span></span> a2 <span class="keyword1"><span class="command">have</span></span> wfG<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> backflows <span class="free">stateful</span> <span class="main">∪</span> backflows <span class="free">X</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

      <span class="keyword1"><span class="command">from</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">x</span><span class="main">∈</span><span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> subset<span class="main">:</span> <span class="quoted"><span class="quoted">"backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span> <span class="main">⊆</span> <span class="free">E</span> <span class="main">∪</span> backflows <span class="free">stateful</span> <span class="main">∪</span> backflows <span class="free">X</span>"</span></span> <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

      <span class="keyword1"><span class="command">from</span></span> Un_set_offending_flows_bound_minus_subseteq'<span class="main">[</span><span class="operator">OF</span> a1 wfG subset accontr_simp<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">(</span><span class="free">E</span> <span class="main">∪</span> backflows <span class="free">stateful</span> <span class="main">∪</span> backflows <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="free">X</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span><span class="free">X</span> <span class="main">-</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span> <span class="main">-</span> <span class="free">E</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
      <span class="keyword1"><span class="command">from</span></span> this xX_simp4 xX_simp5 <span class="keyword1"><span class="command">have</span></span> trans1<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> backflows <span class="free">stateful</span> <span class="main">∪</span> backflows <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> <span class="free">V</span><span class="main">,</span> edges <span class="main">=</span> <span class="free">E</span> <span class="main">∪</span> backflows <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> backflows_un<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_assoc<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> contr1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def stateful_policy.select_convs<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> Eexpand <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_assoc<span class="main">)</span>
      

      <span class="keyword1"><span class="command">from</span></span> filter_compliant_stateful_ACS_maximal<span class="main">[</span><span class="operator">OF</span> a1 a2 a3 a4<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">e</span><span class="main">∈</span><span class="free">E</span> <span class="main">-</span> <span class="main">(</span><span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="bound"><span class="bound">e</span></span> <span class="main">∈</span> <span class="free">E</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∈</span> backflows <span class="free">E</span><span class="main">}</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="bound">e</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> this a5 <span class="quoted"><span class="quoted">‹<span class="skolem">x</span> <span class="main">∈</span> <span class="free">X</span>›</span></span> <span class="keyword1"><span class="command">have</span></span> contr2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">⋃</span><span class="main">(</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="main">⦇</span>hosts <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> <span class="free">E</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="free">stateful</span> <span class="main">∪</span> <span class="main">{</span><span class="skolem">x</span><span class="main">}</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="keyword1"><span class="command">from</span></span> contr1 contr2
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"False"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
    <span class="keyword1"><span class="command">qed</span></span>


    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">filter_compliant_stateful_ACS</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is correct and maximal›</span></span>
    <span class="keyword1"><span class="command">thm</span></span> filter_compliant_stateful_ACS_correct filter_compliant_stateful_ACS_maximal


    <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Getting those together. We cannot say <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>edgesList = E›</span></span></span></span> here because one filters first. I guess filtering ACS first is easier, ...›</span></span>










  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">generate_valid_stateful_policy_IFSACS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span><span class="main">::</span>vertex graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'v</span> stateful_policy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">generate_valid_stateful_policy_IFSACS</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">edgesList</span></span></span> <span class="main">≡</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">filterIFS</span> <span class="main">=</span> filter_IFS_no_violations <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">edgesList</span></span></span> <span class="keyword1">in</span>
        <span class="main">(</span><span class="keyword1">let</span> <span class="bound">filterACS</span> <span class="main">=</span> filter_compliant_stateful_ACS <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="bound">filterIFS</span> <span class="keyword1">in</span> <span class="main">⦇</span> hosts <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="bound">filterACS</span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-generate_valid_stateful_policy_IFSACS_wf_stateful_policy"><span class="command">lemma</span></span> generate_valid_stateful_policy_IFSACS_wf_stateful_policy<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>     edgesList<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
          <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf_stateful_policy <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span>  wfG <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_def wf_stateful_policy_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> edgesList filter_IFS_no_violations_subseteq_input filter_compliant_stateful_ACS_subseteq_input <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rev_subsetD<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>

   <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-generate_valid_stateful_policy_IFSACS_select_simps"><span class="command">lemma</span></span> generate_valid_stateful_policy_IFSACS_select_simps<span class="main">:</span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hosts <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"flows_fix <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"flows_state <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">edgesList</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"hosts <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"flows_fix <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"flows_state <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">edgesList</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> filter_IFS_no_violations_subseteq_input filter_compliant_stateful_ACS_subseteq_input <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> subset_trans<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-generate_valid_stateful_policy_IFSACS_all_security_requirements_fulfilled_IFS"><span class="command">lemma</span></span> generate_valid_stateful_policy_IFSACS_all_security_requirements_fulfilled_IFS<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> validReqs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>     wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>     high_level_policy_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>     edgesList<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span>
          <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">have</span></span> simp3<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_state <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> generate_valid_stateful_policy_IFSACS_select_simps<span class="main">(</span>3<span class="main">)</span> edgesList <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">using</span></span> filter_compliant_stateful_ACS_subseteq_input edgesList <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> backflows_subseteq this <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"backflows <span class="main">(</span>set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> backflows <span class="main">(</span>set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>
    <span class="keyword1"><span class="command">hence</span></span> subseteqhlp1<span class="main">:</span>
      <span class="quoted"><span class="quoted">"edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span>set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span>set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> high_level_policy_valid <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def get_IFS_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> filter_IFS_no_violations_correct<span class="main">[</span><span class="operator">OF</span> valid_reqs_IFS_D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validReqs<span class="main"><span class="main">]</span></span> wfG this edgesList<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword1"><span class="command">from</span></span> this edgesList <span class="keyword1"><span class="command">have</span></span> goalIFS<span class="main">:</span>
        <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span>set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Un_absorb2 filter_IFS_no_violations_subseteq_input order_trans<span class="main">)</span>


      <span class="keyword1"><span class="command">from</span></span>  wfG filter_IFS_no_violations_subseteq_input<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> Es<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">edgesList</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> G<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> M<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="free">M</span>"</span></span><span class="main">]</span> edgesList <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> le_iff_sup wf_graph_remove_edges_union<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> backflows_wf<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>
        <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> backflows <span class="main">(</span>set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this wf_graph_union_edges wfG <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span>set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> graph.cases graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> graph.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_mono<span class="main">[</span><span class="operator">OF</span> valid_reqs_IFS_D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validReqs<span class="main"><span class="main">]</span></span> subseteqhlp1 this goalIFS<span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span>set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">.</span></span>
      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def generate_valid_stateful_policy_IFSACS_select_simps simp3 Un_absorb2<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_def<span class="main">)</span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">theorem</span></span> generate_valid_stateful_policy_IFSACS_stateful_policy_compliance<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> validReqs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     high_level_policy_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     edgesList<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     Tau<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒯</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"stateful_policy_compliance <span class="free">𝒯</span> <span class="free">G</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_stateful_policy <span class="free">𝒯</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tau<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_wf_stateful_policy<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wfG edgesList<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_stateful_policy <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_wf_stateful_policy<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wfG edgesList<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"hosts <span class="free">𝒯</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tau<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_select_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_fix <span class="free">𝒯</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tau<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_select_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">" all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tau<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> generate_valid_stateful_policy_IFSACS_all_security_requirements_fulfilled_IFS<span class="main">[</span><span class="operator">OF</span> validReqs wfG high_level_policy_valid<span class="main">]</span> edgesList <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> filter_compliant_stateful_ACS_correct<span class="main">[</span><span class="operator">OF</span> valid_reqs_ACS_D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validReqs<span class="main"><span class="main">]</span></span> wfG _ _ Tau<span class="main"><span class="main">[</span></span><span class="operator">simplified</span> generate_valid_stateful_policy_IFSACS_def Let_def<span class="main"><span class="main">]</span></span><span class="main">]</span> all_security_requirements_fulfilled_ACS_D<span class="main">[</span><span class="operator">OF</span> high_level_policy_valid<span class="main">]</span>
        edgesList filter_IFS_no_violations_subseteq_input <span class="keyword1"><span class="command">by</span></span> <span class="operator">metis</span>

    <span class="keyword1"><span class="command">from</span></span> 1 2 3 4 5 6 validReqs high_level_policy_valid wfG
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> stateful_policy_compliance_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>





  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">generate_valid_stateful_policy_IFSACS_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span><span class="main">::</span>vertex graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant_configured list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'v</span> stateful_policy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">generate_valid_stateful_policy_IFSACS_2</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">edgesList</span></span></span> <span class="main">≡</span> 
    <span class="main">⦇</span> hosts <span class="main">=</span> nodes <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span>filter_IFS_no_violations <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">edgesList</span></span></span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">edgesList</span></span></span><span class="main">)</span> <span class="main">⦈</span>"</span></span>


  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-generate_valid_stateful_policy_IFSACS_2_wf_stateful_policy"><span class="command">lemma</span></span> generate_valid_stateful_policy_IFSACS_2_wf_stateful_policy<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>     edgesList<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
          <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"wf_stateful_policy <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span>  wfG <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_2_def wf_stateful_policy_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main">)</span>
     <span class="keyword1"><span class="command">using</span></span> edgesList filter_IFS_no_violations_subseteq_input <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rev_subsetD<span class="main">)</span>
   <span class="keyword1"><span class="command">qed</span></span>

   <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-generate_valid_stateful_policy_IFSACS_2_select_simps"><span class="command">lemma</span></span> generate_valid_stateful_policy_IFSACS_2_select_simps<span class="main">:</span>
   <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"hosts <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"flows_fix <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
   <span class="keyword2"><span class="keyword">and</span></span>   <span class="quoted"><span class="quoted">"flows_state <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">edgesList</span>"</span></span>
   <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword3"><span class="command">show</span></span>  <span class="quoted"><span class="quoted">"hosts <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"flows_fix <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"flows_state <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">edgesList</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_2_def<span class="main">)</span>
      <span class="keyword1"><span class="command">using</span></span> filter_compliant_stateful_ACS_subseteq_input <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf.coboundedI2<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-generate_valid_stateful_policy_IFSACS_2_all_security_requirements_fulfilled_IFS"><span class="command">lemma</span></span> generate_valid_stateful_policy_IFSACS_2_all_security_requirements_fulfilled_IFS<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> validReqs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>     wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>     high_level_policy_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span>"</span></span>
          <span class="keyword2"><span class="keyword">and</span></span>     edgesList<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span>
          <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">have</span></span> subseteq<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">∩</span> set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

    <span class="keyword1"><span class="command">from</span></span> wfG filter_IFS_no_violations_subseteq_input edgesList
    <span class="keyword1"><span class="command">have</span></span> wfG'<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">⦈</span>"</span></span> 
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> graph_eq_intro Un_absorb2 graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> graph.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> order.trans<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> high_level_policy_valid <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def get_IFS_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> filter_IFS_no_violations_correct<span class="main">[</span><span class="operator">OF</span> valid_reqs_IFS_D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validReqs<span class="main"><span class="main">]</span></span> wfG this edgesList<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>


    <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_mono_stateful_policy_to_network_graph<span class="main">[</span><span class="operator">OF</span> valid_reqs_IFS_D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validReqs<span class="main"><span class="main">]</span></span> subseteq wfG' this<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_2_def<span class="main">)</span>
    <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">.</span></span>
  <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-generate_valid_stateful_policy_IFSACS_2_filter_compliant_stateful_ACS"><span class="command">lemma</span></span> generate_valid_stateful_policy_IFSACS_2_filter_compliant_stateful_ACS<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> validReqs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     high_level_policy_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     edgesList<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     Tau<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒯</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span><span class="operator">-</span> 
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?filterACS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?filterIFS</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_ACS_D<span class="main">[</span><span class="operator">OF</span> high_level_policy_valid<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>

      <span class="keyword1"><span class="command">from</span></span> filter_compliant_stateful_ACS_correct<span class="main">[</span><span class="operator">OF</span> valid_reqs_ACS_D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validReqs<span class="main"><span class="main">]</span></span> wfG edgesList this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
        <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph  <span class="main">⦇</span>hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="var">?filterACS</span><span class="main">⦈</span><span class="main">)</span><span class="main">.</span> 
          <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_minus_backflows<span class="main"><span class="main">[</span></span><span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_alt<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> filter_compliant_stateful_ACS_subseteq_input <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> <span class="main"><span class="main">(</span></span>lifting<span class="main"><span class="main">,</span></span> no_types<span class="main"><span class="main">)</span></span> Un_absorb2 edgesList order_trans<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this validReqs <span class="keyword1"><span class="command">have</span></span> offending_filterACS_upperbound<span class="main">:</span>
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span> 
        <span class="main">⋃</span><span class="main">(</span>c_offending_flows <span class="bound">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span><span class="main">⦈</span><span class="main">)</span> <span class="main">⊆</span> 
          backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_reqs_def get_offending_flows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> wfG filter_compliant_stateful_ACS_subseteq_input edgesList <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> <span class="var">?filterACS</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> graph.cases graph.select_convs<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> graph.select_convs<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> le_iff_sup wf_graph_remove_edges_union<span class="main">)</span>
      <span class="keyword1"><span class="command">from</span></span> this backflows_wf <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wfG <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">G</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
      <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword1"><span class="command">have</span></span> wfG1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span><span class="main">⦈</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> wf_graph_union_edges <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        
      <span class="keyword1"><span class="command">from</span></span> edgesList <span class="keyword1"><span class="command">have</span></span> edgesUnsimp<span class="main">:</span> <span class="quoted"><span class="quoted">"edges <span class="free">G</span> <span class="main">∪</span> <span class="main">(</span><span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> filter_IFS_no_violations_subseteq_input filter_compliant_stateful_ACS_subseteq_input <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

      <span class="comment1">― ‹We set up a ?REM that we use in the <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> configured_SecurityInvariant.Un_set_offending_flows_bound_minus_subseteq<span class="antiquote">}</span></span> lemma›</span>
      <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?REM</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span> <span class="main">-</span> backflows <span class="main">(</span><span class="var">?filterIFS</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span>"</span></span>

      <span class="keyword1"><span class="command">have</span></span> REM_gives_desired_upper_bound<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="var">?REM</span> <span class="main">=</span> backflows <span class="main">(</span><span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

      <span class="keyword1"><span class="command">have</span></span> REM_gives_desired_edges<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="var">?REM</span> <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> <span class="main">(</span>backflows <span class="main">(</span><span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_def<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> wfG <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_graph_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>backflows <span class="var">?filterACS</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> backflows_finite <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> List.finite_set<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> finite1<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span> <span class="main">-</span> backflows <span class="main">(</span><span class="var">?filterIFS</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

      <span class="keyword1"><span class="command">from</span></span> configured_SecurityInvariant.Un_set_offending_flows_bound_minus_subseteq<span class="main">[</span><span class="keyword2"><span class="keyword"><span class="operator">where</span></span></span> E'<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="var">?REM</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">and</span></span></span> X<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span>backflows <span class="main">(</span><span class="var">?filterACS</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span><span class="main">)</span>"</span></span><span class="main">,</span>
          <span class="operator">OF</span> _ wfG1 offending_filterACS_upperbound<span class="main">,</span> <span class="operator">simplified</span> REM_gives_desired_upper_bound REM_gives_desired_edges
          <span class="main">]</span> valid_reqs_ACS_D<span class="main">[</span><span class="operator">OF</span> validReqs<span class="main">,</span> <span class="operator">unfolded</span> valid_reqs_def<span class="main">]</span>
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">m</span><span class="main">.</span> <span class="bound">m</span> <span class="main">∈</span> set <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⟹</span>
              <span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>c_offending_flows <span class="bound">m</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span><span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">)</span><span class="main">⦈</span><span class="main">.</span>
                  <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span><span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span>
         <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> <span class="main">(</span>backflows <span class="main">(</span><span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span><span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span>"</span></span>
       <span class="keyword1"><span class="command">using</span></span> get_offending_flows_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span>
         <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> <span class="main">(</span><span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">)</span> <span class="main">∪</span> <span class="main">(</span>backflows <span class="main">(</span><span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">)</span><span class="main">)</span><span class="main">⦈</span><span class="main">.</span>
       <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span><span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> edgesUnsimp<span class="main">)</span>
      <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span>hosts <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> flows_fix <span class="main">=</span> edges <span class="free">G</span><span class="main">,</span> flows_state <span class="main">=</span> <span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">⦈</span><span class="main">)</span><span class="main">.</span>
                <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span><span class="var">?filterACS</span> <span class="main">∩</span> <span class="var">?filterIFS</span><span class="main">)</span> <span class="main">-</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_policy_to_network_graph_def all_flows_def<span class="main">)</span>

      <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tau generate_valid_stateful_policy_IFSACS_2_def<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filternew_flows_state_alt backflows_minus_backflows<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> inf_commute<span class="main">)</span>
    <span class="keyword1"><span class="command">qed</span></span>
        




  <span class="keyword1"><span class="command">theorem</span></span> generate_valid_stateful_policy_IFSACS_2_stateful_policy_compliance<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> validReqs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     high_level_policy_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     edgesList<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     Tau<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">𝒯</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span>"</span></span>
    <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"stateful_policy_compliance <span class="free">𝒯</span> <span class="free">G</span> <span class="free">M</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
      <span class="keyword1"><span class="command">have</span></span> 1<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_stateful_policy <span class="free">𝒯</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tau<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_2_wf_stateful_policy<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wfG edgesList<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 2<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_stateful_policy <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_wf_stateful_policy<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wfG edgesList<span class="main"><span class="main">]</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 3<span class="main">:</span> <span class="quoted"><span class="quoted">"hosts <span class="free">𝒯</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tau<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_2_select_simps<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 4<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_fix <span class="free">𝒯</span> <span class="main">⊆</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tau<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_2_select_simps<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span><span class="main">)</span>
      <span class="keyword1"><span class="command">have</span></span> 5<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Tau<span class="main">)</span>
        <span class="keyword1"><span class="command">using</span></span> generate_valid_stateful_policy_IFSACS_2_all_security_requirements_fulfilled_IFS<span class="main">[</span><span class="operator">OF</span> validReqs wfG high_level_policy_valid<span class="main">]</span> edgesList <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">have</span></span> 6<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="free">𝒯</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> backflows <span class="main">(</span>filternew_flows_state <span class="free">𝒯</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command">using</span></span> generate_valid_stateful_policy_IFSACS_2_filter_compliant_stateful_ACS<span class="main">[</span><span class="operator">OF</span> 
            validReqs wfG high_level_policy_valid<span class="main">]</span>
        Tau edgesList <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

    <span class="keyword1"><span class="command">from</span></span> 1 2 3 4 5 6 validReqs high_level_policy_valid wfG
    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> stateful_policy_compliance_def <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
  <span class="keyword1"><span class="command">qed</span></span>





  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    If there are no IFS requirements and the ACS requirements cause no side effects,
    effectively, the graph can be considered as undirected graph! 
›</span></span>
  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-generate_valid_stateful_policy_IFSACS_2_noIFS_noACSsideeffects_imp_fullgraph"><span class="command">lemma</span></span> generate_valid_stateful_policy_IFSACS_2_noIFS_noACSsideeffects_imp_fullgraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> validReqs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     high_level_policy_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     edgesList<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     no_ACS_sideeffects<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="main">(</span>backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     no_IFS<span class="main">:</span> <span class="quoted"><span class="quoted">"get_IFS <span class="free">M</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"stateful_policy_to_network_graph <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> undirected <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> filter_IFS_no_violations_accu_no_IFS<span class="main">[</span><span class="operator">OF</span> valid_reqs_IFS_D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validReqs<span class="main"><span class="main">]</span></span> wfG no_IFS<span class="main">]</span> edgesList
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span> <span class="main">=</span> rev <span class="free">edgesList</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_IFS_no_violations_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this filter_compliant_stateful_ACS_subseteq_input <span class="keyword1"><span class="command">have</span></span> flows_state_IFS<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_state <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_2_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> flowsfix<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_fix <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_2_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> hosts<span class="main">:</span> <span class="quoted"><span class="quoted">"hosts <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_2_def<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> filter_compliant_stateful_ACS_accu_no_side_effects<span class="main">[</span><span class="operator">OF</span> valid_reqs_ACS_D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validReqs<span class="main"><span class="main">]</span></span> wfG no_ACS_sideeffects<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span> <span class="main">=</span> rev <span class="main">[</span><span class="bound">e</span><span class="main">←</span><span class="free">edgesList</span> <span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_compliant_stateful_ACS_def edgesList<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> filterACS<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> edgesList <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> undirected_backflows stateful_policy_to_network_graph_def all_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hosts filterACS flows_state_IFS flowsfix<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_minus_backflows<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1" id="TopoS_Stateful_Policy_Algorithm-generate_valid_stateful_policy_IFSACS_noIFS_noACSsideeffects_imp_fullgraph"><span class="command">lemma</span></span> generate_valid_stateful_policy_IFSACS_noIFS_noACSsideeffects_imp_fullgraph<span class="main">:</span>
  <span class="keyword2"><span class="keyword">assumes</span></span> validReqs<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="free">M</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     wfG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     high_level_policy_valid<span class="main">:</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="free">M</span> <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     edgesList<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     no_ACS_sideeffects<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>get_ACS <span class="free">M</span><span class="main">)</span> <span class="main">⦇</span>nodes <span class="main">=</span> nodes <span class="free">G</span><span class="main">,</span> edges <span class="main">=</span> edges <span class="free">G</span> <span class="main">∪</span> backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">⦈</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="main">(</span>backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span>
        <span class="keyword2"><span class="keyword">and</span></span>     no_IFS<span class="main">:</span> <span class="quoted"><span class="quoted">"get_IFS <span class="free">M</span> <span class="main">=</span> <span class="main">[]</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"stateful_policy_to_network_graph <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> undirected <span class="free">G</span>"</span></span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
    <span class="keyword1"><span class="command">from</span></span> filter_IFS_no_violations_accu_no_IFS<span class="main">[</span><span class="operator">OF</span> valid_reqs_IFS_D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validReqs<span class="main"><span class="main">]</span></span> wfG no_IFS<span class="main">]</span> edgesList
      <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"filter_IFS_no_violations <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span> <span class="main">=</span> rev <span class="free">edgesList</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_IFS_no_violations_def<span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> this filter_compliant_stateful_ACS_subseteq_input <span class="keyword1"><span class="command">have</span></span> flows_state_IFS<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_state <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="main">(</span>rev <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> flowsfix<span class="main">:</span> <span class="quoted"><span class="quoted">"flows_fix <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_def<span class="main">)</span>

    <span class="keyword1"><span class="command">have</span></span> hosts<span class="main">:</span> <span class="quoted"><span class="quoted">"hosts <span class="main">(</span>generate_valid_stateful_policy_IFSACS <span class="free">G</span> <span class="free">M</span> <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> nodes <span class="free">G</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> generate_valid_stateful_policy_IFSACS_def<span class="main">)</span>

    <span class="keyword1"><span class="command">from</span></span> filter_compliant_stateful_ACS_accu_no_side_effects<span class="main">[</span><span class="operator">OF</span> valid_reqs_ACS_D<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validReqs<span class="main"><span class="main">]</span></span> wfG no_ACS_sideeffects<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> 
      <span class="quoted"><span class="quoted">"filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="main">(</span>rev <span class="free">edgesList</span><span class="main">)</span> <span class="main">=</span> <span class="main">[</span><span class="bound">e</span><span class="main">←</span><span class="free">edgesList</span> <span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">]</span>"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_compliant_stateful_ACS_def edgesList<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rev_filter rev_swap<span class="main">)</span>
    <span class="keyword1"><span class="command">hence</span></span> filterACS<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_compliant_stateful_ACS <span class="free">G</span> <span class="free">M</span> <span class="main">(</span>rev <span class="free">edgesList</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> edges <span class="free">G</span> <span class="main">-</span> <span class="main">(</span>backflows <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> edgesList <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

    <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> undirected_backflows stateful_policy_to_network_graph_def all_flows_def<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> hosts filterACS flows_state_IFS flowsfix<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backflows_minus_backflows<span class="main">)</span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
    <span class="keyword1"><span class="command">qed</span></span>


<span class="comment1">(*
text{* In the repo history, we see failed attempts which try to prove that under composition, the IFS and ACS filtering is also maximal.
       I guess this does not hold in general. Needs a counter example. *}

*)</span>
<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Stateful_Policy_impl">
<div class="head">
<h1>Theory TopoS_Stateful_Policy_impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Stateful_Policy_impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="TopoS_Composition_Theory_impl.html">TopoS_Composition_Theory_impl</a> <a href="TopoS_Stateful_Policy_Algorithm.html">TopoS_Stateful_Policy_Algorithm</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Stateful Policy -- List Implementaion›</span></span>

<span class="keyword1"><span class="command">record</span></span> <span class="tfree">'v</span> stateful_list_policy <span class="main">=</span>
    hostsL <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list"</span></span>
    flows_fixL <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span><span class="tfree">'v</span><span class="main">)</span> list"</span></span>
    flows_stateL <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span><span class="tfree">'v</span><span class="main">)</span> list"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stateful_list_policy_to_list_graph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> stateful_list_policy <span class="main">⇒</span> <span class="tfree">'v</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stateful_list_policy_to_list_graph</span> <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span> <span class="main">=</span> <span class="main">⦇</span> nodesL <span class="main">=</span> hostsL <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">(</span>flows_fixL <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span><span class="main">)</span> <span class="main">@</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> flows_stateL <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>flows_fixL <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">@</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> backlinks <span class="main">(</span>flows_stateL <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span><span class="main">)</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>flows_fixL <span class="free"><span class="bound"><span class="entity">𝒯</span></span></span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1" id="TopoS_Stateful_Policy_impl-stateful_list_policy_to_list_graph_complies"><span class="command">lemma</span></span> stateful_list_policy_to_list_graph_complies<span class="main">:</span>
  <span class="quoted"><span class="quoted">"list_graph_to_graph <span class="main">(</span>stateful_list_policy_to_list_graph <span class="main">⦇</span> hostsL <span class="main">=</span> <span class="free">V</span><span class="main">,</span> flows_fixL <span class="main">=</span> <span class="free">E<span class="hidden">⇩</span><sub>f</sub></span><span class="main">,</span> flows_stateL <span class="main">=</span> <span class="free">E<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> 
    stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> set <span class="free">V</span><span class="main">,</span> flows_fix <span class="main">=</span> set <span class="free">E<span class="hidden">⇩</span><sub>f</sub></span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="free">E<span class="hidden">⇩</span><sub>σ</sub></span> <span class="main">⦈</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_list_policy_to_list_graph_def stateful_policy_to_network_graph_def all_flows_def list_graph_to_graph_def backlinks_correct<span class="main"><span class="keyword3">,</span></span> <span class="operator">blast</span><span class="main">)</span>

<span class="keyword1" id="TopoS_Stateful_Policy_impl-wf_list_graph_stateful_list_policy_to_list_graph"><span class="command">lemma</span></span> wf_list_graph_stateful_list_policy_to_list_graph<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"wf_list_graph <span class="free">G</span> <span class="main">⟹</span> distinct <span class="free">E</span> <span class="main">⟹</span> set <span class="free">E</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span> <span class="main">⟹</span> wf_list_graph <span class="main">(</span>stateful_list_policy_to_list_graph <span class="main">⦇</span>hostsL <span class="main">=</span> nodesL <span class="free">G</span><span class="main">,</span> flows_fixL <span class="main">=</span> edgesL <span class="free">G</span><span class="main">,</span> flows_stateL <span class="main">=</span> <span class="free">E</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_list_graph_def stateful_list_policy_to_list_graph_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_distinct<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_set<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_set<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_list_graph_axioms_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_set<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">force</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_set<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>1<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
  


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Algorithms›</span></span>

   <span class="keyword1"><span class="command">fun</span></span> <span class="entity">filter_IFS_no_violations_accu</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_IFS_no_violations_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span>"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_IFS_no_violations_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span>
        all_security_requirements_fulfilled <span class="main">(</span>TopoS_Composition_Theory_impl.get_IFS <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span>stateful_list_policy_to_list_graph <span class="main">⦇</span> hostsL <span class="main">=</span> nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_fixL <span class="main">=</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_stateL <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accu</span></span></span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="free">filter_IFS_no_violations_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accu</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span>
        <span class="keyword1">else</span> <span class="free">filter_IFS_no_violations_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">filter_IFS_no_violations</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_IFS_no_violations</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> filter_IFS_no_violations_accu <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">[]</span> <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>

   <span class="keyword1" id="TopoS_Stateful_Policy_impl-filter_IFS_no_violations_accu_distinct"><span class="command">lemma</span></span> filter_IFS_no_violations_accu_distinct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> distinct <span class="main">(</span><span class="free">Es</span><span class="main">@</span><span class="free">accu</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span> distinct <span class="main">(</span>filter_IFS_no_violations_accu <span class="free">G</span> <span class="free">M</span> <span class="free">accu</span> <span class="free">Es</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">accu</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

   <span class="keyword1" id="TopoS_Stateful_Policy_impl-filter_IFS_no_violations_accu_complies"><span class="command">lemma</span></span> filter_IFS_no_violations_accu_complies<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span><span class="main">;</span>
      wf_list_graph <span class="free">G</span><span class="main">;</span> set <span class="free">Es</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">;</span> set <span class="free">accu</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">;</span> distinct <span class="main">(</span><span class="free">Es</span><span class="main">@</span><span class="free">accu</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
      filter_IFS_no_violations_accu <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="free">accu</span> <span class="free">Es</span> <span class="main">=</span> TopoS_Stateful_Policy_Algorithm.filter_IFS_no_violations_accu <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="free">accu</span> <span class="free">Es</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">accu</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_impl_def get_spec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">Es</span><span class="main">)</span>
        <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main">(</span>1<span class="main">)</span> Cons.prems<span class="main">(</span>2<span class="main">)</span><span class="main">]</span><span class="antiquote">}</span></span>›</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?caseDistinction</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>TopoS_Composition_Theory_impl.get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stateful_list_policy_to_list_graph <span class="main">⦇</span> hostsL <span class="main">=</span> nodesL <span class="free">G</span><span class="main">,</span> flows_fixL <span class="main">=</span> edgesL <span class="free">G</span><span class="main">,</span> flows_stateL <span class="main">=</span> <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">accu</span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span>"</span></span>

        <span class="keyword1"><span class="command">from</span></span> get_IFS_get_ACS_select_simps<span class="main">(</span>2<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> get_impl_zip_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>get_impl <span class="main">(</span>zip <span class="main">(</span>TopoS_Composition_Theory_impl.get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TopoS_Composition_Theory_impl.get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          
        <span class="keyword1"><span class="command">from</span></span> get_IFS_get_ACS_select_simps<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> get_spec_zip_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>get_spec <span class="main">(</span>zip <span class="main">(</span>TopoS_Composition_Theory_impl.get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
     
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> Cons.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">Es</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">Es</span> <span class="main">@</span> <span class="skolem">accu</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">Es</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> validLG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="main">(</span>stateful_list_policy_to_list_graph <span class="main">⦇</span>hostsL <span class="main">=</span> nodesL <span class="free">G</span><span class="main">,</span> flows_fixL <span class="main">=</span> edgesL <span class="free">G</span><span class="main">,</span> flows_stateL <span class="main">=</span> <span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_list_graph_stateful_list_policy_to_list_graph<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


        <span class="keyword1"><span class="command">from</span></span> get_IFS_get_ACS_select_simps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main">]</span>
        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>zip <span class="main">(</span>get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>
        <span class="keyword1"><span class="command">from</span></span> all_security_requirements_fulfilled_complies<span class="main">[</span><span class="operator">OF</span> this<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> all_security_requirements_fulfilled_eq_rule<span class="main">:</span> 
        <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">G</span><span class="main">.</span> wf_list_graph <span class="bound">G</span> <span class="main">⟹</span>
            TopoS_Composition_Theory_impl.all_security_requirements_fulfilled <span class="main">(</span>TopoS_Composition_Theory_impl.get_IFS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="bound">G</span> <span class="main">=</span>
            TopoS_Composition_Theory.all_security_requirements_fulfilled <span class="main">(</span>TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="bound">G</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_impl_zip_simp get_spec_zip_simp<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> case_impl_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?caseDistinction</span> <span class="main">⟷</span> TopoS_Composition_Theory.all_security_requirements_fulfilled <span class="main">(</span>TopoS_Composition_Theory.get_IFS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> set <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span><span class="main">,</span> flows_fix <span class="main">=</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">accu</span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> all_security_requirements_fulfilled_eq_rule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validLG<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_list_policy_to_list_graph_complies<span class="main">)</span>

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="var"><span class="quoted"><span class="var">?caseDistinction</span></span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> cTrue<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?caseDistinction</span></span></span>
          
          <span class="keyword1"><span class="command">from</span></span> cTrue <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_Stateful_Policy_impl.filter_IFS_no_violations_accu <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">Es</span><span class="main">)</span> <span class="main">=</span> TopoS_Stateful_Policy_impl.filter_IFS_no_violations_accu <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="skolem">Es</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">from</span></span> cTrue<span class="main">[</span><span class="operator">simplified</span> case_impl_spec<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_Stateful_Policy_Algorithm.filter_IFS_no_violations_accu <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">Es</span><span class="main">)</span> <span class="main">=</span>
            TopoS_Stateful_Policy_Algorithm.filter_IFS_no_violations_accu <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">accu</span><span class="main">)</span><span class="skolem">Es</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>

          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> g1 g2<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">Es</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span><span class="skolem">Es</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> cFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="var">?caseDistinction</span>"</span></span>

          <span class="keyword1"><span class="command">from</span></span> cFalse <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_Stateful_Policy_impl.filter_IFS_no_violations_accu <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">Es</span><span class="main">)</span> <span class="main">=</span> TopoS_Stateful_Policy_impl.filter_IFS_no_violations_accu <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="skolem">Es</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">from</span></span> cFalse<span class="main">[</span><span class="operator">simplified</span> case_impl_spec<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_Stateful_Policy_Algorithm.filter_IFS_no_violations_accu <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">Es</span><span class="main">)</span> <span class="main">=</span>
            TopoS_Stateful_Policy_Algorithm.filter_IFS_no_violations_accu <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="skolem">Es</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>

          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> g1 g2<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">Es</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">accu</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span><span class="skolem">Es</span> <span class="main">@</span> <span class="skolem">accu</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
       <span class="keyword1"><span class="command">qed</span></span>



   <span class="keyword1" id="TopoS_Stateful_Policy_impl-filter_IFS_no_violations_complies"><span class="command">lemma</span></span> filter_IFS_no_violations_complies<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span><span class="main">;</span> wf_list_graph <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span>
       filter_IFS_no_violations <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="main">=</span> TopoS_Stateful_Policy_Algorithm.filter_IFS_no_violations <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> filter_IFS_no_violations_def TopoS_Stateful_Policy_Algorithm.filter_IFS_no_violations_def<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> filter_IFS_no_violations_accu_complies<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_list_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>





    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">filter_compliant_stateful_ACS_accu</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_compliant_stateful_ACS_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="main">[]</span> <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span>"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_compliant_stateful_ACS_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span>
        <span class="free"><span class="bound"><span class="entity">e</span></span></span> <span class="main">∉</span> set <span class="main">(</span>backlinks <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> set <span class="main">(</span>implc_get_offending_flows <span class="main">(</span>get_ACS <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span>stateful_list_policy_to_list_graph <span class="main">⦇</span> hostsL <span class="main">=</span> nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_fixL <span class="main">=</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_stateL <span class="main">=</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accu</span></span></span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> set <span class="bound">F</span> <span class="main">⊆</span> set <span class="main">(</span>backlinks <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accu</span></span></span><span class="main">)</span><span class="main">)</span><span class="main">)</span>
        <span class="keyword1">then</span> <span class="free">filter_compliant_stateful_ACS_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">e</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">accu</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span>
        <span class="keyword1">else</span> <span class="free">filter_compliant_stateful_ACS_accu</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">accu</span></span></span> <span class="free"><span class="bound"><span class="entity">Es</span></span></span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">filter_compliant_stateful_ACS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">filter_compliant_stateful_ACS</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> filter_compliant_stateful_ACS_accu <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">[]</span> <span class="main">(</span>edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>"</span></span>


   <span class="keyword1" id="TopoS_Stateful_Policy_impl-filter_compliant_stateful_ACS_accu_complies"><span class="command">lemma</span></span> filter_compliant_stateful_ACS_accu_complies<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span><span class="main">;</span>
      wf_list_graph <span class="free">G</span><span class="main">;</span> set <span class="free">Es</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">;</span> set <span class="free">accu</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">;</span> distinct <span class="main">(</span><span class="free">Es</span><span class="main">@</span><span class="free">accu</span><span class="main">)</span> <span class="main">⟧</span> <span class="main">⟹</span>
      filter_compliant_stateful_ACS_accu <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="free">accu</span> <span class="free">Es</span> <span class="main">=</span> TopoS_Stateful_Policy_Algorithm.filter_compliant_stateful_ACS_accu <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="free">accu</span> <span class="free">Es</span>"</span></span>
      <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">Es</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">accu</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil
        <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> get_impl_def get_spec_def<span class="main">)</span>
      <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">e</span> <span class="skolem">Es</span><span class="main">)</span>
        <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main">(</span>1<span class="main">)</span> Cons.prems<span class="main">(</span>2<span class="main">)</span><span class="main">]</span><span class="antiquote">}</span></span>›</span>
        <span class="keyword1"><span class="command">let</span></span> <span class="var"><span class="quoted"><span class="var">?caseDistinction</span></span></span> <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="skolem">e</span> <span class="main">∉</span> set <span class="main">(</span>backlinks <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> set <span class="main">(</span>implc_get_offending_flows <span class="main">(</span>get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stateful_list_policy_to_list_graph <span class="main">⦇</span> hostsL <span class="main">=</span> nodesL <span class="free">G</span><span class="main">,</span> flows_fixL <span class="main">=</span> edgesL <span class="free">G</span><span class="main">,</span> flows_stateL <span class="main">=</span> <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">accu</span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span><span class="main">.</span> set <span class="bound">F</span> <span class="main">⊆</span> set <span class="main">(</span>backlinks <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
        
        <span class="keyword1"><span class="command">have</span></span> backlinks_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">e</span> <span class="main">∉</span> set <span class="main">(</span>backlinks <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⟷</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">∉</span> backflows <span class="main">(</span>set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_correct<span class="main">)</span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="bound">X</span><span class="main">.</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>set <span class="main">(</span>implc_get_offending_flows <span class="main">(</span>TopoS_Composition_Theory_impl.get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="bound">G</span><span class="main">)</span><span class="main">.</span> set <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span>
              <span class="main">(</span><span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>set <span class="main">`</span> set <span class="main">(</span>implc_get_offending_flows <span class="main">(</span>TopoS_Composition_Theory_impl.get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="bound">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">G</span> <span class="bound">X</span><span class="main">.</span> wf_list_graph <span class="bound">G</span> <span class="main">⟹</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>set <span class="main">`</span> set <span class="main">(</span>implc_get_offending_flows <span class="main">(</span>TopoS_Composition_Theory_impl.get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="bound">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span>
          <span class="main">(</span><span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>TopoS_Composition_Theory.get_ACS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="bound">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">X</span><span class="main">)</span>"</span></span>
            <span class="keyword1"><span class="command">using</span></span> implc_get_offending_flows_complies<span class="main">[</span><span class="operator">OF</span> get_IFS_get_ACS_select_simps<span class="main"><span class="main">(</span></span>4<span class="main"><span class="main">)</span></span><span class="main"><span class="main">[</span></span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">,</span> <span class="operator">simplified</span> get_IFS_get_ACS_select_simps<span class="main"><span class="main">[</span></span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">]</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">finally</span></span> <span class="keyword1"><span class="command">have</span></span> implc_get_offending_flows_simp_rule<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span><span class="bound">G</span> <span class="bound">X</span><span class="main">.</span> wf_list_graph <span class="bound">G</span> <span class="main">⟹</span> 
          <span class="main">(</span><span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>set <span class="main">(</span>implc_get_offending_flows <span class="main">(</span>TopoS_Composition_Theory_impl.get_ACS <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="bound">G</span><span class="main">)</span><span class="main">.</span> set <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">X</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span><span class="main">∈</span>get_offending_flows <span class="main">(</span>TopoS_Composition_Theory.get_ACS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="bound">G</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="bound">X</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">.</span></span>


        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> Cons.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>4<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span><span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="skolem">Es</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">Es</span> <span class="main">@</span> <span class="skolem">accu</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>5<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"distinct <span class="main">(</span><span class="skolem">Es</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>2<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> validLG<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph <span class="main">(</span>stateful_list_policy_to_list_graph <span class="main">⦇</span>hostsL <span class="main">=</span> nodesL <span class="free">G</span><span class="main">,</span> flows_fixL <span class="main">=</span> edgesL <span class="free">G</span><span class="main">,</span> flows_stateL <span class="main">=</span> <span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">⦈</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> wf_list_graph_stateful_list_policy_to_list_graph<span class="main">)</span>
           <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>›</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

        <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>backlinks <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span>"</span></span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_set backflows_def<span class="main">)</span>
        
        <span class="comment1">― ‹<span class="antiquoted"><span class="antiquote">@{</span><span class="operator">thm</span> implc_get_offending_flows_simp_rule<span class="main">[</span><span class="operator">OF</span> validLG<span class="main">]</span><span class="antiquote">}</span></span>›</span>
        <span class="keyword1"><span class="command">have</span></span> case_impl_spec<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="var">?caseDistinction</span> <span class="main">⟷</span> <span class="main">(</span>
          <span class="skolem">e</span> <span class="main">∉</span> backflows <span class="main">(</span>set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="bound">F</span> <span class="main">∈</span> get_offending_flows <span class="main">(</span>TopoS_Composition_Theory.get_ACS <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">)</span> <span class="main">(</span>stateful_policy_to_network_graph <span class="main">⦇</span> hosts <span class="main">=</span> set <span class="main">(</span>nodesL <span class="free">G</span><span class="main">)</span><span class="main">,</span> flows_fix <span class="main">=</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">accu</span><span class="main">)</span> <span class="main">⦈</span><span class="main">)</span><span class="main">.</span> <span class="bound">F</span> <span class="main">⊆</span> <span class="main">(</span>backflows <span class="main">(</span>set <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">accu</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> 
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_simp<span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> implc_get_offending_flows_simp_rule<span class="main"><span class="main">[</span></span><span class="operator">OF</span> validLG<span class="main"><span class="main">]</span></span><span class="main">)</span>
          <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> stateful_list_policy_to_list_graph_complies<span class="main">)</span>
          <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span>backlinks <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> backflows <span class="main">(</span>insert <span class="skolem">e</span> <span class="main">(</span>set <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main">)</span>
          

        <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
          <span class="keyword1"><span class="command">proof</span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="var"><span class="quoted"><span class="var">?caseDistinction</span></span></span><span class="main">)</span>
          <span class="keyword3"><span class="command">assume</span></span> cTrue<span class="main">:</span> <span class="var"><span class="quoted"><span class="var">?caseDistinction</span></span></span>
          
          <span class="keyword1"><span class="command">from</span></span> cTrue <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_Stateful_Policy_impl.filter_compliant_stateful_ACS_accu <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">Es</span><span class="main">)</span> <span class="main">=</span>  TopoS_Stateful_Policy_impl.filter_compliant_stateful_ACS_accu <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">accu</span><span class="main">)</span> <span class="skolem">Es</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>

          <span class="keyword1"><span class="command">from</span></span> cTrue<span class="main">[</span><span class="operator">simplified</span> case_impl_spec<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_Stateful_Policy_Algorithm.filter_compliant_stateful_ACS_accu <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">Es</span><span class="main">)</span> <span class="main">=</span>
            TopoS_Stateful_Policy_Algorithm.filter_compliant_stateful_ACS_accu <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="main">(</span><span class="skolem">e</span><span class="main">#</span><span class="skolem">accu</span><span class="main">)</span> <span class="skolem">Es</span>"</span></span>
            <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>

          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> g1 g2<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">Es</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹set <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span><span class="skolem">Es</span> <span class="main">@</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">accu</span><span class="main">)</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
        <span class="keyword1"><span class="command">next</span></span>
          <span class="keyword3"><span class="command">assume</span></span> cFalse<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> <span class="main">(</span><span class="var">?caseDistinction</span><span class="main">)</span>"</span></span>

          <span class="keyword1"><span class="command">from</span></span> cFalse <span class="keyword1"><span class="command">have</span></span> g1<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_Stateful_Policy_impl.filter_compliant_stateful_ACS_accu <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">Es</span><span class="main">)</span>  <span class="main">=</span> TopoS_Stateful_Policy_impl.filter_compliant_stateful_ACS_accu <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="skolem">Es</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>

          <span class="keyword1"><span class="command">from</span></span> cFalse<span class="main">[</span><span class="operator">simplified</span> case_impl_spec<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> g2<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_Stateful_Policy_Algorithm.filter_compliant_stateful_ACS_accu <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="main">(</span><span class="skolem">e</span> <span class="main">#</span> <span class="skolem">Es</span><span class="main">)</span> <span class="main">=</span>
            TopoS_Stateful_Policy_Algorithm.filter_compliant_stateful_ACS_accu <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="skolem">accu</span> <span class="skolem">Es</span>"</span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>

          <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span>
            <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> g1 g2<span class="main">)</span>
            <span class="keyword1"><span class="command">using</span></span> Cons.IH<span class="main">[</span><span class="operator">OF</span> Cons.prems<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> Cons.prems<span class="main"><span class="main">(</span></span>2<span class="main"><span class="main">)</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">Es</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹set <span class="skolem">accu</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>›</span></span> <span class="quoted"><span class="quoted">‹distinct <span class="main">(</span><span class="skolem">Es</span> <span class="main">@</span> <span class="skolem">accu</span><span class="main">)</span>›</span></span><span class="main">]</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
          <span class="keyword1"><span class="command">qed</span></span>
       <span class="keyword1"><span class="command">qed</span></span>


   <span class="keyword1" id="TopoS_Stateful_Policy_impl-filter_compliant_stateful_ACS_cont_complies"><span class="command">lemma</span></span> filter_compliant_stateful_ACS_cont_complies<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span><span class="main">;</span> wf_list_graph <span class="free">G</span><span class="main">;</span> set <span class="free">Es</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">;</span> distinct <span class="free">Es</span> <span class="main">⟧</span> <span class="main">⟹</span>
       filter_compliant_stateful_ACS_accu <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="main">[]</span> <span class="free">Es</span> <span class="main">=</span> TopoS_Stateful_Policy_Algorithm.filter_compliant_stateful_ACS <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="free">Es</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> filter_compliant_stateful_ACS_def TopoS_Stateful_Policy_Algorithm.filter_compliant_stateful_ACS_def<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> filter_compliant_stateful_ACS_accu_complies<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

   <span class="keyword1" id="TopoS_Stateful_Policy_impl-filter_compliant_stateful_ACS_complies"><span class="command">lemma</span></span> filter_compliant_stateful_ACS_complies<span class="main">:</span>
    <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span><span class="main">;</span> wf_list_graph <span class="free">G</span> <span class="main">⟧</span> <span class="main">⟹</span>
       filter_compliant_stateful_ACS <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span> <span class="main">=</span> TopoS_Stateful_Policy_Algorithm.filter_compliant_stateful_ACS <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold</span> filter_compliant_stateful_ACS_def TopoS_Stateful_Policy_Algorithm.filter_compliant_stateful_ACS_def<span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> filter_compliant_stateful_ACS_accu_complies<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_list_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">(*TODO: show wf_stateful_policy and distinctness and wf_list_graph, ...*)</span>


   <span class="keyword1"><span class="command">definition</span></span> <span class="entity">generate_valid_stateful_policy_IFSACS</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant list <span class="main">⇒</span> <span class="tfree">'v</span> stateful_list_policy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">generate_valid_stateful_policy_IFSACS</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="bound">filterIFS</span> <span class="main">=</span> filter_IFS_no_violations <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="keyword1">in</span>
        <span class="main">(</span><span class="keyword1">let</span> <span class="bound">filterACS</span> <span class="main">=</span> filter_compliant_stateful_ACS_accu <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">[]</span> <span class="bound">filterIFS</span> <span class="keyword1">in</span> <span class="main">⦇</span> hostsL <span class="main">=</span> nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_fixL <span class="main">=</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_stateL <span class="main">=</span> <span class="bound">filterACS</span> <span class="main">⦈</span><span class="main">)</span><span class="main">)</span>"</span></span>



  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">inefficient_list_intersect</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">inefficient_list_intersect</span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">inefficient_list_intersect</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">bs</span></span></span> <span class="keyword1">then</span> <span class="free"><span class="bound"><span class="entity">a</span></span></span><span class="main">#</span><span class="main">(</span><span class="free">inefficient_list_intersect</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span> <span class="keyword1">else</span> <span class="free">inefficient_list_intersect</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="free"><span class="bound"><span class="entity">bs</span></span></span><span class="main">)</span>"</span></span>
  <span class="keyword1" id="TopoS_Stateful_Policy_impl-inefficient_list_intersect_correct"><span class="command">lemma</span></span> inefficient_list_intersect_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>inefficient_list_intersect <span class="free">a</span> <span class="free">b</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span>set <span class="free">a</span><span class="main">)</span> <span class="main">∩</span> <span class="main">(</span>set <span class="free">b</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">a</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">generate_valid_stateful_policy_IFSACS_2</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="tfree">'v</span> SecurityInvariant list <span class="main">⇒</span>  <span class="tfree">'v</span> stateful_list_policy"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">generate_valid_stateful_policy_IFSACS_2</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">=</span>
    <span class="main">⦇</span> hostsL <span class="main">=</span> nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_fixL <span class="main">=</span> edgesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">,</span> flows_stateL <span class="main">=</span> inefficient_list_intersect <span class="main">(</span>filter_IFS_no_violations <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">(</span>filter_compliant_stateful_ACS <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">M</span></span></span><span class="main">)</span> <span class="main">⦈</span>"</span></span>


   <span class="keyword1" id="TopoS_Stateful_Policy_impl-generate_valid_stateful_policy_IFSACS_2_complies"><span class="command">lemma</span></span> generate_valid_stateful_policy_IFSACS_2_complies<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span><span class="main">∀</span> <span class="main">(</span><span class="bound">m_impl</span><span class="main">,</span> <span class="bound">m_spec</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">M</span><span class="main">.</span> SecurityInvariant_complies_formal_def <span class="bound">m_impl</span> <span class="bound">m_spec</span><span class="main">;</span>
          wf_list_graph <span class="free">G</span><span class="main">;</span>
          valid_reqs <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span><span class="main">;</span>
          TopoS_Composition_Theory.all_security_requirements_fulfilled <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span><span class="main">;</span>
          <span class="free">𝒯</span> <span class="main">=</span> <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 <span class="free">G</span> <span class="main">(</span>get_impl <span class="free">M</span><span class="main">)</span><span class="main">)</span><span class="main">⟧</span> <span class="main">⟹</span> 
   stateful_policy_compliance <span class="main">⦇</span>hosts <span class="main">=</span> set <span class="main">(</span>hostsL <span class="free">𝒯</span><span class="main">)</span><span class="main">,</span> flows_fix <span class="main">=</span> set <span class="main">(</span>flows_fixL <span class="free">𝒯</span><span class="main">)</span><span class="main">,</span> flows_state <span class="main">=</span> set <span class="main">(</span>flows_stateL <span class="free">𝒯</span><span class="main">)</span> <span class="main">⦈</span> <span class="main">(</span>list_graph_to_graph <span class="free">G</span><span class="main">)</span> <span class="main">(</span>get_spec <span class="free">M</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> edgesList<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"edgesL <span class="free">G</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> generate_valid_stateful_policy_IFSACS_2_stateful_policy_compliance<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">metis</span> wf_list_graph_def wf_list_graph_iff_wf_graph<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> TopoS_Stateful_Policy_Algorithm.generate_valid_stateful_policy_IFSACS_2_def TopoS_Stateful_Policy_impl.generate_valid_stateful_policy_IFSACS_2_def<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> list_graph_to_graph_def inefficient_list_intersect_correct<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="free">𝒯</span> <span class="main">=</span> <span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter_compliant_stateful_ACS_complies<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule</span><span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> filter_IFS_no_violations_complies<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">thin_tac</span> <span class="quoted"><span class="quoted">"<span class="main">_</span>"</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> list_graph_to_graph_def<span class="main">)</span>
    



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="METASINVAR_SystemBoundary">
<div class="head">
<h1>Theory METASINVAR_SystemBoundary</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> METASINVAR_SystemBoundary
<span class="keyword2"><span class="keyword">imports</span></span> <a href="SINVAR_BLPtrusted_impl.html">SINVAR_BLPtrusted_impl</a>
        <a href="SINVAR_SubnetsInGW_impl.html">SINVAR_SubnetsInGW_impl</a>
        <span class="quoted">"<a href="TopoS_Composition_Theory_impl.html">../TopoS_Composition_Theory_impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Meta SecurityInvariant: System Boundaries›</span></span>


<span class="keyword1"><span class="command">datatype</span></span> system_components <span class="main">=</span> SystemComponent
                           <span class="main">|</span> SystemBoundaryInput
                           <span class="main">|</span> SystemBoundaryOutput
                           <span class="main">|</span> SystemBoundaryInputOutput


<span class="keyword1"><span class="command">fun</span></span> <span class="entity">system_components_to_subnets</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"system_components <span class="main">⇒</span> subnets"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">system_components_to_subnets</span> SystemComponent <span class="main">=</span> Member"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">system_components_to_subnets</span> SystemBoundaryInput <span class="main">=</span> InboundGateway"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">system_components_to_subnets</span> SystemBoundaryOutput <span class="main">=</span> Member"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">system_components_to_subnets</span> SystemBoundaryInputOutput <span class="main">=</span> InboundGateway"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">system_components_to_blp</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"system_components <span class="main">⇒</span> SINVAR_BLPtrusted.node_config"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">system_components_to_blp</span> SystemComponent <span class="main">=</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">system_components_to_blp</span> SystemBoundaryInput <span class="main">=</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">system_components_to_blp</span> SystemBoundaryOutput <span class="main">=</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span>"</span></span> <span class="main">|</span>
  <span class="quoted"><span class="quoted">"<span class="free">system_components_to_blp</span> SystemBoundaryInputOutput <span class="main">=</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">new_meta_system_boundary</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span><span class="main">::</span>vertex <span class="main">×</span> system_components<span class="main">)</span> list <span class="main">⇒</span> string <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> SecurityInvariant<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
  <span class="quoted"><span class="quoted">"<span class="free">new_meta_system_boundary</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span> <span class="free"><span class="bound"><span class="entity">description</span></span></span> <span class="main">=</span> <span class="main">[</span>
      new_configured_list_SecurityInvariant SINVAR_LIB_SubnetsInGW <span class="main">⦇</span> 
          node_properties <span class="main">=</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> system_components_to_subnets <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
          <span class="main">⦈</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">description</span></span></span> <span class="main">@</span> <span class="inner_quoted">'' (ACS)''</span><span class="main">)</span>
      <span class="main">,</span>
      new_configured_list_SecurityInvariant SINVAR_LIB_BLPtrusted <span class="main">⦇</span> 
          node_properties <span class="main">=</span> map_of <span class="main">(</span>map <span class="main">(</span><span class="main">λ</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">c</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">v</span><span class="main">,</span> system_components_to_blp <span class="bound">c</span><span class="main">)</span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">C</span></span></span><span class="main">)</span>
          <span class="main">⦈</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">description</span></span></span> <span class="main">@</span> <span class="inner_quoted">'' (IFS)''</span><span class="main">)</span>
      <span class="main">]</span>"</span></span>


<span class="keyword1" id="METASINVAR_SystemBoundary-system_components_to_subnets"><span class="command">lemma</span></span> system_components_to_subnets<span class="main">:</span>
      <span class="quoted"><span class="quoted">"SINVAR_SubnetsInGW.allowed_subnet_flow
        SINVAR_SubnetsInGW.default_node_properties
        <span class="main">(</span>system_components_to_subnets <span class="free">c</span><span class="main">)</span> <span class="main">⟷</span>
       <span class="free">c</span> <span class="main">=</span> SystemBoundaryInput <span class="main">∨</span> <span class="free">c</span> <span class="main">=</span> SystemBoundaryInputOutput"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_SubnetsInGW.default_node_properties_def<span class="main">)</span>

<span class="keyword1" id="METASINVAR_SystemBoundary-system_components_to_blp"><span class="command">lemma</span></span> system_components_to_blp<span class="main">:</span>
      <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">¬</span> trusted SINVAR_BLPtrusted.default_node_properties <span class="main">⟶</span>
       security_level <span class="main">(</span>system_components_to_blp <span class="free">c</span><span class="main">)</span> <span class="main">≤</span> security_level SINVAR_BLPtrusted.default_node_properties<span class="main">)</span>
       <span class="main">⟷</span>
       <span class="free">c</span> <span class="main">=</span> SystemBoundaryOutput <span class="main">∨</span> <span class="free">c</span> <span class="main">=</span> SystemBoundaryInputOutput"</span></span>
<span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">c</span></span><span class="main">)</span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_BLPtrusted.default_node_properties_def<span class="main">)</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>new_meta_system_boundary <span class="free">C</span> <span class="free">description</span><span class="main">)</span> <span class="free">G</span> <span class="main">⟷</span>
       <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">v<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="bound">v<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="keyword1">case</span> <span class="main">(</span><span class="main">(</span>map_of <span class="free">C</span><span class="main">)</span> <span class="bound">v<span class="hidden">⇩</span><sub>1</sub></span><span class="main">,</span> <span class="main">(</span>map_of <span class="free">C</span><span class="main">)</span> <span class="bound">v<span class="hidden">⇩</span><sub>2</sub></span><span class="main">)</span>
          <span class="keyword1">of</span> 
          <span class="comment1">― ‹No restrictions outside of the component›</span>
             <span class="main">(</span>None<span class="main">,</span> None<span class="main">)</span> <span class="main">⇒</span> True

          <span class="comment1">― ‹no restrictions inside the component›</span>
          <span class="main">|</span>  <span class="main">(</span>Some <span class="bound">c1</span><span class="main">,</span> Some <span class="bound">c2</span><span class="main">)</span> <span class="main">⇒</span> True

          <span class="comment1">― ‹System Boundaries Input›</span>
          <span class="main">|</span>  <span class="main">(</span>None<span class="main">,</span> Some SystemBoundaryInputOutput<span class="main">)</span> <span class="main">⇒</span> True
          <span class="main">|</span>  <span class="main">(</span>None<span class="main">,</span> Some SystemBoundaryInput<span class="main">)</span> <span class="main">⇒</span> True

          <span class="comment1">― ‹System Boundaries Output›</span>
          <span class="main">|</span>  <span class="main">(</span>Some SystemBoundaryOutput<span class="main">,</span> None<span class="main">)</span> <span class="main">⇒</span> True
          <span class="main">|</span>  <span class="main">(</span>Some SystemBoundaryInputOutput<span class="main">,</span> None<span class="main">)</span> <span class="main">⇒</span> True

          <span class="comment1">― ‹everything else is prohibited›</span>
          <span class="main">|</span>  <span class="main"><span class="bound">_</span></span> <span class="main">⇒</span> False
       <span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> new_meta_system_boundary_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> all_security_requirements_fulfilled_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Let_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_LIB_SubnetsInGW_def SINVAR_LIB_BLPtrusted_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_SubnetsInGW_impl.NetModel_node_props_def SINVAR_BLPtrusted_impl.NetModel_node_props_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> iffI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main"><span class="main">(</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">a</span></span></span><span class="main"><span class="main"><span class="main">,</span></span></span><span class="skolem"><span class="skolem"><span class="skolem">b</span></span></span><span class="main"><span class="main"><span class="main">)</span></span></span>"</span></span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"map_of <span class="free">C</span> <span class="skolem">a</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"map_of <span class="free">C</span> <span class="skolem">b</span>"</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_of_map<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> system_components.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> system_components_to_subnets<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"map_of <span class="free">C</span> <span class="skolem">b</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_of_map<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> system_components.split<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> system_components_to_blp<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_of_map<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> system_components.split<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">intro</span> conjI<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_of_map<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split_asm system_components.split_asm<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_SubnetsInGW.default_node_properties_def<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">subgoal</span></span></span></span> <span class="keyword2"><span class="keyword">for</span></span> a b
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="skolem"><span class="skolem">a</span></span><span class="main"><span class="main">,</span></span><span class="skolem"><span class="skolem">b</span></span><span class="main"><span class="main">)</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> ballE<span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> map_of_map<span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> option.split_asm system_components.split_asm<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_BLPtrusted.default_node_properties_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> x<span class="main"><span class="keyword3">,</span></span> <span class="operator">case_tac</span> <span class="quoted"><span class="improper"><span class="quoted"><span class="improper">x</span></span></span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">simp_all</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"<span class="keyword1">let</span> <span class="bound">nodes</span> <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">9</span><span class="main">,</span><span class="numeral">10</span><span class="main">]</span><span class="main">;</span>
           <span class="bound">sinvars</span> <span class="main">=</span> new_meta_system_boundary
              <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> SystemBoundaryInput<span class="main">)</span><span class="main">,</span>
               <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> SystemComponent<span class="main">)</span><span class="main">,</span>
               <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> SystemBoundaryOutput<span class="main">)</span><span class="main">,</span>
               <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> SystemBoundaryInputOutput<span class="main">)</span>
               <span class="main">]</span> <span class="inner_quoted">''foobar''</span>
       <span class="keyword1">in</span> generate_valid_topology <span class="bound">sinvars</span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="bound">nodes</span><span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="bound">nodes</span> <span class="bound">nodes</span> <span class="main">⦈</span>"</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_Impl">
<div class="head">
<h1>Theory TopoS_Impl</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_Impl
<span class="keyword2"><span class="keyword">imports</span></span> <a href="TopoS_Library.html">TopoS_Library</a> <a href="TopoS_Composition_Theory_impl.html">TopoS_Composition_Theory_impl</a>
    <span class="comment1">(*Mehr Meta wagen!*)</span>
    <span class="quoted">"<a href="METASINVAR_SystemBoundary.html">Security_Invariants/METASINVAR_SystemBoundary</a>"</span>
    <span class="comment1">(*stuff*)</span>
    <span class="quoted">"<a href="ML_GraphViz.html">Lib/ML_GraphViz</a>"</span>
    <a href="TopoS_Stateful_Policy_impl.html">TopoS_Stateful_Policy_impl</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">‹ML Visualization Interface›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">print_offending_flows_debug</span> <span class="main">::</span>
  <span class="quoted"><span class="quoted">"<span class="tfree">'v</span>  SecurityInvariant list <span class="main">⇒</span> <span class="tfree">'v</span> list_graph <span class="main">⇒</span> <span class="main">(</span>string <span class="main">×</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list list<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">print_offending_flows_debug</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="main">=</span> map
    <span class="main">(</span><span class="main">λ</span><span class="bound">m</span><span class="main">.</span>
         <span class="main">(</span>implc_description <span class="bound">m</span> <span class="main">@</span> <span class="inner_quoted">'' (''</span> <span class="main">@</span> implc_type <span class="bound">m</span> <span class="main">@</span> <span class="inner_quoted">'')''</span>
         <span class="main">,</span> implc_offending_flows <span class="bound">m</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span>
    <span class="main">)</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>

<span class="comment1">(*TODO: move and tune*)</span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">pretty_assoclist</span> <span class="entity">ctxt</span> <span class="entity">header</span> <span class="entity">t</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">ls</span> <span class="main">:</span> <span class="main">(</span>term * term<span class="main">)</span> list <span class="main">=</span> <span class="entity">t</span> |&gt; <span class="entity">HOLogic.dest_list</span> |&gt; map <span class="entity">HOLogic.dest_prod</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">pretty</span> <span class="main">=</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">t</span> <span class="main">=&gt;</span> Pretty.string_of <span class="main">(</span>Syntax.pretty_term <span class="entity">ctxt</span> <span class="entity">t</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span> <span class="entity">ls</span>
       |&gt; map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">x</span><span class="main">,</span> <span class="entity">y</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="inner_quoted">"  "</span>^<span class="entity">pretty</span> <span class="entity">x</span>^<span class="inner_quoted">": "</span>^<span class="entity">pretty</span> <span class="entity">y</span><span class="main">)</span>
       |&gt; space_implode <span class="inner_quoted">"\n"</span>
       |&gt; <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">s</span> <span class="main">=&gt;</span> <span class="entity">header</span>^<span class="entity">s</span><span class="main">)</span>
       |&gt; writeln <span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Utility Functions›</span></span>

  <span class="keyword1"><span class="command">fun</span></span> <span class="entity">rembiflowdups</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">rembiflowdups</span> <span class="main">[]</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="main">|</span>
    <span class="quoted"><span class="quoted">"<span class="free">rembiflowdups</span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="keyword1">if</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="main">∨</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="keyword1">then</span> <span class="free">rembiflowdups</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span> <span class="keyword1">else</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">s</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">r</span></span></span><span class="main">)</span><span class="main">#</span><span class="free">rembiflowdups</span> <span class="free"><span class="bound"><span class="entity">as</span></span></span><span class="main">)</span>"</span></span>


  <span class="keyword1" id="TopoS_Impl-rembiflowdups_complete"><span class="command">lemma</span></span> rembiflowdups_complete<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⟦</span> <span class="main">∀</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">x</span> <span class="main">⟧</span> <span class="main">⟹</span> set <span class="main">(</span>rembiflowdups <span class="free">x</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>backlinks <span class="main">(</span>rembiflowdups <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> set <span class="free">x</span>"</span></span>
    <span class="keyword1"><span class="command">proof</span></span>
      <span class="keyword3"><span class="command">assume</span></span> a<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="free">x</span>"</span></span>
      <span class="keyword1"><span class="command">have</span></span> subset1<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rembiflowdups <span class="free">x</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarsimp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> if_split_asm<span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">blast</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> set_backlinks_simp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="main">∀</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">x</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="bound">x</span> <span class="main">⟹</span> set <span class="main">(</span>backlinks <span class="bound">x</span><span class="main">)</span> <span class="main">=</span> set <span class="bound">x</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_set<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
         <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span><span class="main"><span class="keyword3">+</span></span>
      <span class="keyword1"><span class="command">have</span></span> subset2<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>backlinks <span class="main">(</span>rembiflowdups <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">x</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">subst</span> set_backlinks_simp<span class="main"><span class="main">[</span></span><span class="operator">OF</span> a<span class="main"><span class="main">,</span></span> <span class="operator">symmetric</span><span class="main"><span class="main">]</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_subset subset1<span class="main">)</span>

      <span class="keyword1"><span class="command">from</span></span> subset1 subset2 
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>rembiflowdups <span class="free">x</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>backlinks <span class="main">(</span>rembiflowdups <span class="free">x</span><span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="free">x</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="quoted">"set <span class="free">x</span> <span class="main">⊆</span> set <span class="main">(</span>rembiflowdups <span class="free">x</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>backlinks <span class="main">(</span>rembiflowdups <span class="free">x</span><span class="main">)</span><span class="main">)</span>"</span></span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">x</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> a as e<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule</span> disjE<span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">defer</span></span></span></span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">fastforce</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="improper">a</span></span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> s r<span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="improper">s</span><span class="main">,</span><span class="improper">r</span><span class="main">)</span> <span class="main">∉</span> set <span class="improper">as</span> <span class="main">∧</span> <span class="main">(</span><span class="improper">r</span><span class="main">,</span><span class="improper">s</span><span class="main">)</span> <span class="main">∉</span> set <span class="improper">as</span>"</span></span><span class="main">)</span>
         <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
        <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> backlinks_set<span class="main">)</span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">qed</span></span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹only for prettyprinting›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">filter_for_biflows</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">filter_for_biflows</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">≡</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">.</span> <span class="main">(</span>snd <span class="bound">e</span><span class="main">,</span> fst <span class="bound">e</span><span class="main">)</span> <span class="main">∈</span> set <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">]</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">filter_for_uniflows</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">filter_for_uniflows</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">≡</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">.</span> <span class="main">(</span>snd <span class="bound">e</span><span class="main">,</span> fst <span class="bound">e</span><span class="main">)</span> <span class="main">∉</span> set <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">]</span>"</span></span>

  <span class="keyword1" id="TopoS_Impl-filter_for_biflows_correct"><span class="command">lemma</span></span> filter_for_biflows_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>filter_for_biflows <span class="free">E</span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>filter_for_biflows <span class="free">E</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> filter_for_biflows_def
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">E</span></span><span class="main"><span class="keyword3">,</span></span> <span class="operator">auto</span><span class="main">)</span>

  <span class="keyword1" id="TopoS_Impl-filter_for_biflows_un_filter_for_uniflows"><span class="command">lemma</span></span> filter_for_biflows_un_filter_for_uniflows<span class="main">:</span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_for_biflows <span class="free">E</span><span class="main">)</span> <span class="main">∪</span> set <span class="main">(</span>filter_for_uniflows <span class="free">E</span><span class="main">)</span> <span class="main">=</span> set <span class="free">E</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_for_biflows_def filter_for_uniflows_def<span class="main">)</span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">partition_by_biflows</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> list <span class="main">⇒</span> <span class="main">(</span><span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> list <span class="main">×</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span> <span class="tfree">'a</span><span class="main">)</span> list<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">partition_by_biflows</span> <span class="free"><span class="bound"><span class="entity">E</span></span></span> <span class="main">≡</span> <span class="main">(</span>rembiflowdups <span class="main">(</span>filter_for_biflows <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span><span class="main">,</span> remdups <span class="main">(</span>filter_for_uniflows <span class="free"><span class="bound"><span class="entity">E</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="TopoS_Impl-partition_by_biflows_correct"><span class="command">lemma</span></span> partition_by_biflows_correct<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="keyword1">case</span> partition_by_biflows <span class="free">E</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">biflows</span><span class="main">,</span> <span class="bound">uniflows</span><span class="main">)</span> <span class="main">⇒</span> set <span class="bound">biflows</span> <span class="main">∪</span> set <span class="main">(</span>backlinks <span class="main">(</span><span class="bound">biflows</span><span class="main">)</span><span class="main">)</span> <span class="main">∪</span> set <span class="bound">uniflows</span> <span class="main">=</span> set <span class="free">E</span>"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> partition_by_biflows_def<span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> filter_for_biflows_un_filter_for_uniflows filter_for_biflows_correct rembiflowdups_complete<span class="main">)</span>


  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"partition_by_biflows <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span> <span class="main">(</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>



<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="comment1">(*apply args to f. f ist best supplied using @{const_name "name_of_function"} *)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">apply_function</span> <span class="main">(</span><span class="entity">ctxt</span><span class="main">:</span> <span class="entity">Proof.context</span><span class="main">)</span> <span class="main">(</span><span class="entity">f</span><span class="main">:</span> string<span class="main">)</span> <span class="main">(</span><span class="entity">args</span><span class="main">:</span> term list<span class="main">)</span> <span class="main">:</span> term <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> writeln <span class="main">(</span><span class="inner_quoted">"applying "</span>^<span class="entity">f</span>^<span class="inner_quoted">" to "</span> ^ <span class="main">(</span>fold <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">t</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">acc</span> <span class="main">=&gt;</span> <span class="entity">acc</span>^<span class="main">(</span>Pretty.string_of <span class="main">(</span>Syntax.pretty_term <span class="main">(</span>Config.put show_types true <span class="entity">ctxt</span><span class="main">)</span> <span class="entity">t</span><span class="main">)</span><span class="main">)</span>^<span class="inner_quoted">" "</span><span class="main">)</span> <span class="entity">args</span> <span class="inner_quoted">""</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="comment1">(*val t_eval = Code_Evaluation.dynamic_value_strict thy t;*)</span>
    <span class="comment1">(* $ associates to the left, give f its arguments*)</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">applied_untyped_uneval</span><span class="main">:</span> term <span class="main">=</span> list_comb <span class="main">(</span>Const <span class="main">(</span><span class="entity">f</span><span class="main">,</span> dummyT<span class="main">)</span><span class="main">,</span> <span class="entity">args</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">applied_uneval</span><span class="main">:</span> term <span class="main">=</span> Syntax.check_term <span class="entity">ctxt</span> <span class="entity">applied_untyped_uneval</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">applied_uneval</span> |&gt; <span class="entity">Code_Evaluation.dynamic_value_strict</span> <span class="entity">ctxt</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>


<span class="comment1">(*ctxt -&gt; edges -&gt; (biflows, uniflows)*)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">partition_by_biflows</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">t</span><span class="main">:</span> term<span class="main">)</span> <span class="main">:</span> <span class="main">(</span>term * term<span class="main">)</span> <span class="main">=</span> 
  <span class="entity">apply_function</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "partition_by_biflows"<span class="antiquote">}</span></span> <span class="main">[</span><span class="entity">t</span><span class="main">]</span> |&gt; <span class="entity">HOLogic.dest_prod</span>


<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_tune_node_format</span> <span class="main">(</span><span class="entity">edges</span><span class="main">:</span> term<span class="main">)</span> <span class="main">:</span> term <span class="main">-&gt;</span> string <span class="main">-&gt;</span> string <span class="main">=</span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span>fastype_of <span class="entity">edges</span><span class="main">)</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"<span class="main">(</span>string <span class="main">×</span> string<span class="main">)</span> list"</span><span class="antiquote">}</span></span>
    <span class="keyword2"><span class="keyword">then</span></span>
      <span class="entity">tune_string_vertex_format</span>
    <span class="keyword2"><span class="keyword">else</span></span>
      <span class="entity">Graphviz.default_tune_node_format</span><span class="main">;</span>

  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">evalutae_term</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">edges</span><span class="main">:</span> term<span class="main">)</span> <span class="main">:</span> term <span class="main">=</span> 
    <span class="keyword2"><span class="keyword">case</span></span> <span class="entity">Code_Evaluation.dynamic_value</span> <span class="entity">ctxt</span> <span class="entity">edges</span>
      <span class="keyword2"><span class="keyword">of</span></span> SOME <span class="entity">x</span> <span class="main">=&gt;</span> <span class="entity">x</span>
      <span class="main">|</span> NONE <span class="main">=&gt;</span> <span class="keyword3"><span class="keyword">raise</span></span> TERM <span class="main">(</span><span class="inner_quoted">"could not evaluate"</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">visualize_edges</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">edges</span><span class="main">:</span> term<span class="main">)</span> <span class="main">(</span><span class="entity">coloredges</span><span class="main">:</span> <span class="main">(</span>string * term<span class="main">)</span> list<span class="main">)</span> <span class="main">(</span><span class="entity">graphviz_header</span><span class="main">:</span> string<span class="main">)</span> <span class="main">=</span> 
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> writeln<span class="main">(</span><span class="inner_quoted">"visualize_edges"</span><span class="main">)</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">biflows</span><span class="main">,</span> <span class="entity">uniflows</span><span class="main">)</span> <span class="main">=</span> <span class="entity">partition_by_biflows</span> <span class="entity">ctxt</span> <span class="entity">edges</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      <span class="entity">Graphviz.visualize_graph_pretty</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">get_tune_node_format</span> <span class="entity">edges</span><span class="main">)</span> <span class="main">(</span><span class="main">[</span>
      <span class="main">(</span><span class="inner_quoted">""</span><span class="main">,</span> <span class="entity">uniflows</span><span class="main">)</span><span class="main">,</span>
      <span class="main">(</span><span class="inner_quoted">"edge [dir=\"none\", color=\"#000000\"]"</span><span class="main">,</span> <span class="entity">biflows</span><span class="main">)</span><span class="main">]</span> @ <span class="entity">coloredges</span><span class="main">)</span> <span class="comment1">(*dir=none, dir=both*)</span>
       <span class="entity">graphviz_header</span>
    <span class="keyword2"><span class="keyword">end</span></span>

  <span class="comment1">(*iterate over the edges in ML, useful for printing them in certain formats*)</span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">iterate_edges_ML</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">edges</span><span class="main">:</span> term<span class="main">)</span> <span class="main">(</span><span class="entity">all</span><span class="main">:</span> <span class="main">(</span>string*string<span class="main">)</span> <span class="main">-&gt;</span> unit<span class="main">)</span> <span class="main">(</span><span class="entity">bi</span><span class="main">:</span> <span class="main">(</span>string*string<span class="main">)</span> <span class="main">-&gt;</span> unit<span class="main">)</span> <span class="main">(</span><span class="entity">uni</span><span class="main">:</span> <span class="main">(</span>string*string<span class="main">)</span> <span class="main">-&gt;</span> unit<span class="main">)</span><span class="main">:</span> unit <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> writeln<span class="main">(</span><span class="inner_quoted">"iterate_edges_ML"</span><span class="main">)</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">tune_node_format</span> <span class="main">=</span> <span class="main">(</span><span class="entity">get_tune_node_format</span> <span class="entity">edges</span><span class="main">)</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">node_to_string</span> <span class="main">=</span> <span class="entity">Graphviz.node_to_string</span> <span class="entity">ctxt</span> <span class="entity">tune_node_format</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">evaluated_edges</span> <span class="main">:</span> term <span class="main">=</span> <span class="entity">evalutae_term</span> <span class="entity">ctxt</span> <span class="entity">edges</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">biflows</span><span class="main">,</span> <span class="entity">uniflows</span><span class="main">)</span> <span class="main">=</span> <span class="entity">partition_by_biflows</span> <span class="entity">ctxt</span> <span class="entity">evaluated_edges</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      <span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">edge_to_list</span> <span class="main">(</span><span class="entity">es</span><span class="main">:</span> term<span class="main">)</span> <span class="main">:</span> <span class="main">(</span>term * term<span class="main">)</span> list <span class="main">=</span> <span class="entity">es</span> |&gt; <span class="entity">HOLogic.dest_list</span> |&gt; map <span class="entity">HOLogic.dest_prod</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">edge_to_string</span> <span class="main">(</span><span class="entity">es</span><span class="main">:</span> <span class="main">(</span>term * term<span class="main">)</span> list<span class="main">)</span> <span class="main">:</span> <span class="main">(</span>string * string<span class="main">)</span> list <span class="main">=</span>
          map <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span> <span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="entity">node_to_string</span> <span class="entity">v1</span><span class="main">,</span> <span class="entity">node_to_string</span> <span class="entity">v2</span><span class="main">)</span><span class="main">)</span> <span class="entity">es</span>
      <span class="keyword2"><span class="keyword">in</span></span>
        <span class="entity">edge_to_list</span> <span class="entity">evaluated_edges</span> |&gt; <span class="entity">edge_to_string</span> |&gt; map <span class="entity">all</span><span class="main">;</span>
        <span class="entity">edge_to_list</span> <span class="entity">biflows</span> |&gt; <span class="entity">edge_to_string</span> |&gt; map <span class="entity">bi</span><span class="main">;</span>
        <span class="entity">edge_to_list</span> <span class="entity">uniflows</span> |&gt; <span class="entity">edge_to_string</span> |&gt; map <span class="entity">uni</span><span class="main">;</span>
        <span class="main">(</span><span class="main">)</span>
      <span class="keyword2"><span class="keyword">end</span></span>
      <span class="keyword3"><span class="keyword">handle</span></span> Subscript <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"Subscript Exception in iterate_edges_ML"</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
    
<span class="keyword2"><span class="keyword">end</span></span>
›</span>

<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">biflows</span><span class="main">,</span> <span class="entity">uniflows</span><span class="main">)</span> <span class="main">=</span> <span class="entity">partition_by_biflows</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">::</span>int<span class="main">,</span> <span class="main">1</span><span class="main">::</span>int<span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Pretty.writeln <span class="main">(</span>Syntax.pretty_term <span class="main">(</span>Config.put show_types true <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span><span class="main">)</span> <span class="entity">biflows</span><span class="main">)</span><span class="main">;</span>
  <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> Pretty.writeln <span class="main">(</span>Syntax.pretty_term <span class="main">(</span>Config.put show_types true <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span><span class="main">)</span> <span class="entity">uniflows</span><span class="main">)</span><span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="keyword1"><span class="keyword">val</span></span> <span class="entity">t</span> <span class="main">=</span> fastype_of <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="inner_quoted">''x''</span><span class="main">,</span> <span class="numeral">2</span><span class="main">::</span>nat<span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>

›</span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹<span class="comment1">(*
visualize_edges @{context}  @{term "[(1::int, 1::int), (1,2), (2, 1), (1,3)]"} []; *)</span>
›</span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">internal_get_invariant_types_list</span><span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> SecurityInvariant list <span class="main">⇒</span> string list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">internal_get_invariant_types_list</span> <span class="free"><span class="bound"><span class="entity">M</span></span></span> <span class="main">≡</span> map implc_type <span class="free"><span class="bound"><span class="entity">M</span></span></span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">internal_node_configs</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'a</span> list_graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">⇒</span> <span class="tfree">'b</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'a</span> <span class="main">×</span><span class="tfree">'b</span><span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">internal_node_configs</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">config</span></span></span> <span class="main">≡</span> zip <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span> <span class="main">(</span>map <span class="free"><span class="bound"><span class="entity">config</span></span></span> <span class="main">(</span>nodesL <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">ML</span></span> <span class="quoted">‹
<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">get_graphivz_node_desc</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">node_config</span><span class="main">:</span> term<span class="main">)</span><span class="main">:</span> string <span class="main">=</span>
   <span class="keyword2"><span class="keyword">let</span></span>
     <span class="keyword1"><span class="keyword">val</span></span> <span class="main">(</span><span class="entity">node</span><span class="main">,</span> <span class="entity">config</span><span class="main">)</span> <span class="main">=</span> <span class="entity">HOLogic.dest_prod</span> <span class="entity">node_config</span><span class="main">;</span>
     <span class="comment1">(*TODO: tune node format? There must be a better way ...*)</span>
     <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">tune_node_format</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="main">(</span>fastype_of <span class="entity">node</span><span class="main">)</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">typ</span> <span class="quoted">"string"</span><span class="antiquote">}</span></span>
      <span class="keyword2"><span class="keyword">then</span></span>
        <span class="entity">tune_string_vertex_format</span>
      <span class="keyword2"><span class="keyword">else</span></span>
        <span class="entity">Graphviz.default_tune_node_format</span><span class="main">;</span>
     <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">node_str</span> <span class="main">=</span> <span class="entity">Graphviz.node_to_string</span> <span class="entity">ctxt</span> <span class="entity">tune_node_format</span> <span class="entity">node</span><span class="main">;</span>
     <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">config_str</span> <span class="main">=</span> <span class="entity">Graphviz.term_to_string_html</span> <span class="entity">ctxt</span> <span class="entity">config</span><span class="main">;</span>
   <span class="keyword2"><span class="keyword">in</span></span>
     <span class="entity">node_str</span>^<span class="inner_quoted">"[label=&lt;&lt;TABLE BORDER=\"0\" CELLSPACING=\"0\"&gt;&lt;TR&gt;&lt;TD&gt;&lt;FONT face=\"Verdana Bold\"&gt;"</span>^<span class="entity">node_str</span>^<span class="inner_quoted">"&lt;/FONT&gt;&lt;/TD&gt;&lt;/TR&gt;&lt;TR&gt;&lt;TD&gt;"</span>^<span class="entity">config_str</span>^<span class="inner_quoted">"&lt;/TD&gt;&lt;/TR&gt;&lt;/TABLE&gt;&gt;]\n"</span>
   <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">generate_graphviz_header</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">G</span><span class="main">:</span> term<span class="main">)</span> <span class="main">(</span><span class="entity">configs</span><span class="main">:</span> term<span class="main">)</span><span class="main">:</span> string <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">configlist</span><span class="main">:</span> term list <span class="main">=</span> <span class="entity">apply_function</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "internal_node_configs"<span class="antiquote">}</span></span> <span class="main">[</span><span class="entity">G</span><span class="main">,</span> <span class="entity">configs</span><span class="main">]</span> |&gt; <span class="entity">HOLogic.dest_list</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      fold <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">c</span> <span class="main">=&gt;</span> <span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">acc</span> <span class="main">=&gt;</span> <span class="entity">acc</span>^<span class="entity">get_graphivz_node_desc</span> <span class="entity">ctxt</span> <span class="entity">c</span><span class="main">)</span> <span class="entity">configlist</span> <span class="inner_quoted">""</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="comment1">(* Convenience function. Use whenever possible!
  M: security requirements, list
  G: list_graph*)</span>
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">visualize_graph_header</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">M</span><span class="main">:</span> term<span class="main">)</span> <span class="main">(</span><span class="entity">G</span><span class="main">:</span> term<span class="main">)</span> <span class="main">(</span><span class="entity">Config</span><span class="main">:</span> term<span class="main">)</span><span class="main">:</span> unit <span class="main">=</span> 
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">wf_list_graph</span> <span class="main">=</span> <span class="entity">apply_function</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "wf_list_graph"<span class="antiquote">}</span></span> <span class="main">[</span><span class="entity">G</span><span class="main">]</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">all_fulfilled</span> <span class="main">=</span> <span class="entity">apply_function</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "all_security_requirements_fulfilled"<span class="antiquote">}</span></span> <span class="main">[</span><span class="entity">M</span><span class="main">,</span> <span class="entity">G</span><span class="main">]</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">edges</span> <span class="main">=</span> <span class="entity">apply_function</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "edgesL"<span class="antiquote">}</span></span> <span class="main">[</span><span class="entity">G</span><span class="main">]</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">invariants</span> <span class="main">=</span> <span class="entity">apply_function</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "internal_get_invariant_types_list"<span class="antiquote">}</span></span> <span class="main">[</span><span class="entity">M</span><span class="main">]</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="main">_</span> <span class="main">=</span> writeln<span class="main">(</span><span class="inner_quoted">"Invariants:"</span> ^ Pretty.string_of <span class="main">(</span>Syntax.pretty_term <span class="entity">ctxt</span> <span class="entity">invariants</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">header</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">Config</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[]</span>"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span> <span class="inner_quoted">"#header"</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="entity">generate_graphviz_header</span> <span class="entity">ctxt</span> <span class="entity">G</span> <span class="entity">Config</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">wf_list_graph</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"False"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span>
      error <span class="main">(</span><span class="inner_quoted">"The supplied graph is syntactically invalid. Check wf_list_graph."</span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">all_fulfilled</span> <span class="main">=</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"False"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span>
      <span class="main">(</span><span class="keyword2"><span class="keyword">let</span></span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">offending</span> <span class="main">=</span> <span class="entity">apply_function</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "implc_get_offending_flows"<span class="antiquote">}</span></span> <span class="main">[</span><span class="entity">M</span><span class="main">,</span> <span class="entity">G</span><span class="main">]</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">offending_flat</span> <span class="main">=</span> <span class="entity">apply_function</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "List.remdups"<span class="antiquote">}</span></span> <span class="main">[</span><span class="entity">apply_function</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> "List.concat"<span class="antiquote">}</span></span> <span class="main">[</span><span class="entity">offending</span><span class="main">]</span><span class="main">]</span><span class="main">;</span>
        <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">offending_debug</span> <span class="main">=</span> <span class="entity">apply_function</span> <span class="entity">ctxt</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">const_name</span> print_offending_flows_debug<span class="antiquote">}</span></span> <span class="main">[</span><span class="entity">M</span><span class="main">,</span> <span class="entity">G</span><span class="main">]</span><span class="main">;</span>
      <span class="keyword2"><span class="keyword">in</span></span>
       writeln<span class="main">(</span><span class="inner_quoted">"offending flows:"</span><span class="main">)</span><span class="main">;</span>
       Pretty.writeln <span class="main">(</span>Syntax.pretty_term <span class="entity">ctxt</span> <span class="entity">offending</span><span class="main">)</span><span class="main">;</span>
       <span class="entity">pretty_assoclist</span> <span class="entity">ctxt</span> <span class="inner_quoted">"Offending flows per invariant:\n"</span> <span class="entity">offending_debug</span><span class="main">;</span>
       <span class="entity">visualize_edges</span> <span class="entity">ctxt</span> <span class="entity">edges</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF0000\", constraint=false]"</span><span class="main">,</span> <span class="entity">offending_flat</span><span class="main">)</span><span class="main">]</span> <span class="entity">header</span><span class="main">;</span> 
      <span class="main">(</span><span class="main">)</span> <span class="keyword2"><span class="keyword">end</span></span><span class="main">)</span>
    <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">all_fulfilled</span> &lt;&gt; <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"True"</span><span class="antiquote">}</span></span> <span class="keyword2"><span class="keyword">then</span></span> <span class="keyword3"><span class="keyword">raise</span></span> ERROR <span class="inner_quoted">"all_fulfilled neither False nor True"</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="main">(</span>
       writeln<span class="main">(</span><span class="inner_quoted">"All valid:"</span><span class="main">)</span><span class="main">;</span>
       <span class="entity">visualize_edges</span> <span class="entity">ctxt</span> <span class="entity">edges</span> <span class="main">[</span><span class="main">]</span> <span class="entity">header</span><span class="main">;</span> 
      <span class="main">(</span><span class="main">)</span><span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>


<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">visualize_graph</span> <span class="entity">ctxt</span> <span class="main">(</span><span class="entity">M</span><span class="main">:</span> term<span class="main">)</span> <span class="main">(</span><span class="entity">G</span><span class="main">:</span> term<span class="main">)</span><span class="main">:</span> unit <span class="main">=</span> <span class="entity">visualize_graph_header</span> <span class="entity">ctxt</span> <span class="entity">M</span> <span class="entity">G</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[]</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Network_Security_Policy_Verification">
<div class="head">
<h1>Theory Network_Security_Policy_Verification</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Network Security Policy Verification›</span></span>
<span class="keyword1"><span class="command">theory</span></span> Network_Security_Policy_Verification
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="TopoS_Interface.html">TopoS_Interface</a>
  <a href="TopoS_Interface_impl.html">TopoS_Interface_impl</a>
  <a href="TopoS_Library.html">TopoS_Library</a>
  <a href="TopoS_Composition_Theory.html">TopoS_Composition_Theory</a>
  <a href="TopoS_Stateful_Policy.html">TopoS_Stateful_Policy</a>
  <a href="TopoS_Composition_Theory_impl.html">TopoS_Composition_Theory_impl</a>
  <a href="TopoS_Stateful_Policy_Algorithm.html">TopoS_Stateful_Policy_Algorithm</a>
  <a href="TopoS_Stateful_Policy_impl.html">TopoS_Stateful_Policy_impl</a>
  <a href="TopoS_Impl.html">TopoS_Impl</a>
<span class="keyword2"><span class="keyword">begin</span></span>



<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹A small Tutorial›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We demonstrate usage of the executable theory.›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Everything that is indented and starts with `Interlude:' summarizes the main correctness proofs and can be skipped if only the implementation is concerned›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Policy›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The secuity policy is a directed graph.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">policy</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>
                edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹It is syntactically well-formed›</span></span>
<span class="keyword1" id="Network_Security_Policy_Verification-wf_list_graph_policy"><span class="command">lemma</span></span> wf_list_graph_policy<span class="main">:</span> <span class="quoted"><span class="quoted">"wf_list_graph policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In contrast, this is not a syntactically well-formed graph.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> wf_list_graph <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">]</span><span class="main">::</span>nat list<span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Our <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> policy<span class="antiquote"><span class="antiquote">}</span></span></span></span> has three rules.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>edgesL policy<span class="main">)</span> <span class="main">=</span> <span class="numeral">3</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Security Invariants›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We construct a security invariant. Node <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">::</span></span>nat"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has confidential data›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLP_security_levels</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat <span class="main">⇀</span> SINVAR_BLPtrusted.node_config"</span></span><span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">BLP_security_levels</span> <span class="main">≡</span> <span class="main">[</span><span class="numeral">2</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLP_m</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>nat SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">BLP_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_BLPtrusted <span class="main">⦇</span> 
          node_properties <span class="main">=</span> BLP_security_levels
          <span class="main">⦈</span> <span class="inner_quoted">''Two has confidential information''</span>"</span></span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interlude: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> BLP_m<span class="antiquote"><span class="antiquote">}</span></span></span></span> is a valid implementation of a SecurityInvariant›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLP_m_spec</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat SecurityInvariant_configured option"</span></span><span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">BLP_m_spec</span> <span class="main">≡</span> new_configured_SecurityInvariant <span class="main">(</span>
        SINVAR_BLPtrusted.sinvar<span class="main">,</span>
        SINVAR_BLPtrusted.default_node_properties<span class="main">,</span>
        SINVAR_BLPtrusted.receiver_violation<span class="main">,</span>
        SecurityInvariant.node_props SINVAR_BLPtrusted.default_node_properties <span class="main">⦇</span> 
          node_properties <span class="main">=</span> BLP_security_levels
        <span class="main">⦈</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Fist, we need to show that the formal definition obeys all requirements, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> new_configured_SecurityInvariant<span class="antiquote"><span class="antiquote">}</span></span></span></span> verifies this. To double check, we manually give the configuration.›</span></span>
  <span class="keyword1" id="Network_Security_Policy_Verification-BLP_m_spec"><span class="command">lemma</span></span> BLP_m_spec<span class="main">:</span> <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="main">=</span> <span class="main">(</span><span class="main">λ</span> <span class="bound">v</span><span class="main">.</span> <span class="main">(</span><span class="keyword1">case</span> BLP_security_levels <span class="bound">v</span> <span class="keyword1">of</span> Some <span class="bound">c</span> <span class="main">⇒</span> <span class="bound">c</span> <span class="main">|</span> None <span class="main">⇒</span> SINVAR_BLPtrusted.default_node_properties<span class="main">)</span><span class="main">)</span>"</span></span>
      <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"BLP_m_spec <span class="main">=</span> Some <span class="main">⦇</span> 
              c_sinvar <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> SINVAR_BLPtrusted.sinvar <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">,</span>
              c_offending_flows <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="bound">G</span><span class="main">.</span> SecurityInvariant_withOffendingFlows.set_offending_flows SINVAR_BLPtrusted.sinvar <span class="bound">G</span> <span class="free">nP</span><span class="main">)</span><span class="main">,</span>
              c_isIFS <span class="main">=</span> SINVAR_BLPtrusted.receiver_violation
            <span class="main">⦈</span>"</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">is</span></span> <span class="quoted"><span class="quoted">"BLP_m_spec <span class="main">=</span> Some <span class="var">?Spec</span>"</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span> 
    <span class="keyword1"><span class="command">have</span></span> NetModelLib<span class="main">:</span> <span class="quoted"><span class="quoted">"TopoS_modelLibrary SINVAR_LIB_BLPtrusted SINVAR_BLPtrusted.sinvar"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> nP<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">nP</span> <span class="main">=</span> nm_node_props SINVAR_LIB_BLPtrusted <span class="main">⦇</span> 
              node_properties <span class="main">=</span> BLP_security_levels
            <span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff SINVAR_LIB_BLPtrusted_def SINVAR_BLPtrusted_impl.NetModel_node_props_def<span class="main">)</span>
  
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"BLP_m_spec <span class="main">=</span> new_configured_SecurityInvariant <span class="main">(</span>SINVAR_BLPtrusted.sinvar<span class="main">,</span> SINVAR_BLPtrusted.default_node_properties<span class="main">,</span> SINVAR_BLPtrusted.receiver_violation<span class="main">,</span> <span class="free">nP</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> BLP_m_spec_def nP <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_BLPtrusted_impl.NetModel_node_props_def SINVAR_LIB_BLPtrusted_def<span class="main">)</span>
    <span class="keyword1"><span class="command">also</span></span> <span class="keyword1"><span class="command"><span class="improper">with</span></span></span> TopoS_modelLibrary_yields_new_configured_SecurityInvariant<span class="main">[</span><span class="operator">OF</span> NetModelLib nP<span class="main">]</span>
    <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">…</span> <span class="main">=</span> Some <span class="var">?Spec</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SINVAR_LIB_BLPtrusted_def<span class="main">)</span>
    <span class="keyword1"><span class="command">finally</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1" id="Network_Security_Policy_Verification-valid_reqs_BLP"><span class="command">lemma</span></span> valid_reqs_BLP<span class="main">:</span> <span class="quoted"><span class="quoted">"valid_reqs <span class="main">[</span>the BLP_m_spec<span class="main">]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> valid_reqs_def<span class="main">)</span><span class="main">(</span><span class="operator">metis</span> BLP_m_spec_def BLPtrusted_impl.spec new_configured_SecurityInvariant.simps new_configured_SecurityInvariant_sound option.distinct<span class="main"><span class="main">(</span></span>1<span class="main"><span class="main">)</span></span> option.exhaust_sel<span class="main">)</span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interlude: While <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> BLP_m<span class="antiquote"><span class="antiquote">}</span></span></span></span> is executable code, we will now show that this executable code complies with its formal definition.›</span></span>
  <span class="keyword1" id="Network_Security_Policy_Verification-complies_BLP"><span class="command">lemma</span></span> complies_BLP<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_complies_formal_def BLP_m <span class="main">(</span>the BLP_m_spec<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">unfolding</span></span> BLP_m_def
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> new_configured_list_SecurityInvariant_complies<span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_m_spec_def<span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">unfold_locales</span><span class="main">)</span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> fun_eq_iff SINVAR_LIB_BLPtrusted_def SINVAR_BLPtrusted_impl.NetModel_node_props_def<span class="main">)</span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define the list of all security invariants of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">"nat SecurityInvariant list"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
     The type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">nat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is because the policy's nodes are of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">nat</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">security_invariants</span> <span class="main">=</span> <span class="main">[</span>BLP_m<span class="main">]</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We can see that the policy does not fulfill the security invariants.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> all_security_requirements_fulfilled security_invariants policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We ask why. Obviously, node 2 leaks confidential data to node 3.›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"implc_get_offending_flows security_invariants policy"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_get_offending_flows security_invariants policy <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interlude: the implementation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> implc_get_offending_flows<span class="antiquote"><span class="antiquote">}</span></span></span></span> corresponds to the formal definition <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> get_offending_flows<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">`</span> set <span class="main">(</span>implc_get_offending_flows <span class="main">(</span>get_impl <span class="main">[</span><span class="main">(</span>BLP_m<span class="main">,</span> the BLP_m_spec<span class="main">)</span><span class="main">]</span><span class="main">)</span> policy<span class="main">)</span> <span class="main">=</span> get_offending_flows <span class="main">(</span>get_spec <span class="main">[</span><span class="main">(</span>BLP_m<span class="main">,</span> the BLP_m_spec<span class="main">)</span><span class="main">]</span><span class="main">)</span> <span class="main">(</span>list_graph_to_graph policy<span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> implc_get_offending_flows_complies<span class="main">)</span>
   <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp_all</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> complies_BLP wf_list_graph_policy<span class="main">)</span>
  

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Visualization of the violation (only in interactive mode)
›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"security_invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Experimental: the config (only one) can be added to the end.›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"security_invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"BLP_security_levels"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The policy has a flaw. We throw it away and generate a new one which fulfills the invariants.
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">max_policy</span> <span class="main">=</span> generate_valid_topology security_invariants <span class="main">⦇</span>nodesL <span class="main">=</span> nodesL policy<span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interlude: the implementation <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> implc_get_offending_flows<span class="antiquote"><span class="antiquote">}</span></span></span></span> corresponds to the formal definition <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> get_offending_flows<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
  <span class="keyword1"><span class="command">thm</span></span> generate_valid_topology_complies

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interlude: the formal definition is sound›</span></span>
  <span class="keyword1"><span class="command">thm</span></span> generate_valid_topology_sound

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Here, it is also complete›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span> <span class="main">⟹</span> max_topo <span class="main">[</span>the BLP_m_spec<span class="main">]</span> <span class="main">(</span>TopoS_Composition_Theory.generate_valid_topology <span class="main">[</span>the BLP_m_spec<span class="main">]</span> <span class="main">(</span>fully_connected <span class="free">G</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> generate_valid_topology_max_topo<span class="main"><span class="main">[</span></span><span class="operator">OF</span> valid_reqs_BLP<span class="main"><span class="main">]</span></span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">assumption</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_m_spec<span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Calculating the maximum policy›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"max_policy"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"max_policy <span class="main">=</span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Visualizing the maximum policy (only in interactive mode)
›</span></span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"security_invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"max_policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Of course, all security invariants hold for the maximum policy.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled security_invariants max_policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹A stateful implementation›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We generate a stateful policy›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">stateful_policy</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS_2 policy security_invariants"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹When thinking about it carefully, no flow can be stateful without introducing an information leakage here!›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"stateful_policy"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"stateful_policy <span class="main">=</span> <span class="main">⦇</span>hostsL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">]</span><span class="main">,</span> flows_fixL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> flows_stateL <span class="main">=</span> <span class="main">[]</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Interlude: the stateful policy we are computing fulfills all the necessary properties›</span></span>
  <span class="keyword1"><span class="command">thm</span></span> generate_valid_stateful_policy_IFSACS_2_complies

  <span class="comment1">(*the individual algorithms fir IFS/ACS return a maximum policy*)</span>
  <span class="keyword1"><span class="command">thm</span></span> filter_compliant_stateful_ACS_correct filter_compliant_stateful_ACS_maximal
  <span class="keyword1"><span class="command">thm</span></span> filter_IFS_no_violations_correct filter_IFS_no_violations_maximal

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Visualizing the stateful policy (only in interactive mode)
›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL stateful_policy"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL stateful_policy"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is how it would look like if <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">3</span></span><span class="main"><span class="main">,</span></span><span class="main"><span class="main">1</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> were a stateful flow›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL stateful_policy"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="numeral">3</span><span class="main">::</span>nat<span class="main">,</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>


<span class="keyword1"><span class="command">hide_const</span></span> policy security_invariants max_policy stateful_policy


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Example_BLP">
<div class="head">
<h1>Theory Example_BLP</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Example_BLP
<span class="keyword2"><span class="keyword">imports</span></span> <a href="TopoS_Library.html">TopoS_Library</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLPexample1</span><span class="main">::</span><span class="quoted"><span class="quoted">"bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">BLPexample1</span> <span class="main">≡</span> <span class="main">(</span>nm_eval SINVAR_LIB_BLPbasic<span class="main">)</span> fabNet <span class="main">⦇</span> node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''PresenceSensor''</span> <span class="main">↦</span> <span class="numeral">2</span><span class="main">,</span> 
                                                  <span class="inner_quoted">''Webcam''</span> <span class="main">↦</span> <span class="numeral">3</span><span class="main">,</span> 
                                                  <span class="inner_quoted">''SensorSink''</span> <span class="main">↦</span> <span class="numeral">3</span><span class="main">,</span>
                                                  <span class="inner_quoted">''Statistics''</span> <span class="main">↦</span> <span class="numeral">3</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLPexample3</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string <span class="main">×</span> string<span class="main">)</span> list list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">BLPexample3</span> <span class="main">≡</span> <span class="main">(</span>nm_offending_flows SINVAR_LIB_BLPbasic<span class="main">)</span> fabNet <span class="main">(</span><span class="main">(</span>nm_node_props SINVAR_LIB_BLPbasic<span class="main">)</span> sensorProps_NMParams_try3<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"BLPexample1"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"BLPexample3"</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="TopoS_generateCode">
<div class="head">
<h1>Theory TopoS_generateCode</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> TopoS_generateCode
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="TopoS_Library.html">TopoS_Library</a>
  <a href="Example_BLP.html">Example_BLP</a>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">setup</span></span> <span class="quoted">‹<span class="keyword1"><span class="keyword">fn</span></span> <span class="entity">thy</span> <span class="main">=&gt;</span>
  <span class="keyword2"><span class="keyword">let</span></span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">package</span> <span class="main">=</span> <span class="inner_quoted">"package tum.in.net.psn.log_topo.SecurityInvariants.GENERATED"</span><span class="main">;</span>   
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">date</span> <span class="main">=</span> Date.toString <span class="main">(</span>Date.fromTimeLocal <span class="main">(</span>Time.now <span class="main">(</span><span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">export_file</span> <span class="main">=</span> Context.theory_name <span class="entity">thy</span> ^ <span class="inner_quoted">".thy"</span><span class="main">;</span>
    <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">header</span> <span class="main">=</span> <span class="entity">package</span> ^ <span class="inner_quoted">"\n"</span> ^ <span class="inner_quoted">"// Generated by Isabelle ("</span> ^ Distribution.version ^ <span class="inner_quoted">") on "</span> ^ <span class="entity">date</span> ^ <span class="inner_quoted">"\n"</span> ^ <span class="inner_quoted">"// src: "</span> ^ <span class="entity">export_file</span> ^ <span class="inner_quoted">"\n"</span><span class="main">;</span>
  <span class="keyword2"><span class="keyword">in</span></span>
    <span class="entity">Code_Target.set_printings</span> <span class="main">(</span><span class="entity">Code_Symbol.Module</span> <span class="main">(</span><span class="inner_quoted">""</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"Scala"</span><span class="main">,</span> SOME <span class="main">(</span><span class="entity">header</span><span class="main">,</span> <span class="main">[</span><span class="main">]</span><span class="main">)</span><span class="main">)</span><span class="main">]</span><span class="main">)</span><span class="main">)</span> <span class="entity">thy</span>
  <span class="keyword2"><span class="keyword">end</span></span>
›</span>


<span class="keyword1"><span class="command">export_code</span></span> 
  <span class="comment1">― ‹generic network security invariants›</span>
      <span class="quoted"><span class="quoted">SINVAR_LIB_BLPbasic</span></span>
      <span class="quoted"><span class="quoted">SINVAR_LIB_Dependability</span></span>
      <span class="quoted"><span class="quoted">SINVAR_LIB_DomainHierarchyNG</span></span>
      <span class="quoted"><span class="quoted">SINVAR_LIB_Subnets</span></span>
      <span class="quoted"><span class="quoted">SINVAR_LIB_BLPtrusted</span></span> 
      <span class="quoted"><span class="quoted">SINVAR_LIB_PolEnforcePointExtended</span></span>
      <span class="quoted"><span class="quoted">SINVAR_LIB_Sink</span></span>
      <span class="quoted"><span class="quoted">SINVAR_LIB_NonInterference</span></span>
      <span class="quoted"><span class="quoted">SINVAR_LIB_SubnetsInGW</span></span>
      <span class="quoted"><span class="quoted">SINVAR_LIB_CommunicationPartners</span></span>
  <span class="comment1">― ‹accessors to the packed invariants›</span>
      <span class="quoted"><span class="quoted">nm_eval</span></span>
      <span class="quoted"><span class="quoted">nm_node_props</span></span>
      <span class="quoted"><span class="quoted">nm_offending_flows</span></span>
      <span class="quoted"><span class="quoted">nm_sinvar</span></span>
      <span class="quoted"><span class="quoted">nm_default</span></span>
      <span class="quoted"><span class="quoted">nm_receiver_violation</span></span> <span class="quoted"><span class="quoted">nm_name</span></span>
  <span class="comment1">― ‹TopoS Params›</span>
      <span class="quoted"><span class="quoted">node_properties</span></span>
  <span class="comment1">― ‹Finite Graph functions›</span>
      <span class="quoted"><span class="quoted">FiniteListGraph.wf_list_graph</span></span>
      <span class="quoted"><span class="quoted">FiniteListGraph.add_node</span></span> 
      <span class="quoted"><span class="quoted">FiniteListGraph.delete_node</span></span>
      <span class="quoted"><span class="quoted">FiniteListGraph.add_edge</span></span>
      <span class="quoted"><span class="quoted">FiniteListGraph.delete_edge</span></span>
      <span class="quoted"><span class="quoted">FiniteListGraph.delete_edges</span></span>
  <span class="comment1">― ‹Examples›</span>
  <span class="quoted"><span class="quoted">BLPexample1</span></span> <span class="quoted"><span class="quoted">BLPexample3</span></span> 
  <span class="keyword2"><span class="keyword">in</span></span> Scala
  <span class="comment1">(*file "code/isabelle_generated.scala"*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="attic">
<div class="head">
<h1>Theory attic</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Attic›</span></span>
<span class="keyword1"><span class="command">theory</span></span> attic
<span class="keyword2"><span class="keyword">imports</span></span> <a href="../../HOL/HOL/Main.html">Main</a> <span class="quoted">"<a href="FiniteGraph.html">Lib/FiniteGraph</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹old lemma, mainly unused.›</span></span>

<span class="keyword1" id="attic-exists_x1x2_x1notoffending_natLeq"><span class="command">lemma</span></span> exists_x1x2_x1notoffending_natLeq<span class="main">:</span> 
  <span class="keyword2"><span class="keyword">fixes</span></span> 
    <span class="free">G</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">f</span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="free">p</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> nat"</span></span>
  <span class="keyword2"><span class="keyword">assumes</span></span>
    <span class="quoted"><span class="quoted">"wf_graph <span class="free">G</span>"</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">p</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">p</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊆</span> edges <span class="free">G</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">f</span><span class="main">.</span> <span class="main">¬</span> <span class="free">p</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">p</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span><span class="main">.</span> <span class="free">p</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">p</span> <span class="bound">e2</span>"</span></span>
  <span class="keyword2"><span class="keyword">shows</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="bound">x1</span><span class="main">,</span><span class="bound">x2</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">x1</span><span class="main">,</span><span class="bound">x2</span><span class="main">)</span><span class="main">∈</span> <span class="free">f</span> <span class="main">∧</span> <span class="bound">x1</span> <span class="main">∈</span> fst <span class="main">`</span> <span class="free">f</span> <span class="main">∧</span> <span class="bound">x1</span> <span class="main">∉</span> snd <span class="main">`</span> <span class="free">f</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="bound">x1</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">(</span><span class="free">p</span><span class="main">`</span>fst<span class="main">`</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">proof</span></span> <span class="operator">-</span>
   <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> a2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span><span class="bound">x</span><span class="main">∈</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">p</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">p</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
   <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> a3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">f</span> <span class="main">⊆</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="free">f</span><span class="main">.</span> <span class="main">¬</span> <span class="free">p</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">p</span> <span class="bound">e2</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">from</span></span> assms <span class="keyword1"><span class="command">have</span></span> a4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span><span class="main">∈</span><span class="main">(</span>edges <span class="free">G</span><span class="main">)</span> <span class="main">-</span> <span class="free">f</span><span class="main">.</span> <span class="free">p</span> <span class="bound">e1</span> <span class="main">≤</span> <span class="free">p</span> <span class="bound">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">from</span></span> assms<span class="main">(</span>1<span class="main">)</span> <span class="keyword1"><span class="command">have</span></span> finiteE<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> wf_graph.finiteE <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
   <span class="keyword1"><span class="command">from</span></span> finiteE conjunct1<span class="main">[</span><span class="operator">OF</span> a3<span class="main">]</span> <span class="keyword1"><span class="command">have</span></span>  finiteF<span class="main">:</span> <span class="quoted"><span class="quoted">"finite <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> rev_finite_subset<span class="main">)</span>

   <span class="comment1">― ‹Find a suitable x1, it is the Max of the firsts›</span>
   <span class="keyword1"><span class="command">from</span></span> finiteF <span class="keyword1"><span class="command">have</span></span> x12<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">f</span><span class="main">.</span> Max <span class="main">(</span><span class="free">p</span><span class="main">`</span>fst<span class="main">`</span> <span class="free">f</span><span class="main">)</span> <span class="main">≥</span> <span class="free">p</span> <span class="main">(</span>fst <span class="bound">x</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">metis</span> Max_ge finite_imageI image_eqI<span class="main">)</span>
   <span class="keyword1"><span class="command">from</span></span> a2 a4 <span class="keyword1"><span class="command">have</span></span> x14<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="free">p</span> <span class="bound">x1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">p</span><span class="main">`</span>fst<span class="main">`</span> <span class="free">f</span> <span class="main">∧</span> <span class="bound">x1</span> <span class="main">∈</span> fst<span class="main">`</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fast</span>
   <span class="keyword1"><span class="command">from</span></span> finiteF <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span><span class="main">`</span>fst<span class="main">`</span> <span class="free">f</span><span class="main">)</span> <span class="main">≠</span> <span class="main">{}</span> <span class="main">⟹</span> Max <span class="main">(</span><span class="free">p</span><span class="main">`</span>fst<span class="main">`</span> <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">p</span><span class="main">`</span>fst<span class="main">`</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">simp</span>
   <span class="keyword1"><span class="command">hence</span></span> x15<span class="main">:</span> <span class="quoted"><span class="quoted">"Max <span class="main">(</span><span class="free">p</span><span class="main">`</span>fst<span class="main">`</span> <span class="free">f</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span><span class="free">p</span><span class="main">`</span>fst<span class="main">`</span> <span class="free">f</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">using</span></span> x14 <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command">hence</span></span> <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x1</span><span class="main">.</span> <span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="bound">x1</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">(</span><span class="free">p</span><span class="main">`</span>fst<span class="main">`</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="bound">x1</span> <span class="main">∈</span> fst<span class="main">`</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
   <span class="keyword1"><span class="command">from</span></span> this x14 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x1</span></span> <span class="keyword2"><span class="keyword">where</span></span> x1Cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span><span class="free">p</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">=</span> Max <span class="main">(</span><span class="free">p</span><span class="main">`</span>fst<span class="main">`</span> <span class="free">f</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="skolem">x1</span> <span class="main">∈</span> fst<span class="main">`</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   
   <span class="comment1">― ‹Thus x1 is not in the seconds, not offending›</span>
   <span class="keyword1"><span class="command">from</span></span> x1Cond x15 <span class="keyword1"><span class="command">have</span></span> x1ImportantProp3<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">∈</span> <span class="free">p</span><span class="main">`</span>fst<span class="main">`</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
   <span class="keyword1"><span class="command">from</span></span> x1Cond conjunct2<span class="main">[</span><span class="operator">OF</span> a3<span class="main">]</span> x12 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span><span class="main">.</span> <span class="free">p</span> <span class="skolem">x1</span> <span class="main">&gt;</span> <span class="free">p</span> <span class="bound">e2</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>

   <span class="keyword1"><span class="command">from</span></span> x1Cond this a2 a3 a4 <span class="keyword1"><span class="command">have</span></span> x1ImportantProp1<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="free">p</span> <span class="skolem">x1</span><span class="main">)</span> <span class="main">∉</span> <span class="free">p</span><span class="main">`</span>snd<span class="main">`</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
   <span class="keyword1"><span class="command">hence</span></span> x1ImportantProp2<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∉</span> snd<span class="main">`</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

   <span class="comment1">― ‹Obtain x2›</span>
   <span class="keyword1"><span class="command">from</span></span> x1ImportantProp3 x1Cond <span class="keyword1"><span class="command">have</span></span> x1ImportantProp4<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">x1</span> <span class="main">∈</span> fst<span class="main">`</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">presburger</span>
   <span class="keyword1"><span class="command">from</span></span> this x1ImportantProp2 <span class="keyword1"><span class="command">have</span></span>  <span class="quoted"><span class="quoted">"<span class="main">∃</span> <span class="bound">x1</span> <span class="bound">x2</span><span class="main">.</span> <span class="main">(</span><span class="bound">x1</span><span class="main">,</span><span class="bound">x2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">∧</span> <span class="bound">x1</span> <span class="main">∉</span> snd<span class="main">`</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">fastforce</span>
   <span class="keyword1"><span class="command">from</span></span> this x1Cond x1ImportantProp2 <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">x2</span></span> <span class="keyword2"><span class="keyword">where</span></span> x2Cond<span class="main">:</span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">∧</span> <span class="skolem">x1</span> <span class="main">∉</span> snd<span class="main">`</span> <span class="free">f</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">force</span>
   
   <span class="keyword1"><span class="command">from</span></span> a3 <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="quoted">"<span class="main">⋀</span> <span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">f</span> <span class="main">⟹</span> <span class="bound">x</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
   <span class="keyword1"><span class="command">from</span></span> this x2Cond <span class="keyword1"><span class="command">have</span></span> x1x2Cond<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">x1</span><span class="main">,</span><span class="skolem">x2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free">G</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>

   <span class="keyword1"><span class="command">from</span></span> x1x2Cond x2Cond x1Cond <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
<span class="keyword1"><span class="command">qed</span></span>


<span class="keyword1" id="attic-exCasePairSimp"><span class="command">lemma</span></span> exCasePairSimp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">(</span><span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

<span class="keyword1" id="attic-exCasePairNotSimp"><span class="command">lemma</span></span> exCasePairNotSimp<span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">∃</span><span class="bound">x</span><span class="main">.</span> <span class="bound">x</span> <span class="main">∈</span> <span class="free">A</span> <span class="main">∧</span> <span class="main">¬</span> <span class="main">(</span><span class="keyword1">case</span> <span class="bound">x</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">⇒</span> <span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span> <span class="main">=</span> <span class="main">(</span><span class="main">∃</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="free">A</span><span class="main">.</span> <span class="main">¬</span> <span class="main">(</span><span class="free">P</span> <span class="bound">e1</span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>


<span class="comment1">(* moved here from FiniteGraph.thy. Currently unused *)</span>
<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Paths›</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹A path is represented by a list of adjacent edges.›</span></span>
  <span class="keyword1"><span class="command">type_synonym</span></span> <span class="tfree">'v</span> path <span class="main">=</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'v</span> <span class="main">×</span> <span class="tfree">'v</span><span class="main">)</span> list"</span></span>

  <span class="keyword1"><span class="command">context</span></span> wf_graph
  <span class="keyword2"><span class="keyword">begin</span></span>
    <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹The following predicate describes a valid path:›</span></span>
    <span class="comment1">(* is-path src [src, ...., dst] dst *)</span>
    <span class="keyword1"><span class="command">fun</span></span> <span class="entity">is_path</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> <span class="main">⇒</span> <span class="tfree">'v</span> path <span class="main">⇒</span> <span class="tfree">'v</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">is_path</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">[]</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">∧</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span><span class="main">∈</span>V"</span></span> <span class="main">|</span>
      <span class="quoted"><span class="quoted">"<span class="free">is_path</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span> <span class="main">(</span><span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">#</span><span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span> <span class="main">⟷</span> <span class="free"><span class="bound"><span class="entity">v</span></span></span><span class="main">=</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">v1</span></span></span><span class="main">,</span><span class="free"><span class="bound"><span class="entity">v2</span></span></span><span class="main">)</span><span class="main">∈</span>E <span class="main">∧</span> <span class="free">is_path</span> <span class="free"><span class="bound"><span class="entity">v2</span></span></span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="free"><span class="bound"><span class="entity">v'</span></span></span>"</span></span>
  
    <span class="keyword1" id="attic-is_path_simps"><span class="command">lemma</span></span> is_path_simps<span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main"><span class="main"><span class="main">!</span></span></span></span></span><span class="main">]</span><span class="main">:</span>
      <span class="quoted"><span class="quoted">"is_path <span class="free">v</span> <span class="main">[]</span> <span class="free">v</span> <span class="main">⟷</span> <span class="free">v</span><span class="main">∈</span>V"</span></span>
      <span class="quoted"><span class="quoted">"is_path <span class="free">v</span> <span class="main">[</span><span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">]</span> <span class="free">v'</span> <span class="main">⟷</span> <span class="main">(</span><span class="free">v</span><span class="main">,</span><span class="free">v'</span><span class="main">)</span><span class="main">∈</span>E"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E_wfD<span class="main">)</span>
    
    <span class="keyword1" id="attic-is_path_memb"><span class="command">lemma</span></span> is_path_memb<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
      <span class="quoted"><span class="quoted">"is_path <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span> <span class="main">⟹</span> <span class="free">v</span><span class="main">∈</span>V <span class="main">∧</span> <span class="free">v'</span><span class="main">∈</span>V"</span></span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induction</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> 
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E_wfD<span class="main">)</span>
      <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

    <span class="keyword1" id="attic-is_path_split"><span class="command">lemma</span></span> is_path_split<span class="main">:</span>
      <span class="quoted"><span class="quoted">"is_path <span class="free">v</span> <span class="main">(</span><span class="free">p1</span><span class="main">@</span><span class="free">p2</span><span class="main">)</span> <span class="free">v'</span> <span class="main">⟷</span> <span class="main">(</span><span class="main">∃</span><span class="bound">u</span><span class="main">.</span> is_path <span class="free">v</span> <span class="free">p1</span> <span class="bound">u</span> <span class="main">∧</span> is_path <span class="bound">u</span> <span class="free">p2</span> <span class="free">v'</span><span class="main">)</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p1</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span> <span class="operator">auto</span>

    <span class="keyword1" id="attic-is_path_split'"><span class="command">lemma</span></span> is_path_split'<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> 
      <span class="quoted"><span class="quoted">"is_path <span class="free">v</span> <span class="main">(</span><span class="free">p1</span><span class="main">@</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">u'</span><span class="main">)</span><span class="main">#</span><span class="free">p2</span><span class="main">)</span> <span class="free">v'</span> 
        <span class="main">⟷</span> is_path <span class="free">v</span> <span class="free">p1</span> <span class="free">u</span> <span class="main">∧</span> <span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">u'</span><span class="main">)</span><span class="main">∈</span>E <span class="main">∧</span> is_path <span class="free">u'</span> <span class="free">p2</span> <span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> is_path_split<span class="main">)</span>
  <span class="keyword2"><span class="keyword">end</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Set of intermediate vertices of a path. These are all vertices but
    the last one. Note that, if the last vertex also occurs earlier on the path,
    it is contained in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>int_vertices›</span></span></span></span>.›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">int_vertices</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> path <span class="main">⇒</span> <span class="tfree">'v</span> set"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">int_vertices</span> <span class="free"><span class="bound"><span class="entity">p</span></span></span> <span class="main">≡</span> set <span class="main">(</span>map fst <span class="free"><span class="bound"><span class="entity">p</span></span></span><span class="main">)</span>"</span></span>

  <span class="keyword1" id="attic-int_vertices_simps"><span class="command">lemma</span></span> int_vertices_simps<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span>
    <span class="quoted"><span class="quoted">"int_vertices <span class="main">[]</span> <span class="main">=</span> <span class="main">{}</span>"</span></span>
    <span class="quoted"><span class="quoted">"int_vertices <span class="main">(</span><span class="free">vv</span><span class="main">#</span><span class="free">p</span><span class="main">)</span> <span class="main">=</span> insert <span class="main">(</span>fst <span class="free">vv</span><span class="main">)</span> <span class="main">(</span>int_vertices <span class="free">p</span><span class="main">)</span>"</span></span>
    <span class="quoted"><span class="quoted">"int_vertices <span class="main">(</span><span class="free">p1</span><span class="main">@</span><span class="free">p2</span><span class="main">)</span> <span class="main">=</span> int_vertices <span class="free">p1</span> <span class="main">∪</span> int_vertices <span class="free">p2</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> int_vertices_def<span class="main">)</span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_graph<span class="main">)</span> int_vertices_subset<span class="main">:</span> 
    <span class="quoted"><span class="quoted">"is_path <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span> <span class="main">⟹</span> int_vertices <span class="free">p</span> <span class="main">⊆</span> V"</span></span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span><span class="main">)</span>
     <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span><span class="main">)</span> 
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">force</span> <span class="quasi_keyword">dest</span><span class="main"><span class="main">:</span></span> E_wfD<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>

  <span class="keyword1" id="attic-int_vertices_empty"><span class="command">lemma</span></span> int_vertices_empty<span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"int_vertices <span class="free">p</span> <span class="main">=</span> <span class="main">{}</span> <span class="main">⟷</span> <span class="free">p</span><span class="main">=</span><span class="main">[]</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="free">p</span></span><span class="main">)</span> <span class="operator">auto</span>

<span class="keyword1"><span class="command">subsubsection</span></span> <span class="quoted"><span class="plain_text">‹Splitting Paths›</span></span>
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Split a path at the point where it first leaves the set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>W›</span></span></span></span>:›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_graph<span class="main">)</span> path_split_set<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span><span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∉</span><span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p1</span> <span class="free">p2</span> <span class="free">u</span> <span class="free">w</span> <span class="free">u'</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="free">p1</span><span class="main">@</span><span class="main">(</span><span class="free">u</span><span class="main">,</span><span class="free">u'</span><span class="main">)</span><span class="main">#</span><span class="free">p2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"int_vertices <span class="free">p1</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">∈</span><span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u'</span><span class="main">∉</span><span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">vv</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">∈</span><span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="free">v'</span><span class="main">∉</span><span class="free">W</span>›</span></span>
    <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vv</span><span class="main">=</span><span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        REST<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path <span class="skolem">u'</span> <span class="skolem">p</span> <span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">vv</span></span><span class="main">)</span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Distinguish wether the second node <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>u'›</span></span></span></span> of the path is 
      in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>W›</span></span></span></span>. If yes, the proposition follows by the 
      induction hypothesis, otherwise it is straightforward, as
      the split takes place at the first edge of the path.›</span></span>
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> A <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span><span class="main">∈</span><span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">from</span></span> Cons.hyps<span class="main">[</span><span class="operator">OF</span> _ REST<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">uu</span></span> <span class="skolem"><span class="skolem">uu'</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">p1</span><span class="main">@</span><span class="main">(</span><span class="skolem">uu</span><span class="main">,</span><span class="skolem">uu'</span><span class="main">)</span><span class="main">#</span><span class="skolem">p2</span>"</span></span> <span class="quoted"><span class="quoted">"int_vertices <span class="skolem">p1</span> <span class="main">⊆</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">uu</span> <span class="main">∈</span> <span class="free">W</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">uu'</span> <span class="main">∉</span> <span class="free">W</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
      <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">vv</span><span class="main">#</span><span class="skolem">p1</span>"</span></span> <span class="quoted"><span class="skolem">uu</span></span> <span class="quoted"><span class="skolem">uu'</span></span> <span class="quoted"><span class="skolem">p2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span><span class="main">∉</span><span class="free">W</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="skolem">v</span></span> <span class="quoted"><span class="skolem">u'</span></span> <span class="quoted"><span class="skolem">p</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>
  
  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Split a path at the point where it first enters the set <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>W›</span></span></span></span>:›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_graph<span class="main">)</span> path_split_set'<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">v'</span><span class="main">∈</span><span class="free">W</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p1</span> <span class="free">p2</span> <span class="free">u</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="free">p1</span><span class="main">@</span><span class="free">p2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"is_path <span class="free">v</span> <span class="free">p1</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"is_path <span class="free">u</span> <span class="free">p2</span> <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"int_vertices <span class="free">p1</span> <span class="main">⊆</span> <span class="main">-</span><span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">∈</span><span class="free">W</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="quoted">"<span class="free">v</span><span class="main">∈</span><span class="free">W</span>"</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> True <span class="keyword1"><span class="command">with</span></span> that<span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="free">p</span></span><span class="main">]</span> assms <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> False <span class="keyword1"><span class="command">with</span></span> assms that <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?thesis</span></span></span>
    <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
      <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">next</span></span>
      <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">vv</span> <span class="skolem">p</span><span class="main">)</span>
      <span class="keyword1"><span class="command">note</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main"><span class="main">!</span></span></span><span class="main">]</span> <span class="main">=</span> <span class="quoted"><span class="quoted">‹<span class="free">v'</span><span class="main">∈</span><span class="free">W</span>›</span></span> <span class="quoted"><span class="quoted">‹<span class="skolem">v</span><span class="main">∉</span><span class="free">W</span>›</span></span>
      <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
        <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vv</span><span class="main">=</span><span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span><span class="main">∈</span>E"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
          REST<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path <span class="skolem">u'</span> <span class="skolem">p</span> <span class="free">v'</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">vv</span></span><span class="main">)</span> <span class="operator">auto</span>
    
      <span class="keyword1"><span class="command">txt</span></span> <span class="quoted"><span class="plain_text">‹Distinguish wether the second node <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>u'›</span></span></span></span> of the path is 
        in <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>W›</span></span></span></span>. If yes, the proposition is straightforward, otherwise,
        it follows by the induction hypothesis.
›</span></span>
      <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> A <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span><span class="main">∈</span><span class="free">W</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="skolem">vv</span><span class="main">]</span>"</span></span> <span class="quoted"><span class="skolem">p</span></span> <span class="quoted"><span class="skolem">u'</span></span><span class="main">]</span> REST <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
        <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">,</span> <span class="operator">intro</span><span class="main"><span class="main">!</span></span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">u'</span><span class="main">∉</span><span class="free">W</span>"</span></span>
        <span class="keyword1"><span class="command">from</span></span> Cons.hyps<span class="main">[</span><span class="operator">OF</span> REST<span class="main">]</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="skolem"><span class="skolem">u''</span></span> <span class="keyword2"><span class="keyword">where</span></span>
          <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">p1</span><span class="main">@</span><span class="skolem">p2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
            <span class="quoted"><span class="quoted">"is_path <span class="skolem">u'</span> <span class="skolem">p1</span> <span class="skolem">u''</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> 
            <span class="quoted"><span class="quoted">"is_path <span class="skolem">u''</span> <span class="skolem">p2</span> <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            <span class="quoted"><span class="quoted">"int_vertices <span class="skolem">p1</span> <span class="main">⊆</span> <span class="main">-</span><span class="free">W</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
            <span class="quoted"><span class="quoted">"<span class="skolem">u''</span><span class="main">∈</span><span class="free">W</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
        <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>3<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">vv</span><span class="main">#</span><span class="skolem">p1</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
    <span class="keyword1"><span class="command">qed</span></span>
  <span class="keyword1"><span class="command">qed</span></span>

  <span class="keyword1"><span class="command">text</span></span> <span class="quoted"><span class="plain_text">‹Split a path at the point where a given vertex is first visited:›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="main">(</span><span class="keyword2"><span class="keyword">in</span></span> wf_graph<span class="main">)</span> path_split_vertex<span class="main">:</span>
    <span class="keyword2"><span class="keyword">assumes</span></span> <span class="quoted"><span class="quoted">"is_path <span class="free">v</span> <span class="free">p</span> <span class="free">v'</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">∈</span>int_vertices <span class="free">p</span>"</span></span>
    <span class="keyword2"><span class="keyword">obtains</span></span> <span class="free">p1</span> <span class="free">p2</span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">p</span><span class="main">=</span><span class="free">p1</span><span class="main">@</span><span class="free">p2</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"is_path <span class="free">v</span> <span class="free">p1</span> <span class="free">u</span>"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">u</span> <span class="main">∉</span> int_vertices <span class="free">p1</span>"</span></span>
    <span class="keyword1"><span class="command">using</span></span> assms
  <span class="keyword1"><span class="command">proof</span></span> <span class="main">(</span><span class="operator">induct</span> <span class="quoted"><span class="free">p</span></span> <span class="quasi_keyword">arbitrary</span><span class="main"><span class="main">:</span></span> <span class="quoted"><span class="free">v</span></span> <span class="quoted"><span class="free">thesis</span></span><span class="main">)</span>
    <span class="keyword3"><span class="command">case</span></span> Nil <span class="keyword3"><span class="command">thus</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
  <span class="keyword1"><span class="command">next</span></span>
    <span class="keyword3"><span class="command">case</span></span> <span class="main">(</span>Cons <span class="skolem">vv</span> <span class="skolem">p</span><span class="main">)</span>
    <span class="keyword1"><span class="command">from</span></span> Cons.prems <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">u'</span></span> <span class="keyword2"><span class="keyword">where</span></span> 
      <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="skolem">vv</span><span class="main">=</span><span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">v</span><span class="main">∈</span>V"</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="skolem">v</span><span class="main">,</span><span class="skolem">u'</span><span class="main">)</span><span class="main">∈</span>E"</span></span> <span class="keyword2"><span class="keyword">and</span></span>
        REST<span class="main">:</span> <span class="quoted"><span class="quoted">"is_path <span class="skolem">u'</span> <span class="skolem">p</span> <span class="free">v'</span>"</span></span>
      <span class="keyword1"><span class="command">by</span></span> <span class="main">(</span><span class="operator">cases</span> <span class="quoted"><span class="skolem">vv</span></span><span class="main">)</span> <span class="operator">auto</span>
    
    <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">=</span><span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="main">[]</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="skolem">vv</span><span class="main">#</span><span class="skolem">p</span>"</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">thesis</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">moreover</span></span> <span class="keyword1"><span class="command">{</span></span>
      <span class="keyword3"><span class="command">assume</span></span> <span class="main">[</span><span class="operator">simp</span><span class="main">]</span><span class="main">:</span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">≠</span><span class="skolem">v</span>"</span></span>
      <span class="keyword1"><span class="command">with</span></span> Cons.hyps<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">OF</span> _ REST<span class="main">]</span> Cons.prems<span class="main">(</span>3<span class="main">)</span> <span class="keyword3"><span class="command">obtain</span></span> <span class="skolem"><span class="skolem">p1</span></span> <span class="skolem"><span class="skolem">p2</span></span> <span class="keyword2"><span class="keyword">where</span></span>
        <span class="quoted"><span class="quoted">"<span class="skolem">p</span><span class="main">=</span><span class="skolem">p1</span><span class="main">@</span><span class="skolem">p2</span>"</span></span> <span class="quoted"><span class="quoted">"is_path <span class="skolem">u'</span> <span class="skolem">p1</span> <span class="free">u</span>"</span></span> <span class="quoted"><span class="quoted">"<span class="free">u</span><span class="main">∉</span>int_vertices <span class="skolem">p1</span>"</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
      <span class="keyword1"><span class="command">with</span></span> Cons.prems<span class="main">(</span>1<span class="main">)</span><span class="main">[</span><span class="operator">of</span> <span class="quoted"><span class="quoted">"<span class="skolem">vv</span><span class="main">#</span><span class="skolem">p1</span>"</span></span> <span class="quoted"><span class="skolem">p2</span></span><span class="main">]</span> <span class="keyword1"><span class="command">have</span></span> <span class="quoted"><span class="skolem">thesis</span></span>
        <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>
    <span class="keyword1"><span class="command">}</span></span> <span class="keyword1"><span class="command">ultimately</span></span> <span class="keyword3"><span class="command">show</span></span> <span class="var"><span class="quoted"><span class="var">?case</span></span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">blast</span>
  <span class="keyword1"><span class="command">qed</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Impl_List_Playground_ChairNetwork">
<div class="head">
<h1>Theory Impl_List_Playground_ChairNetwork</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Impl_List_Playground_ChairNetwork
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Impl.html">../TopoS_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An example of our chair network [simplified]›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Our access control view on the network›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ChairNetwork_empty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork_empty</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''WebSrv''</span><span class="main">,</span> <span class="inner_quoted">''FilesSrv''</span><span class="main">,</span> <span class="inner_quoted">''PrinterBW''</span><span class="main">,</span>
                                <span class="inner_quoted">''PrinterColor''</span><span class="main">,</span> <span class="inner_quoted">''Students''</span><span class="main">,</span>
                                <span class="inner_quoted">''Employees''</span><span class="main">,</span> <span class="inner_quoted">''EReachable''</span><span class="main">,</span>
                                <span class="inner_quoted">''Internet''</span><span class="main">]</span><span class="main">,</span>
                      edgesL <span class="main">=</span> <span class="main">[]</span> <span class="main">⦈</span>"</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph ChairNetwork_empty"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Our security requirements›</span></span>
  <span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹We have a server with confidential data›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ConfidentialChairData</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">ConfidentialChairData</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_BLPtrusted_impl.SINVAR_LIB_BLPtrusted <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''FilesSrv''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                             <span class="inner_quoted">''Employees''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span><span class="main">,</span>
                             <span class="inner_quoted">''EReachable''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span><span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''confidential data''</span>"</span></span>


  <span class="comment1">(*
  subsubsection{*We have a hierarchical printing policy*}
    definition "PrintingHierarchy_nodes=[''Employees''↦ DN (''ColorPrinting''--Leaf, 0),
                           ''PrinterColor''↦ DN (''ColorPrinting''--''Printer''--Leaf, 0),
                           ''Students''↦ DN (''ColorPrinting''--''BwPrinting''--Leaf, 0),
                           ''PrinterBW''↦ DN (''ColorPrinting''--''BwPrinting''--''Printer''--Leaf, 0)]"
    definition "PrintingHierarchy_tree=Department ''ColorPrinting'' [
              Department ''Printer'' [], 
              Department ''BwPrinting'' [
                  Department ''Printer'' []]]"
    definition PrintingHierarchy::"string SecurityInvariant" where
      "PrintingHierarchy ≡ new_configured_list_SecurityInvariant SINVAR_DomainHierarchyNG_impl.SINVAR_LIB_DomainHierarchyNG ⦇ 
        node_properties = PrintingHierarchy_nodes
        ⦈"  *)</span>
  <span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The color printer is only accessibly by employees, The black.white printer by employees and students›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">PrintingACL</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_CommunicationPartners <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''PrinterColor''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''Employees''</span><span class="main">,</span> <span class="inner_quoted">''EReachable''</span><span class="main">]</span><span class="main">,</span>
                             <span class="inner_quoted">''PrinterBW''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''Employees''</span><span class="main">,</span> <span class="inner_quoted">''EReachable''</span><span class="main">,</span> <span class="inner_quoted">''Students''</span><span class="main">]</span><span class="main">,</span>
                             <span class="inner_quoted">''Employees''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''EReachable''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''Students''</span> <span class="main">↦</span> Care<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''printing ACL''</span>"</span></span>

  <span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Printers are information sinks›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">PrintingSink</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_Sink <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''PrinterColor''</span> <span class="main">↦</span> Sink<span class="main">,</span>
                             <span class="inner_quoted">''PrinterBW''</span> <span class="main">↦</span> Sink<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''printing sink''</span>"</span></span>



  <span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Students may access each other but are not accessible from the outside›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">StudentSubnet</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_SubnetsInGW <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Students''</span> <span class="main">↦</span> Member<span class="main">,</span> <span class="inner_quoted">''Employees''</span> <span class="main">↦</span> Member<span class="main">,</span> <span class="inner_quoted">''EReachable''</span> <span class="main">↦</span> InboundGateway<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''student subnet''</span>"</span></span>


  <span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The files server is only accessibly by employees›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">FilesSrvACL</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_CommunicationPartners <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''FilesSrv''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''Employees''</span><span class="main">,</span> <span class="inner_quoted">''EReachable''</span><span class="main">]</span><span class="main">,</span>
                             <span class="inner_quoted">''Employees''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''EReachable''</span> <span class="main">↦</span> Care<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''file srv acl''</span>"</span></span>


  <span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹emplyees are reachable from the Internet›</span></span>
    <span class="comment1">(*nothing to do here*)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_sinvar ConfidentialChairData ChairNetwork_empty"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_sinvar PrintingACL ChairNetwork_empty"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_sinvar PrintingSink ChairNetwork_empty"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_sinvar StudentSubnet ChairNetwork_empty"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_sinvar FilesSrvACL ChairNetwork_empty"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairSecurityRequirements</span> <span class="main">=</span> <span class="main">[</span>ConfidentialChairData<span class="main">,</span> PrintingACL<span class="main">,</span> PrintingSink<span class="main">,</span> StudentSubnet<span class="main">,</span> FilesSrvACL<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"implc_get_offending_flows ChairSecurityRequirements ChairNetwork_empty"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"generate_valid_topology ChairSecurityRequirements ChairNetwork_empty"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"List.product <span class="main">(</span>nodesL ChairNetwork_empty<span class="main">)</span> <span class="main">(</span>nodesL ChairNetwork_empty<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork</span> <span class="main">=</span> generate_valid_topology ChairSecurityRequirements 
      <span class="main">⦇</span>nodesL <span class="main">=</span> nodesL ChairNetwork_empty<span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="main">(</span>nodesL ChairNetwork_empty<span class="main">)</span> <span class="main">(</span>nodesL ChairNetwork_empty<span class="main">)</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled ChairSecurityRequirements ChairNetwork"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"ChairNetwork"</span></span>

<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"ChairSecurityRequirements"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"ChairNetwork"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>



<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Impl_List_Playground_statefulpolicycompliance">
<div class="head">
<h1>Theory Impl_List_Playground_statefulpolicycompliance</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Impl_List_Playground_statefulpolicycompliance
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Impl.html">../TopoS_Impl</a>"</span>
    <a href="Impl_List_Playground_ChairNetwork.html">Impl_List_Playground_ChairNetwork</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">thm</span></span> ChairNetwork_def
<span class="keyword1"><span class="command">thm</span></span> ChairSecurityRequirements_def

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork_stateful_IFS</span> <span class="main">=</span>
  <span class="main">⦇</span> hostsL <span class="main">=</span> nodesL ChairNetwork<span class="main">,</span>
    flows_fixL <span class="main">=</span> edgesL ChairNetwork<span class="main">,</span>
    flows_stateL <span class="main">=</span> filter_IFS_no_violations ChairNetwork ChairSecurityRequirements <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"edgesL ChairNetwork"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"filter_IFS_no_violations ChairNetwork ChairSecurityRequirements"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"ChairNetwork_stateful_IFS"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>flows_stateL ChairNetwork_stateful_IFS<span class="main">)</span> <span class="main">⊆</span>
       <span class="main">(</span>set <span class="main">(</span>flows_fixL ChairNetwork_stateful_IFS<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">(*must always hold*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="main">(</span>flows_fixL ChairNetwork_stateful_IFS<span class="main">)</span><span class="main">)</span> <span class="main">-</span> set <span class="main">(</span>flows_stateL ChairNetwork_stateful_IFS<span class="main">)</span>"</span></span>
<span class="comment1">(*only problems: printers!!!*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"stateful_list_policy_to_list_graph ChairNetwork_stateful_IFS"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork_stateful_ACS</span> <span class="main">=</span>
  <span class="main">⦇</span> hostsL <span class="main">=</span> nodesL ChairNetwork<span class="main">,</span>
   flows_fixL <span class="main">=</span> edgesL ChairNetwork<span class="main">,</span>
   flows_stateL <span class="main">=</span> filter_compliant_stateful_ACS ChairNetwork ChairSecurityRequirements <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"edgesL ChairNetwork"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"filter_compliant_stateful_ACS ChairNetwork ChairSecurityRequirements"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"ChairNetwork_stateful_ACS"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>flows_stateL ChairNetwork_stateful_ACS<span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>set <span class="main">(</span>flows_fixL ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">(*must always hold*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="main">(</span>flows_fixL ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span> <span class="main">-</span> set <span class="main">(</span>flows_stateL ChairNetwork_stateful_ACS<span class="main">)</span>"</span></span>

<span class="comment1">(*TODO: lemma … = X by eval*)</span>

<span class="comment1">(*flows that are already allowed in both directions are not marked as stateful*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>set <span class="main">(</span>flows_fixL ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span> <span class="main">-</span> set <span class="main">(</span>flows_stateL ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span> <span class="main">-</span> set <span class="main">(</span>backlinks <span class="main">(</span>flows_fixL ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*the new backflows*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>stateful_list_policy_to_list_graph ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>set <span class="main">(</span>edgesL ChairNetwork<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*the resulting ACS graph*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"stateful_list_policy_to_list_graph ChairNetwork_stateful_ACS"</span></span>


<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"generate_valid_stateful_policy_IFSACS ChairNetwork ChairSecurityRequirements"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"generate_valid_stateful_policy_IFSACS_2 ChairNetwork ChairSecurityRequirements"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>flows_fixL <span class="main">(</span>generate_valid_stateful_policy_IFSACS ChairNetwork ChairSecurityRequirements<span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       set <span class="main">(</span>flows_fixL <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 ChairNetwork ChairSecurityRequirements<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>flows_stateL <span class="main">(</span>generate_valid_stateful_policy_IFSACS ChairNetwork ChairSecurityRequirements<span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       set <span class="main">(</span>flows_stateL <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 ChairNetwork ChairSecurityRequirements<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork_stateful</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS ChairNetwork ChairSecurityRequirements"</span></span>


<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL ChairNetwork_stateful"</span><span class="antiquote">}</span></span> 
  <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span>
   <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL ChairNetwork_stateful"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>




<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Example">
<div class="head">
<h1>Theory Example</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Example
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Interface.html">../TopoS_Interface</a>"</span> <span class="quoted">"<a href="TopoS_Library.html">../TopoS_Library</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">subsection</span></span> <span class="quoted"><span class="plain_text">‹Network Graph and Security Requirements›</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We define the network›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_net_secgw</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_net_secgw</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">]</span><span class="main">,</span> 
    edgesL <span class="main">=</span> <span class="main">[</span>
      <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> 
      <span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">11</span><span class="main">)</span><span class="main">,</span><span class="main">(</span><span class="numeral">8</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">,</span> 
      <span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">12</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"wf_list_graph example_net_secgw"</span></span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We add two security requirements›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">NMParams_secgw_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> secgw_member<span class="main">)</span> TopoS_Params"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">NMParams_secgw_1</span> <span class="main">≡</span> <span class="main">⦇</span> node_properties <span class="main">=</span> <span class="main">[</span><span class="main">1</span> <span class="main">↦</span> DomainMember<span class="main">,</span> 
                                     <span class="numeral">2</span> <span class="main">↦</span> DomainMember<span class="main">,</span> 
                                     <span class="numeral">3</span> <span class="main">↦</span> DomainMember<span class="main">,</span>
                                     <span class="numeral">8</span> <span class="main">↦</span> PolEnforcePoint<span class="main">]</span> <span class="main">⦈</span>"</span></span>


  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">NMParams_blptrusted_1</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>nat<span class="main">,</span> SINVAR_BLPtrusted.node_config<span class="main">)</span> TopoS_Params"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">NMParams_blptrusted_1</span> <span class="main">≡</span> <span class="main">⦇</span> node_properties <span class="main">=</span> <span class="main">[</span><span class="main">1</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span> 
                                     <span class="numeral">2</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span> 
                                     <span class="numeral">3</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                                     <span class="numeral">8</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Both security requirements fulfilled?›</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"PolEnforcePoint_eval example_net_secgw NMParams_secgw_1"</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"SINVAR_BLPtrusted_impl.BLP_eval example_net_secgw NMParams_blptrusted_1"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Add violations!›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">example_net_secgw_invalid</span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">example_net_secgw_invalid</span> <span class="main">≡</span> example_net_secgw<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">11</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="numeral">11</span><span class="main">,</span><span class="numeral">8</span><span class="main">)</span><span class="main">#</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">#</span><span class="main">(</span>edgesL example_net_secgw<span class="main">)</span><span class="main">⦈</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Security Requirement still fulfilled?›</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"PolEnforcePoint_eval example_net_secgw_invalid NMParams_secgw_1"</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Whom to blame?›</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"PolEnforcePointExtended_offending_list example_net_secgw_invalid
          <span class="main">(</span>SINVAR_SecGwExt_impl.NetModel_node_props NMParams_secgw_1<span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Security Requirement still fulfilled?›</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"SINVAR_BLPtrusted_impl.BLP_eval example_net_secgw_invalid NMParams_blptrusted_1"</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Whom to blame?›</span></span>
  <span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"SINVAR_BLPtrusted_impl.BLP_offending_list example_net_secgw_invalid
      <span class="main">(</span>SINVAR_BLPtrusted_impl.NetModel_node_props NMParams_blptrusted_1<span class="main">)</span>"</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Example_NetModel">
<div class="head">
<h1>Theory Example_NetModel</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Example_NetModel
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Interface.html">../TopoS_Interface</a>"</span> <span class="quoted">"<a href="TopoS_Helper.html">../TopoS_Helper</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A toy example that defines a valid network security requirement model›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">default_node_properties</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"bool"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>  <span class="quoted"><span class="quoted">"<span class="free">default_node_properties</span> <span class="main">≡</span> False"</span></span>

<span class="keyword1"><span class="command">fun</span></span> <span class="entity">sinvar</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="tfree">'v</span> graph <span class="main">⇒</span> <span class="main">(</span><span class="tfree">'v</span> <span class="main">⇒</span> bool<span class="main">)</span> <span class="main">⇒</span> bool"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">sinvar</span> <span class="free"><span class="bound"><span class="entity">G</span></span></span> <span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="main">=</span> <span class="main">(</span><span class="main">∀</span> <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∈</span> <span class="main">(</span>edges <span class="free"><span class="bound"><span class="entity">G</span></span></span><span class="main">)</span><span class="main">.</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e1</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="free"><span class="bound"><span class="entity">nP</span></span></span> <span class="bound">e2</span><span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(* we will not define receiver_violation!! Works for both! *)</span>


<span class="keyword1" id="Example_NetModel-sinvar_mono"><span class="command">lemma</span></span> sinvar_mono<span class="main">:</span> <span class="quoted"><span class="quoted">"SecurityInvariant_withOffendingFlows.sinvar_mono sinvar"</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">only</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.sinvar_mono_def<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">clarify</span><span class="main">)</span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">auto</span>

 
<span class="comment1">― ‹The preliminaries: mostly, sinvar is monotonic›</span>
<span class="keyword1"><span class="command">interpretation</span></span> SecurityInvariant_preliminaries
<span class="keyword2"><span class="keyword">where</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">frule_tac</span> finite_distinct_list<span class="main"><span class="main">[</span></span><span class="operator">OF</span> wf_graph.finiteE<span class="main"><span class="main">]</span></span><span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">erule_tac</span> exE<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rename_tac</span> list_edges<span class="main">)</span>
    <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> ff<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="improper">list_edges</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> SecurityInvariant_withOffendingFlows.mono_imp_set_offending_flows_not_empty<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
       <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span><span class="main">)</span><span class="main"><span class="keyword3">[</span></span>6<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">auto</span> <span class="quasi_keyword">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.is_offending_flows_def graph_ops<span class="main">)</span><span class="main"><span class="keyword3">[</span></span>2<span class="main"><span class="keyword3">]</span></span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">fact</span> SecurityInvariant_withOffendingFlows.sinvar_mono_imp_is_offending_flows_mono<span class="main"><span class="main">[</span></span><span class="operator">OF</span> sinvar_mono<span class="main"><span class="main">]</span></span><span class="main">)</span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="comment1">― ‹With generic target focus›</span>
<span class="keyword1"><span class="command">interpretation</span></span> Example_NetModel<span class="main">:</span> SecurityInvariant
<span class="keyword2"><span class="keyword">where</span></span> default_node_properties <span class="main">=</span> <span class="quoted">default_node_properties</span>
<span class="keyword2"><span class="keyword">and</span></span> sinvar <span class="main">=</span> <span class="quoted">sinvar</span>
<span class="keyword2"><span class="keyword">and</span></span> receiver_violation <span class="main">=</span> <span class="quoted"><span class="free">receiver_violation</span></span> <span class="comment1">(*yep, that's a variable*)</span>
  <span class="keyword1"><span class="command">unfolding</span></span> default_node_properties_def
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">unfold_locales</span>

   <span class="comment1">― ‹Secure bydefault›</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span><span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
       SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
       SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> graph_ops<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
   <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="operator">blast</span>

 <span class="comment1">― ‹Uniqueness›</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>default_node_properties_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SecurityInvariant_withOffendingFlows.set_offending_flows_def
     SecurityInvariant_withOffendingFlows.is_offending_flows_min_set_def
     SecurityInvariant_withOffendingFlows.is_offending_flows_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> graph_ops<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span> <span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">split</span><span class="main"><span class="main">:</span></span> prod.split_asm prod.split<span class="main">)</span>
 <span class="comment1">― ‹proof by counter example: assume False is not the unique default parameter›</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">⦇</span> nodes<span class="main">=</span><span class="main">{</span>vertex_1<span class="main">}</span><span class="main">,</span> edges <span class="main">=</span> <span class="main">{</span><span class="main">(</span>vertex_1<span class="main">,</span>vertex_1<span class="main">)</span><span class="main">}</span> <span class="main">⦈</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule</span> conjI<span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> wf_graph_def<span class="main"><span class="keyword3">;</span></span> <span class="operator">fail</span><span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">λ</span> <span class="bound">x</span><span class="main">.</span> default_node_properties<span class="main">)</span><span class="main">(</span>vertex_1 <span class="main">:=</span> False<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span>default_node_properties_def<span class="main">)</span>
 <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">case_tac</span> <span class="quoted"><span class="free">receiver_violation</span></span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">simp_all</span><span class="main">)</span>
  <span class="keyword1"><span class="command"><span class="improper"><span class="command">apply</span></span></span></span><span class="main">(</span><span class="operator">rule_tac</span> x<span class="main"><span class="main">=</span></span><span class="quoted"><span class="quoted"><span class="quoted">"<span class="main"><span class="main">{</span></span><span class="main"><span class="main">(</span></span>vertex_1<span class="main"><span class="main">,</span></span>vertex_1<span class="main"><span class="main">)</span></span><span class="main"><span class="main">}</span></span>"</span></span></span> <span class="keyword2"><span class="keyword"><span class="quasi_keyword">in</span></span></span> exI<span class="main"><span class="keyword3">,</span></span> <span class="operator">simp</span><span class="main">)</span><span class="main"><span class="keyword3">+</span></span>
<span class="keyword1"><span class="command"><span class="improper"><span class="command">done</span></span></span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹And we end up with a totally useless network security requirement model. I hope this was instructive.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Example_Forte14">
<div class="head">
<h1>Theory Example_Forte14</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Example_Forte14
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Impl.html">../TopoS_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">policy</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''CC''</span><span class="main">,</span> <span class="inner_quoted">''C1''</span><span class="main">,</span> <span class="inner_quoted">''C2''</span><span class="main">,</span> <span class="inner_quoted">''IFEsrv''</span><span class="main">,</span> <span class="inner_quoted">''IFE1''</span><span class="main">,</span> <span class="inner_quoted">''IFE2''</span><span class="main">,</span> <span class="inner_quoted">''SAT''</span><span class="main">,</span> <span class="inner_quoted">''Wifi''</span><span class="main">,</span> <span class="inner_quoted">''P1''</span><span class="main">,</span> <span class="inner_quoted">''P2''</span> <span class="main">]</span><span class="main">,</span>
                edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''CC''</span><span class="main">,</span> <span class="inner_quoted">''C1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''CC''</span><span class="main">,</span> <span class="inner_quoted">''C2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''CC''</span><span class="main">,</span> <span class="inner_quoted">''IFEsrv''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C1''</span><span class="main">,</span> <span class="inner_quoted">''CC''</span><span class="main">)</span><span class="main">,</span> 
                          <span class="main">(</span><span class="inner_quoted">''C1''</span><span class="main">,</span> <span class="inner_quoted">''C2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C2''</span><span class="main">,</span> <span class="inner_quoted">''CC''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C2''</span><span class="main">,</span> <span class="inner_quoted">''C1''</span><span class="main">)</span><span class="main">,</span> 
                          <span class="main">(</span><span class="inner_quoted">''IFEsrv''</span><span class="main">,</span> <span class="inner_quoted">''IFE1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''IFEsrv''</span><span class="main">,</span> <span class="inner_quoted">''IFE2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''IFEsrv''</span><span class="main">,</span> <span class="inner_quoted">''SAT''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''IFEsrv''</span><span class="main">,</span> <span class="inner_quoted">''Wifi''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''IFE1''</span><span class="main">,</span> <span class="inner_quoted">''IFEsrv''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''IFE2''</span><span class="main">,</span> <span class="inner_quoted">''IFEsrv''</span><span class="main">)</span><span class="main">,</span> 
                          <span class="main">(</span><span class="inner_quoted">''Wifi''</span><span class="main">,</span> <span class="inner_quoted">''IFEsrv''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Wifi''</span><span class="main">,</span> <span class="inner_quoted">''SAT''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Wifi''</span><span class="main">,</span> <span class="inner_quoted">''P1''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''Wifi''</span><span class="main">,</span> <span class="inner_quoted">''P2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''P1''</span><span class="main">,</span> <span class="inner_quoted">''Wifi''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''P1''</span><span class="main">,</span> <span class="inner_quoted">''P2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''P2''</span><span class="main">,</span> <span class="inner_quoted">''Wifi''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''P2''</span><span class="main">,</span> <span class="inner_quoted">''P1''</span><span class="main">)</span>
                          <span class="main">]</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="comment1">(*21 rules*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"length <span class="main">(</span>edgesL policy<span class="main">)</span> <span class="main">=</span> <span class="numeral">21</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">DomainHierarchy_m</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">DomainHierarchy_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_DomainHierarchyNG_impl.SINVAR_LIB_DomainHierarchyNG <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span>
            <span class="inner_quoted">''CC''</span> <span class="main">↦</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''crew''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span>
            <span class="inner_quoted">''C1''</span> <span class="main">↦</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''crew''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span>
            <span class="inner_quoted">''C2''</span> <span class="main">↦</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''crew''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span>
            <span class="inner_quoted">''IFEsrv''</span> <span class="main">↦</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span>
            <span class="inner_quoted">''IFE1''</span> <span class="main">↦</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span>
            <span class="inner_quoted">''IFE2''</span> <span class="main">↦</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span>
            <span class="inner_quoted">''SAT''</span> <span class="main">↦</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span><span class="inner_quoted">''INET''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span>
            <span class="inner_quoted">''Wifi''</span> <span class="main">↦</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span><span class="inner_quoted">''POD''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span>
            <span class="inner_quoted">''P1''</span> <span class="main">↦</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span><span class="inner_quoted">''POD''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span>
            <span class="inner_quoted">''P2''</span> <span class="main">↦</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span><span class="inner_quoted">''POD''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span>
          <span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''Device Hierarchy''</span>"</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹sanity check that the host attributes correspond to the desired hierarchy›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"DomainHierarchyNG_sanity_check_config
    <span class="main">(</span>map snd <span class="main">[</span>
            <span class="main">(</span><span class="inner_quoted">''CC''</span><span class="main">,</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''crew''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span><span class="inner_quoted">''C1''</span><span class="main">,</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''crew''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span><span class="inner_quoted">''C2''</span><span class="main">,</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''crew''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span><span class="inner_quoted">''IFEsrv''</span><span class="main">,</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span><span class="inner_quoted">''IFE1''</span><span class="main">,</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span><span class="inner_quoted">''IFE2''</span><span class="main">,</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span><span class="inner_quoted">''SAT''</span><span class="main">,</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span><span class="inner_quoted">''INET''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span><span class="inner_quoted">''Wifi''</span><span class="main">,</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span><span class="inner_quoted">''POD''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span><span class="inner_quoted">''P1''</span><span class="main">,</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span><span class="inner_quoted">''POD''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
            <span class="main">(</span><span class="inner_quoted">''P2''</span><span class="main">,</span> DN <span class="main">(</span><span class="inner_quoted">''aircraft''</span><span class="main">--</span><span class="inner_quoted">''entertain''</span><span class="main">--</span><span class="inner_quoted">''POD''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>
                            <span class="main">]</span><span class="main">)</span>
            <span class="main">(</span>
            Department <span class="inner_quoted">''aircraft''</span> <span class="main">[</span>
              Department <span class="inner_quoted">''entertain''</span> <span class="main">[</span>
                Department <span class="inner_quoted">''POD''</span> <span class="main">[]</span><span class="main">,</span> Department <span class="inner_quoted">''INET''</span> <span class="main">[]</span>
              <span class="main">]</span><span class="main">,</span>
              Department <span class="inner_quoted">''crew''</span> <span class="main">[]</span>
            <span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">PolEnforcePoint_m</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">PolEnforcePoint_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_PolEnforcePointExtended <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''IFEsrv''</span> <span class="main">↦</span> SINVAR_SecGwExt.PolEnforcePointIN<span class="main">,</span>
                             <span class="inner_quoted">''IFE1''</span> <span class="main">↦</span> SINVAR_SecGwExt.DomainMember<span class="main">,</span>
                             <span class="inner_quoted">''IFE2''</span> <span class="main">↦</span> SINVAR_SecGwExt.DomainMember<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''IFEsrc mediates access of its thin clients''</span>"</span></span>


<span class="comment1">(*
0 - unclassified
1 - confidential
2 - secret
3 - topsecret
*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLP_m</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">BLP_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_BLPtrusted <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''CC''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="numeral">2</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                             <span class="inner_quoted">''C1''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="numeral">2</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                             <span class="inner_quoted">''C2''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="numeral">2</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                             <span class="inner_quoted">''IFE1''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                             <span class="inner_quoted">''IFE2''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                             <span class="inner_quoted">''IFEsrv''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span><span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''Confidential data''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">security_invariants</span> <span class="main">=</span> <span class="main">[</span> DomainHierarchy_m<span class="main">,</span> PolEnforcePoint_m<span class="main">,</span> BLP_m<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled security_invariants policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_get_offending_flows security_invariants policy <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Visualization with a violation.
›</span></span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"security_invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="inner_quoted">''P1''</span><span class="main">,</span> <span class="inner_quoted">''CC''</span><span class="main">)</span><span class="main">#</span>edgesL policy<span class="main">⦈</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>






<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">max_policy</span> <span class="main">=</span> generate_valid_topology security_invariants <span class="main">⦇</span>nodesL <span class="main">=</span> nodesL policy<span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">⦈</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹calculating the maximum policy›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"max_policy"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The diff to the maximum policy. It adds reflexive flows and the IFEsrv may send to the PODs.
›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edgesL policy"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL max_policy<span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL policy<span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Visualizing the maximum policy.
›</span></span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"security_invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"max_policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled security_invariants policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled security_invariants max_policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹A stateful implementation›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">stateful_policy</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS policy security_invariants"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"stateful_policy"</span></span>

<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL stateful_policy"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL stateful_policy"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Distributed_WebApp">
<div class="head">
<h1>Theory Distributed_WebApp</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Distributed_WebApp
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Impl.html">../TopoS_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Distributed Web Application Example›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
    The symbolic policy names are of type <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">typ</span></span> <span class="quoted"><span class="quoted">string</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, e.g. <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''WebFrnt''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We start with the empty policy, only the entities are defined.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">policy</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span> <span class="inner_quoted">''DB''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">,</span> <span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">]</span><span class="main">,</span>
                edgesL <span class="main">=</span> <span class="main">[]</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Sanity check›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="comment1">(*proof by eval means we have executable code to show the lemma. No need to show anything by hand*)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Defining the security invariants›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">LogSink_m</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">LogSink_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_Sink <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Log''</span> <span class="main">↦</span> Sink<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''No information must leave the logging server''</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
0 - unclassified
1 - confidential
›</span></span>
<span class="comment1">― ‹trusted: can access any security level, privacy-level 0: can reveal to anyone. I.e. can declassify›</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">BLP_m</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">BLP_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_BLPtrusted <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''DB''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                             <span class="inner_quoted">''Log''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                             <span class="inner_quoted">''WebApp''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span> 
                             <span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''The database and the logging server have confidential information''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Subnet_m</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">Subnet_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_SubnetsInGW <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''DB''</span> <span class="main">↦</span> Member<span class="main">,</span>
                             <span class="inner_quoted">''Log''</span> <span class="main">↦</span> Member<span class="main">,</span>
                             <span class="inner_quoted">''WebApp''</span> <span class="main">↦</span> Member<span class="main">,</span>
                             <span class="inner_quoted">''WebFrnt''</span> <span class="main">↦</span> InboundGateway <span class="comment1">― ‹DMZ›</span>
                             <span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''internal/DMZ structure''</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">DBACL_m</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">DBACL_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_CommunicationPartners <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''DB''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''WebApp''</span><span class="main">]</span><span class="main">,</span>
                             <span class="inner_quoted">''WebApp''</span> <span class="main">↦</span> Care
                             <span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''ACL of db''</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The list of security invariants›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">security_invariants</span> <span class="main">=</span> <span class="main">[</span>Subnet_m<span class="main">,</span> BLP_m<span class="main">,</span> LogSink_m<span class="main">,</span> DBACL_m<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹All security invariants are fulfilled (obviously, the policy permits no flows).›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled security_invariants policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Obviously, no policy rules violate the security invariants.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_get_offending_flows security_invariants policy <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We generate the maximum security policy.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">max_policy</span> <span class="main">=</span> generate_valid_topology security_invariants <span class="main">⦇</span>nodesL <span class="main">=</span> nodesL policy<span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">⦈</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Calculating the maximum policy (executing it).›</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"max_policy"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"max_policy <span class="main">=</span> 
   <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span> <span class="inner_quoted">''DB''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">,</span> <span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">]</span><span class="main">,</span>
    edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span> <span class="inner_quoted">''WebFrnt''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span> <span class="inner_quoted">''WebApp''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''DB''</span><span class="main">,</span> <span class="inner_quoted">''DB''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''DB''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''DB''</span><span class="main">,</span> <span class="inner_quoted">''WebApp''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Log''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''WebFrnt''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''DB''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''WebApp''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''INET''</span><span class="main">,</span> <span class="inner_quoted">''WebFrnt''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''INET''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">(*proof by eval means it can be directly executed*)</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Visualizing the maximum policy
›</span></span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"security_invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"max_policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The maximum policy also fulfills all security invariants.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled security_invariants max_policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This holds in general: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> generate_valid_topology_sound<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹fine-tuning generated policy.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">my_policy</span> <span class="main">=</span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span> <span class="inner_quoted">''DB''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">,</span> <span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">]</span><span class="main">,</span>
    edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span> <span class="inner_quoted">''WebFrnt''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span> <span class="inner_quoted">''WebApp''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''DB''</span><span class="main">,</span> <span class="inner_quoted">''DB''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''DB''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''DB''</span><span class="main">,</span> <span class="inner_quoted">''WebApp''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Log''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''WebFrnt''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''DB''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''WebApp''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''INET''</span><span class="main">,</span> <span class="inner_quoted">''WebFrnt''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''INET''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled security_invariants my_policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL my_policy<span class="main">)</span> <span class="main">⊂</span> set <span class="main">(</span>edgesL max_policy<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The diff to the maximum policy.
›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edgesL my_policy"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#3399FF\", constraint=false]"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL max_policy<span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL my_policy<span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>



<span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹A stateful implementation›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">stateful_policy</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS my_policy security_invariants"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"stateful_policy"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹the stateful compliance criteria›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹No information flow violations›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>get_IFS security_invariants<span class="main">)</span> <span class="main">(</span>stateful_list_policy_to_list_graph stateful_policy<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹No access control side effects›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span> <span class="bound">F</span> <span class="main">∈</span> set <span class="main">(</span>implc_get_offending_flows <span class="main">(</span>get_ACS security_invariants<span class="main">)</span> <span class="main">(</span>stateful_list_policy_to_list_graph stateful_policy<span class="main">)</span><span class="main">)</span><span class="main">.</span>
            set <span class="bound">F</span> <span class="main">⊆</span> set <span class="main">(</span>backlinks <span class="main">(</span>flows_stateL stateful_policy<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>set <span class="main">(</span>flows_fixL stateful_policy<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In general, the calculated stateful policy complies with the security policy: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">thm</span></span> generate_valid_stateful_policy_IFSACS_stateful_policy_compliance<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Visualizing the stateful policy.›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL stateful_policy"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL stateful_policy"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Exporting to Network Security Mechanism Configurations›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Space-separated policy dump›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL stateful_policy"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">""</span>^<span class="entity">v1</span>^<span class="inner_quoted">" "</span>^<span class="entity">v2</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>

writeln <span class="inner_quoted">"# stateful answers"</span><span class="main">;</span>
<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL stateful_policy"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="entity">v2</span>^<span class="inner_quoted">" "</span>^<span class="entity">v1</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹firewall -- classical use case›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹

<span class="comment1">(*header*)</span>
writeln <span class="main">(</span><span class="inner_quoted">"echo 1 &gt; /proc/sys/net/ipv4/ip_forward"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"# flush all rules"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"iptables -F"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"#default policy for FORWARD chain:"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"iptables -P FORWARD DROP"</span><span class="main">)</span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>  <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL stateful_policy"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"iptables -A FORWARD -i $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_iface -s $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -o $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_iface -d $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT"</span>^<span class="inner_quoted">" # "</span>^<span class="entity">v1</span>^<span class="inner_quoted">" -&gt; "</span>^<span class="entity">v2</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL stateful_policy"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"iptables -I FORWARD -m state --state ESTABLISHED -i $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_iface -s $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -o $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_iface -d $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT # "</span>^<span class="entity">v2</span>^<span class="inner_quoted">" -&gt; "</span>^<span class="entity">v1</span>^<span class="inner_quoted">" (answer)"</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹firewall -- OpenVPN scenario›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹

<span class="comment1">(*header*)</span>
writeln <span class="main">(</span><span class="inner_quoted">"echo 1 &gt; /proc/sys/net/ipv4/ip_forward"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"# flush all rules"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"iptables -F"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"#default policy for FORWARD chain:"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"iptables -P FORWARD DROP"</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">iface</span> <span class="main">(</span><span class="entity">s</span><span class="main">:</span> string<span class="main">)</span><span class="main">:</span> string <span class="main">=</span>
  <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">s</span> <span class="main">=</span> <span class="inner_quoted">"INET"</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="inner_quoted">"eth0"</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="inner_quoted">"tun0"</span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">←</span> flows_fixL stateful_policy<span class="main">.</span> <span class="bound">s</span> <span class="main">≠</span> <span class="bound">r</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"iptables -A FORWARD -i "</span>^<span class="entity">iface</span> <span class="entity">v1</span>^<span class="inner_quoted">" -s $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -o "</span>^<span class="entity">iface</span> <span class="entity">v2</span>^<span class="inner_quoted">" -d $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT"</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL stateful_policy"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"iptables -I FORWARD -m state --state ESTABLISHED -i "</span>^<span class="entity">iface</span> <span class="entity">v2</span>^<span class="inner_quoted">" -s $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -o "</span>^<span class="entity">iface</span> <span class="entity">v1</span>^<span class="inner_quoted">" -d $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT"</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
›</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>flows_stateL stateful_policy<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>flows_fixL stateful_policy<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stateful_flows</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string <span class="main">×</span> string<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stateful_flows</span> <span class="main">≡</span> <span class="main">[</span><span class="main">(</span><span class="bound">src</span><span class="main">,</span> <span class="bound">dst</span><span class="main">)</span> <span class="main">←</span> flows_stateL stateful_policy<span class="main">.</span> <span class="bound">src</span> <span class="main">≠</span> <span class="bound">dst</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"stateful_flows"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">stateless_flows</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span>string <span class="main">×</span> string<span class="main">)</span> list"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">stateless_flows</span> <span class="main">≡</span> <span class="main">[</span><span class="main">(</span><span class="bound">src</span><span class="main">,</span> <span class="bound">dst</span><span class="main">)</span> <span class="main">←</span> flows_fixL stateful_policy<span class="main">.</span> <span class="bound">src</span> <span class="main">≠</span> <span class="bound">dst</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">src</span><span class="main">,</span> <span class="bound">dst</span><span class="main">)</span> <span class="main">∉</span> set stateful_flows<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"stateless_flows"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹OpenFlow Flow table Rules›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">ARP</span> <span class="main">(</span><span class="entity">src</span><span class="main">:</span> string<span class="main">)</span> <span class="main">(</span><span class="entity">dst</span><span class="main">:</span> string<span class="main">)</span><span class="main">:</span> string <span class="main">=</span>
  <span class="inner_quoted">"# ARP Request\n"</span>^
  <span class="inner_quoted">"in_port=${port_"</span>^<span class="entity">src</span>^<span class="inner_quoted">"} dl_src=${mac_"</span>^<span class="entity">src</span>^<span class="inner_quoted">"} dl_dst=ff:ff:ff:ff:ff:ff arp arp_sha=${mac_"</span>^<span class="entity">src</span>^<span class="inner_quoted">"} "</span>^
  <span class="inner_quoted">"arp_spa=${ip4_"</span>^<span class="entity">src</span>^<span class="inner_quoted">"} arp_tpa=${ip4_"</span>^<span class="entity">dst</span>^<span class="inner_quoted">"} priority=40000 action=mod_dl_dst:${mac_"</span>^<span class="entity">dst</span>^<span class="inner_quoted">"},output:${port_"</span>^<span class="entity">dst</span>^<span class="inner_quoted">"}"</span>^<span class="inner_quoted">"\n"</span>^
  <span class="inner_quoted">"# ARP Reply\n"</span>^
  <span class="inner_quoted">"dl_src=${mac_"</span>^<span class="entity">dst</span>^<span class="inner_quoted">"} dl_dst=${mac_"</span>^<span class="entity">src</span>^<span class="inner_quoted">"} arp arp_sha=${mac_"</span>^<span class="entity">dst</span>^<span class="inner_quoted">"} "</span>^
  <span class="inner_quoted">"arp_spa=${ip4_"</span>^<span class="entity">dst</span>^<span class="inner_quoted">"} arp_tpa=${ip4_"</span>^<span class="entity">src</span>^<span class="inner_quoted">"} priority=40000 action=output:${port_"</span>^<span class="entity">src</span>^<span class="inner_quoted">"}"</span><span class="main">;</span>

<span class="keyword2"><span class="keyword">local</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">IPv4_helper</span> <span class="main">(</span><span class="entity">priority</span><span class="main">:</span> int<span class="main">)</span> <span class="main">(</span><span class="entity">nw_src_wildcard</span><span class="main">:</span> bool<span class="main">)</span> <span class="main">(</span><span class="entity">nw_dst_wildcard</span><span class="main">:</span> bool<span class="main">)</span> <span class="main">(</span><span class="entity">src</span><span class="main">:</span> string<span class="main">)</span> <span class="main">(</span><span class="entity">dst</span><span class="main">:</span> string<span class="main">)</span><span class="main">:</span> string <span class="main">=</span>
    <span class="keyword2"><span class="keyword">let</span></span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">nw_src</span> <span class="main">=</span> <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">nw_src_wildcard</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="inner_quoted">"*"</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="inner_quoted">"${ip4_"</span>^<span class="entity">src</span>^<span class="inner_quoted">"}"</span><span class="main">)</span><span class="main">;</span>
      <span class="keyword1"><span class="keyword">val</span></span> <span class="entity">nw_dst</span> <span class="main">=</span> <span class="main">(</span><span class="keyword2"><span class="keyword">if</span></span> <span class="entity">nw_dst_wildcard</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="inner_quoted">"*"</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="inner_quoted">"${ip4_"</span>^<span class="entity">dst</span>^<span class="inner_quoted">"}"</span><span class="main">)</span><span class="main">;</span>
    <span class="keyword2"><span class="keyword">in</span></span>
      <span class="inner_quoted">"in_port=${port_"</span>^<span class="entity">src</span>^<span class="inner_quoted">"} dl_src=${mac_"</span>^<span class="entity">src</span>^<span class="inner_quoted">"} ip nw_src="</span>^<span class="entity">nw_src</span>^<span class="inner_quoted">" "</span>^
      <span class="inner_quoted">"nw_dst="</span>^<span class="entity">nw_dst</span>^<span class="inner_quoted">" priority="</span>^<span class="main">(</span>Int.toString <span class="entity">priority</span><span class="main">)</span>^<span class="inner_quoted">" action=mod_dl_dst:${mac_"</span>^<span class="entity">dst</span>^<span class="inner_quoted">"},output:${port_"</span>^<span class="entity">dst</span>^<span class="inner_quoted">"}"</span>
    <span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>
<span class="keyword2"><span class="keyword">in</span></span>
  <span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">IPv4</span> <span class="main">(</span><span class="entity">src</span><span class="main">:</span> string<span class="main">)</span> <span class="main">(</span><span class="entity">dst</span><span class="main">:</span> string<span class="main">)</span><span class="main">:</span> string <span class="main">=</span>
    <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">dst</span> <span class="main">=</span> <span class="inner_quoted">"INET"</span> <span class="keyword2"><span class="keyword">then</span></span>
      <span class="entity">IPv4_helper</span> <span class="inner_numeral">30000</span> false true <span class="entity">src</span> <span class="entity">dst</span>
    <span class="keyword2"><span class="keyword">else</span></span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">src</span> <span class="main">=</span> <span class="inner_quoted">"INET"</span> <span class="keyword2"><span class="keyword">then</span></span>
      <span class="entity">IPv4_helper</span> <span class="inner_numeral">30000</span> true false <span class="entity">src</span> <span class="entity">dst</span>
    <span class="keyword2"><span class="keyword">else</span></span>
      <span class="entity">IPv4_helper</span> <span class="inner_numeral">40000</span> false false <span class="entity">src</span> <span class="entity">dst</span>
      <span class="main">;</span>
<span class="keyword2"><span class="keyword">end</span></span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"stateful_flows"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="main">(</span><span class="entity">ARP</span> <span class="entity">v1</span> <span class="entity">v2</span><span class="main">)</span> ^ <span class="inner_quoted">"\n"</span> ^ <span class="main">(</span><span class="entity">ARP</span> <span class="entity">v2</span> <span class="entity">v1</span><span class="main">)</span> ^ <span class="inner_quoted">"\n"</span> ^ <span class="main">(</span><span class="entity">IPv4</span> <span class="entity">v1</span> <span class="entity">v2</span><span class="main">)</span> ^ <span class="inner_quoted">"\n"</span> ^ <span class="main">(</span><span class="entity">IPv4</span> <span class="entity">v2</span> <span class="entity">v1</span><span class="main">)</span> ^<span class="inner_quoted">"\n"</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"stateless_flows"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span>  writeln <span class="main">(</span><span class="main">(</span><span class="entity">ARP</span> <span class="entity">v1</span> <span class="entity">v2</span><span class="main">)</span> ^ <span class="inner_quoted">"\n"</span> ^ <span class="main">(</span><span class="entity">IPv4</span> <span class="entity">v1</span> <span class="entity">v2</span><span class="main">)</span> ^ <span class="inner_quoted">"\n"</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
›</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Finally, all the functions demonstrated here can be exported to several programming languages
     to obtain a stand-alone tool.›</span></span>
<span class="keyword1"><span class="command">export_code</span></span>
  <span class="quoted"><span class="quoted">security_invariants</span></span>
  <span class="quoted"><span class="quoted">policy</span></span>
  <span class="quoted"><span class="quoted">all_security_requirements_fulfilled</span></span>
  <span class="quoted"><span class="quoted">implc_get_offending_flows</span></span>
  <span class="quoted"><span class="quoted">max_policy</span></span>
  <span class="quoted"><span class="quoted">my_policy</span></span>
  <span class="quoted"><span class="quoted">generate_valid_stateful_policy_IFSACS</span></span>
  <span class="quoted"><span class="quoted">stateful_policy</span></span>
  <span class="quoted"><span class="quoted">stateful_flows</span></span>
  <span class="quoted"><span class="quoted">stateless_flows</span></span>
<span class="keyword2"><span class="keyword">in</span></span> Scala






<span class="comment1">(*dockermynet4*)</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">dockermynet4policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">dockermynet4policy</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span> <span class="inner_quoted">''DB''</span><span class="main">,</span> <span class="inner_quoted">''Log''</span><span class="main">,</span> <span class="inner_quoted">''WebApp''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">]</span><span class="main">,</span>
                edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''INET''</span><span class="main">,</span><span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''INET''</span><span class="main">,</span><span class="inner_quoted">''WebFrnt''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span><span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span><span class="inner_quoted">''WebApp''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span><span class="inner_quoted">''DB''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span><span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''WebApp''</span><span class="main">,</span><span class="inner_quoted">''WebFrnt''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''DB''</span><span class="main">,</span><span class="inner_quoted">''WebApp''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''DB''</span><span class="main">,</span><span class="inner_quoted">''DB''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''DB''</span><span class="main">,</span><span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''Log''</span><span class="main">,</span><span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''Log''</span><span class="main">,</span><span class="inner_quoted">''WebFrnt''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span><span class="inner_quoted">''WebApp''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span><span class="inner_quoted">''Log''</span><span class="main">)</span><span class="main">,</span>
                          <span class="main">(</span><span class="inner_quoted">''WebFrnt''</span><span class="main">,</span><span class="inner_quoted">''WebFrnt''</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph dockermynet4policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"security_invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"dockermynet4policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
writeln <span class="main">(</span><span class="inner_quoted">"*filter"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">":INPUT ACCEPT [0:0]"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">":FORWARD DROP [0:0]"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">":OUTPUT ACCEPT [0:0]"</span>^<span class="inner_quoted">"\n"</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mkiface</span> <span class="entity">s</span> <span class="main">=</span> <span class="keyword2"><span class="keyword">if</span></span> <span class="entity">s</span> <span class="main">=</span> <span class="inner_quoted">"INET"</span> <span class="keyword2"><span class="keyword">then</span></span> <span class="inner_quoted">"INET_iface"</span> <span class="keyword2"><span class="keyword">else</span></span> <span class="inner_quoted">"br-b74b417b331f"</span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>  <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL <span class="main">(</span>generate_valid_stateful_policy_IFSACS max_policy security_invariants<span class="main">)</span>"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"-A FORWARD -i "</span>^<span class="entity">mkiface</span> <span class="entity">v1</span>^<span class="inner_quoted">" -s $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -o "</span>^<span class="entity">mkiface</span> <span class="entity">v2</span>^<span class="inner_quoted">" -d $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT"</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL <span class="main">(</span>generate_valid_stateful_policy_IFSACS max_policy security_invariants<span class="main">)</span>"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"-I FORWARD -m state --state ESTABLISHED -i "</span>^<span class="entity">mkiface</span> <span class="entity">v2</span>^<span class="inner_quoted">" -s $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -o "</span>^<span class="entity">mkiface</span> <span class="entity">v1</span>^<span class="inner_quoted">" -d $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT"</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>

writeln <span class="main">(</span><span class="inner_quoted">"COMMIT"</span>^<span class="inner_quoted">"\n"</span><span class="main">)</span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL <span class="main">(</span>generate_valid_stateful_policy_IFSACS max_policy security_invariants<span class="main">)</span>"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL <span class="main">(</span>generate_valid_stateful_policy_IFSACS max_policy security_invariants<span class="main">)</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>

<span class="comment1">(*dfwfw (docker firewall) rules: https://github.com/irsl/dfwfw*)</span>

<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
writeln <span class="main">(</span><span class="inner_quoted">"{"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"\"container_to_container\": {"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"\"rules\": ["</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"\n"</span><span class="main">)</span><span class="main">;</span>

<span class="keyword1"><span class="keyword">fun</span></span> <span class="entity">mkdfwfwrule</span> <span class="entity">filter</span> <span class="entity">v1</span> <span class="entity">v2</span> <span class="main">=</span> <span class="inner_quoted">"{"</span>^<span class="inner_quoted">"\n"</span>^
             <span class="inner_quoted">"  \"network\": \"mynet\","</span>^<span class="inner_quoted">"\n"</span>^
             <span class="inner_quoted">"  \"src_container\": \"Name =~ ^"</span>^ String.map Char.toLower <span class="entity">v1</span> ^<span class="inner_quoted">"-?\\\\d*$\","</span>^<span class="inner_quoted">"\n"</span>^
             <span class="inner_quoted">"  \"dst_container\": \"Name =~ ^"</span>^ String.map Char.toLower <span class="entity">v2</span> ^<span class="inner_quoted">"-?\\\\d*$\","</span>^<span class="inner_quoted">"\n"</span>^
             <span class="inner_quoted">"  \"filter\": \""</span>^<span class="entity">filter</span>^<span class="inner_quoted">"\","</span>^<span class="inner_quoted">"\n"</span>^
             <span class="inner_quoted">"  \"action\": \"ACCEPT\""</span>^<span class="inner_quoted">"\n"</span>^
          <span class="inner_quoted">"},"</span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>  <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL <span class="main">(</span>generate_valid_stateful_policy_IFSACS max_policy security_invariants<span class="main">)</span>"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="entity">mkdfwfwrule</span> <span class="inner_quoted">""</span> <span class="entity">v1</span> <span class="entity">v2</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL <span class="main">(</span>generate_valid_stateful_policy_IFSACS max_policy security_invariants<span class="main">)</span>"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="entity">mkdfwfwrule</span> <span class="inner_quoted">"-m state --state ESTABLISHED"</span> <span class="entity">v2</span> <span class="entity">v1</span><span class="main">)</span><span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>

writeln <span class="main">(</span><span class="inner_quoted">"]}}"</span>^<span class="inner_quoted">"\n"</span><span class="main">)</span><span class="main">;</span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="I8_SSH_Landscape">
<div class="head">
<h1>Theory I8_SSH_Landscape</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> I8_SSH_Landscape
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Impl.html">../TopoS_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(*generated with ITval (spurious)*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="entity">I8SSHgraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">I8SSHgraph</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">0</span><span class="main">,</span> <span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">,</span> <span class="numeral">5</span><span class="main">,</span> <span class="numeral">6</span><span class="main">,</span> <span class="numeral">7</span><span class="main">,</span> <span class="numeral">8</span><span class="main">,</span> <span class="numeral">9</span><span class="main">,</span> <span class="numeral">10</span><span class="main">,</span> <span class="numeral">11</span><span class="main">,</span> <span class="numeral">12</span><span class="main">,</span> <span class="numeral">13</span><span class="main">,</span> <span class="numeral">14</span><span class="main">,</span> <span class="numeral">15</span><span class="main">,</span> <span class="numeral">16</span><span class="main">,</span> <span class="numeral">17</span><span class="main">,</span> <span class="numeral">18</span><span class="main">,</span> <span class="numeral">19</span><span class="main">,</span> <span class="numeral">20</span><span class="main">,</span> <span class="numeral">21</span><span class="main">,</span> <span class="numeral">22</span><span class="main">,</span> <span class="numeral">23</span><span class="main">]</span><span class="main">,</span>
    edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">20</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">18</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> 
      <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">20</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">18</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">17</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">18</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">17</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">18</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">20</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">18</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">20</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">17</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">17</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">20</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">17</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">18</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">17</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">17</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">18</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">20</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">18</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">20</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">15</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">19</span><span class="main">,</span> <span class="numeral">16</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">20</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">18</span><span class="main">,</span> <span class="numeral">7</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">22</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">23</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">11</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">8</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">9</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">13</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">12</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">10</span><span class="main">,</span> <span class="numeral">21</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="numeral">8</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">14</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">9</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">12</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">23</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">7</span><span class="main">,</span> <span class="numeral">10</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">22</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">16</span><span class="main">,</span> <span class="numeral">18</span><span class="main">)</span><span class="main">,</span> 
        <span class="main">(</span><span class="numeral">21</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">17</span><span class="main">,</span> <span class="numeral">19</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">14</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">15</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">13</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">11</span><span class="main">,</span> <span class="numeral">17</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span> 


<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">0</span><span class="main">,</span> <span class="numeral">20</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL I8SSHgraph<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">←</span> <span class="main">(</span>edgesL I8SSHgraph<span class="main">)</span><span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> <span class="numeral">2</span><span class="main">]</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph I8SSHgraph"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">Confidentiality1</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>nat SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">Confidentiality1</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_BLPtrusted_impl.SINVAR_LIB_BLPtrusted <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="main">0</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="main">1</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">2</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">3</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">4</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">5</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">6</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">7</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">8</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">9</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">10</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">11</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">12</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">13</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">14</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">15</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">16</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">17</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">18</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">19</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">20</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">21</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">22</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
         <span class="numeral">23</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''some confidentiality lables''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Subnet1</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_SubnetsInGW <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="main">0</span> <span class="main">↦</span> Unassigned<span class="main">,</span>
         <span class="main">1</span> <span class="main">↦</span> Unassigned<span class="main">,</span>
         <span class="numeral">2</span> <span class="main">↦</span> Member<span class="main">,</span>
         <span class="numeral">3</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">4</span> <span class="main">↦</span> Member<span class="main">,</span>
         <span class="numeral">5</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">6</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">7</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">8</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">9</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">10</span> <span class="main">↦</span> Member<span class="main">,</span>
         <span class="numeral">11</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">12</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">13</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">14</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">15</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">16</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">17</span> <span class="main">↦</span> Unassigned<span class="main">,</span>
         <span class="numeral">18</span> <span class="main">↦</span> Member<span class="main">,</span>
         <span class="numeral">19</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">20</span> <span class="main">↦</span> Unassigned<span class="main">,</span>
         <span class="numeral">21</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">22</span> <span class="main">↦</span> InboundGateway<span class="main">,</span>
         <span class="numeral">23</span> <span class="main">↦</span> Member<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''some subnet things''</span>"</span></span>


    <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">PrintingSink</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_Sink <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="numeral">3</span> <span class="main">↦</span> Sink<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''information must not leave printer''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">I8Requirements</span> <span class="main">=</span> <span class="main">[</span> Confidentiality1<span class="main">,</span> Subnet1 <span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"implc_get_offending_flows I8Requirements I8SSHgraph"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"implc_offending_flows PrintingSink I8SSHgraph"</span></span>

<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"I8Requirements"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"I8SSHgraph"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled I8Requirements I8SSHgraph"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_IFS_no_violations I8SSHgraph I8Requirements<span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>edgesL I8SSHgraph<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"filter_compliant_stateful_ACS I8SSHgraph I8Requirements"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹noBiFlows is the list of flows where not already a bidirectional flows is allowed.
      That is, the list of flows we might wish to be stateful to enhance connectivity.›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">noBiFlows</span> <span class="main">=</span> <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL I8SSHgraph<span class="main">.</span> <span class="keyword1">case</span> <span class="bound">e</span> <span class="keyword1">of</span> <span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">⇒</span> <span class="main">¬</span> <span class="main">(</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL I8SSHgraph<span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">r</span><span class="main">,</span><span class="bound">s</span><span class="main">)</span> <span class="main">∈</span> set <span class="main">(</span>edgesL I8SSHgraph<span class="main">)</span><span class="main">)</span> <span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set noBiFlows <span class="main">=</span> set <span class="main">(</span>filter_compliant_stateful_ACS I8SSHgraph I8Requirements<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"generate_valid_stateful_policy_IFSACS I8SSHgraph I8Requirements"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹even the order of the list is preserved!!›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"flows_stateL <span class="main">(</span>generate_valid_stateful_policy_IFSACS I8SSHgraph I8Requirements<span class="main">)</span> <span class="main">=</span> noBiFlows"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>flows_stateL <span class="main">(</span>generate_valid_stateful_policy_IFSACS I8SSHgraph I8Requirements<span class="main">)</span><span class="main">)</span> <span class="main">=</span> set noBiFlows"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>




<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Impl_List_Playground">
<div class="head">
<h1>Theory Impl_List_Playground</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Impl_List_Playground
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Impl.html">../TopoS_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The executbale models and the composition theory. We can build examples here›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">testGraph</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">testGraph</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Master''</span><span class="main">,</span> <span class="inner_quoted">''Slave1''</span><span class="main">,</span> <span class="inner_quoted">''Slave2''</span><span class="main">,</span> <span class="inner_quoted">''other1''</span><span class="main">,</span> <span class="inner_quoted">''other2''</span><span class="main">]</span><span class="main">,</span> 
                 edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''Master''</span><span class="main">,</span> <span class="inner_quoted">''Slave1''</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph testGraph"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">req1</span> <span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">req1</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_SecGwExt_impl.SINVAR_LIB_PolEnforcePointExtended <span class="main">⦇</span> 
      node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Master''</span> <span class="main">↦</span> PolEnforcePoint<span class="main">,</span>
                         <span class="inner_quoted">''Slave1''</span> <span class="main">↦</span> DomainMember<span class="main">,</span>
                         <span class="inner_quoted">''Slave2''</span> <span class="main">↦</span> DomainMember<span class="main">]</span>
      <span class="main">⦈</span> <span class="inner_quoted">''req1''</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">req2</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_NoRefl_impl.SINVAR_LIB_NoRefl <span class="main">⦇</span> 
      node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Master''</span> <span class="main">↦</span> Refl<span class="main">,</span>
                         <span class="inner_quoted">''other1''</span> <span class="main">↦</span> Refl<span class="main">,</span>
                         <span class="inner_quoted">''other2''</span> <span class="main">↦</span> Refl<span class="main">]</span>
      <span class="main">⦈</span> <span class="inner_quoted">''req2''</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">reqs</span> <span class="main">=</span> <span class="main">[</span>req1<span class="main">,</span> req2<span class="main">]</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">max_network</span> <span class="main">=</span> generate_valid_topology reqs 
      <span class="main">⦇</span>nodesL <span class="main">=</span> nodesL testGraph<span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="main">(</span>nodesL testGraph<span class="main">)</span> <span class="main">(</span>nodesL testGraph<span class="main">)</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"max_network"</span></span>

<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"reqs"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"max_network"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Impl_List_Playground_ChairNetwork_statefulpolicy_example">
<div class="head">
<h1>Theory Impl_List_Playground_ChairNetwork_statefulpolicy_example</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> Impl_List_Playground_ChairNetwork_statefulpolicy_example
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Impl.html">../TopoS_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹An example of our chair network [simplified]›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Our access control view on the network›</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ChairNetwork_empty</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork_empty</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''WebSrv''</span><span class="main">,</span> <span class="inner_quoted">''FilesSrv''</span><span class="main">,</span> <span class="inner_quoted">''Printer''</span><span class="main">,</span>
                                <span class="inner_quoted">''Students''</span><span class="main">,</span>
                                <span class="inner_quoted">''Employees''</span><span class="main">,</span>
                                <span class="inner_quoted">''Internet''</span><span class="main">]</span><span class="main">,</span>
                      edgesL <span class="main">=</span> <span class="main">[]</span> <span class="main">⦈</span>"</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph ChairNetwork_empty"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Our security requirements›</span></span>
  <span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹We have a server with confidential data›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ConfidentialChairData</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
      <span class="quoted"><span class="quoted">"<span class="free">ConfidentialChairData</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_BLPtrusted_impl.SINVAR_LIB_BLPtrusted <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''FilesSrv''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                             <span class="inner_quoted">''Employees''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span><span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''confidential data''</span>"</span></span>


  <span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹accessibly by employees and students›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">PrintingACL</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_CommunicationPartners <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Printer''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''Employees''</span><span class="main">,</span> <span class="inner_quoted">''Students''</span><span class="main">]</span><span class="main">,</span>
                             <span class="inner_quoted">''Employees''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''Students''</span> <span class="main">↦</span> Care<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''printing acl''</span>"</span></span>

  <span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Printers are information sinks›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">PrintingSink</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_Sink <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Printer''</span> <span class="main">↦</span> Sink<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''printing sink''</span>"</span></span>



  <span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹Students and Employees may access each other but are not accessible from the outside›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">InternalSubnet</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_SubnetsInGW <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Students''</span> <span class="main">↦</span> Member<span class="main">,</span> <span class="inner_quoted">''Employees''</span> <span class="main">↦</span> Member<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''internal subnet''</span>"</span></span>


  <span class="keyword1"><span class="command">subsubsection</span></span><span class="quoted"><span class="plain_text">‹The files server is only accessibly by employees›</span></span>
    <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">FilesSrvACL</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_CommunicationPartners <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''FilesSrv''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''Employees''</span><span class="main">]</span><span class="main">,</span>
                             <span class="inner_quoted">''Employees''</span> <span class="main">↦</span> Care<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''file srv acl''</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairSecurityRequirements</span> <span class="main">=</span> <span class="main">[</span>ConfidentialChairData<span class="main">,</span> PrintingACL<span class="main">,</span> PrintingSink<span class="main">,</span> InternalSubnet<span class="main">,</span> FilesSrvACL<span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set ChairSecurityRequirements<span class="main">.</span> implc_sinvar <span class="bound">m</span> ChairNetwork_empty"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"implc_get_offending_flows ChairSecurityRequirements ChairNetwork_empty"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"generate_valid_topology ChairSecurityRequirements ChairNetwork_empty"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"List.product <span class="main">(</span>nodesL ChairNetwork_empty<span class="main">)</span> <span class="main">(</span>nodesL ChairNetwork_empty<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork</span> <span class="main">=</span> generate_valid_topology ChairSecurityRequirements 
      <span class="main">⦇</span>nodesL <span class="main">=</span> nodesL ChairNetwork_empty<span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="main">(</span>nodesL ChairNetwork_empty<span class="main">)</span> <span class="main">(</span>nodesL ChairNetwork_empty<span class="main">)</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"ChairNetwork"</span></span>


<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"ChairSecurityRequirements"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"ChairNetwork"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork_stateful_IFS</span> <span class="main">=</span> <span class="main">⦇</span> hostsL <span class="main">=</span> nodesL ChairNetwork<span class="main">,</span> flows_fixL <span class="main">=</span> edgesL ChairNetwork<span class="main">,</span> flows_stateL <span class="main">=</span> filter_IFS_no_violations ChairNetwork ChairSecurityRequirements <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"edgesL ChairNetwork"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"filter_IFS_no_violations ChairNetwork ChairSecurityRequirements"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"ChairNetwork_stateful_IFS"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>flows_stateL ChairNetwork_stateful_IFS<span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>set <span class="main">(</span>flows_fixL ChairNetwork_stateful_IFS<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">(*must always hold*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="main">(</span>flows_fixL ChairNetwork_stateful_IFS<span class="main">)</span><span class="main">)</span> <span class="main">-</span> set <span class="main">(</span>flows_stateL ChairNetwork_stateful_IFS<span class="main">)</span>"</span></span>
<span class="comment1">(*only problems: printers!!!*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"stateful_list_policy_to_list_graph ChairNetwork_stateful_IFS"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>filter_IFS_no_violations ChairNetwork <span class="main">[</span>ConfidentialChairData<span class="main">]</span><span class="main">)</span> <span class="main">=</span> set <span class="main">(</span>edgesL ChairNetwork<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork_stateful_ACS</span> <span class="main">=</span> <span class="main">⦇</span> hostsL <span class="main">=</span> nodesL ChairNetwork<span class="main">,</span> flows_fixL <span class="main">=</span> edgesL ChairNetwork<span class="main">,</span> flows_stateL <span class="main">=</span> filter_compliant_stateful_ACS ChairNetwork ChairSecurityRequirements <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"edgesL ChairNetwork"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"filter_compliant_stateful_ACS ChairNetwork ChairSecurityRequirements"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"ChairNetwork_stateful_ACS"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>flows_stateL ChairNetwork_stateful_ACS<span class="main">)</span> <span class="main">⊆</span> <span class="main">(</span>set <span class="main">(</span>flows_fixL ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span> <span class="comment1">(*must always hold*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span>set <span class="main">(</span>flows_fixL ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span> <span class="main">-</span> set <span class="main">(</span>flows_stateL ChairNetwork_stateful_ACS<span class="main">)</span>"</span></span>

<span class="comment1">(*flows that are already allowed in both directions are not marked as stateful*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="main">(</span>set <span class="main">(</span>flows_fixL ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span> <span class="main">-</span> set <span class="main">(</span>flows_stateL ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span> <span class="main">-</span> set <span class="main">(</span>backlinks <span class="main">(</span>flows_fixL ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*the new backflows*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>stateful_list_policy_to_list_graph ChairNetwork_stateful_ACS<span class="main">)</span><span class="main">)</span> <span class="main">-</span> <span class="main">(</span>set <span class="main">(</span>edgesL ChairNetwork<span class="main">)</span><span class="main">)</span>"</span></span>

<span class="comment1">(*the resulting ACS graph*)</span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"stateful_list_policy_to_list_graph ChairNetwork_stateful_ACS"</span></span>


<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"generate_valid_stateful_policy_IFSACS ChairNetwork ChairSecurityRequirements"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"generate_valid_stateful_policy_IFSACS_2 ChairNetwork ChairSecurityRequirements"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>flows_fixL <span class="main">(</span>generate_valid_stateful_policy_IFSACS ChairNetwork ChairSecurityRequirements<span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       set <span class="main">(</span>flows_fixL <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 ChairNetwork ChairSecurityRequirements<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>flows_stateL <span class="main">(</span>generate_valid_stateful_policy_IFSACS ChairNetwork ChairSecurityRequirements<span class="main">)</span><span class="main">)</span> <span class="main">=</span>
       set <span class="main">(</span>flows_stateL <span class="main">(</span>generate_valid_stateful_policy_IFSACS_2 ChairNetwork ChairSecurityRequirements<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork_stateful</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS ChairNetwork ChairSecurityRequirements"</span></span>


<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL ChairNetwork_stateful"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL ChairNetwork_stateful"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>

<span class="comment1">(*these requirements impose no restrictoins on the stateful flows*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork_stateful_v2</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS ChairNetwork
    <span class="main">[</span>ConfidentialChairData<span class="main">,</span> PrintingACL<span class="main">,</span>  InternalSubnet<span class="main">,</span> FilesSrvACL<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL ChairNetwork_stateful_v2"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span>
     <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL ChairNetwork_stateful_v2"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>

<span class="comment1">(*The sink requirements imposes the restriction that the printer cannot answer*)</span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ChairNetwork_stateful_v3</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS ChairNetwork <span class="main">[</span>PrintingSink<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL ChairNetwork_stateful_v3"</span><span class="antiquote">}</span></span>
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL ChairNetwork_stateful_v3"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹An example of bad side-effects in access control policies›</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">ACL_not_with</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>string SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">ACL_not_with</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_ACLnotCommunicateWith_impl.SINVAR_LIB_ACLnotCommunicateWith <span class="main">⦇</span> 
        node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''A''</span> <span class="main">↦</span> <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''B''</span> <span class="main">↦</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''C''</span> <span class="main">↦</span> <span class="main">{}</span><span class="main">]</span>
        <span class="main">⦈</span> <span class="inner_quoted">''example: a must not reach C''</span>"</span></span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="entity">simple_network</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">simple_network</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''A''</span><span class="main">,</span> <span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''C''</span><span class="main">]</span><span class="main">,</span>
                      edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''A''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''C''</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph ChairNetwork_empty"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">∀</span><span class="bound">m</span> <span class="main">∈</span> set <span class="main">[</span>ACL_not_with<span class="main">]</span><span class="main">.</span> implc_sinvar <span class="bound">m</span> simple_network"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_get_offending_flows <span class="main">[</span>ACL_not_with<span class="main">]</span> simple_network <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_get_offending_flows <span class="main">[</span>ACL_not_with<span class="main">]</span> 
    <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''A''</span><span class="main">,</span> <span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''C''</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''A''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''C''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''A''</span><span class="main">,</span> <span class="inner_quoted">''B''</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="main">=</span>
      <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''C''</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''A''</span><span class="main">,</span> <span class="inner_quoted">''B''</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_get_offending_flows <span class="main">[</span>ACL_not_with<span class="main">]</span> 
    <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''A''</span><span class="main">,</span> <span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''C''</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''A''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''C''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C''</span><span class="main">,</span> <span class="inner_quoted">''B''</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="main">=</span>
      <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"generate_valid_stateful_policy_IFSACS simple_network <span class="main">[</span>ACL_not_with<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span> <span class="quoted"><span class="quoted">"generate_valid_stateful_policy_IFSACS_2 simple_network <span class="main">[</span>ACL_not_with<span class="main">]</span>"</span></span>








<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹performance test›</span></span>
<span class="comment1">(*6 minutes , about 1.8k edges in graph, most of the times, no requirements apply,
  simply added some nodes, edges to the chair network. topology is valid*)</span>
<span class="comment1">(*value "generate_valid_stateful_policy_IFSACS biggraph ChairSecurityRequirements"*)</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="CryptoDB">
<div class="head">
<h1>Theory CryptoDB</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹CryptoDB›</span></span>
<span class="keyword1"><span class="command">theory</span></span> CryptoDB
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Impl.html">../../TopoS_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="keyword2"><span class="keyword">case</span></span> !<span class="entity">Graphviz.open_viewer</span> <span class="keyword2"><span class="keyword">of</span></span>
    <span class="entity">OpenImmediately</span> <span class="main">=&gt;</span> <span class="entity">Graphviz.open_viewer</span> := <span class="entity">AskTimeouted</span> <span class="inner_numeral">3.0</span>
  <span class="main">|</span> <span class="entity">AskTimeouted</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">DoNothing</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">policy</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span>
                        <span class="inner_quoted">''A''</span><span class="main">,</span> <span class="inner_quoted">''A_encrypter''</span><span class="main">,</span> <span class="inner_quoted">''A_channel''</span><span class="main">,</span>
                        <span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''B_encrypter''</span><span class="main">,</span> <span class="inner_quoted">''B_channel''</span><span class="main">,</span>
                        <span class="inner_quoted">''C''</span><span class="main">,</span> <span class="inner_quoted">''C_encrypter''</span><span class="main">,</span> <span class="inner_quoted">''C_channel_in''</span><span class="main">,</span> <span class="inner_quoted">''C_channel_out''</span><span class="main">,</span> <span class="inner_quoted">''C_decrypter''</span><span class="main">,</span>
                        <span class="inner_quoted">''Adversary''</span><span class="main">,</span>
                        <span class="inner_quoted">''CryptoDB''</span><span class="main">]</span><span class="main">,</span>
              edgesL <span class="main">=</span> <span class="main">[</span>
              <span class="main">(</span><span class="inner_quoted">''A''</span><span class="main">,</span> <span class="inner_quoted">''A_encrypter''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''A_encrypter''</span><span class="main">,</span> <span class="inner_quoted">''A_channel''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''A_channel''</span><span class="main">,</span> <span class="inner_quoted">''CryptoDB''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''B''</span><span class="main">,</span> <span class="inner_quoted">''B_encrypter''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''B_encrypter''</span><span class="main">,</span> <span class="inner_quoted">''B_channel''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''B_channel''</span><span class="main">,</span> <span class="inner_quoted">''CryptoDB''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''C''</span><span class="main">,</span> <span class="inner_quoted">''C_encrypter''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C_encrypter''</span><span class="main">,</span> <span class="inner_quoted">''C_channel_out''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C_channel_out''</span><span class="main">,</span> <span class="inner_quoted">''CryptoDB''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''CryptoDB''</span><span class="main">,</span> <span class="inner_quoted">''C_channel_in''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C_channel_in''</span><span class="main">,</span> <span class="inner_quoted">''C_decrypter''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C_decrypter''</span><span class="main">,</span> <span class="inner_quoted">''C''</span><span class="main">)</span>
              <span class="main">]</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tainiting_host_attributes</span> <span class="main">≡</span> <span class="main">[</span>
                           <span class="inner_quoted">''A''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''A_encrypter''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''A_channel''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''B''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''B''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''B_encrypter''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{</span><span class="inner_quoted">''B''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''B_channel''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''C''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''C_encrypter''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''C_decrypter''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''C_channel_out''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''C_channel_in''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''Adversary''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{}</span>
                           <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>tainiting_host_attributes<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tainiting_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Tainting_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_TaintingTrusted <span class="main">⦇</span>
        node_properties <span class="main">=</span> tainiting_host_attributes <span class="main">⦈</span> <span class="inner_quoted">''user-data''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[]</span><span class="main">::</span>string SecurityInvariant list"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">A_host_attributes</span> <span class="main">≡</span>
                <span class="main">[</span><span class="inner_quoted">''A''</span> <span class="main">↦</span> Member<span class="main">,</span>
                 <span class="inner_quoted">''A_encrypter''</span> <span class="main">↦</span> Member<span class="main">,</span>
                 <span class="inner_quoted">''A_channel''</span> <span class="main">↦</span> Member
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom A_host_attributes <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> A_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SystemA_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant
                                  SINVAR_LIB_SubnetsInGW
                                    <span class="main">⦇</span> node_properties <span class="main">=</span> A_host_attributes <span class="main">⦈</span> <span class="inner_quoted">''sys-A''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">B_host_attributes</span> <span class="main">≡</span>
                <span class="main">[</span><span class="inner_quoted">''B''</span> <span class="main">↦</span> Member<span class="main">,</span>
                 <span class="inner_quoted">''B_encrypter''</span> <span class="main">↦</span> Member<span class="main">,</span>
                 <span class="inner_quoted">''B_channel''</span> <span class="main">↦</span> Member
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom B_host_attributes <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> B_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SystemB_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant
                                  SINVAR_LIB_SubnetsInGW
                                    <span class="main">⦇</span> node_properties <span class="main">=</span> B_host_attributes <span class="main">⦈</span> <span class="inner_quoted">''sys-B''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">C_host_attributes</span> <span class="main">≡</span>
                <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''C_channel_in''</span><span class="main">,</span> SystemBoundaryInput<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''C_decrypter''</span><span class="main">,</span> SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''C''</span><span class="main">,</span> SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''C_encrypter''</span><span class="main">,</span> SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''C_channel_out''</span><span class="main">,</span> SystemBoundaryOutput<span class="main">)</span>
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>map_of C_host_attributes<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> C_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SystemC_m</span> <span class="main">≡</span> new_meta_system_boundary C_host_attributes <span class="inner_quoted">''sys-C''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">invariants</span> <span class="main">≡</span> <span class="main">[</span>Tainting_m<span class="main">,</span> SystemA_m<span class="main">,</span> SystemB_m<span class="main">]</span> <span class="main">@</span> SystemC_m"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled invariants policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"implc_get_offending_flows invariants <span class="main">(</span>policy<span class="main">⦇</span> edgesL <span class="main">:=</span> edgesL policy<span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(</span>policy<span class="main">⦇</span> edgesL <span class="main">:=</span> edgesL policy<span class="main">⦈</span><span class="main">)</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">make_policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> SecurityInvariant<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">make_policy</span> <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">≡</span> generate_valid_topology <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span><span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">⦈</span>"</span></span>


<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹visualizing all flows which may not end at the adversary. I.e. things which are prohibited.›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edgesL policy"</span><span class="antiquote">}</span></span>
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span>
     <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">←</span>  List.product  <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">.</span>
     <span class="main">(</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>edgesL policy<span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e2</span> <span class="main">=</span> <span class="inner_quoted">''Adversary''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">≠</span> <span class="inner_quoted">''Adversary''</span><span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edgesL policy"</span><span class="antiquote">}</span></span>
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span>
     <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span>
                <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL policy<span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span>
›</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="IDEM">
<div class="head">
<h1>Theory IDEM</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹IDEM›</span></span>
<span class="keyword1"><span class="command">theory</span></span> IDEM
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Impl.html">../../TopoS_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="keyword2"><span class="keyword">case</span></span> !<span class="entity">Graphviz.open_viewer</span> <span class="keyword2"><span class="keyword">of</span></span>
    <span class="entity">OpenImmediately</span> <span class="main">=&gt;</span> <span class="entity">Graphviz.open_viewer</span> := <span class="entity">AskTimeouted</span> <span class="inner_numeral">3.0</span>
  <span class="main">|</span> <span class="entity">AskTimeouted</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">DoNothing</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">policy</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Logger''</span><span class="main">,</span>
                        <span class="inner_quoted">''Sensor_Controller''</span><span class="main">,</span>
                        <span class="inner_quoted">''P4S_in''</span><span class="main">,</span>
                        <span class="inner_quoted">''P4S_filter_A''</span><span class="main">,</span>
                        <span class="inner_quoted">''P4S_filter_B''</span><span class="main">,</span>
                        <span class="inner_quoted">''P4S_filter_C''</span><span class="main">,</span>
                        <span class="inner_quoted">''P4S_aggregator_C''</span><span class="main">,</span>
                        <span class="inner_quoted">''P4S_encrypt_A''</span><span class="main">,</span>
                        <span class="inner_quoted">''P4S_encrypt_B''</span><span class="main">,</span>
                        <span class="inner_quoted">''P4S_encrypt_C''</span><span class="main">,</span>
                        <span class="inner_quoted">''P4S_encrypt_C_low''</span><span class="main">,</span>
                        <span class="inner_quoted">''P4S_out''</span><span class="main">,</span>
                        <span class="inner_quoted">''P4S_DB''</span><span class="main">,</span>

                        <span class="inner_quoted">''Adversary''</span><span class="main">]</span><span class="main">,</span>
              edgesL <span class="main">=</span> <span class="main">[</span>
              <span class="main">(</span><span class="inner_quoted">''Logger''</span><span class="main">,</span> <span class="inner_quoted">''Sensor_Controller''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''Sensor_Controller''</span><span class="main">,</span> <span class="inner_quoted">''P4S_in''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''P4S_in''</span><span class="main">,</span>       <span class="inner_quoted">''P4S_filter_A''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''P4S_in''</span><span class="main">,</span>       <span class="inner_quoted">''P4S_filter_B''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''P4S_in''</span><span class="main">,</span>       <span class="inner_quoted">''P4S_filter_C''</span><span class="main">)</span><span class="main">,</span>

              <span class="main">(</span><span class="inner_quoted">''P4S_filter_A''</span>    <span class="main">,</span> <span class="inner_quoted">''P4S_encrypt_A''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''P4S_filter_B''</span>    <span class="main">,</span> <span class="inner_quoted">''P4S_encrypt_B''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''P4S_filter_C''</span>    <span class="main">,</span> <span class="inner_quoted">''P4S_encrypt_C''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''P4S_filter_C''</span>    <span class="main">,</span> <span class="inner_quoted">''P4S_aggregator_C''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''P4S_aggregator_C''</span><span class="main">,</span> <span class="inner_quoted">''P4S_encrypt_C_low''</span><span class="main">)</span><span class="main">,</span>

              <span class="main">(</span><span class="inner_quoted">''P4S_encrypt_A''</span>      <span class="main">,</span> <span class="inner_quoted">''P4S_out''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''P4S_encrypt_B''</span>      <span class="main">,</span> <span class="inner_quoted">''P4S_out''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''P4S_encrypt_C''</span>      <span class="main">,</span> <span class="inner_quoted">''P4S_out''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''P4S_encrypt_C_low''</span>  <span class="main">,</span> <span class="inner_quoted">''P4S_out''</span><span class="main">)</span><span class="main">,</span>

              <span class="main">(</span><span class="inner_quoted">''P4S_out''</span><span class="main">,</span> <span class="inner_quoted">''P4S_DB''</span><span class="main">)</span>
              <span class="main">]</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">tainiting_host_attributes</span> <span class="main">≡</span> <span class="main">[</span>
                           <span class="inner_quoted">''Logger''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">,</span><span class="inner_quoted">''B''</span><span class="main">,</span><span class="inner_quoted">''C''</span><span class="main">,</span><span class="inner_quoted">''D''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''Sensor_Controller''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">,</span><span class="inner_quoted">''B''</span><span class="main">,</span><span class="inner_quoted">''C''</span><span class="main">,</span><span class="inner_quoted">''D''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''P4S_in''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">,</span><span class="inner_quoted">''B''</span><span class="main">,</span><span class="inner_quoted">''C''</span><span class="main">,</span><span class="inner_quoted">''D''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''P4S_filter_A''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">}</span> <span class="main">{</span><span class="inner_quoted">''B''</span><span class="main">,</span><span class="inner_quoted">''C''</span><span class="main">,</span><span class="inner_quoted">''D''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''P4S_filter_B''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''B''</span><span class="main">}</span> <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">,</span><span class="inner_quoted">''C''</span><span class="main">,</span><span class="inner_quoted">''D''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''P4S_filter_C''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span> <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">,</span><span class="inner_quoted">''B''</span><span class="main">,</span><span class="inner_quoted">''D''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''P4S_aggregator_C''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''C_low''</span><span class="main">}</span> <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''P4S_encrypt_A''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''P4S_encrypt_B''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{</span><span class="inner_quoted">''B''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''P4S_encrypt_C''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span><span class="main">,</span>
                           <span class="inner_quoted">''P4S_encrypt_C_low''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span><span class="main">{</span><span class="inner_quoted">''C_low''</span><span class="main">}</span>
                           <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>tainiting_host_attributes<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> tainiting_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Tainting_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_TaintingTrusted <span class="main">⦇</span>
        node_properties <span class="main">=</span> tainiting_host_attributes <span class="main">⦈</span> <span class="inner_quoted">''critical energy data''</span> "</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">system_EMS</span> <span class="main">≡</span>
                <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''Logger''</span><span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''Sensor_Controller''</span><span class="main">,</span>  SystemBoundaryOutput<span class="main">)</span>
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom<span class="main">(</span>map_of system_EMS<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> system_EMS_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">system_EMS_m</span> <span class="main">≡</span> new_meta_system_boundary system_EMS <span class="inner_quoted">''EMS''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">system_P4S</span> <span class="main">≡</span>
                <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''P4S_in''</span><span class="main">,</span>  SystemBoundaryInput<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''P4S_filter_A''</span><span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''P4S_filter_B''</span><span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''P4S_filter_C''</span><span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''P4S_aggregator_C''</span><span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''P4S_encrypt_A''</span><span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''P4S_encrypt_B''</span><span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''P4S_encrypt_C''</span><span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''P4S_encrypt_C_low''</span><span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''P4S_out''</span><span class="main">,</span>  SystemBoundaryOutput<span class="main">)</span>
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom<span class="main">(</span>map_of system_P4S<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> system_P4S_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">system_P4S_m</span> <span class="main">≡</span> new_meta_system_boundary system_P4S <span class="inner_quoted">''P4S''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">system_P4Sstorage</span> <span class="main">≡</span>
                <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''P4S_DB''</span><span class="main">,</span>  SystemBoundaryInput<span class="main">)</span>
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom<span class="main">(</span>map_of system_P4Sstorage<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> system_P4Sstorage_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">system_P4Sstorage_m</span> <span class="main">≡</span> new_meta_system_boundary system_P4Sstorage <span class="inner_quoted">''P4S storage''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">invariants</span> <span class="main">≡</span> <span class="main">[</span>Tainting_m<span class="main">]</span> <span class="main">@</span> system_EMS_m <span class="main">@</span> system_P4S_m <span class="main">@</span>system_P4Sstorage_m"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled invariants policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"implc_get_offending_flows invariants <span class="main">(</span>policy<span class="main">⦇</span> edgesL <span class="main">:=</span> edgesL policy<span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="comment1">(*ML{*
visualize_graph @{context} @{term "invariants"} @{term "(policy⦇ edgesL := edgesL policy⦈)"};
*}*)</span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">tainiting_host_attributes</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">make_policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> SecurityInvariant<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">make_policy</span> <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">≡</span> generate_valid_topology <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span><span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">⦈</span>"</span></span>


<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edgesL policy"</span><span class="antiquote">}</span></span>
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span>
     <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">←</span>  List.product  <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">.</span>
     <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e2</span> <span class="main">=</span> <span class="inner_quoted">''Adversary''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">≠</span> <span class="inner_quoted">''Adversary''</span><span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span>
›</span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="MeasrDroid">
<div class="head">
<h1>Theory MeasrDroid</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span><span class="quoted"><span class="plain_text">‹Measr Droid›</span></span>
<span class="keyword1"><span class="command">theory</span></span> MeasrDroid
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Impl.html">../../TopoS_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="keyword2"><span class="keyword">case</span></span> !<span class="entity">Graphviz.open_viewer</span> <span class="keyword2"><span class="keyword">of</span></span>
    <span class="entity">OpenImmediately</span> <span class="main">=&gt;</span> <span class="entity">Graphviz.open_viewer</span> := <span class="entity">AskTimeouted</span> <span class="inner_numeral">3.0</span>
  <span class="main">|</span> <span class="entity">AskTimeouted</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">DoNothing</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Architecture Definition›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">policy</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span> <span class="comment1">― ‹SmartPhone A:›</span>
                         <span class="inner_quoted">''Sensors_A''</span><span class="main">,</span>
                         <span class="inner_quoted">''Encryption_A''</span><span class="main">,</span>
                         <span class="inner_quoted">''Client_A_out''</span><span class="main">,</span>

                         <span class="comment1">― ‹SmartPhone B:›</span>
                         <span class="inner_quoted">''Sensors_B''</span><span class="main">,</span>
                         <span class="inner_quoted">''Encryption_B''</span><span class="main">,</span>
                         <span class="inner_quoted">''Client_B_out''</span><span class="main">,</span>

                         <span class="comment1">― ‹SmartPhone C:›</span>
                         <span class="inner_quoted">''Sensors_C''</span><span class="main">,</span>
                         <span class="inner_quoted">''Encryption_C''</span><span class="main">,</span>
                         <span class="inner_quoted">''Client_C_out''</span><span class="main">,</span>

                         <span class="inner_quoted">''UploadDroid''</span><span class="main">,</span>

                         <span class="comment1">― ‹CollectDroid:›</span>
                         <span class="inner_quoted">''C3PO_in''</span><span class="main">,</span>
                         <span class="inner_quoted">''C3PO_Dec_A''</span><span class="main">,</span>
                         <span class="inner_quoted">''C3PO_Dec_B''</span><span class="main">,</span>
                         <span class="inner_quoted">''C3PO_Dec_C''</span><span class="main">,</span>
                         <span class="inner_quoted">''C3PO_Storage''</span><span class="main">,</span>

                         <span class="inner_quoted">''Adversary''</span><span class="main">]</span><span class="main">,</span>
              edgesL <span class="main">=</span> <span class="main">[</span>
              <span class="main">(</span><span class="inner_quoted">''Sensors_A''</span><span class="main">,</span>    <span class="inner_quoted">''Encryption_A''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''Encryption_A''</span><span class="main">,</span> <span class="inner_quoted">''Client_A_out''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''Client_A_out''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">,</span>

              <span class="main">(</span><span class="inner_quoted">''Sensors_B''</span><span class="main">,</span>    <span class="inner_quoted">''Encryption_B''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''Encryption_B''</span><span class="main">,</span> <span class="inner_quoted">''Client_B_out''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''Client_B_out''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">,</span>

              <span class="main">(</span><span class="inner_quoted">''Sensors_C''</span><span class="main">,</span>    <span class="inner_quoted">''Encryption_C''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''Encryption_C''</span><span class="main">,</span> <span class="inner_quoted">''Client_C_out''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''Client_C_out''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">,</span>

              <span class="comment1">⌦‹(''UploadDroid'', ''C3PO_in'')›</span>  <span class="comment1">― ‹C3PO pulls!›</span>
              <span class="main">(</span><span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">,</span>

              <span class="main">(</span><span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Dec_A''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Dec_B''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Dec_C''</span><span class="main">)</span><span class="main">,</span>

              <span class="main">(</span><span class="inner_quoted">''C3PO_Dec_A''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Storage''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''C3PO_Dec_B''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Storage''</span><span class="main">)</span><span class="main">,</span>
              <span class="main">(</span><span class="inner_quoted">''C3PO_Dec_C''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Storage''</span><span class="main">)</span>

              <span class="main">]</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Specification of Security Requirements›</span></span>


<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">taint_labels</span> <span class="main">≡</span> <span class="main">[</span>
                           <span class="inner_quoted">''Sensors_A''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''Sensors_B''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''B''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''Sensors_C''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>

                           <span class="inner_quoted">''Encryption_A''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">}</span> <span class="main">,</span>
                           <span class="inner_quoted">''Encryption_B''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{</span><span class="inner_quoted">''B''</span><span class="main">}</span> <span class="main">,</span>
                           <span class="inner_quoted">''Encryption_C''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{}</span> <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span> <span class="main">,</span>

                           <span class="inner_quoted">''C3PO_Dec_A''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''C3PO_Dec_B''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''B''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''C3PO_Dec_C''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span> <span class="main">{}</span> <span class="main">,</span>

                           <span class="inner_quoted">''C3PO_Storage''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">,</span><span class="inner_quoted">''B''</span><span class="main">,</span><span class="inner_quoted">''C''</span><span class="main">}</span> <span class="main">{}</span>

                           <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>taint_labels<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> taint_labels_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Tainting_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_TaintingTrusted <span class="main">⦇</span>
        node_properties <span class="main">=</span> taint_labels <span class="main">⦈</span> <span class="inner_quoted">''taint labels''</span>"</span></span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A convenient way to specify encryption and decryption pairs›</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">mk_Enc_Dec_pair</span>
    <span class="main">::</span> <span class="quoted"><span class="quoted">"string set <span class="main">⇒</span> <span class="main">(</span>SINVAR_TaintingTrusted.taints <span class="main">×</span> SINVAR_TaintingTrusted.taints<span class="main">)</span>"</span></span>
  <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">mk_Enc_Dec_pair</span> <span class="free"><span class="bound"><span class="entity">taints_to_be_encrypted</span></span></span> <span class="main">≡</span> <span class="main">(</span>TaintsUntaints <span class="main">{}</span> <span class="free"><span class="bound"><span class="entity">taints_to_be_encrypted</span></span></span><span class="main">,</span>
                                             TaintsUntaints <span class="free"><span class="bound"><span class="entity">taints_to_be_encrypted</span></span></span> <span class="main">{}</span><span class="main">)</span>"</span></span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"taint_labels <span class="main">=</span> <span class="main">(</span><span class="keyword1">let</span> <span class="main">(</span><span class="bound">Enc_A</span><span class="main">,</span> <span class="bound">Dec_A</span><span class="main">)</span> <span class="main">=</span> mk_Enc_Dec_pair <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">}</span><span class="main">;</span>
                             <span class="main">(</span><span class="bound">Enc_B</span><span class="main">,</span> <span class="bound">Dec_B</span><span class="main">)</span> <span class="main">=</span> mk_Enc_Dec_pair <span class="main">{</span><span class="inner_quoted">''B''</span><span class="main">}</span><span class="main">;</span>
                             <span class="main">(</span><span class="bound">Enc_C</span><span class="main">,</span> <span class="bound">Dec_C</span><span class="main">)</span> <span class="main">=</span> mk_Enc_Dec_pair <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span>
                       <span class="keyword1">in</span> <span class="main">[</span>
                           <span class="inner_quoted">''Sensors_A''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''Sensors_B''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''B''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>
                           <span class="inner_quoted">''Sensors_C''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''C''</span><span class="main">}</span> <span class="main">{}</span><span class="main">,</span>

                           <span class="inner_quoted">''Encryption_A''</span> <span class="main">↦</span> <span class="bound">Enc_A</span><span class="main">,</span>
                           <span class="inner_quoted">''Encryption_B''</span> <span class="main">↦</span> <span class="bound">Enc_B</span><span class="main">,</span>
                           <span class="inner_quoted">''Encryption_C''</span> <span class="main">↦</span> <span class="bound">Enc_C</span><span class="main">,</span>

                           <span class="inner_quoted">''C3PO_Dec_A''</span> <span class="main">↦</span> <span class="bound">Dec_A</span><span class="main">,</span>
                           <span class="inner_quoted">''C3PO_Dec_B''</span> <span class="main">↦</span> <span class="bound">Dec_B</span><span class="main">,</span>
                           <span class="inner_quoted">''C3PO_Dec_C''</span> <span class="main">↦</span> <span class="bound">Dec_C</span><span class="main">,</span>

                           <span class="inner_quoted">''C3PO_Storage''</span> <span class="main">↦</span> TaintsUntaints <span class="main">{</span><span class="inner_quoted">''A''</span><span class="main">,</span><span class="inner_quoted">''B''</span><span class="main">,</span><span class="inner_quoted">''C''</span><span class="main">}</span> <span class="main">{}</span>
                           <span class="main">]</span><span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> taint_labels_def mk_Enc_Dec_pair_def<span class="main">)</span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[]</span><span class="main">::</span>string SecurityInvariant list"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">smartphone_system_A</span> <span class="main">≡</span>
                <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''Client_A_out''</span> <span class="main">,</span>  SystemBoundaryOutput<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''Sensors_A''</span> <span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''Encryption_A''</span> <span class="main">,</span>  SystemComponent<span class="main">)</span>
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>map_of smartphone_system_A<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smartphone_system_A_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SystemA_m</span> <span class="main">≡</span> new_meta_system_boundary smartphone_system_A <span class="inner_quoted">''smartphone A''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">smartphone_system_B</span> <span class="main">≡</span>
                <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''Client_B_out''</span> <span class="main">,</span>  SystemBoundaryOutput<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''Sensors_B''</span> <span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''Encryption_B''</span> <span class="main">,</span>  SystemComponent<span class="main">)</span>
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom<span class="main">(</span>map_of smartphone_system_B<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smartphone_system_B_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SystemB_m</span> <span class="main">≡</span> new_meta_system_boundary smartphone_system_B <span class="inner_quoted">''smartphone B''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">smartphone_system_C</span> <span class="main">≡</span>
                <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''Client_C_out''</span> <span class="main">,</span>  SystemBoundaryOutput<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''Sensors_C''</span> <span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''Encryption_C''</span> <span class="main">,</span>  SystemComponent<span class="main">)</span>
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom<span class="main">(</span>map_of smartphone_system_C<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> smartphone_system_C_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SystemC_m</span> <span class="main">≡</span> new_meta_system_boundary smartphone_system_C <span class="inner_quoted">''smartphone C''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">system_C3PO</span> <span class="main">≡</span>
                <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''C3PO_in''</span> <span class="main">,</span>  SystemBoundaryOutput<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''C3PO_Dec_A''</span> <span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''C3PO_Dec_C''</span> <span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''C3PO_Dec_B''</span> <span class="main">,</span>  SystemComponent<span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''C3PO_Storage''</span> <span class="main">,</span>  SystemComponent<span class="main">)</span>
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom<span class="main">(</span>map_of system_C3PO<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> system_C3PO_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SystemC3PO_m</span> <span class="main">≡</span> new_meta_system_boundary system_C3PO <span class="inner_quoted">''C3PO''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Technically, the following definition does not impose any restrictions.
       Upload Droid must be reachable from anywhere, therefore it is an <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SystemBoundaryInput<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
       In addition, Upload Droid will maintain stateful connections with other entities.
       Therefore, we want to allow Upload Droid to send out any data, which also makes it an
       <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SystemBoundaryOutput<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
       ›</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">system_UploadDroid</span> <span class="main">≡</span>
                <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''UploadDroid''</span><span class="main">,</span>  SystemBoundaryInputOutput<span class="main">)</span>
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom<span class="main">(</span>map_of system_UploadDroid<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> system_UploadDroid_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SystemUploadDroid_m</span> <span class="main">≡</span> new_meta_system_boundary system_UploadDroid <span class="inner_quoted">''UploadDroid''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">invariants</span> <span class="main">≡</span> <span class="main">[</span>Tainting_m<span class="main">]</span> <span class="main">@</span> SystemA_m <span class="main">@</span> SystemB_m <span class="main">@</span> SystemC_m <span class="main">@</span> SystemC3PO_m <span class="main">@</span> SystemUploadDroid_m"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled invariants policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"implc_get_offending_flows invariants <span class="main">(</span>policy<span class="main">⦇</span> edgesL <span class="main">:=</span> edgesL policy<span class="main">⦈</span><span class="main">)</span>"</span></span>
<span class="comment1">(*ML{*
visualize_graph @{context} @{term "invariants"} @{term "(policy⦇ edgesL := (''Adversary'', ''C3PO_Storage'')#edgesL policy⦈)"};
*}*)</span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">taint_labels</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Analyzing the Policy›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">make_policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> SecurityInvariant<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">make_policy</span> <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">≡</span> generate_valid_topology <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span><span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">⦈</span>"</span></span>


<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL policy<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
We analyze the specification of our security invariants. The model includes a node <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Adversary''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
and we will analyze which interaction with an adversary are not prohibited by the requirements. 
Therefore, we generate a policy only from the security invariants and compare it to our manually designed policy.

We find the following flows which are allowed but which we did not consider in our policy 
 <span class="antiquoted"><span class="antiquoted">▪</span></span> All reflexive flows, i.e. every component can interact with itself. This is fine.
 <span class="antiquoted"><span class="antiquoted">▪</span></span> Within each smartphone, internally, arbitrary communication is possible. We cannot prevent this at a user's smartphone.
 <span class="antiquoted"><span class="antiquoted">▪</span></span> Every smartphone could send data to the adversary.
   It is important that this is generally allowed since we don't to put any restrictions on the
   Internet connectivity of a smartphone. 
   For example, this allows the smartphone user to surf facebook, which is not a trusted component in our system.
   The collected data is encrypted once it leaves the smartphone (via MeasrDroid), therefore, sensor data is not leaked.
 <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''C3PO_in''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> could send data to the adversary. At this point, the data is still encrypted.
   It would be possible to add an additional security invariant to make sure that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''C3PO_in''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
   only connects to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''UploadDroid''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
 <span class="antiquoted"><span class="antiquoted">▪</span></span> An adversary could send data to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''UploadDroid''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
   Since the system shall be accessible to any smartphone connected to the Internet, without authentication,
   we cannot prevent that a malicious user might send fake data.
 <span class="antiquoted"><span class="antiquoted">▪</span></span> The Upload Droid could send data to the adversary.
   This does not undermine the security concept because upload droid only stores encrypted data. 
   In fact, the security assumptions were from the very beginning that <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''UploadDroid''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can get compromised.
 <span class="antiquoted"><span class="antiquoted">▪</span></span> C3PO could directly save data in its database without decrypting.
   This is fine and might potentially be used in a future version for backups.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL policy<span class="main">)</span><span class="main">]</span> <span class="main">=</span>
 set <span class="main">[</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> v <span class="main">←</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">]</span> <span class="main">∪</span>
 <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''Encryption_A''</span><span class="main">,</span> <span class="inner_quoted">''Sensors_A''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Client_A_out''</span><span class="main">,</span> <span class="inner_quoted">''Sensors_A''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Client_A_out''</span><span class="main">,</span> <span class="inner_quoted">''Encryption_A''</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span>

 <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''Encryption_B''</span><span class="main">,</span> <span class="inner_quoted">''Sensors_B''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Client_B_out''</span><span class="main">,</span> <span class="inner_quoted">''Sensors_B''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Client_B_out''</span><span class="main">,</span> <span class="inner_quoted">''Encryption_B''</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span>

 <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''Encryption_C''</span><span class="main">,</span> <span class="inner_quoted">''Sensors_C''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Client_C_out''</span><span class="main">,</span> <span class="inner_quoted">''Sensors_C''</span><span class="main">)</span><span class="main">,</span>  <span class="main">(</span><span class="inner_quoted">''Client_C_out''</span><span class="main">,</span> <span class="inner_quoted">''Encryption_C''</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span>
 
 <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''Client_C_out''</span><span class="main">,</span> <span class="inner_quoted">''Adversary''</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="inner_quoted">''Client_B_out''</span><span class="main">,</span> <span class="inner_quoted">''Adversary''</span><span class="main">)</span><span class="main">,</span>
  <span class="main">(</span><span class="inner_quoted">''Client_A_out''</span><span class="main">,</span> <span class="inner_quoted">''Adversary''</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span>

 <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''Adversary''</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span>

 <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''Adversary''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span>

 <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''UploadDroid''</span><span class="main">,</span> <span class="inner_quoted">''Adversary''</span><span class="main">)</span><span class="main">}</span> <span class="main">∪</span>

 <span class="main">{</span><span class="main">(</span><span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Storage''</span><span class="main">)</span><span class="main">}</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹visualization›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edgesL policy"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#3399FF\", constraint=false]"</span><span class="main">,</span>
     <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL policy<span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹A visualization which shows all flows to the adversary which must NEVER happen
      (only considering taint labels, i.e. system boundaries are not considered).›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edgesL policy"</span><span class="antiquote">}</span></span>
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span>
     <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="bound">e1</span><span class="main">,</span> <span class="bound">e2</span><span class="main">)</span> <span class="main">←</span>  List.product  <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">.</span>
     <span class="main">(</span><span class="bound">e1</span><span class="main">,</span><span class="bound">e2</span><span class="main">)</span> <span class="main">∉</span> set <span class="main">(</span>edgesL <span class="main">(</span>make_policy <span class="main">[</span>Tainting_m<span class="main">]</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e2</span> <span class="main">=</span> <span class="inner_quoted">''Adversary''</span><span class="main">)</span> <span class="main">∧</span> <span class="main">(</span><span class="bound">e1</span> <span class="main">≠</span> <span class="inner_quoted">''Adversary''</span><span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We conclude that the security invariants adequately reflect all aspects of the system we wanted to specify.›</span></span>






<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹A stateful implementation›</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">stateful_policy</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS policy invariants"</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL stateful_policy"</span><span class="antiquote">}</span></span>
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL stateful_policy"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"stateful_policy <span class="main">=</span>
<span class="main">⦇</span>hostsL <span class="main">=</span>
    <span class="main">[</span><span class="inner_quoted">''Sensors_A''</span><span class="main">,</span> <span class="inner_quoted">''Encryption_A''</span><span class="main">,</span> <span class="inner_quoted">''Client_A_out''</span><span class="main">,</span> <span class="inner_quoted">''Sensors_B''</span><span class="main">,</span> <span class="inner_quoted">''Encryption_B''</span><span class="main">,</span> <span class="inner_quoted">''Client_B_out''</span><span class="main">,</span> <span class="inner_quoted">''Sensors_C''</span><span class="main">,</span>
     <span class="inner_quoted">''Encryption_C''</span><span class="main">,</span> <span class="inner_quoted">''Client_C_out''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Dec_A''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Dec_B''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Dec_C''</span><span class="main">,</span>
     <span class="inner_quoted">''C3PO_Storage''</span><span class="main">,</span> <span class="inner_quoted">''Adversary''</span><span class="main">]</span><span class="main">,</span>
    flows_fixL <span class="main">=</span>
      <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''Sensors_A''</span><span class="main">,</span> <span class="inner_quoted">''Encryption_A''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Encryption_A''</span><span class="main">,</span> <span class="inner_quoted">''Client_A_out''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Client_A_out''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Sensors_B''</span><span class="main">,</span> <span class="inner_quoted">''Encryption_B''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Encryption_B''</span><span class="main">,</span> <span class="inner_quoted">''Client_B_out''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Client_B_out''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Sensors_C''</span><span class="main">,</span> <span class="inner_quoted">''Encryption_C''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Encryption_C''</span><span class="main">,</span> <span class="inner_quoted">''Client_C_out''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Client_C_out''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Dec_A''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Dec_B''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Dec_C''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C3PO_Dec_A''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Storage''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''C3PO_Dec_B''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Storage''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''C3PO_Dec_C''</span><span class="main">,</span> <span class="inner_quoted">''C3PO_Storage''</span><span class="main">)</span><span class="main">]</span><span class="main">,</span>
    flows_stateL <span class="main">=</span>
      <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''Sensors_A''</span><span class="main">,</span> <span class="inner_quoted">''Encryption_A''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Encryption_A''</span><span class="main">,</span> <span class="inner_quoted">''Client_A_out''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Client_A_out''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Sensors_B''</span><span class="main">,</span> <span class="inner_quoted">''Encryption_B''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Encryption_B''</span><span class="main">,</span> <span class="inner_quoted">''Client_B_out''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Client_B_out''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Sensors_C''</span><span class="main">,</span> <span class="inner_quoted">''Encryption_C''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Encryption_C''</span><span class="main">,</span> <span class="inner_quoted">''Client_C_out''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Client_C_out''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''C3PO_in''</span><span class="main">,</span> <span class="inner_quoted">''UploadDroid''</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹A firewall for Collect Droid›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The firewall is installed at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''C3PO_in''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, this we only filter for the rules which affect this component.›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹

<span class="comment1">(*header*)</span>
writeln <span class="main">(</span><span class="inner_quoted">"# flush all rules"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"iptables -F"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"#default policy for FORWARD chain:"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"iptables -P INPUT DROP"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"iptables -P OUTPUT DROP"</span>^<span class="inner_quoted">"\n"</span>^
         <span class="inner_quoted">"iptables -P FORWARD DROP"</span><span class="main">)</span><span class="main">;</span>


writeln <span class="main">(</span><span class="inner_quoted">"# INPUT"</span>^<span class="inner_quoted">"\n"</span><span class="main">)</span><span class="main">;</span>
<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>  <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">←</span> flows_fixL stateful_policy<span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> <span class="inner_quoted">''C3PO_in''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"iptables -A INPUT -i $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_iface -s $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -o $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_iface -d $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT"</span>^<span class="inner_quoted">" # "</span>^<span class="entity">v1</span>^<span class="inner_quoted">" -&gt; "</span>^<span class="entity">v2</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>
<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">←</span> flows_stateL stateful_policy<span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="inner_quoted">''C3PO_in''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"iptables -I INPUT -m state --state ESTABLISHED -i $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_iface -s $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -o $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_iface -d $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT # "</span>^<span class="entity">v2</span>^<span class="inner_quoted">" -&gt; "</span>^<span class="entity">v1</span>^<span class="inner_quoted">" (answer)"</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>

writeln <span class="main">(</span><span class="inner_quoted">"# OUTPUT"</span>^<span class="inner_quoted">"\n"</span><span class="main">)</span><span class="main">;</span>
<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>  <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">←</span> flows_fixL stateful_policy<span class="main">.</span> <span class="bound">s</span> <span class="main">=</span> <span class="inner_quoted">''C3PO_in''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"iptables -A OUTPUT -i $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_iface -s $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -o $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_iface -d $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT"</span>^<span class="inner_quoted">" # "</span>^<span class="entity">v1</span>^<span class="inner_quoted">" -&gt; "</span>^<span class="entity">v2</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>
<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="main">(</span><span class="bound">s</span><span class="main">,</span><span class="bound">r</span><span class="main">)</span> <span class="main">←</span> flows_stateL stateful_policy<span class="main">.</span> <span class="bound">r</span> <span class="main">=</span> <span class="inner_quoted">''C3PO_in''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"iptables -I OUTPUT -m state --state ESTABLISHED -i $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_iface -s $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -o $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_iface -d $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT # "</span>^<span class="entity">v2</span>^<span class="inner_quoted">" -&gt; "</span>^<span class="entity">v1</span>^<span class="inner_quoted">" (answer)"</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="SINVAR_Examples">
<div class="head">
<h1>Theory SINVAR_Examples</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">theory</span></span> SINVAR_Examples
<span class="keyword2"><span class="keyword">imports</span></span>
  <a href="TopoS_Interface.html">TopoS_Interface</a>
  <a href="TopoS_Interface_impl.html">TopoS_Interface_impl</a>
  <a href="TopoS_Library.html">TopoS_Library</a>
  <a href="TopoS_Composition_Theory.html">TopoS_Composition_Theory</a>
  <a href="TopoS_Stateful_Policy.html">TopoS_Stateful_Policy</a>
  <a href="TopoS_Composition_Theory_impl.html">TopoS_Composition_Theory_impl</a>
  <a href="TopoS_Stateful_Policy_Algorithm.html">TopoS_Stateful_Policy_Algorithm</a>
  <a href="TopoS_Stateful_Policy_impl.html">TopoS_Stateful_Policy_impl</a>
  <a href="TopoS_Impl.html">TopoS_Impl</a>
<span class="keyword2"><span class="keyword">begin</span></span>


<span class="comment1">(*Instead of opening a lot of pdfs now, ask whether to open them first.
  If not clicked yes/no, it will wait 3 seconds until it continues.
  Don't change other settings!
  DoNothing must remain DoNothing for batch build.
  Changing this reference will change the behavior of all other theories! Careful with this one ;-)*)</span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="keyword2"><span class="keyword">case</span></span> !<span class="entity">Graphviz.open_viewer</span> <span class="keyword2"><span class="keyword">of</span></span>
    <span class="entity">OpenImmediately</span> <span class="main">=&gt;</span> <span class="entity">Graphviz.open_viewer</span> := <span class="entity">AskTimeouted</span> <span class="inner_numeral">3.0</span>
  <span class="main">|</span> <span class="entity">AskTimeouted</span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span>
  <span class="main">|</span> <span class="entity">DoNothing</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span>
›</span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">make_policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> SecurityInvariant<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">make_policy</span> <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">≡</span> generate_valid_topology <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">V</span></span></span><span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="free"><span class="bound"><span class="entity">V</span></span></span> <span class="main">⦈</span>"</span></span>



<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SINK_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_Sink <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Bot1''</span> <span class="main">↦</span> Sink<span class="main">,</span>
                             <span class="inner_quoted">''Bot2''</span> <span class="main">↦</span> Sink<span class="main">,</span>
                             <span class="inner_quoted">''MissionControl1''</span> <span class="main">↦</span> SinkPool<span class="main">,</span>
                             <span class="inner_quoted">''MissionControl2''</span> <span class="main">↦</span> SinkPool
                             <span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''bots and control are infromation sink''</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy <span class="main">[</span>SINK_m<span class="main">]</span> <span class="main">[</span><span class="inner_quoted">''INET''</span><span class="main">,</span> <span class="inner_quoted">''Supervisor''</span><span class="main">,</span> <span class="inner_quoted">''Bot1''</span><span class="main">,</span> <span class="inner_quoted">''Bot2''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>SINK_m<span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"make_policy <span class="main">[</span>SINK_m<span class="main">]</span> <span class="main">[</span><span class="inner_quoted">''INET''</span><span class="main">,</span> <span class="inner_quoted">''Supervisor''</span><span class="main">,</span> <span class="inner_quoted">''Bot1''</span><span class="main">,</span> <span class="inner_quoted">''Bot2''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="inner_quoted">''Bot1''</span> <span class="main">↦</span> Sink<span class="main">,</span>
             <span class="inner_quoted">''Bot2''</span> <span class="main">↦</span> Sink<span class="main">,</span>
             <span class="inner_quoted">''MissionControl1''</span> <span class="main">↦</span> SinkPool<span class="main">,</span>
             <span class="inner_quoted">''MissionControl2''</span> <span class="main">↦</span> SinkPool
             <span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>
<span class="keyword2"><span class="keyword">end</span></span>






<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ACL_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_CommunicationPartners <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''db1''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''h1''</span><span class="main">,</span> <span class="inner_quoted">''h2''</span><span class="main">]</span><span class="main">,</span>
                             <span class="inner_quoted">''db2''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''db1''</span><span class="main">]</span><span class="main">,</span>
                             <span class="inner_quoted">''h1''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''h2''</span> <span class="main">↦</span> Care
                             <span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''ACL for databases''</span>"</span></span> 
  <span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy <span class="main">[</span>ACL_m<span class="main">]</span> <span class="main">[</span><span class="inner_quoted">''db1''</span><span class="main">,</span> <span class="inner_quoted">''db2''</span><span class="main">,</span> <span class="inner_quoted">''h1''</span><span class="main">,</span> <span class="inner_quoted">''h2''</span><span class="main">,</span> <span class="inner_quoted">''h3''</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>ACL_m<span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"make_policy <span class="main">[</span>ACL_m<span class="main">]</span> <span class="main">[</span><span class="inner_quoted">''db1''</span><span class="main">,</span> <span class="inner_quoted">''db2''</span><span class="main">,</span> <span class="inner_quoted">''h1''</span><span class="main">,</span> <span class="inner_quoted">''h2''</span><span class="main">,</span> <span class="inner_quoted">''h3''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="inner_quoted">''db1''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''h1''</span><span class="main">,</span> <span class="inner_quoted">''h2''</span><span class="main">]</span><span class="main">,</span>
             <span class="inner_quoted">''db2''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''db1''</span><span class="main">]</span><span class="main">,</span>
             <span class="inner_quoted">''h1''</span> <span class="main">↦</span> Care<span class="main">,</span>
             <span class="inner_quoted">''h2''</span> <span class="main">↦</span> Care
             <span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>
<span class="keyword2"><span class="keyword">end</span></span>




<span class="keyword1"><span class="command">definition</span></span> <span class="entity">CommWith_m</span><span class="main">::</span><span class="quoted"><span class="quoted">"<span class="main">(</span>nat SecurityInvariant<span class="main">)</span>"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">CommWith_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_ACLcommunicateWith <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span>
                  <span class="main">1</span> <span class="main">↦</span> <span class="main">[</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>
                  <span class="numeral">2</span> <span class="main">↦</span> <span class="main">[</span><span class="numeral">3</span><span class="main">]</span><span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''One can only talk to 2,3''</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Experimental: the config (only one) can be added to the end.›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>CommWith_m<span class="main">]</span>"</span><span class="antiquote">}</span></span>
       <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span> <span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">]</span><span class="main">,</span>
                edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>
                  <span class="main">(</span><span class="main">1</span><span class="main">::</span>nat<span class="main">)</span> <span class="main">↦</span> <span class="main">[</span><span class="numeral">2</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>
                  <span class="numeral">2</span> <span class="main">↦</span> <span class="main">[</span><span class="numeral">3</span><span class="main">]</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy <span class="main">[</span>CommWith_m<span class="main">]</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"implc_offending_flows CommWith_m <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy <span class="main">[</span>CommWith_m<span class="main">]</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span>"</span></span>


<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span> new_configured_list_SecurityInvariant SINVAR_LIB_ACLcommunicateWith <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span>
                  <span class="main">1</span><span class="main">::</span>nat <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>
                  <span class="numeral">2</span> <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
                  <span class="numeral">3</span> <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
                  <span class="numeral">4</span> <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''usefull description here''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_offending_flows <span class="main">(</span>new_configured_list_SecurityInvariant SINVAR_LIB_ACLcommunicateWith <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span>
                  <span class="main">1</span><span class="main">::</span>nat <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>
                  <span class="numeral">2</span> <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
                  <span class="numeral">3</span> <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
                  <span class="numeral">4</span> <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''usefull description here''</span><span class="main">)</span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="main">=</span>
        <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>



<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">G_dep</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">G_dep</span> <span class="main">≡</span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span>
                                                       <span class="main">(</span><span class="numeral">4</span><span class="main">,</span><span class="numeral">5</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span><span class="numeral">6</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">6</span><span class="main">,</span><span class="numeral">7</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph G_dep"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">DEP_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_Dependability <span class="main">⦇</span> 
          node_properties <span class="main">=</span> Some <span class="main">∘</span> dependability_fix_nP G_dep <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>
          <span class="main">⦈</span> <span class="inner_quoted">''automatically computed dependability invariant''</span>"</span></span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>DEP_m<span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"G_dep"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Some <span class="main">∘</span> dependability_fix_nP G_dep <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Connecting <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">3</span></span><span class="main"><span class="main">,</span></span><span class="numeral"><span class="numeral">4</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. This causes only one offedning flow at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">3</span></span><span class="main"><span class="main">,</span></span><span class="numeral"><span class="numeral">4</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>DEP_m<span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"G_dep<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">#</span>edgesL G_dep<span class="main">⦈</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Some <span class="main">∘</span> dependability_fix_nP G_dep <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We try to increase the dependability level at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">3</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. Suddenly, offending flows everywhere.›</span></span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>new_configured_list_SecurityInvariant SINVAR_LIB_Dependability <span class="main">⦇</span> 
          node_properties <span class="main">=</span> Some <span class="main">∘</span> <span class="main">(</span><span class="main">(</span>dependability_fix_nP G_dep <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="numeral">3</span> <span class="main">:=</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
          <span class="main">⦈</span> <span class="inner_quoted">''changed deps''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"G_dep<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">#</span>edgesL G_dep<span class="main">⦈</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Some <span class="main">∘</span> <span class="main">(</span><span class="main">(</span>dependability_fix_nP G_dep <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="numeral">3</span> <span class="main">:=</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_offending_flows <span class="main">(</span>new_configured_list_SecurityInvariant SINVAR_LIB_Dependability <span class="main">⦇</span> 
                          node_properties <span class="main">=</span> Some <span class="main">∘</span> <span class="main">(</span><span class="main">(</span>dependability_fix_nP G_dep <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">(</span><span class="numeral">3</span> <span class="main">:=</span> <span class="numeral">2</span><span class="main">)</span><span class="main">)</span>
                          <span class="main">⦈</span> <span class="inner_quoted">''changed deps''</span><span class="main">)</span>
             <span class="main">(</span>G_dep<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">#</span>edgesL G_dep<span class="main">⦈</span><span class="main">)</span> <span class="main">=</span> 
           <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">5</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">5</span><span class="main">,</span> <span class="numeral">6</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹If we recompute the dependability levels for the changed graph, we see that suddenly, 
        The level at <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">2</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> increased, though we only added the edge <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">3</span></span><span class="main"><span class="main">,</span></span><span class="numeral"><span class="numeral">4</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.
        This hints that we connected the graph. If an attacker can now compromise <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, she 
        may be able to peek much deeper into the network.›</span></span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>new_configured_list_SecurityInvariant SINVAR_LIB_Dependability <span class="main">⦇</span> 
          node_properties <span class="main">=</span> Some <span class="main">∘</span> dependability_fix_nP <span class="main">(</span>G_dep<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">#</span>edgesL G_dep<span class="main">⦈</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>
          <span class="main">⦈</span> <span class="inner_quoted">''changed deps''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"G_dep<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">#</span>edgesL G_dep<span class="main">⦈</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Some <span class="main">∘</span> dependability_fix_nP <span class="main">(</span>G_dep<span class="main">⦇</span>edgesL <span class="main">:=</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">)</span><span class="main">#</span>edgesL G_dep<span class="main">⦈</span><span class="main">)</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Dependability is reflexive, a host can depend on itself.›</span></span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>new_configured_list_SecurityInvariant SINVAR_LIB_Dependability <span class="main">⦇</span> 
          node_properties <span class="main">=</span> Some <span class="main">∘</span> dependability_fix_nP <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>
          <span class="main">⦈</span> <span class="inner_quoted">''changed deps''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"Some <span class="main">∘</span> dependability_fix_nP <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">.</span> <span class="main">0</span><span class="main">)</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>new_configured_list_SecurityInvariant SINVAR_LIB_Dependability_norefl <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">::</span>nat<span class="main">.</span> Some <span class="main">0</span><span class="main">)</span>
          <span class="main">⦈</span> <span class="inner_quoted">''changed deps''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="main">1</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">(</span><span class="main">λ</span><span class="main"><span class="bound">_</span></span><span class="main">::</span>nat<span class="main">.</span> Some <span class="main">(</span><span class="main">0</span><span class="main">::</span>nat<span class="main">)</span><span class="main">)</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="entity">G_noninter</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"nat list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
    <span class="quoted"><span class="quoted">"<span class="free">G_noninter</span> <span class="main">≡</span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph G_noninter"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NonI_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_NonInterference <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span>
                  <span class="main">1</span><span class="main">::</span>nat <span class="main">↦</span> Interfering<span class="main">,</span>
                  <span class="numeral">2</span> <span class="main">↦</span> Unrelated<span class="main">,</span> 
                  <span class="numeral">3</span> <span class="main">↦</span> Unrelated<span class="main">,</span> 
                  <span class="numeral">4</span> <span class="main">↦</span> Interfering<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''One and Four interfere''</span>"</span></span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span> NonI_m <span class="main">]</span>"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"G_noninter"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

  <span class="comment1">(*The same as the CommWith example*)</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_offending_flows NonI_m G_noninter <span class="main">=</span> <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">3</span><span class="main">,</span> <span class="numeral">4</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span> NonI_m <span class="main">]</span>"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span>"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_offending_flows NonI_m <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="main">=</span>
    <span class="main">[</span><span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">,</span> <span class="main">[</span><span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span><span class="main">]</span>"</span></span>
           <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹In comparison, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SINVAR_LIB_ACLcommunicateWith<span class="antiquote"><span class="antiquote">}</span></span></span></span> is less strict. 
        Changing the direction of the edge <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="numeral"><span class="numeral">3</span></span><span class="main"><span class="main">,</span></span><span class="numeral"><span class="numeral">4</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> removes the access from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">1</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="numeral"><span class="quoted"><span class="numeral">4</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>
        and the invariant holds.›</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"implc_offending_flows <span class="main">(</span>new_configured_list_SecurityInvariant SINVAR_LIB_ACLcommunicateWith <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span>
                  <span class="main">1</span><span class="main">::</span>nat <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">]</span><span class="main">,</span>
                  <span class="numeral">2</span> <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
                  <span class="numeral">3</span> <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span>
                  <span class="numeral">4</span> <span class="main">↦</span> <span class="main">[</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''One must not access Four''</span><span class="main">)</span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="main">[</span><span class="main">1</span><span class="main">::</span>nat<span class="main">,</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">,</span><span class="numeral">4</span><span class="main">]</span><span class="main">,</span> edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">2</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="main">1</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">2</span><span class="main">,</span><span class="numeral">3</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="numeral">4</span><span class="main">,</span> <span class="numeral">3</span><span class="main">)</span><span class="main">]</span> <span class="main">⦈</span> <span class="main">=</span> <span class="main">[]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">subnets_host_attributes</span> <span class="main">≡</span> <span class="main">[</span>
                             <span class="inner_quoted">''v11''</span> <span class="main">↦</span> Subnet <span class="main">1</span><span class="main">,</span>
                             <span class="inner_quoted">''v12''</span> <span class="main">↦</span> Subnet <span class="main">1</span><span class="main">,</span>
                             <span class="inner_quoted">''v13''</span> <span class="main">↦</span> Subnet <span class="main">1</span><span class="main">,</span>
                             <span class="inner_quoted">''v1b''</span> <span class="main">↦</span> BorderRouter <span class="main">1</span><span class="main">,</span>
                             <span class="inner_quoted">''v21''</span> <span class="main">↦</span> Subnet <span class="numeral">2</span><span class="main">,</span>
                             <span class="inner_quoted">''v22''</span> <span class="main">↦</span> Subnet <span class="numeral">2</span><span class="main">,</span>
                             <span class="inner_quoted">''v23''</span> <span class="main">↦</span> Subnet <span class="numeral">2</span><span class="main">,</span>
                             <span class="inner_quoted">''v2b''</span> <span class="main">↦</span> BorderRouter <span class="numeral">2</span><span class="main">,</span>
                             <span class="inner_quoted">''v3b''</span> <span class="main">↦</span> BorderRouter <span class="numeral">3</span>
                             <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Subnets_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_Subnets <span class="main">⦇</span> 
          node_properties <span class="main">=</span> subnets_host_attributes
          <span class="main">⦈</span> <span class="inner_quoted">''Collaborating hosts''</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">subnet_hosts</span> <span class="main">≡</span> <span class="main">[</span><span class="inner_quoted">''v11''</span><span class="main">,</span> <span class="inner_quoted">''v12''</span><span class="main">,</span> <span class="inner_quoted">''v13''</span><span class="main">,</span> <span class="inner_quoted">''v1b''</span><span class="main">,</span>
                                      <span class="inner_quoted">''v21''</span><span class="main">,</span> <span class="inner_quoted">''v22''</span><span class="main">,</span> <span class="inner_quoted">''v23''</span><span class="main">,</span> <span class="inner_quoted">''v2b''</span><span class="main">,</span>
                                      <span class="inner_quoted">''v3b''</span><span class="main">,</span> <span class="inner_quoted">''vo''</span><span class="main">]</span>"</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>subnets_host_attributes<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>subnet_hosts<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> subnet_hosts_def subnets_host_attributes_def<span class="main">)</span>
  <span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy <span class="main">[</span>Subnets_m<span class="main">]</span> subnet_hosts"</span></span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>Subnets_m<span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"make_policy <span class="main">[</span>Subnets_m<span class="main">]</span> subnet_hosts"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"subnets_host_attributes"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Emulating the same but with accessible members with SubnetsInGW and ACLs›</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SubnetsInGW_ACL_ms</span> <span class="main">≡</span> <span class="main">[</span>new_configured_list_SecurityInvariant SINVAR_LIB_SubnetsInGW <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''v11''</span> <span class="main">↦</span> Member<span class="main">,</span> <span class="inner_quoted">''v12''</span> <span class="main">↦</span> Member<span class="main">,</span> <span class="inner_quoted">''v13''</span> <span class="main">↦</span> Member<span class="main">,</span> <span class="inner_quoted">''v1b''</span> <span class="main">↦</span> InboundGateway<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''v1 subnet''</span><span class="main">,</span>
          new_configured_list_SecurityInvariant SINVAR_LIB_CommunicationPartners <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''v1b''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''v11''</span><span class="main">,</span> <span class="inner_quoted">''v12''</span><span class="main">,</span> <span class="inner_quoted">''v13''</span><span class="main">,</span> <span class="inner_quoted">''v2b''</span><span class="main">,</span> <span class="inner_quoted">''v3b''</span><span class="main">]</span><span class="main">,</span>
                             <span class="inner_quoted">''v11''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''v12''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''v13''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''v2b''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''v3b''</span> <span class="main">↦</span> Care
                             <span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''v1b ACL''</span><span class="main">,</span>
          new_configured_list_SecurityInvariant SINVAR_LIB_SubnetsInGW <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''v21''</span> <span class="main">↦</span> Member<span class="main">,</span> <span class="inner_quoted">''v22''</span> <span class="main">↦</span> Member<span class="main">,</span> <span class="inner_quoted">''v23''</span> <span class="main">↦</span> Member<span class="main">,</span> <span class="inner_quoted">''v2b''</span> <span class="main">↦</span> InboundGateway<span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''v2 subnet''</span><span class="main">,</span>
          new_configured_list_SecurityInvariant SINVAR_LIB_CommunicationPartners <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''v2b''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''v21''</span><span class="main">,</span> <span class="inner_quoted">''v22''</span><span class="main">,</span> <span class="inner_quoted">''v23''</span><span class="main">,</span> <span class="inner_quoted">''v1b''</span><span class="main">,</span> <span class="inner_quoted">''v3b''</span><span class="main">]</span><span class="main">,</span>
                             <span class="inner_quoted">''v21''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''v22''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''v23''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''v1b''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''v3b''</span> <span class="main">↦</span> Care
                             <span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''v2b ACL''</span><span class="main">,</span>
          <span class="comment1">⌦‹new_configured_list_SecurityInvariant SINVAR_LIB_SubnetsInGW ⦇ 
          node_properties = [''v3b'' ↦ InboundGateway]
          ⦈ ''v3b'',›</span>
          new_configured_list_SecurityInvariant SINVAR_LIB_CommunicationPartners <span class="main">⦇</span> 
          node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''v3b''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''v1b''</span><span class="main">,</span> <span class="inner_quoted">''v2b''</span><span class="main">]</span><span class="main">,</span>
                             <span class="inner_quoted">''v1b''</span> <span class="main">↦</span> Care<span class="main">,</span>
                             <span class="inner_quoted">''v2b''</span> <span class="main">↦</span> Care
                             <span class="main">]</span>
          <span class="main">⦈</span> <span class="inner_quoted">''v3b ACL''</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy SubnetsInGW_ACL_ms subnet_hosts"</span></span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>make_policy <span class="main">[</span>Subnets_m<span class="main">]</span> subnet_hosts<span class="main">)</span><span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>edgesL <span class="main">(</span>make_policy SubnetsInGW_ACL_ms subnet_hosts<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">e</span> <span class="main">&lt;-</span> edgesL <span class="main">(</span>make_policy SubnetsInGW_ACL_ms subnet_hosts<span class="main">)</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL <span class="main">(</span>make_policy <span class="main">[</span>Subnets_m<span class="main">]</span> subnet_hosts<span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span>
   <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''v1b''</span><span class="main">,</span> <span class="inner_quoted">''v11''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''v1b''</span><span class="main">,</span> <span class="inner_quoted">''v12''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''v1b''</span><span class="main">,</span> <span class="inner_quoted">''v13''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''v2b''</span><span class="main">,</span> <span class="inner_quoted">''v21''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''v2b''</span><span class="main">,</span> <span class="inner_quoted">''v22''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''v2b''</span><span class="main">,</span> <span class="inner_quoted">''v23''</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"SubnetsInGW_ACL_ms"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"make_policy SubnetsInGW_ACL_ms subnet_hosts"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>
<span class="keyword2"><span class="keyword">end</span></span>




<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">secgwext_host_attributes</span> <span class="main">≡</span> <span class="main">[</span>
                             <span class="inner_quoted">''hypervisor''</span> <span class="main">↦</span> PolEnforcePoint<span class="main">,</span>
                             <span class="inner_quoted">''securevm1''</span> <span class="main">↦</span> DomainMember<span class="main">,</span>
                             <span class="inner_quoted">''securevm2''</span> <span class="main">↦</span> DomainMember<span class="main">,</span>
                             <span class="inner_quoted">''publicvm1''</span> <span class="main">↦</span> AccessibleMember<span class="main">,</span>
                             <span class="inner_quoted">''publicvm2''</span> <span class="main">↦</span> AccessibleMember
                             <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SecGwExt_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_PolEnforcePointExtended <span class="main">⦇</span> 
          node_properties <span class="main">=</span> secgwext_host_attributes
          <span class="main">⦈</span> <span class="inner_quoted">''secure hypervisor mediates accesses between secure VMs''</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">secgwext_hosts</span> <span class="main">≡</span> <span class="main">[</span><span class="inner_quoted">''hypervisor''</span><span class="main">,</span> <span class="inner_quoted">''securevm1''</span><span class="main">,</span> <span class="inner_quoted">''securevm2''</span><span class="main">,</span>
                                      <span class="inner_quoted">''publicvm1''</span><span class="main">,</span> <span class="inner_quoted">''publicvm2''</span><span class="main">,</span>
                                      <span class="inner_quoted">''INET''</span><span class="main">]</span>"</span></span>

  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>secgwext_host_attributes<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>secgwext_hosts<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> secgwext_hosts_def secgwext_host_attributes_def<span class="main">)</span>
  <span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy <span class="main">[</span>SecGwExt_m<span class="main">]</span> secgwext_hosts"</span></span>
  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>SecGwExt_m<span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"make_policy <span class="main">[</span>SecGwExt_m<span class="main">]</span> secgwext_hosts"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"secgwext_host_attributes"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

  <span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
  <span class="entity">visualize_graph_header</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span>SecGwExt_m<span class="main">,</span> new_configured_list_SecurityInvariant SINVAR_LIB_BLPtrusted <span class="main">⦇</span> 
        node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''hypervisor''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span><span class="main">,</span>
                           <span class="inner_quoted">''securevm1''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                           <span class="inner_quoted">''securevm2''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span>
                           <span class="main">]</span> <span class="main">⦈</span> <span class="inner_quoted">''secure vms are confidential''</span><span class="main">]</span>"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"make_policy <span class="main">[</span>SecGwExt_m<span class="main">,</span> new_configured_list_SecurityInvariant SINVAR_LIB_BLPtrusted <span class="main">⦇</span> 
        node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''hypervisor''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">0</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span><span class="main">,</span>
                           <span class="inner_quoted">''securevm1''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                           <span class="inner_quoted">''securevm2''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span>
                           <span class="main">]</span> <span class="main">⦈</span> <span class="inner_quoted">''secure vms are confidential''</span><span class="main">]</span> secgwext_hosts"</span><span class="antiquote">}</span></span>
    <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"secgwext_host_attributes"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword2"><span class="keyword">end</span></span>
</pre>
</div><div id="Imaginary_Factory_Network">
<div class="head">
<h1>Theory Imaginary_Factory_Network</h1>
</div>
<pre class="source"><span class="keyword1"><span class="command">section</span></span> <span class="quoted"><span class="plain_text">"Example: Imaginary Factory Network"</span></span>
<span class="keyword1"><span class="command">theory</span></span> Imaginary_Factory_Network
<span class="keyword2"><span class="keyword">imports</span></span> <span class="quoted">"<a href="TopoS_Impl.html">../TopoS_Impl</a>"</span>
<span class="keyword2"><span class="keyword">begin</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
In this theory, we give an an example of an imaginary factory network. 
The example was chosen to show the interplay of several security invariants 
and to demonstrate their configuration effort.

The specified security invariants deliberately include some minor specification problems. 
These problems will be used to demonstrate the inner workings of the algorithms and to visualize why 
some computed results will deviate from the expected results. 



The described scenario is an imaginary factory network. 
It consists of sensors and actuators in a cyber-physical system. 
The on-site production units of the factory are completely automated and there are no humans in the production area. 
Sensors are monitoring the building.
The production units are two robots (abbreviated bots) which manufacture the actual goods.
The robots are controlled by two control systems.

The network consists of the following hosts which are responsible for monitoring the building.

  <span class="antiquoted"><span class="antiquoted">▪</span></span> Statistics: A server which collects, processes, and stores all data from the sensors. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> SensorSink: A device which receives the data from the PresenceSensor, Webcam, TempSensor, and FireSensor.
                It sends the data to the Statistics server. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> PresenceSensor: A sensor which detects whether a human is in the building. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> Webcam: A camera which monitors the building indoors. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> TempSensor: A sensor which measures the temperature in the building. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> FireSensor: A sensor which detects fire and smoke. 


The following hosts are responsible for the production line. 

  <span class="antiquoted"><span class="antiquoted">▪</span></span> MissionControl1: An automation device which drives and controls the robots. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> MissionControl2: An automation device which drives and controls the robots. 
                     It contains the logic for a secret production step, carried out only by Robot2.
  <span class="antiquoted"><span class="antiquoted">▪</span></span> Watchdog: Regularly checks the health and technical readings of the robots. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> Robot1: Production robot unit 1. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> Robot2: Production robot unit 2. Does a secret production step. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> AdminPc: A human administrator can log into this machine to supervise or troubleshoot the production. 

We model one additional special host. 

  <span class="antiquoted"><span class="antiquoted">▪</span></span> INET: A symbolic host which represents all hosts which are not part of this network.


The security policy is defined below.
›</span></span>

<span class="keyword1"><span class="command">definition</span></span> <span class="entity">policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"string list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">policy</span> <span class="main">≡</span> <span class="main">⦇</span> nodesL <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''Statistics''</span><span class="main">,</span>
                        <span class="inner_quoted">''SensorSink''</span><span class="main">,</span>
                        <span class="inner_quoted">''PresenceSensor''</span><span class="main">,</span>
                        <span class="inner_quoted">''Webcam''</span><span class="main">,</span>
                        <span class="inner_quoted">''TempSensor''</span><span class="main">,</span>
                        <span class="inner_quoted">''FireSensor''</span><span class="main">,</span>
                        <span class="inner_quoted">''MissionControl1''</span><span class="main">,</span>
                        <span class="inner_quoted">''MissionControl2''</span><span class="main">,</span>
                        <span class="inner_quoted">''Watchdog''</span><span class="main">,</span>
                        <span class="inner_quoted">''Robot1''</span><span class="main">,</span>
                        <span class="inner_quoted">''Robot2''</span><span class="main">,</span>
                        <span class="inner_quoted">''AdminPc''</span><span class="main">,</span>
                        <span class="inner_quoted">''INET''</span><span class="main">]</span><span class="main">,</span>
              edgesL <span class="main">=</span> <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''PresenceSensor''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''Webcam''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''TempSensor''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''FireSensor''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''Statistics''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''MissionControl2''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span>
                        <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span>
                        <span class="main">]</span> <span class="main">⦈</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"wf_list_graph policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[]</span><span class="main">::</span>string SecurityInvariant list"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The idea behind the policy is the following.
The sensors on the left can all send their readings in an unidirectional fashion to the sensor sink, 
which forwards the data to the statistics server.
In the production line, on the right, all devices will set up stateful connections. 
This means, once a connection is established, packet exchange can be bidirectional. 
This makes sure that the watchdog will receive the health information from the robots, 
the mission control machines will receive the current state of the robots, and the administrator can actually log into the mission control machines. 
The policy should only specify who is allowed to set up the connections. 
We will elaborate on the stateful implementation in <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹../TopoS_Stateful_Policy.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span> 
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹../TopoS_Stateful_Policy_Algorithm.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>.›</span></span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Specification of Security Invariants›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Several security invariants are specified.›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Privacy for employees.
  The sensors in the building may record any employee. 
	Due to privacy requirements, the sensor readings, processing, and storage of the data is treated with high security levels. 
	The presence sensor does not allow do identify an individual employee, hence produces less critical data, hence has a lower level.
›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">BLP_privacy_host_attributes</span> <span class="main">≡</span> <span class="main">[</span><span class="inner_quoted">''Statistics''</span> <span class="main">↦</span> <span class="numeral">3</span><span class="main">,</span>
                           <span class="inner_quoted">''SensorSink''</span> <span class="main">↦</span> <span class="numeral">3</span><span class="main">,</span>
                           <span class="inner_quoted">''PresenceSensor''</span> <span class="main">↦</span> <span class="numeral">2</span><span class="main">,</span> <span class="comment1">― ‹less critical data›</span>
                           <span class="inner_quoted">''Webcam''</span> <span class="main">↦</span> <span class="numeral">3</span>
                           <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>BLP_privacy_host_attributes<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_privacy_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">BLP_privacy_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_BLPbasic <span class="main">⦇</span> 
        node_properties <span class="main">=</span> BLP_privacy_host_attributes <span class="main">⦈</span> <span class="inner_quoted">''confidential sensor data''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Secret corporate knowledge and intellectual property:
  The production process is a corporate trade secret. 
	The mission control devices have the trade secretes in their program. 
	The important and secret step is done by MissionControl2.
›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">BLP_tradesecrets_host_attributes</span> <span class="main">≡</span> <span class="main">[</span><span class="inner_quoted">''MissionControl1''</span> <span class="main">↦</span> <span class="main">1</span><span class="main">,</span>
                           <span class="inner_quoted">''MissionControl2''</span> <span class="main">↦</span> <span class="numeral">2</span><span class="main">,</span>
                           <span class="inner_quoted">''Robot1''</span> <span class="main">↦</span> <span class="main">1</span><span class="main">,</span>
                           <span class="inner_quoted">''Robot2''</span> <span class="main">↦</span> <span class="numeral">2</span>
                           <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>BLP_tradesecrets_host_attributes<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_tradesecrets_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">BLP_tradesecrets_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_BLPbasic <span class="main">⦇</span> 
        node_properties <span class="main">=</span> BLP_tradesecrets_host_attributes <span class="main">⦈</span> <span class="inner_quoted">''trade secrets''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Note that Invariant 1 and Invariant 2 are two distinct specifications. 
	They specify individual security goals independent of each other. 
	For example, in Invariant 1,<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''MissionControl2''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has the security level 
	<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">⊥</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and in Invariant 2, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''PresenceSensor''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has security level <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="main"><span class="quoted"><span class="main">⊥</span></span></span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
	Consequently, both cannot interact.
›</span></span>




<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Privacy for employees, exporting aggregated data:
  Monitoring the building while both ensuring privacy of the employees is an important goal for the company. 
	While the presence sensor only collects the single-bit information whether a human is present, the 
  webcam allows to identify individual employees. 
	The data collected by the presence sensor is classified as secret while the data produced by the webcam is top secret. 
	The sensor sink only has the secret security level, hence it is not allowed to process the 
  data generated by the webcam. 
	However, the sensor sink aggregates all data and only distributes a statistical average which does 
  not allow to identify individual employees. 
	It does not store the data over long periods. 
	Therefore, it is marked as trusted and may thus receive the webcam's data. 
	The statistics server, which archives all the data, is considered top secret.
›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">BLP_employee_export_host_attributes</span> <span class="main">≡</span>
                          <span class="main">[</span><span class="inner_quoted">''Statistics''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="numeral">3</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                           <span class="inner_quoted">''SensorSink''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="numeral">2</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span><span class="main">,</span>
                           <span class="inner_quoted">''PresenceSensor''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="numeral">2</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                           <span class="inner_quoted">''Webcam''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="numeral">3</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span>
                           <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>BLP_employee_export_host_attributes<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> BLP_employee_export_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">BLP_employee_export_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_BLPtrusted <span class="main">⦇</span> 
        node_properties <span class="main">=</span> BLP_employee_export_host_attributes <span class="main">⦈</span> <span class="inner_quoted">''employee data (privacy)''</span>"</span></span>
  <span class="comment1">(*TODO: what if Sensor sink were not trusted or had lower or higher level?*)</span>
<span class="keyword2"><span class="keyword">end</span></span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Who can access bot2?
  Robot2 carries out a mission-critical production step. 
	It must be made sure that Robot2 only receives packets from Robot1, the two mission control devices and the watchdog.
›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ACL_bot2_host_attributues</span> <span class="main">≡</span>
                          <span class="main">[</span><span class="inner_quoted">''Robot2''</span> <span class="main">↦</span> Master <span class="main">[</span><span class="inner_quoted">''Robot1''</span><span class="main">,</span>
                                                 <span class="inner_quoted">''MissionControl1''</span><span class="main">,</span>
                                                 <span class="inner_quoted">''MissionControl2''</span><span class="main">,</span>
                                                 <span class="inner_quoted">''Watchdog''</span><span class="main">]</span><span class="main">,</span>
                           <span class="inner_quoted">''MissionControl1''</span> <span class="main">↦</span> Care<span class="main">,</span>
                           <span class="inner_quoted">''MissionControl2''</span> <span class="main">↦</span> Care<span class="main">,</span>
                           <span class="inner_quoted">''Watchdog''</span> <span class="main">↦</span> Care
                           <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>ACL_bot2_host_attributues<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> ACL_bot2_host_attributues_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">ACL_bot2_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_CommunicationPartners
                             <span class="main">⦇</span>node_properties <span class="main">=</span> ACL_bot2_host_attributues <span class="main">⦈</span> <span class="inner_quoted">''Robot2 ACL''</span>"</span></span>
  <span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Note that Robot1 is in the access list of Robot2 but it does not have the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Care<span class="antiquote"><span class="antiquote">}</span></span></span></span> attribute. 
	This means, Robot1 can never access Robot2. 
	A tool could automatically detect such inconsistencies and emit a warning. 
	However, a tool should only emit a warning (not an error) because this setting can be desirable. 
	
	In our factory, this setting is currently desirable: 
	Three months ago, Robot1 had an irreparable hardware error and needed to be removed from the production line. 
	When removing Robot1 physically, all its host attributes were also deleted. 
	The access list of Robot2 was not changed. 
	It was planned that Robot1 will be replaced and later will have the same access rights again. 
	A few weeks later, a replacement for Robot1 arrived. 
	The replacement is also called Robot1. 
	The new robot arrived neither configured nor tested for the production. 
	After carefully testing Robot1, Robot1 has been given back the host attributes for the other security invariants. 
	Despite the ACL entry of Robot2, when Robot1 was added to the network, because of its missing <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Care<span class="antiquote"><span class="antiquote">}</span></span></span></span> attribute, 
	it was not given automatically access to Robot2. 
	This prevented that Robot1 would accidentally impact Robot2 without being fully configured. 
	In our scenario, once Robot1 will be fully configured, tested, and verified, it will be given the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Care<span class="antiquote"><span class="antiquote">}</span></span></span></span> attribute back. 
	
	In general, this design choice of the invariant template prevents that a newly added host may 
	inherit access rights due to stale entries in access lists. 
	At the same time, it does not force administrators to clean up their access lists because a host 
	may only be removed temporarily and wants to be given back its access rights later on. 
	Note that managing access lists scales quadratically in the number of hosts. 
	In contrast, the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> Care<span class="antiquote"><span class="antiquote">}</span></span></span></span> attribute can be considered as a Boolean flag which allows to 
	temporarily enable or disable the access rights of a host locally without touching the carefully 
	constructed access lists of other hosts. 
	It also prevents that new hosts which have the name of hosts removed long ago (but where stale 
	access rights were not cleaned up) accidentally inherit their access rights. 
›</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="comment1">(*TODO: dependability*)</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Hierarchy of fab robots:
  The production line is designed according to a strict command hierarchy. 
	On top of the hierarchy are control terminals which allow a human operator to intervene and supervise the production process. 
	On the level below, one distinguishes between supervision devices and control devices. 
	The watchdog is a typical supervision device whereas the mission control devices are control devices. 
	Directly below the control devices are the robots. 
	This is the structure that is necessary for the example. 
	However, the company defined a few more sub-departments for future use. 
	The full domain hierarchy tree is visualized below. 
›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
  Apart from the watchdog, only the following linear part of the tree is used: 
  <span class="antiquoted"><span class="raw_text"><span class="antiquoted"><span class="raw_text"><span class="operator"><span class="operator">‹</span></span>''Robots'' ⊑ ''ControlDevices'' ⊑ ''ControlTerminal''›</span></span></span></span>.
	Because the watchdog is in a different domain, it needs a trust level of $1$ to access the robots it is monitoring.›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">DomainHierarchy_host_attributes</span> <span class="main">≡</span>
                <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span>
                    DN <span class="main">(</span><span class="inner_quoted">''ControlTerminal''</span><span class="main">--</span><span class="inner_quoted">''ControlDevices''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''MissionControl2''</span><span class="main">,</span>
                    DN <span class="main">(</span><span class="inner_quoted">''ControlTerminal''</span><span class="main">--</span><span class="inner_quoted">''ControlDevices''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span>
                    DN <span class="main">(</span><span class="inner_quoted">''ControlTerminal''</span><span class="main">--</span><span class="inner_quoted">''Supervision''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">1</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''Robot1''</span><span class="main">,</span>
                    DN <span class="main">(</span><span class="inner_quoted">''ControlTerminal''</span><span class="main">--</span><span class="inner_quoted">''ControlDevices''</span><span class="main">--</span><span class="inner_quoted">''Robots''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''Robot2''</span><span class="main">,</span>
                    DN <span class="main">(</span><span class="inner_quoted">''ControlTerminal''</span><span class="main">--</span><span class="inner_quoted">''ControlDevices''</span><span class="main">--</span><span class="inner_quoted">''Robots''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span><span class="main">,</span>
                 <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span>
                    DN <span class="main">(</span><span class="inner_quoted">''ControlTerminal''</span><span class="main">--</span>Leaf<span class="main">,</span> <span class="main">0</span><span class="main">)</span><span class="main">)</span>
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom <span class="main">(</span>map_of DomainHierarchy_host_attributes<span class="main">)</span> <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> DomainHierarchy_host_attributes_def policy_def<span class="main">)</span>

  <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"DomainHierarchyNG_sanity_check_config
    <span class="main">(</span>map snd DomainHierarchy_host_attributes<span class="main">)</span>
        <span class="main">(</span>
        Department <span class="inner_quoted">''ControlTerminal''</span> <span class="main">[</span>
          Department <span class="inner_quoted">''ControlDevices''</span> <span class="main">[</span>
            Department <span class="inner_quoted">''Robots''</span> <span class="main">[]</span><span class="main">,</span>
            Department <span class="inner_quoted">''OtherStuff''</span> <span class="main">[]</span><span class="main">,</span>
            Department <span class="inner_quoted">''ThirdSubDomain''</span> <span class="main">[]</span>
          <span class="main">]</span><span class="main">,</span>
          Department <span class="inner_quoted">''Supervision''</span> <span class="main">[</span>
            Department <span class="inner_quoted">''S1''</span> <span class="main">[]</span><span class="main">,</span>
            Department <span class="inner_quoted">''S2''</span> <span class="main">[]</span>
          <span class="main">]</span>
        <span class="main">]</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Control_hierarchy_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant
                                    SINVAR_LIB_DomainHierarchyNG
                                    <span class="main">⦇</span> node_properties <span class="main">=</span> map_of DomainHierarchy_host_attributes <span class="main">⦈</span>
                                    <span class="inner_quoted">''Production device hierarchy''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Sensor Gateway: 
  The sensors should not communicate among each other; all accesses must be mediated by the sensor sink.›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">PolEnforcePoint_host_attributes</span> <span class="main">≡</span>
                <span class="main">[</span><span class="inner_quoted">''SensorSink''</span> <span class="main">↦</span> PolEnforcePoint<span class="main">,</span>
                 <span class="inner_quoted">''PresenceSensor''</span> <span class="main">↦</span> DomainMember<span class="main">,</span>
                 <span class="inner_quoted">''Webcam''</span> <span class="main">↦</span> DomainMember<span class="main">,</span>
                 <span class="inner_quoted">''TempSensor''</span> <span class="main">↦</span> DomainMember<span class="main">,</span>
                 <span class="inner_quoted">''FireSensor''</span> <span class="main">↦</span> DomainMember
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom PolEnforcePoint_host_attributes <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> PolEnforcePoint_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">PolEnforcePoint_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant
                                  SINVAR_LIB_PolEnforcePointExtended
                                    <span class="main">⦇</span> node_properties <span class="main">=</span> PolEnforcePoint_host_attributes <span class="main">⦈</span>
                                  <span class="inner_quoted">''sensor slaves''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Production Robots are an information sink:
  The actual control program of the robots is a corporate trade secret. 
	The control commands must not leave the robots. 
	Therefore, they are declared information sinks. 
	In addition, the control command must not leave the mission control devices. 
	However, the two devices could possibly interact to synchronize and they must send their commands to the robots. 
	Therefore, they are labeled as sink pools.›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SinkRobots_host_attributes</span> <span class="main">≡</span>
                <span class="main">[</span><span class="inner_quoted">''MissionControl1''</span> <span class="main">↦</span> SinkPool<span class="main">,</span>
                 <span class="inner_quoted">''MissionControl2''</span> <span class="main">↦</span> SinkPool<span class="main">,</span>
                 <span class="inner_quoted">''Robot1''</span> <span class="main">↦</span> Sink<span class="main">,</span>
                 <span class="inner_quoted">''Robot2''</span> <span class="main">↦</span> Sink
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom SinkRobots_host_attributes <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SinkRobots_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SinkRobots_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant
                                  SINVAR_LIB_Sink
                                    <span class="main">⦇</span> node_properties <span class="main">=</span> SinkRobots_host_attributes <span class="main">⦈</span>
                              <span class="inner_quoted">''non-leaking production units''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Subnet of the fab:
  The sensors, including their sink and statistics server are located in their own subnet and must 
  not be accessible from elsewhere. 
	Also, the administrator's PC is in its own subnet. 
	The production units (mission control and robots) are already isolated by the DomainHierarchy 
  and are not added to a subnet explicitly.›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Subnets_host_attributes</span> <span class="main">≡</span>
                <span class="main">[</span><span class="inner_quoted">''Statistics''</span> <span class="main">↦</span> Subnet <span class="main">1</span><span class="main">,</span>
                 <span class="inner_quoted">''SensorSink''</span> <span class="main">↦</span> Subnet <span class="main">1</span><span class="main">,</span>
                 <span class="inner_quoted">''PresenceSensor''</span> <span class="main">↦</span> Subnet <span class="main">1</span><span class="main">,</span>
                 <span class="inner_quoted">''Webcam''</span> <span class="main">↦</span> Subnet <span class="main">1</span><span class="main">,</span>
                 <span class="inner_quoted">''TempSensor''</span> <span class="main">↦</span> Subnet <span class="main">1</span><span class="main">,</span>
                 <span class="inner_quoted">''FireSensor''</span> <span class="main">↦</span> Subnet <span class="main">1</span><span class="main">,</span>
                 <span class="inner_quoted">''AdminPc''</span> <span class="main">↦</span> Subnet <span class="numeral">4</span>
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom Subnets_host_attributes <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> Subnets_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">Subnets_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant
                                  SINVAR_LIB_Subnets
                                    <span class="main">⦇</span> node_properties <span class="main">=</span> Subnets_host_attributes <span class="main">⦈</span>
                           <span class="inner_quoted">''network segmentation''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Access Gateway for the Statistics server:
  The statistics server is further protected from external accesses. 
	Another, smaller subnet is defined with the only member being the statistics server. 
	The only way it may be accessed is via that sensor sink.›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SubnetsInGW_host_attributes</span> <span class="main">≡</span>
                <span class="main">[</span><span class="inner_quoted">''Statistics''</span> <span class="main">↦</span> Member<span class="main">,</span>
                 <span class="inner_quoted">''SensorSink''</span> <span class="main">↦</span> InboundGateway
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom SubnetsInGW_host_attributes <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> SubnetsInGW_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">SubnetsInGW_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant
                                  SINVAR_LIB_SubnetsInGW
                                    <span class="main">⦇</span> node_properties <span class="main">=</span> SubnetsInGW_host_attributes <span class="main">⦈</span>
                               <span class="inner_quoted">''Protectting statistics srv''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹NonInterference (for the sake of example):
	The fire sensor is managed by an external company and has a built-in GSM module to call the fire fighters in case of an emergency. 
	This additional, out-of-band connectivity is not modeled. 
	However, the contract defines that the company's administrator must not interfere in any way with the fire sensor.›</span></span>
<span class="keyword1"><span class="command">context</span></span> <span class="keyword2"><span class="keyword">begin</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NonInterference_host_attributes</span> <span class="main">≡</span>
                <span class="main">[</span><span class="inner_quoted">''Statistics''</span> <span class="main">↦</span> Unrelated<span class="main">,</span>
                 <span class="inner_quoted">''SensorSink''</span> <span class="main">↦</span> Unrelated<span class="main">,</span>
                 <span class="inner_quoted">''PresenceSensor''</span> <span class="main">↦</span> Unrelated<span class="main">,</span>
                 <span class="inner_quoted">''Webcam''</span> <span class="main">↦</span> Unrelated<span class="main">,</span>
                 <span class="inner_quoted">''TempSensor''</span> <span class="main">↦</span> Unrelated<span class="main">,</span>
                 <span class="inner_quoted">''FireSensor''</span> <span class="main">↦</span> Interfering<span class="main">,</span> <span class="comment1">― ‹(!)›</span>
                 <span class="inner_quoted">''MissionControl1''</span> <span class="main">↦</span> Unrelated<span class="main">,</span>
                 <span class="inner_quoted">''MissionControl2''</span> <span class="main">↦</span> Unrelated<span class="main">,</span>
                 <span class="inner_quoted">''Watchdog''</span> <span class="main">↦</span> Unrelated<span class="main">,</span>
                 <span class="inner_quoted">''Robot1''</span> <span class="main">↦</span> Unrelated<span class="main">,</span>
                 <span class="inner_quoted">''Robot2''</span> <span class="main">↦</span> Unrelated<span class="main">,</span>
                 <span class="inner_quoted">''AdminPc''</span> <span class="main">↦</span> Interfering<span class="main">,</span> <span class="comment1">― ‹(!)›</span>
                 <span class="inner_quoted">''INET''</span> <span class="main">↦</span> Unrelated
                 <span class="main">]</span>"</span></span>
  <span class="keyword2"><span class="keyword">private</span></span> <span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"dom NonInterference_host_attributes <span class="main">⊆</span> set <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
    <span class="keyword1"><span class="command">by</span></span><span class="main">(</span><span class="operator">simp</span> <span class="quasi_keyword">add</span><span class="main"><span class="main">:</span></span> NonInterference_host_attributes_def policy_def<span class="main">)</span>
  <span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">NonInterference_m</span> <span class="main">≡</span> new_configured_list_SecurityInvariant SINVAR_LIB_NonInterference
                                    <span class="main">⦇</span> node_properties <span class="main">=</span> NonInterference_host_attributes <span class="main">⦈</span>
                                   <span class="inner_quoted">''for the sake of an acdemic example!''</span>"</span></span>
<span class="keyword2"><span class="keyword">end</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹As discussed, this invariant is very strict and rather theoretical. 
    It is not ENF-structured and may produce an exponential number of offending flows. 
    Therefore, we exclude it by default from our algorithms.›</span></span>




<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">invariants</span> <span class="main">≡</span> <span class="main">[</span>BLP_privacy_m<span class="main">,</span> BLP_tradesecrets_m<span class="main">,</span> BLP_employee_export_m<span class="main">,</span>
                          ACL_bot2_m<span class="main">,</span> Control_hierarchy_m<span class="main">,</span>
                          PolEnforcePoint_m<span class="main">,</span> SinkRobots_m<span class="main">,</span> Subnets_m<span class="main">,</span> SubnetsInGW_m<span class="main">]</span>"</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We have excluded <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> NonInterference_m<span class="antiquote"><span class="antiquote">}</span></span></span></span> because of its infeasible runtime.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"length invariants <span class="main">=</span> <span class="numeral">9</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Policy Verification›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The given policy fulfills all the specified security invariants.
Also with <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> NonInterference_m<span class="antiquote"><span class="antiquote">}</span></span></span></span>, the policy fulfills all security invariants.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled <span class="main">(</span>NonInterference_m<span class="main">#</span>invariants<span class="main">)</span> policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">ML</span></span><span class="quoted">‹
<span class="entity">visualize_graph</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"invariants"</span><span class="antiquote">}</span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"policy"</span><span class="antiquote">}</span></span><span class="main">;</span>
›</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">make_policy</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> SecurityInvariant<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">make_policy</span> <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">≡</span> generate_valid_topology <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span><span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">⦈</span>"</span></span>


<span class="keyword1"><span class="command">definition</span></span> <span class="entity">make_policy_efficient</span> <span class="main">::</span> <span class="quoted"><span class="quoted">"<span class="main">(</span><span class="tfree">'a</span> SecurityInvariant<span class="main">)</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list <span class="main">⇒</span> <span class="tfree">'a</span> list_graph"</span></span> <span class="keyword2"><span class="keyword">where</span></span>
  <span class="quoted"><span class="quoted">"<span class="free">make_policy_efficient</span> <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">≡</span> generate_valid_topology_some <span class="free"><span class="bound"><span class="entity">sinvars</span></span></span> <span class="main">⦇</span>nodesL <span class="main">=</span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span><span class="main">,</span> edgesL <span class="main">=</span> List.product <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="free"><span class="bound"><span class="entity">Vs</span></span></span> <span class="main">⦈</span>"</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The question, ``how good are the specified security invariants?'' remains. 
Therefore, we use the algorithm from <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> make_policy<span class="antiquote"><span class="antiquote">}</span></span></span></span> to generate a policy. 
Then, we will compare our policy with the automatically generated one. 
If we exclude the NonInterference invariant from the policy construction, we know that the resulting 
policy must be maximal. 
Therefore, the computed policy reflects the view of the specified security invariants. 
By maximality of the computed policy and monotonicity, we know that our manually specified policy 
must be a subset of the computed policy. 
This allows to compare the manually-specified policy to the policy implied by the security invariants: 
If there are too many flows which are allowed according to the computed policy but which are not in 
our manually-specified policy, we can conclude that our security invariants are not strict enough. 
›</span></span>
<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span> <span class="comment1">(*15s without NonInterference*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">=</span> 
   <span class="main">⦇</span>nodesL <span class="main">=</span>
    <span class="main">[</span><span class="inner_quoted">''Statistics''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''PresenceSensor''</span><span class="main">,</span> <span class="inner_quoted">''Webcam''</span><span class="main">,</span> <span class="inner_quoted">''TempSensor''</span><span class="main">,</span>
     <span class="inner_quoted">''FireSensor''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">,</span> <span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">,</span>
     <span class="inner_quoted">''Robot2''</span><span class="main">,</span> <span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">]</span><span class="main">,</span>
    edgesL <span class="main">=</span>
      <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''Statistics''</span><span class="main">,</span> <span class="inner_quoted">''Statistics''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''Statistics''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''Webcam''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''PresenceSensor''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''PresenceSensor''</span><span class="main">,</span> <span class="inner_quoted">''PresenceSensor''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Webcam''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Webcam''</span><span class="main">,</span> <span class="inner_quoted">''Webcam''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''TempSensor''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''TempSensor''</span><span class="main">,</span> <span class="inner_quoted">''TempSensor''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''TempSensor''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''FireSensor''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''FireSensor''</span><span class="main">,</span> <span class="inner_quoted">''FireSensor''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''FireSensor''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''MissionControl2''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''MissionControl2''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Watchdog''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Robot1''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''Robot2''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''Watchdog''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''AdminPc''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''INET''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Additional flows which would be allowed but which are not in the policy›</span></span>
<span class="keyword1"><span class="command">lemma</span></span>  <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL policy<span class="main">)</span><span class="main">]</span> <span class="main">=</span> 
        set <span class="main">[</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> v <span class="main">←</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">]</span> <span class="main">∪</span>
        set <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''Webcam''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''TempSensor''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''FireSensor''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''Watchdog''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
We visualize this comparison below. 
The solid edges correspond to the manually-specified policy. 
The dotted edges correspond to the flow which would be additionally permitted by the computed policy.›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edgesL policy"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span>
     <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span>
                <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL policy<span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The comparison reveals that the following flows would be additionally permitted. 
We will discuss whether this is acceptable or if the additional permission indicates that 
we probably forgot to specify an additional security goal. 


  <span class="antiquoted"><span class="antiquoted">▪</span></span> All reflexive flows, i.e. all host can communicate with themselves. 
    Since each host in the policy corresponds to one physical entity, there is no need to explicitly 
    prohibit or allow in-host communication. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''SensorSink''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may access the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Webcam''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
    Both share the same security level, there is no problem with this possible information flow. 
    Technically, a bi-directional connection may even be desirable, since this allows the sensor 
    sink to influence the video stream, e.g. request a lower bit rate if it is overloaded. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> Both the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''TempSensor''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''FireSensor''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may access the Internet. 
    No security levels or other privacy concerns are specified for them. 
    This may raise the question whether this data is indeed public. 
    It is up to the company to decide that this data should also be considered confidential. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''MissionControl1''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> can send to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''MissionControl2''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
    This may be desirable since it was stated anyway that the two may need to cooperate. 
    Note that the opposite direction is definitely prohibited since the critical and secret 
    production step only known to <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''MissionControl2''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> must not leak. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Watchdog''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> may access <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''MissionControl1''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''MissionControl2''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''INET''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
    While it may be acceptable that the watchdog which monitors the robots may also access the control devices, 
    it should raise a concern that the watchdog may freely send data to the Internet. 
    Indeed, the watchdog can access devices which have corporate trade secrets stored but it was 
    never specified that the watchdog should be treated confidentially. 
    Note that in the current setting, the trade secrets will never leave the robots. 
    This is because the policy only specifies a unidirectional information flow from the watchdog 
    to the robots; the robots will not leak any information back to the watchdog. 
    This also means that the watchdog cannot actually monitor the robots. 
    Later, when implementing the scenario, we will see that the simple, hand-waving argument 
    ``the watchdog connects to the robots and the robots send back their data over the established connection'' 
    will not work because of this possible information leak. 
  <span class="antiquoted"><span class="antiquoted">▪</span></span> The <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''AdminPc''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> is allowed to access the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Watchdog''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, 
    <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Robot1''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>, and the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''INET''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
    Since this machine is trusted anyway, the company does not see a problem with this. 
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹without <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> NonInterference_m<span class="antiquote"><span class="antiquote">}</span></span></span></span>›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled invariants <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>




<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Side note: what if we exclude subnets?›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span> <span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span>"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span>
     <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">‹<span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy <span class="main">[</span>BLP_privacy_m<span class="main">,</span> BLP_tradesecrets_m<span class="main">,</span> BLP_employee_export_m<span class="main">,</span>
                           ACL_bot2_m<span class="main">,</span> Control_hierarchy_m<span class="main">,</span>
                           PolEnforcePoint_m<span class="main">,</span> SinkRobots_m<span class="main">,</span> <span class="comment1">⌦‹Subnets_m,›</span> SubnetsInGW_m<span class="main">]</span>  <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span>
                <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>›</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>


<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹About NonInterference›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The NonInterference template was deliberately selected for our scenario as one of the 
`problematic' and rather theoretical invariants. 
Our framework allows to specify almost arbitrary invariant templates. 
We concluded that all non-ENF-structured invariants which may produce an exponential 
number of offending flows are problematic for practical use. 
This includes ``Comm. With'' (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹../Security_Invariants/SINVAR_ACLcommunicateWith.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>), 
``Not Comm. With'' (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹../Security_Invariants/SINVAR_ACLnotCommunicateWith.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>), 
Dependability (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹../Security_Invariants/SINVAR_Dependability.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>), 
and NonInterference (<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">file</span></span> ‹../Security_Invariants/SINVAR_NonInterference.thy›<span class="antiquote"><span class="antiquote">}</span></span></span></span>).
In this section, we discuss the consequences of the NonInterference invariant for automated policy construction. 
We will conclude that, though we can solve all technical challenges, said invariants are 
---due to their inherent ambiguity--- not very well suited for automated policy construction.›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The computed maximum policy does not fulfill invariant 10 (NonInterference). 
This is because the fire sensor and the administrator's PC may be indirectly connected over the Internet. 
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">¬</span> all_security_requirements_fulfilled <span class="main">(</span>NonInterference_m<span class="main">#</span>invariants<span class="main">)</span> <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Since the NonInterference template may produce an exponential number of offending flows, 
it is infeasible to try our automated policy construction algorithm with it. 
We have tried to do so on a machine with 128GB of memory but after a few minutes, the computation ran out of memory. 
On said machine, we were unable to run our policy construction algorithm with the NonInterference invariant for more that five hosts. 

Algorithm <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> make_policy_efficient<span class="antiquote"><span class="antiquote">}</span></span></span></span> improves the policy construction algorithm. 
The new algorithm instantly returns a solution for this scenario with a very small memory footprint. 
›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹The more efficient algorithm does not need to construct the complete set of offending flows›</span></span>
<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy_efficient <span class="main">(</span>invariants<span class="main">@</span><span class="main">[</span>NonInterference_m<span class="main">]</span><span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>
<span class="keyword1"><span class="command">value</span></span><span class="main">[</span>code<span class="main">]</span> <span class="quoted"><span class="quoted">"make_policy_efficient <span class="main">(</span>NonInterference_m<span class="main">#</span>invariants<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span>

<span class="comment1">(* only try this if you have more than 128GB ram. Let me know if you can finish the computation ;-)
   I could not do more than 5 nodes on a 128gb machine.
value[code] "make_policy (NonInterference_m#invariants) (nodesL policy)"
   NonInterference_m produces exponentially many offending flows
*)</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"make_policy_efficient <span class="main">(</span>invariants<span class="main">@</span><span class="main">[</span>NonInterference_m<span class="main">]</span><span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">=</span> 
       make_policy_efficient <span class="main">(</span>NonInterference_m<span class="main">#</span>invariants<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹But <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> NonInterference_m<span class="antiquote"><span class="antiquote">}</span></span></span></span> insists on removing something, which would not be necessary.›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span> <span class="main">≠</span> make_policy_efficient <span class="main">(</span>NonInterference_m<span class="main">#</span>invariants<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>make_policy_efficient <span class="main">(</span>NonInterference_m<span class="main">#</span>invariants<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span>
       <span class="main">⊆</span>
       set <span class="main">(</span>edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This is what it wants to be gone.›</span></span> <span class="comment1">(*may take some minutes*)</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span>
                <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL <span class="main">(</span>make_policy_efficient <span class="main">(</span>NonInterference_m<span class="main">#</span>invariants<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span>
       <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span>
        <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''Watchdog''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span> <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"<span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span>
               <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL <span class="main">(</span>make_policy_efficient <span class="main">(</span>NonInterference_m<span class="main">#</span>invariants<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span> <span class="main">=</span>
       <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span> fst <span class="bound">e</span> <span class="main">=</span> <span class="inner_quoted">''AdminPc''</span> <span class="main">∧</span> snd <span class="bound">e</span> <span class="main">≠</span> <span class="inner_quoted">''AdminPc''</span><span class="main">]</span>"</span></span>
  <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"edgesL policy"</span><span class="antiquote">}</span></span>
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span>
     <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"<span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span>
                <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL <span class="main">(</span>make_policy_efficient <span class="main">(</span>NonInterference_m<span class="main">#</span>invariants<span class="main">)</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span><span class="main">]</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
However, it is an inherent property of the NonInterferance template (and similar templates), 
that the set of offending flows is not uniquely defined. 
Consequently, since several solutions are possible, even our new algorithm may not be able to compute one maximum solution. 
It would be possible to construct some maximal solution, however, this would require to 
enumerate all offending flows, which is infeasible. 
Therefore, our algorithm can only return some (valid but probably not maximal) solution for non-END-structured invariants. 

As a human, we know the scenario and the intention behind the policy. 
Probably, the best solution for policy construction with the NonInterferance property would be to 
restrict outgoing edges from the fire sensor. 
If we consider the policy above which was constructed without NonInterference, if we cut off 
the fire sensor from the Internet, we get a valid policy for the NonInterference property. 
Unfortunately, an algorithm does not have the information of which flows we would like to cut first 
and the algorithm needs to make some choice. 
In this example, the algorithm decides to isolate the administrator's PC from the rest of the world. 
This is also a valid solution. 
We could change the order of the elements to tell the algorithm which edges we would rather sacrifice than others. 
This may help but requires some additional input. 
The author personally prefers to construct only maximum policies with $\Phi$-structured invariants 
and afterwards fix the policy manually for the remaining non-$\Phi$-structured invariants. 
Though our new algorithm gives better results and returns instantly, the very nature of invariant 
templates with an exponential number of offending flows tells that these invariants are problematic 
for automated policy construction. 
›</span></span>



<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Stateful Implementation›</span></span>
<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
In this section, we will implement the policy and deploy it in a network. 
As the scenario description stated, all devices in the production line should establish 
stateful connections which allows -- once the connection is established -- packets to travel in both directions. 
This is necessary for the watchdog, the mission control devices, and the administrator's PC to actually perform their task. 

We compute a stateful implementation. 
Below, the stateful implementation is visualized. 
It consists of the policy as visualized above. 
In addition, dotted edges visualize where answer packets are permitted. 
›</span></span>
<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">stateful_policy</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS policy invariants"</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"stateful_policy <span class="main">=</span>
 <span class="main">⦇</span>hostsL <span class="main">=</span> nodesL policy<span class="main">,</span>
    flows_fixL <span class="main">=</span> edgesL policy<span class="main">,</span>
    flows_stateL <span class="main">=</span>
      <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''Webcam''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''Statistics''</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL stateful_policy"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL stateful_policy"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span> 
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹As can be seen, only the flows <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="inner_quoted"><span class="inner_quoted">''Webcam''</span></span><span class="main"><span class="main">,</span></span> <span class="inner_quoted"><span class="inner_quoted">''SensorSink''</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> 
and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">(</span></span><span class="inner_quoted"><span class="inner_quoted">''SensorSink''</span></span><span class="main"><span class="main">,</span></span> <span class="inner_quoted"><span class="inner_quoted">''Statistics''</span></span><span class="main"><span class="main">)</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> are allowed to be stateful. 
This setup cannot be practically deployed because the watchdog, the mission control devices, 
and the administrator's PC also need to set up stateful connections. 
Previous section's discussion already hinted at this problem. 
The reason why the desired stateful connections are not permitted is due to information leakage. 
In detail: <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> BLP_tradesecrets_m<span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SinkRobots_m<span class="antiquote"><span class="antiquote">}</span></span></span></span> are responsible. 
Both invariants prevent that any data leaves the robots and the mission control devices. 
To verify this suspicion, the two invariants are removed and the stateful flows are computed again. 
The result visualized is below.›</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"generate_valid_stateful_policy_IFSACS policy
      <span class="main">[</span>BLP_privacy_m<span class="main">,</span> BLP_employee_export_m<span class="main">,</span>
       ACL_bot2_m<span class="main">,</span> Control_hierarchy_m<span class="main">,</span> 
       PolEnforcePoint_m<span class="main">,</span>  Subnets_m<span class="main">,</span> SubnetsInGW_m<span class="main">]</span> <span class="main">=</span>
 <span class="main">⦇</span>hostsL <span class="main">=</span> nodesL policy<span class="main">,</span>
    flows_fixL <span class="main">=</span> edgesL policy<span class="main">,</span>
    flows_stateL <span class="main">=</span>
      <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''Webcam''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''Statistics''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''MissionControl2''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹This stateful policy could be transformed into a fully functional implementation. 
However, there would be no security invariants specified which protect the trade secrets. 
Without those two invariants, the invariant specification is too permissive. 
For example, if we recompute the maximum policy, we can see that the robots and mission control can leak any data to the Internet. 
Even without the maximum policy, in the stateful policy above, it can be seen that 
MissionControl1 can exfiltrate information from robot 2, once it establishes a stateful connection.›</span></span>


<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Without the two invariants, the security goals are way too permissive!›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy <span class="main">[</span>BLP_privacy_m<span class="main">,</span> BLP_employee_export_m<span class="main">,</span>
       ACL_bot2_m<span class="main">,</span> Control_hierarchy_m<span class="main">,</span> 
       PolEnforcePoint_m<span class="main">,</span>  Subnets_m<span class="main">,</span> SubnetsInGW_m<span class="main">]</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL policy<span class="main">)</span><span class="main">]</span> <span class="main">=</span>
        set <span class="main">[</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> v <span class="main">←</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">]</span> <span class="main">∪</span>
        set <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''Webcam''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''TempSensor''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''FireSensor''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''Watchdog''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">]</span> <span class="main">∪</span>
        set <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''MissionControl2''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''MissionControl2''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''MissionControl2''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''Robot1''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''Robot2''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''Robot2''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹
<span class="entity">visualize_edges</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL <span class="main">(</span>generate_valid_stateful_policy_IFSACS policy <span class="main">[</span>BLP_privacy_m<span class="main">,</span>  BLP_employee_export_m<span class="main">,</span>
                          ACL_bot2_m<span class="main">,</span> Control_hierarchy_m<span class="main">,</span> 
                          PolEnforcePoint_m<span class="main">,</span>  Subnets_m<span class="main">,</span> SubnetsInGW_m<span class="main">]</span><span class="main">)</span>"</span><span class="antiquote">}</span></span> 
    <span class="main">[</span><span class="main">(</span><span class="inner_quoted">"edge [dir=\"arrow\", style=dashed, color=\"#FF8822\", constraint=false]"</span><span class="main">,</span>
      <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL <span class="main">(</span>generate_valid_stateful_policy_IFSACS policy <span class="main">[</span>BLP_privacy_m<span class="main">,</span>  BLP_employee_export_m<span class="main">,</span>
                          ACL_bot2_m<span class="main">,</span> Control_hierarchy_m<span class="main">,</span> 
                          PolEnforcePoint_m<span class="main">,</span>  Subnets_m<span class="main">,</span> SubnetsInGW_m<span class="main">]</span><span class="main">)</span>"</span><span class="antiquote">}</span></span><span class="main">)</span><span class="main">]</span> <span class="inner_quoted">""</span><span class="main">;</span>
›</span>



<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
Therefore, the two invariants are not removed but repaired. 
The goal is to allow the watchdog, administrator's pc, and the mission control devices to set up stateful connections without leaking corporate trade secrets to the outside. 

First, we repair <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> BLP_tradesecrets_m<span class="antiquote"><span class="antiquote">}</span></span></span></span>.
On the one hand, the watchdog should be able to send packets both <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Robot1''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Robot2''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Robot1''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has a security level of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>security_level"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> and 
<span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Robot2''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> has a security level of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">::</span></span>security_level"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
Consequently, in order to be allowed to send packets to both, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Watchdog''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> must 
have a security level not higher than <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>security_level"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
On the other hand, the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''Watchdog''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span> should be able to receive packets from both. 
By the same argument, it must have a security level of at least <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="numeral"><span class="numeral">2</span></span><span class="main"><span class="main">::</span></span>security_level"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
Consequently, it is impossible to express the desired meaning in the BLP basic template. 
There are only two solutions to the problem: Either the company installs one watchdog 
for each security level, or the watchdog must be trusted. 
We decide for the latter option and upgrade the template to the Bell LaPadula model with trust. 
We define the watchdog as trusted with a security level of <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="main"><span class="main">1</span></span><span class="main"><span class="main">::</span></span>security_level"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
This means, it can receive packets from and send packets to both robots but it cannot leak information to the outside world. 
We do the same for the <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">term</span></span> <span class="quoted"><span class="quoted">"<span class="inner_quoted"><span class="inner_quoted">''AdminPc''</span></span>"</span></span><span class="antiquote"><span class="antiquote">}</span></span></span></span>.

Then, we repair <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SinkRobots_m<span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
We realize that the following set set of hosts forms one big pool of devices which must all 
somehow interact but where information must not leave the pool: 
The administrator's PC, the mission control devices, the robots, and the watchdog. 
Therefore, all those devices are configured to be in the same <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">const</span></span> SinkPool<span class="antiquote"><span class="antiquote">}</span></span></span></span>. 
›</span></span>



<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">invariants_tuned</span> <span class="main">≡</span> <span class="main">[</span>BLP_privacy_m<span class="main">,</span> BLP_employee_export_m<span class="main">,</span>
               ACL_bot2_m<span class="main">,</span> Control_hierarchy_m<span class="main">,</span> 
               PolEnforcePoint_m<span class="main">,</span> Subnets_m<span class="main">,</span> SubnetsInGW_m<span class="main">,</span>
               new_configured_list_SecurityInvariant SINVAR_LIB_Sink
                 <span class="main">⦇</span> node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''MissionControl1''</span> <span class="main">↦</span> SinkPool<span class="main">,</span>
                                      <span class="inner_quoted">''MissionControl2''</span> <span class="main">↦</span> SinkPool<span class="main">,</span>
                                      <span class="inner_quoted">''Robot1''</span> <span class="main">↦</span> SinkPool<span class="main">,</span>
                                      <span class="inner_quoted">''Robot2''</span> <span class="main">↦</span> SinkPool<span class="main">,</span>
                                      <span class="inner_quoted">''Watchdog''</span> <span class="main">↦</span> SinkPool<span class="main">,</span>
                                      <span class="inner_quoted">''AdminPc''</span> <span class="main">↦</span> SinkPool
                                      <span class="main">]</span> <span class="main">⦈</span>
                 <span class="inner_quoted">''non-leaking production units''</span><span class="main">,</span>
               new_configured_list_SecurityInvariant SINVAR_LIB_BLPtrusted
                 <span class="main">⦇</span> node_properties <span class="main">=</span> <span class="main">[</span><span class="inner_quoted">''MissionControl1''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                                      <span class="inner_quoted">''MissionControl2''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="numeral">2</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                                      <span class="inner_quoted">''Robot1''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                                      <span class="inner_quoted">''Robot2''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="numeral">2</span><span class="main">,</span> trusted <span class="main">=</span> False <span class="main">⦈</span><span class="main">,</span>
                                      <span class="inner_quoted">''Watchdog''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span><span class="main">,</span>
                                        <span class="comment1">― ‹trust because <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>bot2›</span></span> must send to it. <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>security_level›</span></span> 1 to interact with <span class="antiquoted"><span class="raw_text"><span class="operator">‹</span>bot›</span></span> 1›</span>
                                      <span class="inner_quoted">''AdminPc''</span> <span class="main">↦</span> <span class="main">⦇</span> security_level <span class="main">=</span> <span class="main">1</span><span class="main">,</span> trusted <span class="main">=</span> True <span class="main">⦈</span>
                                      <span class="main">]</span> <span class="main">⦈</span>
                 <span class="inner_quoted">''trade secrets''</span>
              <span class="main">]</span>"</span></span>

<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"all_security_requirements_fulfilled invariants_tuned policy"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>


<span class="keyword1"><span class="command">definition</span></span> <span class="quoted"><span class="quoted">"<span class="free">stateful_policy_tuned</span> <span class="main">=</span> generate_valid_stateful_policy_IFSACS policy invariants_tuned"</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
The computed stateful policy is visualized below.
›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"stateful_policy_tuned
 <span class="main">=</span>
 <span class="main">⦇</span>hostsL <span class="main">=</span> nodesL policy<span class="main">,</span>
    flows_fixL <span class="main">=</span> edgesL policy<span class="main">,</span>
    flows_stateL <span class="main">=</span>
      <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''Webcam''</span><span class="main">,</span> <span class="inner_quoted">''SensorSink''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''Statistics''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''MissionControl2''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">,</span>
       <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''Robot2''</span><span class="main">)</span><span class="main">]</span><span class="main">⦈</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹We even get a better (i.e. stricter) maximum policy›</span></span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">(</span>edgesL <span class="main">(</span>make_policy invariants_tuned <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span> <span class="main">⊂</span>
       set <span class="main">(</span>edgesL <span class="main">(</span>make_policy invariants <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">)</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>
<span class="keyword1"><span class="command">lemma</span></span> <span class="quoted"><span class="quoted">"set <span class="main">[</span><span class="bound">e</span> <span class="main">←</span> edgesL <span class="main">(</span>make_policy invariants_tuned <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">)</span><span class="main">.</span> <span class="bound">e</span> <span class="main">∉</span> set <span class="main">(</span>edgesL policy<span class="main">)</span><span class="main">]</span> <span class="main">=</span>
        set <span class="main">[</span><span class="main">(</span><span class="bound">v</span><span class="main">,</span><span class="bound">v</span><span class="main">)</span><span class="main">.</span> v <span class="main">←</span> <span class="main">(</span>nodesL policy<span class="main">)</span><span class="main">]</span> <span class="main">∪</span>
        set <span class="main">[</span><span class="main">(</span><span class="inner_quoted">''SensorSink''</span><span class="main">,</span> <span class="inner_quoted">''Webcam''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''TempSensor''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''FireSensor''</span><span class="main">,</span> <span class="inner_quoted">''INET''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''MissionControl1''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl1''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''Watchdog''</span><span class="main">,</span> <span class="inner_quoted">''MissionControl2''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''Watchdog''</span><span class="main">)</span><span class="main">,</span>
             <span class="main">(</span><span class="inner_quoted">''AdminPc''</span><span class="main">,</span> <span class="inner_quoted">''Robot1''</span><span class="main">)</span><span class="main">]</span>"</span></span> <span class="keyword1"><span class="command">by</span></span> <span class="operator">eval</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹
It can be seen that all connections which should be stateful are now indeed stateful. 
In addition, it can be seen that MissionControl1 cannot set up a stateful connection to Bot2. 
This is because MissionControl1 was never declared a trusted device and the confidential information 
in MissionControl2 and Robot2 must not leak. 

The improved invariant definition even produces a better (i.e. stricter) maximum policy.›</span></span>

<span class="keyword1"><span class="command">subsection</span></span><span class="quoted"><span class="plain_text">‹Iptables Implementation›</span></span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹firewall -- classical use case›</span></span>
<span class="keyword1"><span class="command">ML_val</span></span><span class="quoted">‹

<span class="comment1">(*header*)</span>
writeln <span class="comment1">(*("echo 1 &gt; /proc/sys/net/ipv4/ip_forward"^"\n"^
         "# flush all rules"^"\n"^
         "iptables -F"^"\n"^
         "#default policy for FORWARD chain:"^"\n"^
         "iptables -P FORWARD DROP");*)</span>
         <span class="main">(</span><span class="inner_quoted">"*filter\n"</span>^
          <span class="inner_quoted">":INPUT ACCEPT [0:0]\n"</span>^
          <span class="inner_quoted">":FORWARD ACCEPT [0:0]\n"</span>^
          <span class="inner_quoted">":OUTPUT ACCEPT [0:0]"</span><span class="main">)</span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span>  <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_fixL stateful_policy_tuned"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"-A FORWARD -i $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_iface -s $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -o $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_iface -d $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT"</span><span class="main">)</span> <span class="main">)</span>
                         <span class="comment1">(*("iptables -A FORWARD -i $\\$\\mathit{"^v1^"\\_iface}$ -s $\\$\\mathit{"^
                          v1^"\\_ipv4}$ -o $\\$\\mathit{"^v2^"\\_iface}$ -d $\\$\\mathit{"^v2^"\\_ipv4}$ -j ACCEPT") )*)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>

<span class="entity">iterate_edges_ML</span> <span class="antiquoted"><span class="entity"><span class="antiquote">@{</span><span class="operator">context</span><span class="antiquote">}</span></span></span> <span class="antiquoted"><span class="antiquote">@{</span><span class="operator">term</span> <span class="quoted">"flows_stateL stateful_policy_tuned"</span><span class="antiquote">}</span></span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">(</span><span class="entity">v1</span><span class="main">,</span><span class="entity">v2</span><span class="main">)</span> <span class="main">=&gt;</span> writeln <span class="main">(</span><span class="inner_quoted">"-I FORWARD -m state --state ESTABLISHED -i $"</span>^<span class="entity">v2</span>^<span class="inner_quoted">"_iface -s $"</span>^
                          <span class="entity">v2</span>^<span class="inner_quoted">"_ipv4 -o $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_iface -d $"</span>^<span class="entity">v1</span>^<span class="inner_quoted">"_ipv4 -j ACCEPT"</span><span class="main">)</span> <span class="main">)</span>
                          <span class="comment1">(*("iptables -I FORWARD -m state --state ESTABLISHED -i $\\$\\mathit{"^
                           v2^"\\_iface}$ -s $\\$\\mathit{"^v2^"\\_ipv4}$ -o $\\$\\mathit{"^
                           v1^"\\_iface}$ -d $\\$\\mathit{"^v1^"_ipv4}$ -j ACCEPT # "^v2^" -&gt; "^v1^" (answer)") )*)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span>
  <span class="main">(</span><span class="keyword1"><span class="keyword">fn</span></span> <span class="main">_</span> <span class="main">=&gt;</span> <span class="main">(</span><span class="main">)</span> <span class="main">)</span><span class="main">;</span>

writeln <span class="inner_quoted">"COMMIT"</span><span class="main">;</span>
›</span>

<span class="keyword1"><span class="command">text</span></span><span class="quoted"><span class="plain_text">‹Using, <span class="antiquoted"><span class="antiquoted"><span class="antiquote"><span class="antiquote">@{</span></span><span class="operator"><span class="operator">url</span></span> "https://github.com/diekmann/Iptables_Semantics"<span class="antiquote"><span class="antiquote">}</span></span></span></span>, the iptables ruleset is indeed correct.›</span></span>

<span class="keyword2"><span class="keyword">end</span></span>


</pre>
</div>